fix_commit_hash,commit_hash,change_type,is_buggy_line,code_change_remove_common_tokens
2e990c354f49e505db04c4c415d1e6441c1cb17a,0f09adfad135eded197988c0acb681f6e635188c,added,0,merged[p].versions[v] = merged[p].versions[v] || {}
2e990c354f49e505db04c4c415d1e6441c1cb17a,0f09adfad135eded197988c0acb681f6e635188c,deleted,1,merged[p].versions[v] = merged[p][v] || {}
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", readInstalled = require(""./utils/read-installed"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", semver = require(""./utils/semver"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", [readAndLink, jsonFile, folder]"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"function readAndLink (jsonFile, folder, cb) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,readJson
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,( jsonFile
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", ""-1-LINK-""+("
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"crypto.createHash(""sha1"").update(folder).digest(""hex"").substr(0,8)"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,)
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", doLink(folder, cb)"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,}
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"function doLink (folder, cb) { return function (er, data) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,if (er) return cb(er)
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"log(data.name+"" ""+data.version, ""link"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"var pkgDir = path.join(npm.dir, data.name, data.version, ""package"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", deps = data.dependencies || {}"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", depNames = Array.isArray(deps) ? deps : Object.keys(deps)"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,if (Array.isArray(deps)) {
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,var o = {}
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"deps.forEach(function (d) { o[d] = ""*"" })"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,deps = o
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,// skip any that are installed
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"readInstalled(depNames, function (er, inst) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"if (er) return log.er(cb, ""Couldn't read installed packages"")(er)"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,for (var d in inst) {
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"var satis = semver.maxSatisfying(Object.keys(inst[d]), deps[d])"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,if (satis) delete deps[d]
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,var depsNeeded = Object.keys(deps).map(function (d) {
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"return d+""@""+deps[d]"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,})
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"log(depsNeeded, ""link install deps"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,chain
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"( [ npm.commands, ""install"", depsNeeded.slice(0) ]"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", [ require(""./utils/link""), folder, pkgDir ]"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", [ npm.commands, ""build"", [data] ]"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,", function (er) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,if (!er) return cb()
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"// error, rollback"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"log(er, ""error linking, rollback"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"var rb = depsNeeded.concat([data.name+""@""+data.version])"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"npm.commands.rm(rb, function (er_) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,"if (er_) log(er_, ""error rolling back"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,cb(er)
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,added,0,}}
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", pkg = {}"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", function (cb) { readJson"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,( jsonFile
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", ""-1-LINK-""+("
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,"crypto.createHash(""sha1"").update(folder).digest(""hex"").substr(0,8)"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,)
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", function (er, data) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,if (er) return cb(er)
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,"log(data.name+"" ""+data.version, ""link"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,pkg._data = data
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,cb()
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,}
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", function (cb) {"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,var data = pkg && pkg._data || pkg
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", pkgDir = path.join(npm.dir, data.name, data.version, ""package"")"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,"require(""./utils/link"")(folder, pkgDir, cb)"
b205a226e36ffcf47408cc4784061baaef867772,48106360d2f4de074947d27dde6d3d3115909e6c,deleted,1,", [npm.commands, ""build"", [pkg]]"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", readInstalled = require(""./utils/read-installed"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", semver = require(""./utils/semver"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", [readAndLink, jsonFile, folder]"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"function readAndLink (jsonFile, folder, cb) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,readJson
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,( jsonFile
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", ""-1-LINK-""+("
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"crypto.createHash(""sha1"").update(folder).digest(""hex"").substr(0,8)"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,)
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", doLink(folder, cb)"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,}
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"function doLink (folder, cb) { return function (er, data) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,if (er) return cb(er)
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"log(data.name+"" ""+data.version, ""link"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"var pkgDir = path.join(npm.dir, data.name, data.version, ""package"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", deps = data.dependencies || {}"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", depNames = Array.isArray(deps) ? deps : Object.keys(deps)"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,if (Array.isArray(deps)) {
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,var o = {}
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"deps.forEach(function (d) { o[d] = ""*"" })"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,deps = o
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,// skip any that are installed
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"readInstalled(depNames, function (er, inst) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"if (er) return log.er(cb, ""Couldn't read installed packages"")(er)"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,for (var d in inst) {
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"var satis = semver.maxSatisfying(Object.keys(inst[d]), deps[d])"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,if (satis) delete deps[d]
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,var depsNeeded = Object.keys(deps).map(function (d) {
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"return d+""@""+deps[d]"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,})
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"log(depsNeeded, ""link install deps"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,chain
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"( [ npm.commands, ""install"", depsNeeded.slice(0) ]"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", [ require(""./utils/link""), folder, pkgDir ]"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", [ npm.commands, ""build"", [data] ]"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,", function (er) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,if (!er) return cb()
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"// error, rollback"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"log(er, ""error linking, rollback"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"var rb = depsNeeded.concat([data.name+""@""+data.version])"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"npm.commands.rm(rb, function (er_) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,"if (er_) log(er_, ""error rolling back"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,cb(er)
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,added,0,}}
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", pkg = {}"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", function (cb) { readJson"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,( jsonFile
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", ""-1-LINK-""+("
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,"crypto.createHash(""sha1"").update(folder).digest(""hex"").substr(0,8)"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,)
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", function (er, data) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,if (er) return cb(er)
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,"log(data.name+"" ""+data.version, ""link"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,pkg._data = data
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,cb()
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,}
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", function (cb) {"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,var data = pkg && pkg._data || pkg
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", pkgDir = path.join(npm.dir, data.name, data.version, ""package"")"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,"require(""./utils/link"")(folder, pkgDir, cb)"
b205a226e36ffcf47408cc4784061baaef867772,1a0fb065b6a28ce54e6c4960c884972d1aaa2ea0,deleted,1,", [npm.commands, ""build"", [pkg]]"
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,added,0,switch (f) {
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,added,0,"case ""true"": f = true; break"
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,added,0,"case ""false"": f = false; break"
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,added,0,"case ""null"": f = null; break"
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,added,0,"case ""undefined"": f = undefined; break"
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,deleted,1,"if (f === '""true""' || f === '""false""' || f === '""null""' || f === '""undefined""') {"
dad6d3998e55d054f5148851307c2a0bdc8f6fd9,54afc83b94732247562209211b206f145958c36d,deleted,1,return JSON.parse(f)
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,d[a] = cleanup(data)
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,function cleanup (data) {
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,Object.keys(data).forEach(function (d) {
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,switch (d) {
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"case ""author"":"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,data[d] = unparsePerson(data[d])
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,break
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"case ""contributors"":"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"case ""maintainers"":"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,data[d] = data[d].map(unparsePerson)
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,default:
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"if (d.charAt(0) === ""_"") delete data[d]"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"else if (typeof data[d] === ""object"") cleanup(data[d])"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,}
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,})
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,return data
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,function unparsePerson (d) {
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"if (typeof d === ""string"") return d"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,return d.name
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"+ (d.email ? "" <""+d.email+"">"" : """")"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"+ (d.url ? "" (""+d.url+"")"" : """")"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"log(d.replace(/\//, '@'), ""view"")"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"process.stdout.write(sys.inspect(data[d],false,5,true))"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"process.stdout.write(""\n"")"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,process.stdout.flush()
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,added,0,"setTimeout(cb,100)"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,deleted,1,d[a] = data
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,deleted,1,"log(d.replace(/\//, '@'), ""view "")"
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,deleted,1,process.stdout.write(sys.inspect(data[d]))
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,deleted,1,process.stdout.flush()
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,deleted,1,cb()
0092af7070aa6d86fc54b7de0c6fb02c5ae3fccf,34692d00a49a9d186f04e5f4935039e1cabfd948,deleted,1,}
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,"function exec (cmd, args, env, takeOver, cwd, cb) {"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,"if (typeof cb !== ""function"") cb = cwd, cwd = process.cwd()"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,"if (typeof cb !== ""function"") cb = takeOver, takeOver = true"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,"if (typeof cb !== ""function"") cb = env, env = process.env"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,", cp = spawn(cmd, args, env, takeOver, cwd)"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,"function spawn (c, a, env, takeOver, cwd) {"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,", opts = { customFds : takeOver ? fds : [-1,-1,-1]"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,", env : env || process.env"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,", cwd : cwd || process.cwd()"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,}
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,added,0,", cp = child_process.spawn(c, a, opts)"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,"function exec (cmd, args, env, takeOver, cb) {"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,"if (!cb) cb = takeOver, takeOver = true"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,"if (!cb) cb = env, env = process.env"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,", cp = spawn(cmd, args, env, takeOver)"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,"function spawn (c, a, env, takeOver) {"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,", cp = child_process.spawn( c"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,", a"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,", env"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,", takeOver ? fds : null"
324d9a803b667658cd8f4c760cbb27f4bd951a20,24663af147912749219ad24c1c25e4c956f091c9,deleted,1,)
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"// must rebuild bundles serially, because it messes with configs."
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,", [chain].concat(args.map(function (a) { return [rebuildBundle, a] }))"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"log.verbose([pkg, deps], ""deps being resolved"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,", depBin = path.join(npm.dir, pkg.name, pkg.version, ""dep-bin"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"}, function (dep, cb) {"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"// link the bins to this pkg's ""dep-bin"" folder."
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"linkBins(dep, depBin, false, cb)"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"function linkBins (pkg, binroot, versioned, cb) {"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"if (typeof cb !== ""function"") cb = versioned, versioned = true"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"if (typeof cb !== ""function"") cb = binroot, binroot = null"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,if (!binroot) {
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"binroot = binroot || npm.config.get(""binroot"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,if (binroot &&
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,(!process.env.PATH || -1 === process.env.PATH.indexOf(binroot))) {
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"log.warn(""bins installing to ""+binroot+"", outside PATH"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,}
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,if (!binroot) return cb()
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"var dep = path.join(npm.dir, pkg.name, pkg.version, ""node_modules"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,added,0,"var to = path.join(binroot, i+(versioned ? ""@""+pkg.version : """"))"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,"// must rebuild bundles synchronously, because it messes with configs."
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,", [chain].concat(args.map(function (a) { return function (cb) {"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,"rebuildBundle(a, cb)"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,}}))
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,"function linkBins (pkg, cb) {"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,"var binroot = npm.config.get(""binroot"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,", dep = path.join(npm.dir, pkg.name, pkg.version, ""node_modules"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,if (!binroot) return cb()
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,if (!process.env.PATH || -1 === process.env.PATH.indexOf(binroot)) {
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,"log.warn(""bins installing to ""+binroot+"", outside PATH"")"
70464378e980cc348cd7dc6b635bbcf6e789c1ce,0890253bd72753fdfd07fa78d7c41c4daf6110b6,deleted,1,"var to = path.join(binroot, i+""@""+pkg.version)"
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,added,0,var descs = remote[p].descriptions
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,added,0,if (descs && descs[v] && descs[v] !== remote[p].description) {
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,added,0,merged[p].versions[v].description = descs[v]
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,added,0,}
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,added,0,"if (remote[p][""dist-tags""][tag] === v) {"
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,added,0,merged[p].versions[v].tags.push(tag)
61d522796ea807bc2e01746c54fae43fc2feacb0,0f09adfad135eded197988c0acb681f6e635188c,deleted,1,"if (remote[p][""dist-tags""][tag] === v) merged[p].versions[v].tags.push(tag)"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"function lifecycle (pkg, stage, wd, unsafe, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"if (typeof cb !== ""function"") cb = unsafe, unsafe = false"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"if (typeof cb !== ""function"") cb = wd, wd = null"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"unsafe = unsafe || npm.config.get(""unsafe-perm"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,&& !unsafe && pkg.scripts[stage]) {
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"lifecycle_(pkg, stage, wd, env, unsafe, cb)"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"function lifecycle_ (pkg, stage, wd, env, unsafe, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"( packageLifecycle && [runPackageLifecycle, pkg, env, wd, unsafe]"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,", [runHookLifecycle, pkg, env, wd, unsafe]"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"function runPackageLifecycle (pkg, env, wd, unsafe, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,", user = unsafe ? null : npm.config.get(""user"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,", group = unsafe ? null : npm.config.get(""group"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"log.verbose(unsafe, ""unsafe-perm in lifecycle"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"function runHookLifecycle (pkg, env, wd, unsafe, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,}
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function lifecycle (pkg, stage, wd, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (typeof wd === ""function"") cb = wd , wd = null"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"&& !npm.config.get(""unsafe-perm"") && pkg.scripts[stage]) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"lifecycle_(pkg, stage, wd, env, cb)"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function lifecycle_ (pkg, stage, wd, env, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"( packageLifecycle && [runPackageLifecycle, pkg, env, wd]"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", [runHookLifecycle, pkg, env, wd]"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function runPackageLifecycle (pkg, env, wd, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", up = npm.config.get(""unsafe-perm"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", user = up ? null : npm.config.get(""user"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", group = up ? null : npm.config.get(""group"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.verbose(up, ""unsafe-perm in lifecycle"")"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function runHookLifecycle (pkg, env, wd, cb) {"
baf983ba19d4ff387bdd5d24fac10c78e34bb09b,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,}
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// install(where, what, family, ancestors)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,//     not in family
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"//   install(where/node_modules/what, dep, family + what, ancestors)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,//     and not in family
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"//   install(where/node_modules/what, dep, family+precise version deps)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// install(where, what, family)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"//   install(where, dep@version, family+list1)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"//   install(where, dep@version, family+list1+list2)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// Managing ""family"" lists..."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// every time we dive into a deeper node_modules folder, the ""family"""
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// list that gets passed along uses the previous ""family"" list as"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,var family = {}
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,", ancestors = {}"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,family[data.name] = ancestors[data.name] = data.version
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"}), where, family, ancestors, false, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// initial ""family"" is the name:version of the root, if it's got"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,if (data) family[data.name] = ancestors[data.name] = data.version
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"fn(args, where, family, ancestors, true, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,// where/node_modules to the family object.
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function installManyTop (what, where, family, ancestors, explicit, cb_) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"installManyTop_(what, where, family, ancestors, explicit, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function installManyTop_ (what, where, family, ancestors, explicit, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"if (er) return installMany(what, where, family, ancestors, explicit, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,// add all the existing packages to the family list.
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// however, do not add to the ancestors list."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,family[p[0]] = p[1]
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"return installMany(what, where, family, ancestors, explicit, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function installMany (what, where, family, ancestors, explicit, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// this file family, and it'll be cached."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,", targetResolver(where, family, ancestors, explicit, d)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,var newPrev = Object.create(family)
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,", newAnc = Object.create(ancestors)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,newAnc[data.name] = data.version
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"installOne(target, where, newPrev, newAnc, parent, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function targetResolver (where, family, ancestors, explicit, deps) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,if (!er && data && family[data.name] === data.version) {
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function installOne (target, where, family, ancestors, parent, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"return localLink(target, where, family, ancestors, parent, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"installOne_(target, where, family, ancestors, parent, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function localLink (target, where, family, ancestors, parent, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function installOne_ (target, where, family, ancestors, parent, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,", [checkCycle, target, ancestors]"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,", [write, target, targetFolder, family, ancestors]"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function checkCycle (target, ancestors, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,// that is already in the prototype tree of the ancestors object.
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,var p = Object.getPrototypeOf(ancestors)
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var er = new Error(""Unresolvable cycle detected"")"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var tree = [target._id, JSON.parse(JSON.stringify(ancestors))]"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,", t = Object.getPrototypeOf(ancestors)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,while (t && t !== Object.prototype) {
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,if (t === p) t.THIS_IS_P = true
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,tree.push(JSON.parse(JSON.stringify(t)))
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,t = Object.getPrototypeOf(t)
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,}
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.warn(tree, ""tree"")"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.warn([name, version, ancestors, p], ""stuff"")"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"function write (target, targetFolder, family, ancestors, cb_) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// something in the ""family"" list."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"return !semver.satisfies(family[d], target.dependencies[d])"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"}), targetFolder, family, ancestors, false, function (er, d) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// install(where, what, previously)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,//     not in previously
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"//   install(where/node_modules/what, dep, previously + what)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,//     and not in previously
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"//   install(where/node_modules/what, dep, previously+precise version deps)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"//   install(where, dep@version, previously+list1)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"//   install(where, dep@version, previously+list1+list2)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// Managing ""previously"" lists..."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// every time we dive into a deeper node_modules folder, the ""previously"""
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// list that gets passed along uses the previous ""previously"" list as"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,var previously = {}
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,previously[data.name] = data.version
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"}), where, previously, false, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// initial ""previously"" is the name:version of the root, if it's got"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,if (data) previously[data.name] = data.version
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"fn(args, where, previously, true, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,// where/node_modules to the previously object.
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function installManyTop (what, where, previously, explicit, cb_) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"installManyTop_(what, where, previously, explicit, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function installManyTop_ (what, where, previously, explicit, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"if (er) return installMany(what, where, previously, explicit, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,// add all the existing packages to the previously list.
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,previously[p[0]] = p[1]
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"return installMany(what, where, previously, explicit, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function installMany (what, where, previously, explicit, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// this file previously, and it'll be cached."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", targetResolver(where, previously, explicit, d)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,var newPrev = Object.create(previously)
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"installOne(target, where, newPrev, parent, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function targetResolver (where, previously, explicit, deps) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,if (!er && data && previously[data.name] === data.version) {
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function installOne (target, where, previously, parent, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"return localLink(target, where, previously, parent, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"installOne_(target, where, previously, parent, cb)"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function localLink (target, where, previously, parent, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function installOne_ (target, where, previously, parent, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", [checkCycle, target, previously]"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", [write, target, targetFolder, previously]"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function checkCycle (target, previously, cb) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,// that is already in the prototype tree of the previously object.
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,var p = Object.getPrototypeOf(previously)
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"var er = new Error(""Unresolveable cycle detected"")"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"function write (target, targetFolder, previously, cb_) {"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// something in the ""previously"" list."
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"return !semver.satisfies(previously[d], target.dependencies[d])"
f16f7c3ec31ce2bd7460651075340d034677b7f0,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"}), targetFolder, previously, false, function (er, d) {"
d74d8525d1c4f73ca35dba9df99923a283bf90ff,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"if (p.indexOf(""/"") === -1 && p.charAt(0) !== ""."") {"
d74d8525d1c4f73ca35dba9df99923a283bf90ff,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"return addNamed(p, """", cb_)"
d74d8525d1c4f73ca35dba9df99923a283bf90ff,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,}
d74d8525d1c4f73ca35dba9df99923a283bf90ff,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"if (p.indexOf(""/"") === -1) return addNamed(p, """", cb_)"
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,if (json.bundledDependencies && !json.bundleDependencies) {
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,json.bundleDependencies = json.bundledDependencies
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,delete json.bundledDependencies
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,}
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,if (json.bundleDependencies && !Array.isArray(json.bundleDependencies)) {
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,"var e = new Error(""bundleDependencies must be an array.\n"""
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,"+""See `npm help json`"")"
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,if (cb) return cb(e)
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,throw e
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,added,0,"delete json[""dev-dependencies""]"
dd17dcfde32e4adb79540f56a4ff56e61d55517f,06dd026d04768edd7adf2aa37cf9a8d9e8c335be,deleted,1,"json[""dev-dependencies""] = null"
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,// the /path/to/node_modules/..
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var where = path.resolve(npm.dir, "".."")"
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonFile = path.resolve( npm.dir, target.name"
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"install( path.resolve(npm.globalDir, "".."")"
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,var where = npm.prefix
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"if (npm.config.get(""global"")) where = path.resolve(where, ""lib"")"
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"var jsonFile = path.resolve( npm.config.get(""prefix""), ""lib"""
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", ""node_modules"", target.name"
2e457459673f24aba25451b858a47cd22e873c7f,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"install( path.resolve(npm.config.get(""prefix""), ""lib"")"
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,added,0,// the /path/to/node_modules/..
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,added,0,"var where = path.resolve(npm.dir, "".."")"
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,added,0,"var jsonFile = path.resolve( npm.dir, target.name"
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,added,0,"install( path.resolve(npm.globalDir, "".."")"
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,deleted,1,var where = npm.prefix
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,deleted,1,"if (npm.config.get(""global"")) where = path.resolve(where, ""lib"")"
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,deleted,1,"var jsonFile = path.resolve( npm.config.get(""prefix""), ""lib"""
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,deleted,1,", ""node_modules"", target.name"
2e457459673f24aba25451b858a47cd22e873c7f,6291d4ce420a7a0873e5c1882dc8926c9527e98e,deleted,1,"install( path.resolve(npm.config.get(""prefix""), ""lib"")"
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,var inc = -1 !== files.indexOf(this.path)
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,// WARNING! Hackety hack!
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,// XXX Fix this in a better way.
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,// Rename .gitignore to .npmignore if there is not a
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,"// .npmignore file there already, the better to lock"
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,// down installed packages with git for deployment.
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,"if (this.basename === "".gitignore"") {"
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,"if (this.parent._entries.indexOf("".npmignore"") !== -1) {"
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,return false
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,}
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,var d = path.dirname(this.path)
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,"this.basename = "".npmignore"""
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,"this.path = path.join(d, "".npmignore"")"
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,added,0,return inc
221211817903641df5d33a119c67ee5c00efaae2,9bb8779f3d45867e0a29507e131e28efe1a18f60,deleted,1,return -1 !== files.indexOf(this.path)
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"json[d] = json.hasOwnProperty(d) ? depObjectify(json[d], d, json._id) : {}"
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,var depObjectifyWarn = {}
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"function depObjectify (deps, d, id) {"
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"if ((!deps || typeof deps !== ""object"" || Array.isArray(deps))"
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,&& !depObjectifyWarn[id+d]) {
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"log.warn( d + "" field should be hash of <name>:<version-range> pairs"""
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,", id )"
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,depObjectifyWarn[id + d] = true
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,}
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,if (!deps) return {}
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"if (typeof deps === ""string"") {"
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"deps = deps.trim().split(/[\n\r\s\t ,]+/)"
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,deleted,1,json[d] = json[d] ? depObjectify(json[d]) : {}
eac92ef67c62d2213b905d1053bc302f004d8e57,c44b8406f52d81dee53acb9ddd8dafa0359bc367,deleted,1,function depObjectify (deps) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"target = dep + ""@"" + target"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"}), where, family, ancestors, false, data, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"fn(args, where, family, ancestors, true, data, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"function installManyTop (what, where, family, ancestors, explicit, parent, cb_) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"installManyTop_(what, where, family, ancestors, explicit, parent, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"function installManyTop_ (what, where, family, ancestors, explicit, parent, cb) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"if (er) return installMany(what, where, family, ancestors, explicit, parent, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"return installMany(what, where, family, ancestors, explicit, parent, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"function installMany (what, where, family, ancestors, explicit, parent, cb) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var parent = data
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", targetResolver(where, family, ancestors, explicit, d, parent)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (er) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.error(er, ""target resolver error"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,return cb(er)
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,}
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"function targetResolver (where, family, ancestors, explicit, deps, parent) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (er && parent && parent.optionalDependencies &&
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"parent.optionalDependencies.hasOwnProperty(what.split(""@"").shift())) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.warn(what, ""optional dependency failed, continuing"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"return cb(null, [])"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"cb(er, [resultList(target, where, parent && parent._id)])"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"function resultList (target, where, parentId) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", prettyWhere && parentId"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", parentId && prettyWhere ]"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"d.push(resultList(target, where, parent && parent._id))"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"t = d + ""@"" + t"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"}), targetFolder, family, ancestors, false, target, function (er, d) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,if (!parsed.protocol) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"target = dep + ""@"" + target"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,}
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"}), where, family, ancestors, false, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"fn(args, where, family, ancestors, true, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"//log.warn(k, ""k"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"//log.warn(things, ""things"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"function installManyTop (what, where, family, ancestors, explicit, cb_) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"installManyTop_(what, where, family, ancestors, explicit, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"function installManyTop_ (what, where, family, ancestors, explicit, cb) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"if (er) return installMany(what, where, family, ancestors, explicit, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"return installMany(what, where, family, ancestors, explicit, cb)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"function installMany (what, where, family, ancestors, explicit, cb) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,var parent = data._id
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"log.verbose(what, ""into ""+where)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", targetResolver(where, family, ancestors, explicit, d)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,if (er) return cb(er)
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"function targetResolver (where, family, ancestors, explicit, deps) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"log.verbose(what, ""cache add"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"cb(er, [resultList(target, where, parent)])"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"function resultList (target, where, parent) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", prettyWhere && parent"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", parent && prettyWhere ]"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"d.push(resultList(target, where, parent))"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"t = d + ""@"" + t"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"}), targetFolder, family, ancestors, false, function (er, d) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"//log.warn(d, ""write installMany cb"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"; [ ""dependencies"""
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,", ""devDependencies"""
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,", ""optionalDependencies"""
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,].forEach(function (d) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,json[d] = json.hasOwnProperty(d)
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"? depObjectify(json[d], d, json._id)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,: {}
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,})
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,// always merge optionals into deps
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,Object.keys(json.optionalDependencies).forEach(function (d) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,json.dependencies[d] = json.optionalDependencies[d]
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,if (opts.dev
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"|| npm.config.get(""dev"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,added,0,"|| npm.config.get(""npat"")) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,deleted,1,";[""dependencies"", ""devDependencies""].forEach(function (d) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,deleted,1,"json[d] = json.hasOwnProperty(d) ? depObjectify(json[d], d, json._id) : {}"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,c44b8406f52d81dee53acb9ddd8dafa0359bc367,deleted,1,"if (opts.dev || npm.config.get(""dev"") || npm.config.get(""npat"")) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,"; [ ""dependencies"""
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,", ""devDependencies"""
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,", ""optionalDependencies"""
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,].forEach(function (d) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,json[d] = json.hasOwnProperty(d)
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,"? depObjectify(json[d], d, json._id)"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,: {}
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,})
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,// always merge optionals into deps
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,Object.keys(json.optionalDependencies).forEach(function (d) {
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,json.dependencies[d] = json.optionalDependencies[d]
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,if (opts.dev
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,"|| npm.config.get(""dev"")"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,added,0,"|| npm.config.get(""npat"")) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,deleted,1,";[""dependencies"", ""devDependencies""].forEach(function (d) {"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,deleted,1,"json[d] = json.hasOwnProperty(d) ? depObjectify(json[d], d, json._id) : {}"
28aa53d798a3abc2c61a24401a0a1a960ae032b3,eac92ef67c62d2213b905d1053bc302f004d8e57,deleted,1,"if (opts.dev || npm.config.get(""dev"") || npm.config.get(""npat"")) {"
80da8e392ab79cfd689fffe560ff46d67b54a725,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"exec(npm.config.get(""git""), [""describe"", ""--tags""], process.env, false, folder,"
80da8e392ab79cfd689fffe560ff46d67b54a725,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"exec( npm.config.get(""git""), [""remote"", ""-v""], process.env, false, folder"
80da8e392ab79cfd689fffe560ff46d67b54a725,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"exec(""git"", [""describe"", ""--tags""], process.env, false, folder,"
80da8e392ab79cfd689fffe560ff46d67b54a725,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"exec( ""git"", [""remote"", ""-v""], process.env, false, folder"
80da8e392ab79cfd689fffe560ff46d67b54a725,8a268945ea1f25b8ffb2fa186952be7823921d91,added,0,"exec(npm.config.get(""git""), [""describe"", ""--tags""], process.env, false, folder,"
80da8e392ab79cfd689fffe560ff46d67b54a725,8a268945ea1f25b8ffb2fa186952be7823921d91,added,0,"exec( npm.config.get(""git""), [""remote"", ""-v""], process.env, false, folder"
80da8e392ab79cfd689fffe560ff46d67b54a725,8a268945ea1f25b8ffb2fa186952be7823921d91,deleted,1,"exec(""git"", [""describe"", ""--tags""], process.env, false, folder,"
80da8e392ab79cfd689fffe560ff46d67b54a725,8a268945ea1f25b8ffb2fa186952be7823921d91,deleted,1,"exec( ""git"", [""remote"", ""-v""], process.env, false, folder"
80da8e392ab79cfd689fffe560ff46d67b54a725,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec( npm.config.get(""git""), [ ""submodule"", ""update"", ""--init"""
80da8e392ab79cfd689fffe560ff46d67b54a725,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec( npm.config.get(""git""), [ ""submodule"", ""add"", url"
80da8e392ab79cfd689fffe560ff46d67b54a725,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec( npm.config.get(""git""), [""submodule"", ""status""], null, false"
80da8e392ab79cfd689fffe560ff46d67b54a725,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec( ""git"", [ ""submodule"", ""update"", ""--init"""
80da8e392ab79cfd689fffe560ff46d67b54a725,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec( ""git"", [ ""submodule"", ""add"", url"
80da8e392ab79cfd689fffe560ff46d67b54a725,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec( ""git"", [""submodule"", ""status""], null, false"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,if (process.env.SUDO_UID && myUid === 0) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,if (!isNaN(process.env.SUDO_UID)) myUid = +process.env.SUDO_UID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,if (!isNaN(process.env.SUDO_GID)) myGid = +process.env.SUDO_GID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"rm(unpackTarget, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,if (er) return cb(er)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"mkdir(unpackTarget, dMode || npm.modes.exec, uid, gid, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"log.verbose([uid, gid], ""unpack_ uid, gid"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"log.verbose(unpackTarget, ""unpackTarget"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"// cp the gzip of the tarball, pipe the stdout into tar's stdin"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,// gzip {tarball} --decompress --stdout \
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,//   | tar -mvxpf - --strip-components=1 -C {unpackTarget}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"gunzTarPerm( tarball, unpackTarget"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,", dMode, fMode"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,", uid, gid"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,", function (er, folder) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"log.verbose(folder, ""gunzed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"readJson(path.resolve(folder, ""package.json""), cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,})
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"function gunzTarPerm (tarball, target, dMode, fMode, uid, gid, cb_) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,var cbCalled = false
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,function cb (er) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,if (cbCalled) return
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,cbCalled = true
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"cb_(er, target)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"// figure out who we're supposed to be, if we're not pretending"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,// to be a specific user.
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"if (npm.config.get(""unsafe-perm"") && process.platform !== ""win32"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,uid = myUid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,gid = myGid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,entry.mode = entry.mode & (~npm.modes.umask)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"// if there's a specific owner uid/gid that we want, then set that"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"if (process.platform !== ""win32"" &&"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"typeof uid === ""number"" &&"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"typeof gid === ""number"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,entry.props.uid = entry.uid = uid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,entry.props.gid = entry.gid = gid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"var extractOpts = { type: ""Directory"", path: target, strip: 1 }"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,var extracter = tar.Extract(extractOpts)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,.pipe(tar.Extract(extractOpts))
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,".on(""close"", cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,".pipe(fstream.Writer({ path: path.resolve(target, ""index.js"") }))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"var j = path.resolve(target, ""package.json"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,added,0,"fs.writeFile(j, JSON.stringify(d) + ""\n"", cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", tmp = path.resolve(parent, ""___"" + base + "".npm"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"mkdir(tmp, dMode || npm.modes.exec, uid, gid, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.verbose([uid, gid], ""unpack_ uid, gid"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.verbose(unpackTarget, ""unpackTarget"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"if (er) return log.er(cb, ""Could not create ""+tmp)(er)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"// cp the gzip of the tarball, pipe the stdout into tar's stdin"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,// gzip {tarball} --decompress --stdout \
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,//   | tar -mvxpf - --strip-components=1 -C {unpackTarget}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"gunzTarPerm( tarball, tmp"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", dMode, fMode"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", uid, gid"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", function (er, folder) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.verbose(folder, ""gunzed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"rm(unpackTarget, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.verbose(unpackTarget, ""rm'ed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"moveIntoPlace(folder, unpackTarget, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,if (er) return cb(er)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.verbose([folder, unpackTarget], ""renamed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"// curse you, nfs!  It will lie and tell you that the"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"// mv is done, when in fact, it isn't.  In theory,"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,// reading the file should cause it to wait until it's done.
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"readJson( path.resolve(unpackTarget, ""package.json"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", function (er, data) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"// now we read the json, so we know it's there."
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"rm(tmp, function (er2) { cb(er || er2, data) })"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,})
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"function gunzTarPerm (tarball, tmp, dMode, fMode, uid, gid, cb) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"var extracter = tar.Extract({ type: ""Directory"", path: tmp })"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,".pipe(tar.Extract({ type: ""Directory"", path: tmp }))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,".on(""close"", afterUntar)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,".pipe(fstream.Writer({ path: path.resolve(tmp, ""package/index.js"") }))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"var j = path.resolve(tmp, ""package/package.json"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"fs.writeFile(j, JSON.stringify(d) + ""\n"", function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,return afterUntar()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,function afterUntar (er) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.silly(er || ""ok"", ""afterUntar"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"// if we're not doing ownership management,"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,// then we're done now.
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"if (er) return log.er(cb, ""Failed unpacking ""+tarball)(er)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,// HACK skip on windows
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"if (npm.config.get(""unsafe-perm"") && process.platform !== ""win32"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,uid = process.getuid()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,gid = process.getgid()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,if (uid === 0) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,if (process.env.SUDO_UID) uid = +process.env.SUDO_UID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,if (process.env.SUDO_GID) gid = +process.env.SUDO_GID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"if (process.platform === ""win32"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"return fs.readdir(tmp, function (er, files) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,files = files.filter(function (f) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"return f && f.indexOf(""\0"") === -1"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"cb(er, files && path.resolve(tmp, files[0]))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"find(tmp, function (f) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,return f !== tmp
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"}, function (er, files) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"asyncMap(files, function (f, cb) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,f = path.resolve(f)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.silly(f, ""asyncMap in gTP"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"fs.lstat(f, function (er, stat) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,if (er || stat.isSymbolicLink()) return cb(er)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"if (typeof uid === ""number"" && typeof gid === ""number"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"fs.chown(f, uid, gid, chown)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,} else chown()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,function chown (er) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,var mode = stat.isDirectory() ? dMode : fMode
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", oldMode = stat.mode & 0777"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,", newMode = (oldMode | mode) & (~npm.modes.umask)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,if (mode && newMode !== oldMode) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"log.silly(newMode.toString(8), ""chmod ""+path.basename(f))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"fs.chmod(f, newMode, cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,} else cb()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"}, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"if (typeof myUid === ""number"" && typeof myGid === ""number"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"fs.chown(tmp, myUid, myGid, chown)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"fs.readdir(tmp, function (er, folder) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,folder = folder && folder.filter(function (f) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,return f && !f.match(/^\._/)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,beeb7fd82e3cc543a9911fe87ec096f8eed29e7a,deleted,1,"cb(er, folder && path.resolve(tmp, folder[0]))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,if (process.env.SUDO_UID && myUid === 0) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,if (!isNaN(process.env.SUDO_UID)) myUid = +process.env.SUDO_UID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,if (!isNaN(process.env.SUDO_GID)) myGid = +process.env.SUDO_GID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"rm(unpackTarget, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,if (er) return cb(er)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"mkdir(unpackTarget, dMode || npm.modes.exec, uid, gid, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"log.verbose([uid, gid], ""unpack_ uid, gid"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"log.verbose(unpackTarget, ""unpackTarget"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"// cp the gzip of the tarball, pipe the stdout into tar's stdin"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,// gzip {tarball} --decompress --stdout \
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,//   | tar -mvxpf - --strip-components=1 -C {unpackTarget}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"gunzTarPerm( tarball, unpackTarget"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,", dMode, fMode"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,", uid, gid"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,", function (er, folder) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"log.verbose(folder, ""gunzed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"readJson(path.resolve(folder, ""package.json""), cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,})
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"function gunzTarPerm (tarball, target, dMode, fMode, uid, gid, cb_) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,var cbCalled = false
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,function cb (er) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,if (cbCalled) return
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,cbCalled = true
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"cb_(er, target)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"// figure out who we're supposed to be, if we're not pretending"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,// to be a specific user.
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"if (npm.config.get(""unsafe-perm"") && process.platform !== ""win32"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,uid = myUid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,gid = myGid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,entry.mode = entry.mode & (~npm.modes.umask)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"// if there's a specific owner uid/gid that we want, then set that"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"if (process.platform !== ""win32"" &&"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"typeof uid === ""number"" &&"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"typeof gid === ""number"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,entry.props.uid = entry.uid = uid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,entry.props.gid = entry.gid = gid
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"var extractOpts = { type: ""Directory"", path: target, strip: 1 }"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,var extracter = tar.Extract(extractOpts)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,.pipe(tar.Extract(extractOpts))
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,".on(""close"", cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,".pipe(fstream.Writer({ path: path.resolve(target, ""index.js"") }))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"var j = path.resolve(target, ""package.json"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,added,0,"fs.writeFile(j, JSON.stringify(d) + ""\n"", cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", tmp = path.resolve(parent, ""___"" + base + "".npm"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"mkdir(tmp, dMode || npm.modes.exec, uid, gid, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.verbose([uid, gid], ""unpack_ uid, gid"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.verbose(unpackTarget, ""unpackTarget"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"if (er) return log.er(cb, ""Could not create ""+tmp)(er)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"// cp the gzip of the tarball, pipe the stdout into tar's stdin"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,// gzip {tarball} --decompress --stdout \
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,//   | tar -mvxpf - --strip-components=1 -C {unpackTarget}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"gunzTarPerm( tarball, tmp"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", dMode, fMode"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", uid, gid"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", function (er, folder) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.verbose(folder, ""gunzed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"rm(unpackTarget, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.verbose(unpackTarget, ""rm'ed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"moveIntoPlace(folder, unpackTarget, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,if (er) return cb(er)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.verbose([folder, unpackTarget], ""renamed"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"// curse you, nfs!  It will lie and tell you that the"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"// mv is done, when in fact, it isn't.  In theory,"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,// reading the file should cause it to wait until it's done.
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"readJson( path.resolve(unpackTarget, ""package.json"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", function (er, data) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"// now we read the json, so we know it's there."
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"rm(tmp, function (er2) { cb(er || er2, data) })"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,})
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"function gunzTarPerm (tarball, tmp, dMode, fMode, uid, gid, cb) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"var extracter = tar.Extract({ type: ""Directory"", path: tmp })"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,".pipe(tar.Extract({ type: ""Directory"", path: tmp }))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,".on(""close"", afterUntar)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,".pipe(fstream.Writer({ path: path.resolve(tmp, ""package/index.js"") }))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"var j = path.resolve(tmp, ""package/package.json"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"fs.writeFile(j, JSON.stringify(d) + ""\n"", function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,return afterUntar()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,function afterUntar (er) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.silly(er || ""ok"", ""afterUntar"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"// if we're not doing ownership management,"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,// then we're done now.
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"if (er) return log.er(cb, ""Failed unpacking ""+tarball)(er)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,// HACK skip on windows
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"if (npm.config.get(""unsafe-perm"") && process.platform !== ""win32"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,uid = process.getuid()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,gid = process.getgid()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,if (uid === 0) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,if (process.env.SUDO_UID) uid = +process.env.SUDO_UID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,if (process.env.SUDO_GID) gid = +process.env.SUDO_GID
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,}
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"if (process.platform === ""win32"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"return fs.readdir(tmp, function (er, files) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,files = files.filter(function (f) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"return f && f.indexOf(""\0"") === -1"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"cb(er, files && path.resolve(tmp, files[0]))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"find(tmp, function (f) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,return f !== tmp
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"}, function (er, files) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"asyncMap(files, function (f, cb) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,f = path.resolve(f)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.silly(f, ""asyncMap in gTP"")"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"fs.lstat(f, function (er, stat) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,if (er || stat.isSymbolicLink()) return cb(er)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"if (typeof uid === ""number"" && typeof gid === ""number"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"fs.chown(f, uid, gid, chown)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,} else chown()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,function chown (er) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,var mode = stat.isDirectory() ? dMode : fMode
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", oldMode = stat.mode & 0777"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,", newMode = (oldMode | mode) & (~npm.modes.umask)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,if (mode && newMode !== oldMode) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"log.silly(newMode.toString(8), ""chmod ""+path.basename(f))"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"fs.chmod(f, newMode, cb)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,} else cb()
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"}, function (er) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"if (typeof myUid === ""number"" && typeof myGid === ""number"") {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"fs.chown(tmp, myUid, myGid, chown)"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"fs.readdir(tmp, function (er, folder) {"
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,folder = folder && folder.filter(function (f) {
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,return f && !f.match(/^\._/)
cc0a00e68fb798c4daea9faf2e0b9508f5c15662,7443d36aca4679e26b39a275a136714b4f6e576a,deleted,1,"cb(er, folder && path.resolve(tmp, folder[0]))"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// if it's identical to its parent, then it's probably someone"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// doing `npm install foo` inside of the foo project.  Print
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// a warning, and skip it."
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"if (parent && parent.name === what && !npm.config.get(""force"")) {"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.warn(""Refusing to install ""+what+"" as a dependency of itself"""
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,",""install"")"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"return cb(null, [])"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,}
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,//
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// Note: `npm install foo` inside of the `foo` package will abort
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// earlier if `--force` is not set.  However, if it IS set, then"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// we need to still fail here, but just skip the first level. Of"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// course, it'll still fail eventually if it's a true cycle, and"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// leave things in an undefined state, but that's what is to be"
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// expected when `--force` is used.  That is why getPrototypeOf
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// is used *twice* here: to skip the first level of repetition.
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var p = Object.getPrototypeOf(Object.getPrototypeOf(ancestors))
53fb75866cc1cd955229922e09f3dd64e63178a1,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,var p = Object.getPrototypeOf(ancestors)
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"exec( npm.config.get(""git""), [""clone"", u, tmp], gitEnv(), false"
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"exec( npm.config.get(""git""), [""checkout"", co], gitEnv(), false, tmp"
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,var gitEnv_
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,function gitEnv () {
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,// git responds to env vars in some weird ways in post-receive hooks
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,// so don't carry those along.
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,if (gitEnv_) return gitEnv_
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,gitEnv_ = {}
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,for (var k in process.env) {
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,if (k.match(/^GIT/)) continue
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,gitEnv_[k] = process.env[k]
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,}
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,return gitEnv_
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"exec( npm.config.get(""git""), [""clone"", u, tmp], null, false"
af8c981c04f869f2a48644dc61f6a2e7b3395fae,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"exec( npm.config.get(""git""), [""checkout"", co], null, false, tmp"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (data) {
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,data._from = u
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,data._resolved = u
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,}
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"var git = npm.config.get(""git"")"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"var archive = [""fetch"", ""-a"", ""origin""]"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"var resolve = [""rev-list"", ""-n1"", co]"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,var env = gitEnv()
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,var errState = null
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,var n = 0
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,var resolved = null
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,var tmp
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"exec(git, archive, env, false, p, function (er, code, stdout, stderr) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,return next(er)
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"tmp = path.join(npm.tmp, Date.now()+""-""+Math.random(), ""tmp.tgz"")"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,next()
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,})
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"exec(git, resolve, env, false, p, function (er, code, stdout, stderr) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"stdout = (stdout + ""\n"" + stderr).trim()"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (er) {
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"log.error(""Failed resolving git HEAD ("" + u + "")"", stderr)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"log.verbose(""git rev-list -n1 "" + co, stdout)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,var parsed = url.parse(u)
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,parsed.hash = stdout
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,resolved = url.format(parsed)
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,function next (er) {
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (errState) return
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (er) return cb(errState = er)
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (++n < 2) return
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"addLocalTarball(tmp, function(er, data) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (data) data._resolved = resolved
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"cb(er, data)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (data) data._from = k
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,data._from = p
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"function addLocalTarball (p, name, cb_) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"if (typeof cb_ !== ""function"") cb_ = name, name = """""
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"if (p.indexOf(npm.tmp) === 0) return addTmpTarball(p, name, cb_)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"if (path.basename(p) !== ""package.tgz"") return cb_(new Error("
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"return addPlacedTarball(p, name, cb_)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"function cb (er, data) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,if (data) data._resolved = p
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,added,0,"return cb_(er, data)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"exec( npm.config.get(""git""), [""fetch"", ""-a"", ""origin""], gitEnv(), false, p"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,", function (er, code, stdout, stderr) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,return cb(er)
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"var tmp = path.join(npm.tmp, Date.now()+""-""+Math.random(), ""tmp.tgz"")"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"addLocalTarball(tmp, cb)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,})
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"function addLocalTarball (p, name, cb) {"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"if (typeof cb !== ""function"") cb = name, name = """""
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"if (p.indexOf(npm.tmp) === 0) return addTmpTarball(p, name, cb)"
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"if (path.basename(p) !== ""package.tgz"") return cb(new Error("
aaf7dab8c30759fdfeea9069f5ba7b477624f89e,d1944cbad06b10bdcd2dfc7e0f03ef82414da27b,deleted,1,"return addPlacedTarball(p, name, cb)"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,", readInstalled = require(""read-installed"")"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"findPeerInvalid(where, function (er, problem) {"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (er) return cb_(er)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (problem) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"var peerInvalidError = new Error(""The package "" + problem.name +"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,""" does not satisfy its siblings' peerDependencies requirements!"")"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"peerInvalidError.code = ""EPEERINVALID"""
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,peerInvalidError.packageName = problem.name
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,peerInvalidError.peersDepending = problem.peersDepending
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,return cb(peerInvalidError)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,}
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,var tree = treeify(installed || [])
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,", pretty = prettify(tree, installed).trim()"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (pretty) console.log(pretty)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"save(where, installed, tree, pretty, cb_)"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,})
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"function findPeerInvalid (where, cb) {"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"readInstalled(where, function (er, data) {"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (er) return cb(er)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"cb(null, findPeerInvalid_(data.dependencies))"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,function findPeerInvalid_ (packageMap) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,for (var packageName in packageMap) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,var pkg = packageMap[packageName]
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (pkg.peerInvalid) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,var peersDepending = {};
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,for (peerName in packageMap) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,var peer = packageMap[peerName]
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (peer.peerDependencies && peer.peerDependencies[packageName]) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"peersDepending[peer.name + ""@"" + peer.version] ="
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,peer.peerDependencies[packageName]
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"return { name: pkg.name, peersDepending: peersDepending }"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,var peerInvalidDep = pkg.dependencies && findPeerInvalid_(pkg.dependencies)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (peerInvalidDep) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,return peerInvalidDep
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,return null
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,var tree = treeify(installed || [])
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,", pretty = prettify(tree, installed).trim()"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,if (pretty) console.log(pretty)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,if (er) return cb_(er)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,"save(where, installed, tree, pretty, cb_)"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,", readInstalled = require(""read-installed"")"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"findPeerInvalid(where, function (er, problem) {"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (er) return cb_(er)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (problem) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"var peerInvalidError = new Error(""The package "" + problem.name +"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,""" does not satisfy its siblings' peerDependencies requirements!"")"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"peerInvalidError.code = ""EPEERINVALID"""
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,peerInvalidError.packageName = problem.name
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,peerInvalidError.peersDepending = problem.peersDepending
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,return cb(peerInvalidError)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,}
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,var tree = treeify(installed || [])
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,", pretty = prettify(tree, installed).trim()"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (pretty) console.log(pretty)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"save(where, installed, tree, pretty, cb_)"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,})
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"function findPeerInvalid (where, cb) {"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"readInstalled(where, function (er, data) {"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (er) return cb(er)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"cb(null, findPeerInvalid_(data.dependencies))"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,function findPeerInvalid_ (packageMap) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,for (var packageName in packageMap) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,var pkg = packageMap[packageName]
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (pkg.peerInvalid) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,var peersDepending = {};
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,for (peerName in packageMap) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,var peer = packageMap[peerName]
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (peer.peerDependencies && peer.peerDependencies[packageName]) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"peersDepending[peer.name + ""@"" + peer.version] ="
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,peer.peerDependencies[packageName]
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,"return { name: pkg.name, peersDepending: peersDepending }"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,var peerInvalidDep = pkg.dependencies && findPeerInvalid_(pkg.dependencies)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,if (peerInvalidDep) {
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,return peerInvalidDep
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,added,0,return null
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,deleted,1,var tree = treeify(installed || [])
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,deleted,1,", pretty = prettify(tree, installed).trim()"
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,deleted,1,if (pretty) console.log(pretty)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,deleted,1,if (er) return cb_(er)
fc13f37bb8538d6f5b9735c0b15df0963ae1de33,8933ccdd0e803defc5a8fa028a29e326bfd41150,deleted,1,"save(where, installed, tree, pretty, cb_)"
8e879f558e15dae25ee81da7d73164896050f8ea,13956300a65465a7b0593d11fda29527a9f4bc1c,deleted,1,", exec = require(""./utils/exec.js"")"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,", exec = require(""child_process"").execFile"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"var git = npm.config.get(""git"")"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"var args = [ ""submodule"", ""update"", ""--init"", ""node_modules/"", name ]"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec(git, args, cb)"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"var args = [ ""submodule"", ""add"", url, ""node_modules/"", name ]"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec(git, args, function (er) {"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"var arg = [ ""submodule"", ""status"" ]"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec(git, args, function (er, stdout, stderr) {"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", exec = require(""./utils/exec.js"")"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec( npm.config.get(""git""), [ ""submodule"", ""update"", ""--init"""
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", ""node_modules/"" + name ]"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", null, true, npm.prefix, cb)"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec( npm.config.get(""git""), [ ""submodule"", ""add"", url"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", null, true, npm.prefix, function (er) {"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec( npm.config.get(""git""), [""submodule"", ""status""], null, false"
8e879f558e15dae25ee81da7d73164896050f8ea,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", npm.prefix, function (er, code, stdout, stderr) {"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,", exec = require(""child_process"").execFile"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var git = npm.config.get(""git"")"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var args = [ ""submodule"", ""update"", ""--init"", ""node_modules/"", name ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"exec(git, args, cb)"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var args = [ ""submodule"", ""add"", url, ""node_modules/"", name ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"exec(git, args, function (er) {"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var arg = [ ""submodule"", ""status"" ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"exec(git, args, function (er, stdout, stderr) {"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", exec = require(""./utils/exec.js"")"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"exec( npm.config.get(""git""), [ ""submodule"", ""update"", ""--init"""
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", ""node_modules/"" + name ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", null, true, npm.prefix, cb)"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"exec( npm.config.get(""git""), [ ""submodule"", ""add"", url"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", null, true, npm.prefix, function (er) {"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"exec( npm.config.get(""git""), [""submodule"", ""status""], null, false"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", npm.prefix, function (er, code, stdout, stderr) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,module.exports = exec
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,exec.spawn = spawn
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var log = require(""npmlog"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", child_process = require(""child_process"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", util = require(""util"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", npm = require(""../npm.js"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", myUID = process.getuid ? process.getuid() : null"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", myGID = process.getgid ? process.getgid() : null"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", isRoot = process.getuid && myUID === 0"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", constants = require(""constants"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", uidNumber = require(""uid-number"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", once = require(""once"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function exec (cmd, args, env, takeOver, cwd, uid, gid, cb) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (typeof cb !== ""function"") cb = gid, gid = null"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (typeof cb !== ""function"") cb = uid, uid = null"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (typeof cb !== ""function"") cb = cwd, cwd = null"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (typeof cb !== ""function"") cb = takeOver, takeOver = true"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (typeof cb !== ""function"") cb = env, env = process.env"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,gid = gid == null ? myGID : gid
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,uid = uid == null ? myUID : uid
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!isRoot) {
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (npm.config.get(""unsafe-perm"")) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,uid = myUID
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,gid = myGID
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else if (uid !== myUID || gid !== myGID) {
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var e = new Error(""EPERM: setuid() operation not permitted"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,e.errno = constants.EPERM
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return cb(e)
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,}
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (uid !== myUID) {
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.verbose(""set uid"", ""from=%s to=%s"", myUID, uid)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (uid && gid && (isNaN(uid) || isNaN(gid))) {
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// get the numeric values
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"return uidNumber(uid, gid, function (er, uid, gid) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (er) return cb(er)
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"exec(cmd, args, env, takeOver, cwd, uid, gid, cb)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,})
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.silly(""exec"", cmd+"" ""+args.map(JSON.stringify).join("" ""))"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var stdout = """""
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", stderr = """""
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", cp = spawn(cmd, args, env, takeOver, cwd, uid, gid)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,cb = once(cb)
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cp.on(""error"", cb)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cp.stdout && cp.stdout.on(""data"", function (chunk) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (chunk) stdout += chunk
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cp.stderr && cp.stderr.on(""data"", function (chunk) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (chunk) stderr += chunk
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cp.on(""close"", function (code) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var er = null
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if (code) er = new Error(""`""+cmd"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"+(args.length ? "" """
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"+ args.map(JSON.stringify).join("" "")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,": """")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"+""` failed with ""+code)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cb(er, code, stdout, stderr)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return cp
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function spawn (c, a, env, takeOver, cwd, uid, gid) {"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var fds = [ 0, 1, 2 ]"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", opts = { customFds : takeOver ? fds : [-1,-1,-1]"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", env : env || process.env"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", cwd : cwd || null }"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,", cp"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (uid && !isNaN(uid)) opts.uid = +uid
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (gid && !isNaN(gid)) opts.gid = +gid
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var name = c +"" ""+ a.map(JSON.stringify).join("" "")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.silly([c, a, opts.cwd], ""spawning"")"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cp = child_process.spawn(c, a, opts)"
8e879f558e15dae25ee81da7d73164896050f8ea,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,cp.name = name
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var exec = require(""child_process"").execFile"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var git = npm.config.get(""git"")"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"var args = [ ""status"", ""--porcelain"" ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,var env = process.env
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"exec(git, args, {env: env}, function (er, stdout, stderr) {"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,"( [ [ exec, git, [ ""add"", ""package.json"" ], {env: process.env} ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,", [ exec, git, [ ""commit"", ""-m"", message ], {env: process.env} ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,", [ exec, git, [ ""tag"", ""v"" + data.version, flag, message ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,added,0,", {env: process.env} ] ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"var exec = require(""./utils/exec.js"")"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"exec( npm.config.get(""git""), [""status"", ""--porcelain""], process.env, false"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", function (er, code, stdout, stderr) {"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,"( [ [ exec, npm.config.get(""git"")"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", [""add"",""package.json""], process.env, false ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", [ exec, npm.config.get(""git"")"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", [""commit"", ""-m"", message ], process.env, false ]"
8e879f558e15dae25ee81da7d73164896050f8ea,80da8e392ab79cfd689fffe560ff46d67b54a725,deleted,1,", [""tag"", ""v""+data.version, flag, message], process.env, false ] ]"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,", which = require(""which"")"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,// check for git
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"which(git, function (err) {"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,if (err) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"err.code = ""ENOGIT"""
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,return cb(err)
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,}
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec(git, args, cb)"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,})
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec(git, args, function (er) {"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,if (er) return cb(er)
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"updateSubmodule(name, cb)"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"exec(git, args, function (er, stdout, stderr) {"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,res = stdout.trim().split(/\n/).map(function (line) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,return line.trim().split(/\s+/)[1]
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,}).filter(function (line) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,// only care about submodules in the node_modules folder.
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,return line && line.match(/^node_modules\//)
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,}).map(function (line) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"return line.replace(/^node_modules\//g, """")"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,// memoize.
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"getSubmodules = function (cb) { return cb(null, res) }"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"cb(null, res)"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec(git, args, cb)"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec(git, args, function (er) {"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (er) return cb(er)
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"updateSubmodule(name, cb)"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec(git, args, function (er, stdout, stderr) {"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,res = stdout.trim().split(/\n/).map(function (line) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return line.trim().split(/\s+/)[1]
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}).filter(function (line) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// only care about submodules in the node_modules folder.
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return line && line.match(/^node_modules\//)
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}).map(function (line) {
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"return line.replace(/^node_modules\//g, """")"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// memoize.
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"getSubmodules = function (cb) { return cb(null, res) }"
82b9e7d1dadbbf705b29c21b96a3ac3b1a4ed1db,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"cb(null, res)"
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,var hasArguments = !!args.length
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"save(where, installed, tree, pretty, hasArguments, cb_)"
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"function save (where, installed, tree, pretty, hasArguments, cb) {"
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,if (!hasArguments ||
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,added,0,"!npm.config.get(""save"") &&"
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,"save(where, installed, tree, pretty, cb_)"
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,"function save (where, installed, tree, pretty, cb) {"
2766b0d43704b784d8e0d610591daa6012377eb2,2d970344545d7dfadf217365755afd0cdca5b1f1,deleted,1,"if (!npm.config.get(""save"") &&"
baafe15bd1568b7d75923a0abb2934e6f8bca3fd,f4f53d2fca95a480f49d7e5691f18032b55248db,added,0,"? ""Valid install targets:\n"" + JSON.stringify(targets) + ""\n"""
baafe15bd1568b7d75923a0abb2934e6f8bca3fd,f4f53d2fca95a480f49d7e5691f18032b55248db,added,0,"var er = new Error( ""No compatible version found: """
baafe15bd1568b7d75923a0abb2934e6f8bca3fd,f4f53d2fca95a480f49d7e5691f18032b55248db,added,0,"er.code = ""ETARGET"""
baafe15bd1568b7d75923a0abb2934e6f8bca3fd,f4f53d2fca95a480f49d7e5691f18032b55248db,added,0,return er
baafe15bd1568b7d75923a0abb2934e6f8bca3fd,f4f53d2fca95a480f49d7e5691f18032b55248db,deleted,1,"? ""Valid install targets:\n"" + JSON.stringify(targets)"
baafe15bd1568b7d75923a0abb2934e6f8bca3fd,f4f53d2fca95a480f49d7e5691f18032b55248db,deleted,1,"return new Error( ""No compatible version found: """
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,added,0,"var gp = Object.getOwnPropertyDescriptor(config, ""globalPrefix"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,added,0,"Object.defineProperty(npm, ""globalPrefix"", gp)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,added,0,"var lp = Object.getOwnPropertyDescriptor(config, ""localPrefix"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,added,0,"Object.defineProperty(npm, ""localPrefix"", lp)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,added,0,return cb()
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", findPrefix = require(""./utils/find-prefix.js"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", getUid = require(""uid-number"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", mkdirp = require(""mkdirp"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", slide = require(""slide"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", chain = slide.chain"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// /usr/local is often a read-only fs, which is not"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,// well handled by node or mkdirp.  Just double-check
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,// in the case of errors when making the prefix dirs.
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"function mkdir (p, cb) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"mkdirp(p, function (er, made) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// it could be that we couldn't create it, because it"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// already exists, and is on a read-only fs."
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (er) {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"return fs.stat(p, function (er2, st) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (er2 || !st.isDirectory()) return cb(er)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"return cb(null, made)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,})
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,}
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"return cb(er, made)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"var token = config.get(""_token"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"if (typeof token === ""string"") {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,try {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,token = JSON.parse(token)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"config.set(""_token"", token, ""user"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"config.save(""user"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,} catch (e) { token = null }
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,// save the token cookie in the config file
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (npm.registry.couchLogin) {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,npm.registry.couchLogin.tokenSet = function (tok) {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"npm.config.set(""_token"", tok, ""user"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,// ignore save error.  best effort.
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"npm.config.save(""user"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"chain([ [ loadPrefix, npm, cli ]"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", [ setUser, config, config.root ]"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", [ loadUid, npm ]"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"], cb)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"function loadPrefix (npm, config, cb) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,// try to guess at a good node_modules location.
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,var p
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", gp"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"if (!Object.prototype.hasOwnProperty.call(config, ""prefix"")) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,p = process.cwd()
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,} else {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"p = npm.config.get(""prefix"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"gp = npm.config.get(""prefix"")"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"findPrefix(p, function (er, p) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"Object.defineProperty(npm, ""localPrefix"","
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,{ get : function () { return p }
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", set : function (r) { return p = r }"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", enumerable : true"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// the prefix MUST exist, or else nothing works."
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"if (!npm.config.get(""global"")) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"mkdir(p, next)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,next(er)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,gp = path.resolve(gp)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"Object.defineProperty(npm, ""globalPrefix"","
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,{ get : function () { return gp }
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", set : function (r) { return gp = r }"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"mkdir(gp, next)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,var i = 2
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,", errState = null"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,function next (er) {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (errState) return
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (er) return cb(errState = er)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (--i === 0) return cb()
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"function loadUid (npm, cb) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// if we're not in unsafe-perm mode, then figure out who"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// to run stuff as.  Do this first, to support `npm update npm -g`"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"if (!npm.config.get(""unsafe-perm"")) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"getUid(npm.config.get(""user""), npm.config.get(""group""), cb)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,process.nextTick(cb)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"function setUser (cl, dc, cb) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// If global, leave it as-is."
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// If not global, then set the user to the owner of the prefix folder."
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"// Just set the default, so it can be overridden."
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"if (cl.get(""global"")) return cb()"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,if (process.env.SUDO_UID) {
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,dc.user = +(process.env.SUDO_UID)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,return cb()
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"var prefix = path.resolve(cl.get(""prefix""))"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"mkdir(prefix, function (er) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"log.error(""could not create prefix dir"", prefix)"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,return cb(er)
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,"fs.stat(prefix, function (er, st) {"
1707fcedb7503251eb77719aba7ac52931721205,701a32d6c02c1d615276ff99b2d9f5a2e7530694,deleted,1,dc.user = st && st.uid
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,", git = require(""./utils/git.js"")"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"git.whichAndExec(args, cb)"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"git.whichAndExec(args, function _(er, stdout) {"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,if (er) return cb(er)
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,var res = stdout.trim().split(/\n/).map(function (line) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,return line.trim().split(/\s+/)[1]
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,}).filter(function (line) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,// only care about submodules in the node_modules folder.
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,return line && line.match(/^node_modules\//)
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,}).map(function (line) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"return line.replace(/^node_modules\//g, """")"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,// memoize.
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"getSubmodules = function (cb) { return cb(null, res) }"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,added,0,"cb(null, res)"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", exec = require(""child_process"").execFile"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"var git = npm.config.get(""git"")"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// check for git
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"which(git, function (err) {"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (err) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"err.code = ""ENOGIT"""
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return cb(err)
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec(git, args, cb)"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,})
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec(git, args, function (er) {"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (er) return cb(er)
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"updateSubmodule(name, cb)"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"exec(git, args, function (er, stdout) {"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,var res = stdout.trim().split(/\n/).map(function (line) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return line.trim().split(/\s+/)[1]
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}).filter(function (line) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// only care about submodules in the node_modules folder.
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return line && line.match(/^node_modules\//)
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}).map(function (line) {
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"return line.replace(/^node_modules\//g, """")"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// memoize.
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"getSubmodules = function (cb) { return cb(null, res) }"
59eb112eec7bfd0e39b6098142d76ad66d3aca14,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"cb(null, res)"
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,added,0,"var json = path.join(npm.localPrefix, ""package.json"")"
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,added,0,: npm.localPrefix
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,added,0,"else readJson(path.join(npm.localPrefix, ""package.json""), function (er, d) {"
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,added,0,var pkgdir = npm.localPrefix
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,added,0,"var json = path.join(npm.localPrefix, 'package.json')"
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,deleted,1,"var json = path.join(npm.prefix, ""package.json"")"
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,deleted,1,: npm.prefix
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,deleted,1,"else readJson(path.join(npm.prefix, ""package.json""), function (er, d) {"
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,deleted,1,var pkgdir = process.cwd()
0dc6a07c778071c94c2251429c7d107e88a45095,912254128d56664e9233b5536bac2c837c7d0650,deleted,1,"var json = path.join(npm.prefix, 'package.json')"
a11c88bdb1488b87d8dcac69df9a55a7a91184b6,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,added,0,var name = data.name
a11c88bdb1488b87d8dcac69df9a55a7a91184b6,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,added,0,// scoped packages get special treatment
a11c88bdb1488b87d8dcac69df9a55a7a91184b6,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,added,0,"if (name[0] === ""@"") name = name.substr(1).replace(/\//g, ""-"")"
a11c88bdb1488b87d8dcac69df9a55a7a91184b6,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,added,0,"var fname = name + ""-"" + data.version + "".tgz"""
a11c88bdb1488b87d8dcac69df9a55a7a91184b6,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,deleted,1,"var fname = path.resolve(data._id.replace(/@/g, ""-"") + "".tgz"")"
6784767fe15e28b44c81a1d4bb1738c642a65d78,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,added,0,", writeStream = require('fs-write-stream-atomic')"
6784767fe15e28b44c81a1d4bb1738c642a65d78,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,added,0,", to = writeStream(fname)"
6784767fe15e28b44c81a1d4bb1738c642a65d78,e67b796a898041ea3b5221d80bbd7a7e1fcc43d3,deleted,1,", to = fs.createWriteStream(fname)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,", log = require(""npmlog"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,", randomBytes = require(""crypto"").pseudoRandomBytes // only need uniqueness"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"function addLocalTarball (p, pkgData, shasum, cb) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"assert(typeof cb === ""function"", ""must have callback"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"// If we don't have a shasum yet, compute it."
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (er) return cb(er)
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.silly(""addLocalTarball"", ""shasum (computed)"", shasum)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"addLocalTarball(p, pkgData, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"if (path.basename(p) !== ""package.tgz"") {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return cb(new Error(""Not a valid cache tarball name: ""+p))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,}
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""addLocalTarball"", ""adding from inside cache"", p)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return addPlacedTarball(p, pkgData, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"addTmpTarball(p, pkgData, shasum, function (er, data) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return cb(er, data)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"assert(shasum, ""must have shasum by now"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (!cb) return undefined
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""addTmpTarball"", ""already have metadata; skipping unpack"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return addTmpTarball_(tgz, pkgData, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// This is a tarball we probably downloaded from the internet.  The shasum's
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"// already been checked, but we haven't ever had a peek inside, so we unpack"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// it here just to make sure it is what it says it is.
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,//
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"// NOTE: we might not have any clue what we think it is, for example if the"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// user just did `npm install ./foo.tgz`
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// generate a unique filename
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"randomBytes(6, function (er, random) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"var target = path.join(npm.tmp, ""unpack-"" + random.toString(""hex""))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"getCacheStat(function (er, cs) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""addTmpTarball"", ""validating metadata from"", tgz)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"tar.unpack(tgz, target, null, null, cs.uid, cs.gid, function (er, data) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// check that this is what we expected.
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (!data.name) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return cb(new Error(""No name provided""))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,else if (pkgData.name && data.name !== pkgData.name) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return cb(new Error(""Invalid Package: expected "" + pkgData.name +"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,""" but found "" + data.name))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (!data.version) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return cb(new Error(""No version provided""))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,else if (pkgData.version && data.version !== pkgData.version) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return cb(new Error(""Invalid Package: expected "" +"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"pkgData.name + ""@"" + pkgData.version +"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,""" but found "" + data.name + ""@"" + data.version))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"addTmpTarball_(tgz, data, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,})
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", readJson = require(""read-package-json"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"function addLocalTarball (p, pkgData, shasum, cb_) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"assert(typeof cb_ === ""function"", ""must have callback"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var name = pkgData.name || """""
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// If we don't have a shasum yet, then get the shasum now."
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (er) return cb_(er)
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"addLocalTarball(p, pkgData, shasum, cb_)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// if it's a tar, and not in place,"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// then unzip to .tmp, add the tmp folder, and clean up tmp"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"if (pathIsInside(p, npm.tmp))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"return addTmpTarball(p, pkgData, shasum, cb_)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"if (path.basename(p) !== ""package.tgz"") return cb_(new Error("
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"""Not a valid cache tarball name: ""+p))"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"return addPlacedTarball(p, pkgData, shasum, cb_)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"function cb (er, data) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"return cb_(er, data)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,}
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// just copy it over and then add the temp tarball file.
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var tmp = path.join(npm.tmp, name + Date.now()"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"+ ""-"" + Math.random(), ""tmp.tgz"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"mkdir(path.dirname(tmp), function (er) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (er) return cb(er)
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,var from = fs.createReadStream(p)
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", to = writeStream(tmp, { mode: npm.modes.file })"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", errState = null"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,function errHandler (er) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (errState) return
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,cb(errState = er)
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"from.on(""error"", errHandler)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"to.on(""error"", errHandler)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"to.on(""close"", function () {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"addTmpTarball(tmp, pkgData, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,})
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,from.pipe(to)
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"assert(shasum, ""should have shasum by now"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (!cb) return
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"addTmpTarball_(tgz, pkgData, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// This is a tarball we probably downloaded from the internet.
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// The shasum's already been checked, but we haven't ever had"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// a peek inside, so we unpack it here just to make sure it is"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// what it says it is.
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// Note: we might not have any clue what we think it is, for"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// example if the user just did `npm install ./foo.tgz`
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var target = tgz + ""-unpack"""
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"getCacheStat(function (er, cs) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"tar.unpack(tgz, target, null, null, cs.uid, cs.gid, next)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,function next (er) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var pj = path.join(target, ""package.json"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"readJson(pj, function (er, data) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// XXX dry with similar stanza in add-local.js
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"er = needName(er, data)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"er = needVersion(er, data)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// check that this is what we expected.
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (!er && pkgData.name && pkgData.name !== data.name) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"er = new Error( ""Invalid Package: expected """
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"+ pkgData.name + "" but found """
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,+ data.name )
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (!er && pkgData.version && pkgData.version !== data.version) {
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"+ pkgData.name + ""@"" + pkgData.version"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"+ "" but found """
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"+ data.name + ""@"" + data.version )"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"addTmpTarball_(tgz, data, shasum, cb)"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"function needName(er, data) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,return er ? er
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,": (data && !data.name) ? new Error(""No name provided"")"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,: null
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"function needVersion(er, data) {"
4b2d95d0641435b09d047ae5cb2226f292bf38f0,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,": (data && !data.version) ? new Error(""No version provided"")"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", ""submodule"""
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// npm submodule <pkg>
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// Check the package contents for a git repository url.
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"// If there is one, then create a git submodule in the node_modules folder."
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,module.exports = submodule
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"var npm = require(""./npm.js"")"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", cache = require(""./cache.js"")"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", git = require(""./utils/git.js"")"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", asyncMap = require(""slide"").asyncMap"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,", chain = require(""slide"").chain"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"submodule.usage = ""npm submodule <pkg>"""
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"submodule.completion = require(""./docs.js"").completion"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"function submodule (args, cb) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"if (npm.config.get(""global"")) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"return cb(new Error(""Cannot use submodule command in global mode.""))"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (args.length === 0) return cb(submodule.usage)
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"asyncMap(args, function (arg, cb) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"cache.add(arg, null, null, false, cb)"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"}, function (er, pkgs) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (er) return cb(er)
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,chain(pkgs.map(function (pkg) { return function (cb) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"submodule_(pkg, cb)"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"}}), cb)"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,})
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"function submodule_ (pkg, cb) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (!pkg.repository
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"|| pkg.repository.type !== ""git"""
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,|| !pkg.repository.url) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"return cb(new Error(pkg._id + "": No git repository listed""))"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// prefer https:// github urls
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,pkg.repository.url = pkg.repository.url
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,".replace(/^(git:\/\/)?(git@)?github.com[:\/]/, ""https://github.com/"")"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"// first get the list of submodules, and update if it's already there."
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"getSubmodules(function (er, modules) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"// if there's already a submodule, then just update it."
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,if (modules.indexOf(pkg.name) !== -1) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"return updateSubmodule(pkg.name, cb)"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"addSubmodule(pkg.name, pkg.repository.url, cb)"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"function updateSubmodule (name, cb) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"var args = [ ""submodule"", ""update"", ""--init"", ""node_modules/"", name ]"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"git.whichAndExec(args, cb)"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"function addSubmodule (name, url, cb) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"var args = [ ""submodule"", ""add"", url, ""node_modules/"", name ]"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,var getSubmodules = function (cb) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"var args = [ ""submodule"", ""status"" ]"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"git.whichAndExec(args, function _(er, stdout) {"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,var res = stdout.trim().split(/\n/).map(function (line) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return line.trim().split(/\s+/)[1]
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}).filter(function (line) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// only care about submodules in the node_modules folder.
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,return line && line.match(/^node_modules\//)
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,}).map(function (line) {
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"return line.replace(/^node_modules\//g, """")"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,// memoize.
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"getSubmodules = function (cb) { return cb(null, res) }"
1e6447360207f45ad6188e5780fdf4517de6e23d,0ab385b8d5db34d9cd486490f9f54ef49c94719d,deleted,1,"cb(null, res)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,", addLocal = require(""./add-local.js"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,", realizePackageSpecifier = require(""realize-package-specifier"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,git.whichAndExec(
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"[ ""config"", ""--get"", ""remote.origin.url"" ],"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"{ cwd : p, env : gitEnv },"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"function (er, stdout, stderr) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"var stdoutTrimmed = (stdout + ""\n"" + stderr).trim()"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (er || u !== stdout.trim()) {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.warn( ""`git config --get remote.origin.url` returned """
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"+ ""wrong result (""+u+"")"", stdoutTrimmed )"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"return rm(p, function (er){"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (er) return cb(er)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"cloneGitRemote(p, u, co, origUrl, silent, cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,})
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,}
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""git remote.origin.url"", stdoutTrimmed)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"fetchRemote(p, u, co, origUrl, cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"var templates = path.join(npm.config.get(""cache""), ""_git_remotes"", ""_templates"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"[ ""clone"", ""--template="" + templates, ""--mirror"", u, p ],"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"{ cwd : p, env : gitEnv() },"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"stdout = (stdout + ""\n"" + stderr).trim()"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (er) {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (silent) {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""git clone "" + u, stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,} else {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""git clone "" + u, stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,return cb(er)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"function fetchRemote (p, u, co, origUrl, cb) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"[ ""fetch"", ""-a"", ""origin"" ],"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""git fetch -a origin (""+u+"")"", stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""git fetch -a origin (""+u+"")"", stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"if (process.platform === ""win32"") {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.silly(""verifyOwnership"", ""skipping for windows"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,resolveHead()
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,else {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"getCacheStat(function(er, cs) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""Could not get cache stat"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"chownr(p, cs.uid, cs.gid, function(er) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""Failed to change folder ownership under npm cache for %s"", p)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"resolveHead(p, u, co, origUrl, cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"function resolveHead (p, u, co, origUrl, cb) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"[ ""rev-list"", ""-n1"", co ],"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,var resolved = url.format(parsed)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"if (parsed.protocol !== ""git:"") resolved = ""git+"" + resolved"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// node incorrectly sticks a / at the start of the path We know that the
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"// host won't change, so split and detect this"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"if (spo[1].charAt(0) === "":"" && spr[1].charAt(0) === ""/"") {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"cache(p, u, stdout, resolved, cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,/**
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,* Make an actual clone from the bare (mirrored) cache. There is no safe way to
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"* do a one-step clone to a treeish that isn't guaranteed to be a branch, so"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,* this has to be two steps.
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,*/
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"function cache (p, u, treeish, resolved, cb) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"var tmp = path.join(npm.tmp, Date.now()+""-""+Math.random(), treeish)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"[ ""clone"", p, tmp ],"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""Failed to clone ""+resolved+"" from ""+u, stderr)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""git clone"", ""from"", p)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""git clone"", stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"[ ""checkout"", treeish ],"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"{ cwd : tmp, env : gitEnv() },"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""Failed to check out ""+treeish, stderr)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.verbose(""git checkout"", stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"realizePackageSpecifier(tmp, function (er, spec) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"log.error(""Failed to map"", tmp, ""to a package specifier"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// https://github.com/npm/npm/issues/6400
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,// ensure pack logic is applied
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"addLocal(spec, null, function (er, data) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,if (data) data._resolved = resolved
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,added,0,"cb(er, data)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", once = require(""once"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", zlib = require(""zlib"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", addLocalTarball = require(""./add-local-tarball.js"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,", writeStream = require(""fs-write-stream-atomic"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var args = [ ""config"", ""--get"", ""remote.origin.url"" ]"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,var env = gitEnv()
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// check for git
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"git.whichAndExec(args, {cwd: p, env: env}, function (er, stdout, stderr) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var stdoutTrimmed = (stdout + ""\n"" + stderr).trim()"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (er || u !== stdout.trim()) {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.warn( ""`git config --get remote.origin.url` returned """
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"+ ""wrong result (""+u+"")"", stdoutTrimmed )"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"return rm(p, function (er){"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (er) return cb(er)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"cloneGitRemote(p, u, co, origUrl, silent, cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,})
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.verbose(""git remote.origin.url"", stdoutTrimmed)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"archiveGitRemote(p, u, co, origUrl, cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var args = [ ""clone"", ""--template="" + path.join(npm.config.get(""cache""),"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"""_git_remotes"", ""_templates""), ""--mirror"", u, p ]"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"stdout = (stdout + ""\n"" + stderr).trim()"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (er) {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (silent) {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.verbose(""git clone "" + u, stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,} else {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.error(""git clone "" + u, stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,return cb(er)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"function archiveGitRemote (p, u, co, origUrl, cb) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var archive = [ ""fetch"", ""-a"", ""origin"" ]"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var resolve = [ ""rev-list"", ""-n1"", co ]"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,var resolved = null
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,var tmp
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"git.whichAndExec(archive, {cwd: p, env: env}, function (er, stdout, stderr) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.error(""git fetch -a origin (""+u+"")"", stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,}
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.verbose(""git fetch -a origin (""+u+"")"", stdout)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"tmp = path.join(npm.tmp, Date.now()+""-""+Math.random(), ""tmp.tgz"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"if (process.platform === ""win32"") {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.silly(""verifyOwnership"", ""skipping for windows"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,resolveHead()
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"getCacheStat(function(er, cs) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.error(""Could not get cache stat"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"chownr(p, cs.uid, cs.gid, function(er) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.error(""Failed to change folder ownership under npm cache for %s"", p)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,function resolveHead () {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"git.whichAndExec(resolve, {cwd: p, env: env}, function (er, stdout, stderr) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,resolved = url.format(parsed)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"if (parsed.protocol !== ""git:"") {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"resolved = ""git+"" + resolved"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,// node incorrectly sticks a / at the start of the path
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"// We know that the host won't change, so split and detect this"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"if (spo[1].charAt(0) === "":"" && spr[1].charAt(0) === ""/"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,next()
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,function next () {
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"mkdir(path.dirname(tmp), function (er) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,var gzip = zlib.createGzip({ level: 9 })
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var args = [""archive"", co, ""--format=tar"", ""--prefix=package/""]"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,var out = writeStream(tmp)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,cb = once(cb)
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"var cp = git.spawn(args, { env: env, cwd: p })"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"cp.on(""error"", cb)"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"cp.stderr.on(""data"", function(chunk) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"log.silly(chunk.toString(), ""git archive"")"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"cp.stdout.pipe(gzip).pipe(out).on(""close"", function() {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"addLocalTarball(tmp, null, null, function(er, data) {"
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,if (data) data._resolved = resolved
00ecb6101422984696929f602e14da186f9f669c,0404aa49d0affc618b7b15b63eb07cdd7d49906a,deleted,1,"cb(er, data)"
aa2ea543e080461521cc1235d971284f012aae63,f6712869ee0f3f2cfa705aa626ae374213ef0fef,added,0,Object.keys(deps || []).forEach(function (d) {
aa2ea543e080461521cc1235d971284f012aae63,f6712869ee0f3f2cfa705aa626ae374213ef0fef,deleted,1,Object.keys(deps).forEach(function (d) {
0e8d4736a1cbdda41ae8eba8a02c7ff7ce80c2ff,1f108b8a1f0f28a21b4ba4d0b86037abfd426dcd,added,0,"mr({port : common.port}, function (er, server) {"
0e8d4736a1cbdda41ae8eba8a02c7ff7ce80c2ff,1f108b8a1f0f28a21b4ba4d0b86037abfd426dcd,deleted,1,"mr(common.port, function (server) {"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var bundled = data.bundleDependencies || data.bundledDependencies || []
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// only take the hit for readInstalled if there are probably bundled
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// dependencies to read
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (bundled.length) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"readInstalled(where, { dev: true }, andBuildResolvedTree)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,} else {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,andBuildResolvedTree()
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,}
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"function andBuildResolvedTree (er, current) {"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (er) return cb(er)
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,// each target will be a data object corresponding
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"// to a package, folder, or whatever that is in the cache now."
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var newPrev = Object.create(context.family)
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", newAnc = Object.create(context.ancestors)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (!context.root) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,newAnc[data.name] = data.version
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,bundled.forEach(function (bundle) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var bundleData = current.dependencies[bundle]
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if ((!bundleData || !bundleData.version) && current.devDependencies) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,log.verbose(
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"'installMany', bundle, 'was bundled with',"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,data.name + '@' + data.version +
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,""", but wasn't found in dependencies. Trying devDependencies"""
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,)
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,bundleData = current.devDependencies[bundle]
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (!bundleData || !bundleData.version) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,log.warn(
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,""", but bundled package wasn't found in unpacked tree"""
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"'installMany', bundle + '@' + bundleData.version,"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"'was bundled with', data.name + '@' + data.version"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,newPrev[bundle] = bundleData.version
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,})
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,targets.forEach(function (t) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,newPrev[t.name] = t.version
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.silly(""install resolved"", targets)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,targets.filter(function (t) { return t }).forEach(function (t) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.info(""install"", ""%s into %s"", t._id, where)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"asyncMap(targets, function (target, cb) {"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.info(""installOne"", target._id)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var wrapData = wrap ? wrap[target.name] : null
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var newWrap = wrapData && wrapData.dependencies
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,? wrap[target.name].dependencies || {}
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,: null
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var newContext = { family: newPrev
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", ancestors: newAnc"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", parent: parent"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", explicit: false"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,", wrap: newWrap }"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"installOne(target, where, newContext, cb)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"}, cb)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,var isBundled = bd && bd.indexOf(d.name) !== -1
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"var currentIsSatisfactory = semver.satisfies(d.version, deps[d.name] || ""*"", true)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (isBundled || currentIsSatisfactory || deps[d.name] === d._resolved) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.verbose('install', what, 'is installed as', context.family[what])"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,if (!cb_) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"return log.verbose(""installOne"", ""of"", target.name, ""to"", where, ""already in flight; waiting"")"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,else {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"log.verbose(""installOne"", ""of"", target.name, ""to"", where, ""not in flight; installing"")"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,added,0,"if (semver.validRange(family[d], true)) {"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,// each target will be a data object corresponding
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"// to a package, folder, or whatever that is in the cache now."
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,var newPrev = Object.create(context.family)
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", newAnc = Object.create(context.ancestors)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,if (!context.root) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,newAnc[data.name] = data.version
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,targets.forEach(function (t) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,newPrev[t.name] = t.version
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,})
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"log.silly(""install resolved"", targets)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,targets.filter(function (t) { return t }).forEach(function (t) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"log.info(""install"", ""%s into %s"", t._id, where)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"asyncMap(targets, function (target, cb) {"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"log.info(""installOne"", target._id)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,var wrapData = wrap ? wrap[target.name] : null
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,var newWrap = wrapData && wrapData.dependencies
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,? wrap[target.name].dependencies || {}
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,: null
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,var newContext = { family: newPrev
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", ancestors: newAnc"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", parent: parent"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", explicit: false"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,", wrap: newWrap }"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"installOne(target, where, newContext, cb)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"}, cb)"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,if (bd && bd.indexOf(d.name) !== -1 ||
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"semver.satisfies(d.version, deps[d.name] || ""*"", true) ||"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,deps[d.name] === d._resolved) {
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,if (!cb_) return log.verbose(
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"""installOne"","
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"""of"", target.name,"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"""to"", where,"
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"""already in flight; waiting"""
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,)
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,else log.verbose(
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"""not in flight; installing"""
051c4738486a826300f205b71590781ce7744f01,f16f7c3ec31ce2bd7460651075340d034677b7f0,deleted,1,"if (semver.validRange(family[d], true))"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var url = require('url')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var semver = require('semver')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var crypto = require('crypto')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var Stream = require('stream').Stream
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var assert = require('assert')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var fixer = require('normalize-package-data/lib/fixer.js')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var concat = require('concat-stream')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"return name.replace('/', '%2f')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"assert(typeof uri === 'string', 'must pass registry URI to publish')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"assert(params && typeof params === 'object', 'must pass params to publish')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"assert(typeof cb === 'function', 'must pass callback to publish')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"(!access) || ['public', 'restricted'].indexOf(access) !== -1,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"assert(auth && typeof auth === 'object', 'must pass auth to publish')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var er = new Error('auth required for publishing')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,er.code = 'ENEEDAUTH'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"metadata && typeof metadata === 'object',"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'must pass package metadata to publish'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,} catch (er) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,if (!version) return cb(new Error('invalid semver: ' + metadata.version))
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"assert(body, 'must pass package body to publish')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"assert(body instanceof Stream, 'package body passed to publish must be a stream')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"sink.on('error', cb)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var root = {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"_id: data.name,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"name: data.name,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"description: data.description,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"'dist-tags': {},"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"versions: {},"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,readme: data.readme || ''
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,}
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"root.maintainers = [{ name: auth.username, email: auth.email }]"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,root['dist-tags'][tag] = data.version
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var tbName = data.name + '-' + data.version + '.tgz'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var tbURI = data.name + '/-/' + tbName
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,data._id = data.name + '@' + data.version
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,data.dist.shasum = crypto.createHash('sha1').update(tarbuffer).digest('hex')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,".replace(/^https:\/\//, 'http://')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"'content_type': 'application/octet-stream',"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"'data': tarbuffer.toString('base64'),"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'length': tarbuffer.length
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"method: 'PUT',"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"body: root,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,auth: auth
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var r409 = 'must supply latest _rev to update existing package'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var r409b = 'Document update conflict.'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,if (parsed && (parsed.reason === r409 || parsed.reason === r409b)) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"client.log.error('publish', 'Failed PUT ' + (res && res.statusCode))"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"if (!er && !conflict) return cb(er, parsed, json, res)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"client.request(fixed + '?write=true', { auth: auth }, function (er, current) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,}).concat(Object.keys(current.time || {}).map(function (v) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"if (semver.valid(v, true)) return semver.clean(v, true)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,}).filter(function (v) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,case 'dist-tags':
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,case 'versions':
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,case '_attachments':
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,case 'maintainers':
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"body: current,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var e = new Error('cannot modify pre-existing version')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,e.code = 'EPUBLISHCONFLICT'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var test = require('tap').test
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var fs = require('fs')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var server = require('./lib/server.js')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var common = require('./lib/common.js')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var URI = 'http://localhost:1337/'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var USERNAME = 'username'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var PASSWORD = '%1234@asdf%'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var EMAIL = 'i@izs.me'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var METADATA = require('../package.json')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var ACCESS = 'public'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var BODY_PATH = require.resolve('../package.json')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var BODY = fs.createReadStream(BODY_PATH)
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var AUTH = {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"username: USERNAME,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"password: PASSWORD,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,email: EMAIL
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var PARAMS = {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"metadata: METADATA,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"access: ACCESS,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"body: BODY,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,auth: AUTH
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"test('publish call contract', function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"}, 'requires a URI')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"}, 'requires URI to be a string')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"}, 'requires params object')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"client.publish(URI, '', nop)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"}, 'params must be object')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"}, 'requires callback')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"client.publish(URI, PARAMS, 'callback')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"}, 'callback must be function')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"{ name: 'AssertionError', message: 'must pass package metadata to publish' },"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'params must include metadata for package'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"{ name: 'AssertionError', message: 'must pass package body to publish' },"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'params must include body of package to publish'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,body: BODY
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"{ name: 'AssertionError', message: 'must pass auth to publish' },"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'params must include auth'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"metadata: -1,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'metadata must be object'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"access: 'hamchunx',"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"name: 'AssertionError',"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"message: ""if present, access level must be either 'public' or 'restricted'"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"body: -1,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,message: 'package body passed to publish must be a stream'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'body must be a Stream'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"t.test('malformed semver in publish', function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,metadata.version = '%!@#$'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"metadata: metadata,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"message: BODY,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"'invalid semver: %!@#$',"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,'got expected semver validation failure'
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"test('publish', function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"var pd = fs.readFileSync(BODY_PATH, 'base64')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"server.expect('/npm-registry-client', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"t.equal(req.method, 'PUT')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var b = ''
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,req.setEncoding('utf8')
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"req.on('data', function (d) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"req.on('end', function () {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"t.equal(o._id, 'npm-registry-client')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"t.equal(o['dist-tags'].latest, METADATA.version)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"t.same(o.maintainers, [{ name: 'username', email: 'i@izs.me' }])"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,var att = o._attachments[METADATA.name + '-' + METADATA.version + '.tgz']
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"var hash = crypto.createHash('sha1').update(pd, 'base64').digest('hex')"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,res.json({ created: true })
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,added,0,"t.deepEqual(data, { created: true })"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var url = require(""url"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", semver = require(""semver"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", crypto = require(""crypto"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", Stream = require(""stream"").Stream"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", assert = require(""assert"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", fixer = require(""normalize-package-data/lib/fixer.js"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", concat = require(""concat-stream"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"return name.replace(""/"", ""%2f"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"assert(typeof uri === ""string"", ""must pass registry URI to publish"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"assert(params && typeof params === ""object"", ""must pass params to publish"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"assert(typeof cb === ""function"", ""must pass callback to publish"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"(!access) || [""public"", ""restricted""].indexOf(access) !== -1,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"assert(auth && typeof auth === ""object"", ""must pass auth to publish"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var er = new Error(""auth required for publishing"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"er.code = ""ENEEDAUTH"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"metadata && typeof metadata === ""object"","
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""must pass package metadata to publish"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,}
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,catch (er) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"if (!version) return cb(new Error(""invalid semver: "" + metadata.version))"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"assert(body, ""must pass package body to publish"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"assert(body instanceof Stream, ""package body passed to publish must be a stream"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"sink.on(""error"", cb)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,var root =
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,{ _id : data.name
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", name : data.name"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", description : data.description"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", ""dist-tags"" : {}"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", versions : {}"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", readme: data.readme || """""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"root.maintainers = [{name : auth.username, email : auth.email}]"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"root[""dist-tags""][tag] = data.version"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var tbName = data.name + ""-"" + data.version + "".tgz"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,", tbURI = data.name + ""/-/"" + tbName"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"data._id = data.name+""@""+data.version"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"data.dist.shasum = crypto.createHash(""sha1"").update(tarbuffer).digest(""hex"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,".replace(/^https:\/\//, ""http://"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""content_type"": ""application/octet-stream"","
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""data"": tarbuffer.toString(""base64""),"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""length"": tarbuffer.length"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"method : ""PUT"","
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"body : root,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,auth : auth
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var r409 = ""must supply latest _rev to update existing package"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var r409b = ""Document update conflict."""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,if (parsed && (parsed.reason === r409 || parsed.reason === r409b))
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"client.log.error(""publish"", ""Failed PUT ""+(res && res.statusCode))"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,if (!er && !conflict)
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"return cb(er, parsed, json, res)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"client.request(fixed+""?write=true"", { auth : auth }, function (er, current) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,}).concat(Object.keys(current.time || {}).map(function(v) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"if (semver.valid(v, true))"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"return semver.clean(v, true)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,}).filter(function(v) {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"case ""dist-tags"":"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"case ""versions"":"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"case ""_attachments"":"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"case ""maintainers"":"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"body   : current,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,auth   : auth
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var e = new Error(""cannot modify pre-existing version"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"e.code = ""EPUBLISHCONFLICT"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var test = require(""tap"").test"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var crypto = require(""crypto"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var fs = require(""fs"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var server = require(""./lib/server.js"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var common = require(""./lib/common.js"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var URI       = ""http://localhost:1337/"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var USERNAME  = ""username"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var PASSWORD  = ""%1234@asdf%"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var EMAIL     = ""i@izs.me"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var METADATA  = require(""../package.json"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var ACCESS    = ""public"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var BODY_PATH = require.resolve(""../package.json"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var BODY      = fs.createReadStream(BODY_PATH, ""base64"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,var AUTH      = {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"username : USERNAME,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"password : PASSWORD,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,email    : EMAIL
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,var PARAMS  = {
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"metadata : METADATA,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"access   : ACCESS,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"body     : BODY,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,auth     : AUTH
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"test(""publish call contract"", function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"}, ""requires a URI"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"}, ""requires URI to be a string"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"}, ""requires params object"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"client.publish(URI, """", nop)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"}, ""params must be object"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"}, ""requires callback"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"client.publish(URI, PARAMS, ""callback"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"}, ""callback must be function"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"access : ACCESS,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"body : BODY,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,auth : AUTH
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"{ name : ""AssertionError"", message : ""must pass package metadata to publish"" },"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""params must include metadata for package"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"{ name : ""AssertionError"", message : ""must pass package body to publish"" },"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""params must include body of package to publish"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,body : BODY
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"{ name : ""AssertionError"", message : ""must pass auth to publish"" },"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""params must include auth"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"metadata : -1,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""metadata must be object"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"access : ""hamchunx"","
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"name    : ""AssertionError"","
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"message : ""if present, access level must be either 'public' or 'restricted'"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"body : -1,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"message : ""package body passed to publish must be a stream"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""body must be a Stream"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"t.test(""malformed semver in publish"", function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"metadata.version = ""%!@#$"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"metadata : metadata,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"message : BODY,"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""invalid semver: %!@#$"","
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"""got expected semver validation failure"""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"test(""publish"", function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var pd = fs.readFileSync(BODY_PATH, ""base64"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"server.expect(""/npm-registry-client"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"t.equal(req.method, ""PUT"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var b = """""
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"req.setEncoding(""utf8"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"req.on(""data"", function (d) {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"req.on(""end"", function () {"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"t.equal(o._id, ""npm-registry-client"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"t.equal(o[""dist-tags""].latest, METADATA.version)"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"t.same(o.maintainers, [{ name : ""username"", email : ""i@izs.me"" }])"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var att = o._attachments[METADATA.name+""-""+METADATA.version+"".tgz""]"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"var hash = crypto.createHash(""sha1"").update(pd, ""base64"").digest(""hex"")"
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,res.json({ created : true })
fe1bc387a14475e373557de669e03d9d006d3173,2da4f398bf3fe0880b520e299ce0d91c8d20f0c4,deleted,1,"t.deepEqual(data, { created : true })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var assert = require('assert')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var url = require('url')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var zlib = require('zlib')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var Stream = require('stream').Stream
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var request = require('request')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var once = require('once')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"assert(typeof uri === 'string', 'must pass uri to request')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"assert(params && typeof params === 'object', 'must pass params to request')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"assert(typeof cb_ === 'function', 'must pass callback to request')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,params.method = params.method || 'GET'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('request', 'uri', uri)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var isUserChange = uri.match(adduserChange)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var adduserNew = /\/?-\/user\/org\.couchdb\.user:([^/?]+)$/
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var isNewUser = uri.match(adduserNew)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var alwaysAuth = params.auth && params.auth.alwaysAuth
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var isDelete = params.method === 'DELETE'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var isWrite = params.body || isDelete
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,return cb(new Error('trying to change user document without writing(?!)'))
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('request', 'updating existing user; sending authorization')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else if (isNewUser) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('request', ""new user, so can't send auth"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else if (alwaysAuth) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('request', 'always-auth set; sending authorization')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else if (isWrite) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('request', 'sending authorization for write operation')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('request', 'no auth needed')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (er) er.code = 'ESSL'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"self.log.info('retry', 'will retry, error on last attempt: ' + er)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"self.log.verbose('headers', response.headers)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (response.headers['npm-notice']) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"self.log.warn('notice', response.headers['npm-notice'])"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers['accept-encoding'] = 'gzip'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"'application/json',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,opts.followRedirect = (typeof params.follow === 'boolean' ? params.follow : true)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('etag', params.etag)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers[params.method === 'GET' ? 'if-none-match' : 'if-match'] = params.etag
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (params.lastModified && params.method === 'GET') {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('lastModified', params.lastModified)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers['if-modified-since'] = params.lastModified
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers['content-type'] = 'application/json'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers['content-length'] = params.body.length
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else if (typeof params.body === 'string') {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers['content-length'] = Buffer.byteLength(params.body)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else if (params.body instanceof Stream) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,headers['content-type'] = 'application/octet-stream'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (params.body.size) headers['content-length'] = params.body.size
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.http('request', params.method, parsed.href || '/')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"req.on('error', cb)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"req.on('socket', function (s) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"s.on('error', cb)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,function decodeResponseBody (cb) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (response.headers['content-encoding'] !== 'gzip') {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (urlObj.auth) urlObj.auth = '***'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (data && typeof data === 'string' && response.statusCode !== 304) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,ex.message += '\n' + data
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.verbose('bad json', data)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"this.log.error('registry', 'error parsing json')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,return cb(
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"response.statusCode + ' ' + require('http').STATUS_CODES[response.statusCode],"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"null,"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"data,"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,response
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (parsed && response.headers['last-modified']) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,parsed._lastModified = response.headers['last-modified']
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"// for the search endpoint, the 'error' property can be an object"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,if (parsed && parsed.error && typeof parsed.error !== 'object' ||
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,w = w.split('/')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,name = w[w.indexOf('_rewrite') + 1]
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'Registry returned ' + response.statusCode +
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,' for ' + method +
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,' on ' + where
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,} else if (name && parsed.error === 'not_found') {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,er = new Error('404 Not Found: ' + name)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,parsed.error + ' ' + (parsed.reason || '') + ': ' + w
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,er.code = 'E' + er.statusCode
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var Readable = require('stream').Readable
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var inherits = require('util').inherits
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var test = require('tap').test
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var concat = require('concat-stream')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var server = require('./lib/server.js')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var common = require('./lib/common.js')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,function OneA () {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,this.push('A')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var URI = 'http://localhost:1337/'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var USERNAME = 'username'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var PASSWORD = '%1234@asdf%'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var EMAIL = 'i@izs.me'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var AUTH = {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"username: USERNAME,"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"password: PASSWORD,"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,email: EMAIL
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var PARAMS = { auth: AUTH }
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"test('request call contract', function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"{ name: 'AssertionError', message: 'must pass uri to request' },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'requires a URI'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'requires URI to be a string'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"{ name: 'AssertionError', message: 'must pass params to request' },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'requires params object'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(URI, '', nop)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'params must be object'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"{ name: 'AssertionError', message: 'must pass callback to request' },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'requires callback'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(URI, PARAMS, 'callback')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'callback must be function'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"test('run request through its paces', function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('/request-defaults', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(req.method, 'GET', 'uses GET by default')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.notOk(d.toString('utf7'), 'no data included in request')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ fetched: 'defaults' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('/last-modified', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(req.headers['if-modified-since'], 'test-last-modified',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'got test if-modified-since')
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ fetched: 'last-modified' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('/etag', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(req.headers['if-none-match'], 'test-etag', 'got test etag')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ fetched: 'etag' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('POST', '/etag-post', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(req.headers['if-match'], 'post-etag', 'got test post etag')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ posted: 'etag' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('PUT', '/body-stream', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(d.toString('utf8'), 'A', 'streamed expected data')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ put: 'stream' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('PUT', '/body-buffer', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(d.toString('utf8'), 'hi', 'streamed expected data')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ put: 'buffer' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('PUT', '/body-string', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(d.toString('utf8'), 'erp', 'streamed expected data')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ put: 'string' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('PUT', '/body-object', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(d.toString('utf8'), '[""tricky""]', 'streamed expected data')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ put: 'object' })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('GET', '/body-error-string', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"res.json({ error: 'not really an error', reason: 'unknown' })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"server.expect('GET', '/body-error-object', function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,res.json({ error: {} })
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"common.registry + '/request-defaults',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.ifError(er, 'call worked')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { fetched: 'defaults' }, 'confirmed defaults work')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.equal(response.headers.connection, 'keep-alive', 'keep-alive set')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var lastModified = { lastModified: 'test-last-modified' }
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/last-modified', lastModified, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { fetched: 'last-modified' }, 'last-modified request sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,var etagged = { etag: 'test-etag' }
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/etag', etagged, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { fetched: 'etag' }, 'etag request sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"method: 'post',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,etag: 'post-etag'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/etag-post', postEtagged, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { posted: 'etag' }, 'POST etag request sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"method: 'PUT',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"body: new OneA(),"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,auth: AUTH
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/body-stream', putStream, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { put: 'stream' }, 'PUT request with stream sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"body: new Buffer('hi'),"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/body-buffer', putBuffer, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { put: 'buffer' }, 'PUT request with buffer sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"body: 'erp',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/body-string', putString, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { put: 'string' }, 'PUT request with string sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"body: { toJSON: function () { return ['tricky'] } },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/body-object', putObject, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"t.deepEquals(data, { put: 'object' }, 'PUT request with object sent')"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/body-error-string', defaults, function (er) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"'not really an error unknown: body-error-string',"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,'call worked'
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,added,0,"client.request(common.registry + '/body-error-object', defaults, function (er) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var assert = require(""assert"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", url = require(""url"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", zlib = require(""zlib"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", Stream = require(""stream"").Stream"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var request = require(""request"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", once = require(""once"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"assert(typeof uri === ""string"", ""must pass uri to request"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"assert(params && typeof params === ""object"", ""must pass params to request"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"assert(typeof cb_ === ""function"", ""must pass callback to request"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"params.method = params.method || ""GET"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""request"", ""uri"", uri)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", isUserChange = uri.match(adduserChange)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", adduserNew = /\/?-\/user\/org\.couchdb\.user:([^/?]+)$/"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", isNewUser = uri.match(adduserNew)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", alwaysAuth = params.auth && params.auth.alwaysAuth"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", isDelete = params.method === ""DELETE"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", isWrite = params.body || isDelete"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"return cb(new Error(""trying to change user document without writing(?!)""))"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""request"", ""updating existing user; sending authorization"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,}
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,else if (isNewUser) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""request"", ""new user, so can't send auth"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,else if (alwaysAuth) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""request"", ""always-auth set; sending authorization"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,else if (isWrite) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""request"", ""sending authorization for write operation"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,else {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""request"", ""no auth needed"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,if (er)
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"er.code = ""ESSL"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"self.log.info(""retry"", ""will retry, error on last attempt: "" + er)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"self.log.verbose(""headers"", response.headers)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (response.headers[""npm-notice""]) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"self.log.warn(""notice"", response.headers[""npm-notice""])"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[""accept-encoding""] = ""gzip"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""application/json"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"opts.followRedirect = (typeof params.follow === ""boolean"" ? params.follow : true)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""etag"", params.etag)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[params.method === ""GET"" ? ""if-none-match"" : ""if-match""] = params.etag"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (params.lastModified && params.method === ""GET"") {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""lastModified"", params.lastModified)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[""if-modified-since""] = params.lastModified"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[""content-type""] = ""application/json"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[""content-length""] = params.body.length"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"else if (typeof params.body === ""string"") {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[""content-length""] = Buffer.byteLength(params.body)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,else if (params.body instanceof Stream) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"headers[""content-type""] = ""application/octet-stream"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (params.body.size) headers[""content-length""] = params.body.size"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.http(""request"", params.method, parsed.href || ""/"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"req.on(""error"", cb)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"req.on(""socket"", function (s) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"s.on(""error"", cb)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,function decodeResponseBody(cb) {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (response.headers[""content-encoding""] !== ""gzip"") {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (urlObj.auth) urlObj.auth = ""***"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (data && typeof data === ""string"" && response.statusCode !== 304) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"ex.message += ""\n"" + data"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.verbose(""bad json"", data)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.log.error(""registry"", ""error parsing json"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"return cb( response.statusCode + "" """
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"+ require(""http"").STATUS_CODES[response.statusCode]"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,", null, data, response )"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (parsed && response.headers[""last-modified""]) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"parsed._lastModified = response.headers[""last-modified""]"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"// for the search endpoint, the ""error"" property can be an object"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"if (parsed && parsed.error && typeof parsed.error !== ""object"" ||"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"w = w.split(""/"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"name = w[w.indexOf(""_rewrite"") + 1]"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""Registry returned "" + response.statusCode +"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,""" for "" + method +"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,""" on "" + where"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"else if (name && parsed.error === ""not_found"") {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"er = new Error(""404 Not Found: "" + name)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"parsed.error + "" "" + (parsed.reason || """") + "": "" + w"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"er.code = ""E"" + er.statusCode"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var Readable = require(""stream"").Readable"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var inherits = require(""util"").inherits"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var test = require(""tap"").test"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var concat = require(""concat-stream"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var server = require(""./lib/server.js"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var common = require(""./lib/common.js"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,function OneA() {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"this.push(""A"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var URI       = ""http://localhost:1337/"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var USERNAME  = ""username"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var PASSWORD  = ""%1234@asdf%"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var EMAIL     = ""i@izs.me"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,var AUTH      = {
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"username : USERNAME,"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"password : PASSWORD,"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,email    : EMAIL
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,var PARAMS    = { auth : AUTH }
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"test(""request call contract"", function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"{ name : ""AssertionError"", message : ""must pass uri to request"" },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""requires a URI"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""requires URI to be a string"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"{ name : ""AssertionError"", message : ""must pass params to request"" },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""requires params object"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(URI, """", nop)"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""params must be object"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"{ name : ""AssertionError"", message : ""must pass callback to request"" },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""requires callback"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(URI, PARAMS, ""callback"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""callback must be function"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"test(""run request through its paces"", function (t) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""/request-defaults"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(req.method, ""GET"", ""uses GET by default"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.notOk(d.toString(""utf7""), ""no data included in request"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ fetched : ""defaults"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""/last-modified"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(req.headers[""if-modified-since""], ""test-last-modified"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""got test if-modified-since"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ fetched : ""last-modified"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""/etag"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(req.headers[""if-none-match""], ""test-etag"", ""got test etag"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ fetched : ""etag"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""POST"", ""/etag-post"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(req.headers[""if-match""], ""post-etag"", ""got test post etag"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ posted : ""etag"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""PUT"", ""/body-stream"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(d.toString(""utf8""), ""A"", ""streamed expected data"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ put : ""stream"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""PUT"", ""/body-buffer"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(d.toString(""utf8""), ""hi"", ""streamed expected data"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ put : ""buffer"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""PUT"", ""/body-string"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(d.toString(""utf8""), ""erp"", ""streamed expected data"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ put : ""string"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""PUT"", ""/body-object"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(d.toString(""utf8""), '[""tricky""]', ""streamed expected data"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ put : ""object"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""GET"", ""/body-error-string"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ ""error"" : ""not really an error"", ""reason"" : ""unknown"" })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"server.expect(""GET"", ""/body-error-object"", function (req, res) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"res.json({ ""error"" : {} })"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"common.registry+""/request-defaults"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.ifError(er, ""call worked"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { fetched : ""defaults"" }, ""confirmed defaults work"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.equal(response.headers.connection, ""keep-alive"", ""keep-alive set"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var lastModified = { lastModified : ""test-last-modified"" }"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/last-modified"", lastModified, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { fetched : ""last-modified"" }, ""last-modified request sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"var etagged = { etag : ""test-etag"" }"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/etag"", etagged, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { fetched : ""etag"" }, ""etag request sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"method : ""post"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"etag   : ""post-etag"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/etag-post"", postEtagged, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { posted : ""etag"" }, ""POST etag request sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"method : ""PUT"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"body : new OneA(),"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,auth : AUTH
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/body-stream"", putStream, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { put : ""stream"" }, ""PUT request with stream sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"body : new Buffer(""hi""),"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/body-buffer"", putBuffer, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { put : ""buffer"" }, ""PUT request with buffer sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"body : ""erp"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/body-string"", putString, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { put : ""string"" }, ""PUT request with string sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"body : { toJSON : function () { return [ ""tricky"" ] } },"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/body-object"", putObject, function (er, data) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"t.deepEquals(data, { put : ""object"" }, ""PUT request with object sent"")"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/body-error-string"", defaults, function (er) {"
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""not really an error unknown: body-error-string"","
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"""call worked"""
fe1bc387a14475e373557de669e03d9d006d3173,a3762de843b842be8fa0ab57cdcd6b164f145942,deleted,1,"client.request(common.registry+""/body-error-object"", defaults, function (er) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var fs
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,fs = require('graceful-fs')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,fs = require('fs')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var path = require('path')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var glob = require('glob')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var normalizeData = require('normalize-package-data')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var safeJSON = require('json-parse-helpfulerror')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,module.exports = readJson
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"gypfile,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"serverjs,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"scriptpath,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"authors,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"readme,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"mans,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"bins,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,githead
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var log, strict, cb"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,for (var i = 1; i < arguments.length - 1; i++) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (typeof arguments[i] === 'boolean') {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,strict = arguments[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,} else if (typeof arguments[i] === 'function') {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,log = arguments[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,}
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!log) log = function () {}
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,cb = arguments[ arguments.length - 1 ]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"readJson_(file, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"function readJson_ (file, log, strict, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.readFile(file, 'utf8', function (er, d) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"parseJson(file, er, d, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,})
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,function stripBOM (content) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,// Remove byte order marker. This catches EF BB BF (the UTF-8 BOM)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,// because the buffer-to-string conversion in `fs.readFileSync()`
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"// translates it to FEFF, the UTF-16 BOM."
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (content.charCodeAt(0) === 0xFEFF) content = content.slice(1)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return content
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (er && er.code === 'ENOENT') return indexjs(file, er, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (er) return cb(er)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,try {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,d = safeJSON.parse(stripBOM(d))
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,} catch (er) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,d = parseIndex(d)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (!d) return cb(parseError(er, file))"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"extras(file, d, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"function indexjs (file, er, log, strict, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (path.basename(file) === 'index.js') return cb(er)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var index = path.resolve(path.dirname(file), 'index.js')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.readFile(index, 'utf8', function (er2, d) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (er2) return cb(er)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!d) return cb(er)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,for (var i = 2; i < arguments.length - 1; i++) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,cb = arguments[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var set = readJson.extraSet
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var n = set.length
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var errState = null
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,set.forEach(function (fn) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fn(file, data, then)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,function then (er) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (errState) return
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (er) return cb(errState = er)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (--n > 0) return
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"final(file, data, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (!data.scripts) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var k = Object.keys(data.scripts)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"k.forEach(scriptpath_, data.scripts)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,function scriptpath_ (key) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var s = this[key]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"// This is never allowed, and only causes problems"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (typeof s !== 'string') return delete this[key]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var spre = /^(\.[\/\\])?node_modules[\/\\].bin[\\\/]/
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (s.match(spre)) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"this[key] = this[key].replace(spre, '')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var dir = path.dirname(file)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var s = data.scripts || {}
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (s.install || s.preinstall) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"glob('*.gyp', { cwd: dir }, function (er, files) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"gypfile_(file, data, files, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (!files.length) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,s.install = 'node-gyp rebuild'
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.scripts = s
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.gypfile = true
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (s.start) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"glob('server.js', { cwd: dir }, function (er, files) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"serverjs_(file, data, files, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,s.start = 'node server.js'
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (data.contributors) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var af = path.resolve(path.dirname(file), 'AUTHORS')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.readFile(af, 'utf8', function (er, ad) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,// ignore error.  just checking it.
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (er) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"authors_(file, data, ad, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"function authors_ (file, data, ad, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,ad = ad.split(/\r?\n/g).map(function (line) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"return line.replace(/^\s*#.*$/, '').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,}).filter(function (line) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return line
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.contributors = ad
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (data.readme) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var globOpts = { cwd: dir, nocase: true, mark: true }"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"glob('{README,README.*}', globOpts, function (er, files) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,// don't accept directories.
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,files = files.filter(function (file) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return !file.match(/\/$/)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!files.length) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var fn = preferMarkdownReadme(files)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var rm = path.resolve(dir, fn)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"readme_(file, data, rm, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,function preferMarkdownReadme (files) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var fallback = 0
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var re = /\.m?a?r?k?d?o?w?n?$/i
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,for (var i = 0; i < files.length; i++) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (files[i].match(re)) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return files[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,} else if (files[i].match(/README$/)) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,fallback = i
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"// prefer README.md, followed by README; otherwise, return"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,// the first filename (which could be README)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return files[fallback]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"function readme_ (file, data, rm, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var rmfn = path.basename(rm)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.readFile(rm, 'utf8', function (er, rm) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"// maybe not readable, or something."
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (er) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.readme = rm
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.readmeFilename = rmfn
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"return cb(er, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var m = data.directories && data.directories.man
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (data.man || !m) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"m = path.resolve(path.dirname(file), m)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"glob('**/*.[0-9]', { cwd: m }, function (er, mans) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"mans_(file, data, mans, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.man = mans.map(function (mf) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"return path.resolve(path.dirname(file), m, mf)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (Array.isArray(data.bin)) return bins_(file, data, data.bin, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var m = data.directories && data.directories.bin
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (data.bin || !m) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"glob('**', { cwd: m }, function (er, bins) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"bins_(file, data, bins, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var m = data.directories && data.directories.bin || '.'
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"data.bin = bins.reduce(function (acc, mf) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (mf && mf.charAt(0) !== '.') {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var f = path.basename(mf)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"acc[f] = path.join(m, mf)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return acc
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"}, {})"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (data.gitHead) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var head = path.resolve(dir, '.git/HEAD')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.readFile(head, 'utf8', function (er, head) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"githead_(file, data, dir, head, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!head.match(/^ref: /)) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.gitHead = head.trim()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var headFile = head.replace(/^ref: /, '').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"headFile = path.resolve(dir, '.git', headFile)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.readFile(headFile, 'utf8', function (er, head) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (er || !head) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"head = head.replace(/^ref: /, '').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data.gitHead = head
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!(data.bin instanceof Object)) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var keys = Object.keys(data.bin)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var keysLeft = keys.length
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!keysLeft) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"function handleExists (relName, result) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,keysLeft--
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!result) warn('No bin file found at ' + relName)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (!keysLeft) cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,keys.forEach(function (key) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var dirName = path.dirname(file)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var relName = data.bin[key]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var binPath = path.resolve(dirName, relName)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"fs.exists(binPath, handleExists.bind(null, relName))"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var pId = makePackageId(data)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,function warn (msg) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (typoWarned[pId]) return
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"if (log) log('package.json', pId, msg)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"normalizeData(data, warn, strict)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,} catch (error) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return cb(error)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"checkBinReferences_(file, data, warn, function () {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,typoWarned[pId] = true
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var name = cleanString(data.name)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var ver = cleanString(data.version)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return name + '@' + ver
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,function cleanString (str) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return (!str || typeof (str) !== 'string') ? '' : str.trim()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data = data.split(/^\/\*\*package(?:\s|$)/m)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,if (data.length < 2) return null
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data = data[1]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data = data.split(/\*\*\/$/m)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,data = data[0]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"data = data.replace(/^\s*\*/mg, '')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return safeJSON.parse(data)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return null
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var e = new Error('Failed to parse json\n' + ex.message)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,e.code = 'EJSONPARSE'
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,e.file = file
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,return e
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// vim: set softtabstop=16 shiftwidth=16:
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var fs = require(""graceful-fs"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var fs = require(""fs"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,module.exports = readJson
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var LRU = require(""lru-cache"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,readJson.cache = new LRU({max: 1000})
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var path = require(""path"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var glob = require(""glob"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var normalizeData = require(""normalize-package-data"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var jsonparse = require(""json-parse-helpfulerror"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"gypfile,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"serverjs,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"scriptpath,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"authors,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"readme,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"mans,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"bins,"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,githead
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var log, strict, cb"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,for (var i = 1; i < arguments.length - 1; i++) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (typeof arguments[i] === 'boolean')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,strict = arguments[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,else if (typeof arguments[i] === 'function')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,log = arguments[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,}
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!log) log = function () {};
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,cb = arguments[ arguments.length - 1 ]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var c = readJson.cache.get(file)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (c) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"cb = cb.bind(null, null, c)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return process.nextTick(cb);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"cb = (function (orig) { return function (er, data) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data) readJson.cache.set(file, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return orig(er, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,} })(cb)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"readJson_(file, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function readJson_ (file, log, strict, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(file, ""utf8"", function (er, d) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"parseJson(file, er, d, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,})
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,function stripBOM(content) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// Remove byte order marker. This catches EF BB BF (the UTF-8 BOM)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// because the buffer-to-string conversion in `fs.readFileSync()`
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"// translates it to FEFF, the UTF-16 BOM."
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (content.charCodeAt(0) === 0xFEFF) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,content = content.slice(1);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return content;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (er && er.code === ""ENOENT"") {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"indexjs(file, er, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (er) return cb(er);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,try {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,d = jsonparse.parse(stripBOM(d))
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,} catch (er) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,d = parseIndex(d)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (!d) return cb(parseError(er, file));"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"extras(file, d, log, strict, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function indexjs (file, er, log, strict, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (path.basename(file) === ""index.js"") {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return cb(er);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var index = path.resolve(path.dirname(file), ""index.js"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(index, ""utf8"", function (er2, d) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (er2) return cb(er);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!d) return cb(er);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,for (var i = 2; i < arguments.length - 1; i++) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,cb = arguments[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var set = readJson.extraSet
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var n = set.length
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var errState = null
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,set.forEach(function (fn) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fn(file, data, then)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,function then(er) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (errState) return;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (er) return cb(errState = er);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (--n > 0) return;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"final(file, data, log, strict, cb);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (!data.scripts) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var k = Object.keys(data.scripts)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"k.forEach(scriptpath_, data.scripts)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,function scriptpath_(key) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,s = this[key]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"// This is never allowed, and only causes problems"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (typeof s !== 'string')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return delete this[key]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var spre = /^(\.[\/\\])?node_modules[\/\\].bin[\\\/]/
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (s.match(spre))
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"this[key] = this[key].replace(spre, '')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var dir = path.dirname(file)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var s = data.scripts || {}
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (s.install || s.preinstall)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"glob(""*.gyp"", { cwd: dir }, function (er, files) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"gypfile_(file, data, files, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (!files.length) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"s.install = ""node-gyp rebuild"""
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.scripts = s
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.gypfile = true
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (s.start) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"glob(""server.js"", { cwd: dir }, function (er, files) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"serverjs_(file, data, files, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"s.start = ""node server.js"""
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data.contributors) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var af = path.resolve(path.dirname(file), ""AUTHORS"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(af, ""utf8"", function (er, ad) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// ignore error.  just checking it.
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (er) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"authors_(file, data, ad, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function authors_ (file, data, ad, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,ad = ad.split(/\r?\n/g).map(function (line) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return line.replace(/^\s*#.*$/, '').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,}).filter(function (line) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return line
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.contributors = ad
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var defDesc = ""Unnamed repository; edit this file "" +"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""'description' to name the repository."""
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function gitDescription (file, data, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data.description) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// just cuz it'd be nice if this file mattered...
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var gitDesc = path.resolve(dir, '.git/description')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(gitDesc, 'utf8', function (er, desc) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (desc) desc = desc.trim()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!er && desc !== defDesc)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.description = desc
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function readmeDescription (file, data) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var d = data.readme
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!d) return;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// the first block of text before the first heading
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// that isn't the first line heading
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,d = d.trim().split('\n')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,for (var s = 0; d[s] && d[s].trim().match(/^(#|$)/); s ++);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var l = d.length
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,for (var e = s + 1; e < l && d[e].trim(); e ++);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"data.description = d.slice(s, e).join(' ').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data.readme) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var globOpts = { cwd: dir, nocase: true, mark: true }"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"glob(""{README,README.*}"", globOpts, function (er, files) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// don't accept directories.
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,files = files.filter(function (file) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return !file.match(/\/$/)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!files.length) return cb();
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var fn = preferMarkdownReadme(files)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var rm = path.resolve(dir, fn)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"readme_(file, data, rm, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,function preferMarkdownReadme(files) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var fallback = 0;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var re = /\.m?a?r?k?d?o?w?n?$/i
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,for (var i = 0; i < files.length; i++) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (files[i].match(re))
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return files[i]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,else if (files[i].match(/README$/))
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,fallback = i
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"// prefer README.md, followed by README; otherwise, return"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// the first filename (which could be README)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return files[fallback];
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function readme_(file, data, rm, cb) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var rmfn = path.basename(rm);
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(rm, ""utf8"", function (er, rm) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"// maybe not readable, or something."
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (er) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.readme = rm
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.readmeFilename = rmfn
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return cb(er, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var m = data.directories && data.directories.man
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data.man || !m) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"m = path.resolve(path.dirname(file), m)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"glob(""**/*.[0-9]"", { cwd: m }, function (er, mans) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"mans_(file, data, mans, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.man = mans.map(function (mf) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return path.resolve(path.dirname(file), m, mf)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (Array.isArray(data.bin)) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return bins_(file, data, data.bin, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var m = data.directories && data.directories.bin
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data.bin || !m) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"glob(""**"", { cwd: m }, function (er, bins) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"bins_(file, data, bins, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var m = data.directories && data.directories.bin || '.'
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"data.bin = bins.reduce(function (acc, mf) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (mf && mf.charAt(0) !== '.') {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var f = path.basename(mf)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"acc[f] = path.join(m, mf)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return acc
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"}, {})"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (data.gitHead) return cb(null, data);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var head = path.resolve(dir, '.git/HEAD')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(head, 'utf8', function (er, head) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"githead_(file, data, dir, head, cb)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!head.match(/^ref: /)) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.gitHead = head.trim()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var headFile = head.replace(/^ref: /, '').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"headFile = path.resolve(dir, '.git', headFile)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.readFile(headFile, 'utf8', function (er, head) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (er || !head) return cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"head = head.replace(/^ref: /, '').trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data.gitHead = head
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!(data.bin instanceof Object)) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var keys = Object.keys(data.bin)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var keysLeft = keys.length
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!keysLeft) return cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function handleExists(relName, result) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,keysLeft--
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (!result) warn(""No bin file found at "" + relName)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (!keysLeft) cb()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,keys.forEach(function (key) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var dirName = path.dirname(file)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var relName = data.bin[key]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var binPath = path.resolve(dirName, relName)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"fs.exists(binPath, handleExists.bind(null, relName))"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var pId = makePackageId(data)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,function warn(msg) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (typoWarned[pId]) return;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"if (log) log(""package.json"", pId, msg);"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"normalizeData(data, warn, strict)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,catch (error) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return cb(error)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"checkBinReferences_(file, data, warn, function () {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,typoWarned[pId] = true
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"readJson.cache.set(file, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"cb(null, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var name = cleanString(data.name)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,var ver = cleanString(data.version)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return name + ""@"" + ver"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,function cleanString(str) {
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"return (!str || typeof(str) !== ""string"") ? """" : str.trim()"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data = data.split(/^\/\*\*package(?:\s|$)/m)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (data.length < 2) return null
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data = data[1]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data = data.split(/\*\*\/$/m)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,data = data[0]
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"data = data.replace(/^\s*\*/mg, """")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return jsonparse.parse(data)
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return null
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var e = new Error(""Failed to parse json\n""+ex.message)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"e.code = ""EJSONPARSE"""
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,e.file = file
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,return e
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var path = require('path')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var tap = require('tap')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"var p = path.resolve(__dirname, 'fixtures/readmes/package.json')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,var readJson = require('../')
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"'name': 'readmes',"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"'version': '99.999.999999999',"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"'readme': '*markdown*\n',"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"'readmeFilename': 'README.md',"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"'description': '*markdown*',"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,'_id': 'readmes@99.999.999999999'
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"tap.test('readme test', function (t) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"readJson(p, function (er, data) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"t.ifError(er, 'read README without error')"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"test(t, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,})
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"function test (t, data) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,"t.deepEqual(data, expect)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,added,0,t.end()
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,// vim: set softtabstop=16 shiftwidth=16:
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var tap = require(""tap"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var readJson = require(""../"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var path = require(""path"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var fs = require(""fs"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"var p = path.resolve(__dirname, ""fixtures/readmes/package.json"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""name"" : ""readmes"","
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""version"" : ""99.999.999999999"","
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""readme"" : ""*markdown*\n"","
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""readmeFilename"" : ""README.md"","
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""description"" : ""*markdown*"","
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"""_id"" : ""readmes@99.999.999999999"""
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"console.error(""readme test"")"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"tap.test(""readme test"", function (t) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"readJson(p, function (er, data) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,if (er) throw er;
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"test(t, data)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,})
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"function test(t, data) {"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,"t.deepEqual(data, expect)"
da015eee45f6daf384598151d06a9b57ffce136e,416f6a4b3a10a67be04dd7e25691f4e72ddffe29,deleted,1,t.end()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonPath = path.resolve(where, ""package.json"")"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('install', 'initial load of', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"readJson(jsonPath, log.warn, function (er, data) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonPath = path.resolve(where, 'package.json')"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('validateInstall', 'loading', jsonPath, 'for validation')"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('readDependencies', 'loading dependencies from', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,if (er) return cb(er)
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose(""save"", ""saving"", things)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.silly(""save"", ""writing"", saveTarget)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonPath = path.join(where, 'package.json')"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('installManyTop', 'reading for lifecycle', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"}), function (jsonPath, cb) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('installManyTop', 'reading scoped package data from', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonPath = path.resolve(name, pkg, 'package.json')"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('targetResolver', 'reading package data from', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"readJson(jsonPath, log.warn, function (er, d) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonPath = path.resolve(npm.globalDir, target.name , 'package.json')"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,var parent = context.parent
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('localLink', 'reading data to link', target.name, 'from', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"[ [ cache.unpack, target.name, target.version, targetFolder, null, null, user, group ],"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,function writePackageJSON (cb) {
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var jsonPath = path.resolve(targetFolder, 'package.json')"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"log.verbose('write', 'writing to', jsonPath)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"writeFileAtomic(jsonPath, JSON.stringify(target, null, 2) + '\n', cb)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"},"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"[ lifecycle, target, ""preinstall"", targetFolder ],"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,function collectBundled (cb) {
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,if (!target.bundleDependencies) return cb()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"var bd = path.resolve(targetFolder, ""node_modules"")"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"fs.readdir(bd, function (er, b) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,"// nothing bundled, maybe"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,if (er) return cb()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,bundled = b || []
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,cb()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,})
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,added,0,} ]
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"var jsonFile = path.resolve(where, ""package.json"")"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"readJson(jsonFile, log.warn, function (er, data) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"readJson(path.resolve(where, 'package.json'), log.warn, function (er, data) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"readJson( path.resolve(where, ""package.json"")"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", log.warn"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", function (er, data) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,if (er)  return cb(er)
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"log.verbose(""saving"", things)"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"readJson(path.join(where, ""package.json""), log.warn, function (er, data) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"}), function (jsonfile, cb) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"readJson(jsonfile, log.warn, function (er, data) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"readJson(path.resolve(name, pkg, ""package.json""), log.warn, function (er, d) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"var jsonFile = path.resolve( npm.globalDir, target.name"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", ""package.json"" )"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", parent = context.parent"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"[ [ cache.unpack, target.name, target.version, targetFolder"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", null, null, user, group ]"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", [ fs, ""writeFile"""
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", path.resolve(targetFolder, ""package.json"")"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", JSON.stringify(target, null, 2) + ""\n"" ]"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", [ lifecycle, target, ""preinstall"", targetFolder ]"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,", function (cb) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,if (!target.bundleDependencies) return cb()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"var bd = path.resolve(targetFolder, ""node_modules"")"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"fs.readdir(bd, function (er, b) {"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,"// nothing bundled, maybe"
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,if (er) return cb()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,bundled = b || []
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,cb()
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,})
c3744baf2e4a140ada61c71fb4725804cec0f7e8,8d64b8d9a4e9e3b55dd6b5a4b206eae63631488b,deleted,1,} ]
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,'use strict'
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var allPackageMetadata = require('./search/all-package-metadata.js')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var packageFilter = require('./search/package-filter.js')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var formatPackageStream = require('./search/format-package-stream.js')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var ms = require('mississippi')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"cb(null, [])"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"function search (args, cb) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var staleness = npm.config.get('searchstaleness')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"var include = prepareIncludes(args, npm.config.get('searchopts'))"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (include.length === 0) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var exclude = prepareExcludes(npm.config.get('searchexclude'))
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,// Used later to figure out whether we had any packages go out
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var anyOutput = false
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,// Get a stream with *all* the packages. This takes care of dealing
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"// with the local cache as well, but that's an internal detail."
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var allEntriesStream = allPackageMetadata(staleness)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,// Grab a stream that filters those packages according to given params.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var searchSection = (npm.config.get('unicode') ? ' ' : '') + 'search'
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var filterStream = streamFilter(function (pkg) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,log.gauge.pulse('search')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"log.gauge.show({section: searchSection, logline: 'scanning ' + pkg.name})"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,// Simply 'true' if the package matches search parameters.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"var match = packageFilter(pkg, include, exclude, {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,description: npm.config.get('description')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,})
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (match) { anyOutput = true }
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,return match
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,// Grab a configured output stream that will spit out packages in the
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,// desired format.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var outputStream = formatPackageStream({
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"args: args, // --searchinclude options are not highlighted"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"long: npm.config.get('long'),"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"description: npm.config.get('description'),"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"json: npm.config.get('json'),"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"parseable: npm.config.get('parseable'),"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,color: npm.color
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"outputStream.on('data', function (chunk) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,output(chunk.toString('utf8'))
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"log.silly('search', 'searching packages')"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"ms.pipe(allEntriesStream, filterStream, outputStream, function (er) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (er) return cb(er)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (!anyOutput && !npm.config.get('json') && !npm.config.get('parseable')) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,output('No matches found for ' + (args.map(JSON.stringify).join(' ')))
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"log.silly('search', 'index search completed')"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,log.clearProgress()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"cb(null, {})"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"function prepareIncludes (args, searchopts) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (typeof searchopts !== 'string') searchopts = ''
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,return searchopts.split(/\s+/).concat(args).map(function (s) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,return s.toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,}).filter(function (s) { return s })
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,function prepareExcludes (searchexclude) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,var exclude
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (typeof searchexclude === 'string') {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,exclude = searchexclude.split(/\s+/)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,} else {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,exclude = []
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,return exclude.map(function (s) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,function streamFilter (filter) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,"return ms.through.obj(function (chunk, enc, cb) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,if (filter(chunk)) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,this.push(chunk)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,}
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,added,0,cb()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var columnify = require('columnify')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var updateIndex = require('./cache/update-index.js')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,search.usage = 'npm search [--long] [search terms ...]' +
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"'\n\naliases: s, se'"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var compl = {}
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var partial = opts.partialWord
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var ipartial = partial.toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var plen = partial.length
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,// get the batch of data that matches so far.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,// this is an example of using npm.commands.search programmatically
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,// to fetch data that has been filtered by a set of arguments.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"search(opts.conf.argv.remain.slice(2), true, function (er, data) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (er) return cb(er)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,Object.keys(data).forEach(function (name) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,data[name].words.split(' ').forEach(function (w) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (w.toLowerCase().indexOf(ipartial) === 0) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,compl[partial + w.substr(plen)] = true
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,}
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,})
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"cb(null, Object.keys(compl))"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function search (args, silent, staleness, cb) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (typeof cb !== 'function') {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,cb = staleness
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,staleness = 600
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,cb = silent
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,silent = false
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var searchopts = npm.config.get('searchopts')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var searchexclude = npm.config.get('searchexclude')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (typeof searchopts !== 'string') searchopts = ''
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,searchopts = searchopts.split(/\s+/)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var opts = searchopts.concat(args).map(function (s) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return s.toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,}).filter(function (s) { return s })
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (opts.length === 0) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (typeof searchexclude === 'string') {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,searchexclude = searchexclude.split(/\s+/)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,} else {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,searchexclude = []
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,searchexclude = searchexclude.map(function (s) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"updateIndex(staleness, opts, searchexclude, filter, function (er, data) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,// now data is the list of data that we want to show.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"// prettify and print it, and then provide the raw"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,// data to the cb.
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"if (er || silent) return cb(er, data)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,log.clearProgress()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"output(prettify(data, args))"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"cb(null, data)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function filter (data, args, notArgs) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (typeof data !== 'object') return false
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,data = getWords(stripData(data))
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"if (filterWords(data, args, notArgs)) return true"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return false
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,function stripData (data) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"name: data.name,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"description: npm.config.get('description') ? data.description : '',"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,maintainers: (data.maintainers || []).map(function (m) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return '=' + m.name
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"}),"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"url: !Object.keys(data.versions || {}).length ? data.url : null,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"keywords: data.keywords || [],"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"version: Object.keys(data.versions || {})[0] || [],"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,time: data.time &&
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,data.time.modified &&
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,(new Date(data.time.modified).toISOString() // remove time
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.split('T').join(' ')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,".replace(/:[0-9]{2}\.[0-9]{3}Z$/, ''))"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,".slice(0, -5) ||"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,'prehistoric'
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,function getWords (data) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,data.words = [ data.name ]
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.concat(data.description)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.concat(data.maintainers)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.concat(data.url && ('<' + data.url + '>'))
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.concat(data.keywords)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.map(function (f) { return f && f.trim && f.trim() })
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.filter(function (f) { return f })
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.join(' ')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,.toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return data
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function filterWords (data, args, notArgs) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var words = data.words
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"for (var i = 0, l = args.length; i < l; i++) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"if (!match(words, args[i])) return false"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"for (i = 0, l = notArgs.length; i < l; i++) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"if (match(words, notArgs[i])) return false"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return true
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function match (words, arg) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (arg.charAt(0) === '/') {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"arg = arg.replace(/\/$/, '')"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"arg = new RegExp(arg.substr(1, arg.length - 1))"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return words.match(arg)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return words.indexOf(arg) !== -1
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function prettify (data, args) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var searchsort = (npm.config.get('searchsort') || 'NAME').toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"var sortField = searchsort.replace(/^\-+/, '')"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var searchRev = searchsort.charAt(0) === '-'
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var truncate = !npm.config.get('long')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (Object.keys(data).length === 0) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return 'No match found for ' + (args.map(JSON.stringify).join(' '))
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var lines = Object.keys(data).map(function (d) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,// strip keyname
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return data[d]
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,}).map(stripData).map(function (dat) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,dat.author = dat.maintainers
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,delete dat.maintainers
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,dat.date = dat.time
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,delete dat.time
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return dat
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,}).map(function (dat) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"// split keywords on whitespace or ,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (typeof dat.keywords === 'string') {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"dat.keywords = dat.keywords.split(/[,\s]+/)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (Array.isArray(dat.keywords)) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,dat.keywords = dat.keywords.join(' ')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"// split author on whitespace or ,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (typeof dat.author === 'string') {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"dat.author = dat.author.split(/[,\s]+/)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (Array.isArray(dat.author)) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,dat.author = dat.author.join(' ')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"lines.sort(function (a, b) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var aa = a[sortField].toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var bb = b[sortField].toLowerCase()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return aa === bb ? 0
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,: aa < bb ? -1 : 1
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,if (searchRev) lines.reverse()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var columns = npm.config.get('description')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"? ['name', 'description', 'author', 'date', 'version', 'keywords']"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,": ['name', 'author', 'date', 'version', 'keywords']"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var output = columnify(
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"lines,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,{
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"include: columns,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"truncate: truncate,"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,config: {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"name: { maxWidth: 40, truncate: false, truncateMarker: '' },"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"description: { maxWidth: 60 },"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"author: { maxWidth: 20 },"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"date: { maxWidth: 11 },"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"version: { maxWidth: 11 },"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,keywords: { maxWidth: Infinity }
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,output = trimToMaxWidth(output)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"output = highlightSearchTerms(output, args)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return output
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"var colors = [31, 33, 32, 36, 34, 35]"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var cl = colors.length
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function addColorMarker (str, arg, i) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var m = i % cl + 1
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var markStart = String.fromCharCode(m)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var markEnd = String.fromCharCode(0)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return str.replace(
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"new RegExp(arg.substr(1, arg.length - 2), 'gi'),"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,function (bit) { return markStart + bit + markEnd }
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"// just a normal string, do the split/map thing"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var pieces = str.toLowerCase().split(arg.toLowerCase())
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var p = 0
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return pieces.map(function (piece) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"piece = str.substr(p, piece.length)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var mark = markStart +
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"str.substr(p + piece.length, arg.length) +"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,markEnd
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,p += piece.length + arg.length
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return piece + mark
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,}).join('')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,function colorize (line) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,for (var i = 0; i < cl; i++) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var m = i + 1
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var color = npm.color ? '\u001B[' + colors[i] + 'm' : ''
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,line = line.split(String.fromCharCode(m)).join(color)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var uncolor = npm.color ? '\u001B[0m' : ''
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return line.split('\u0000').join(uncolor)
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,function getMaxWidth () {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var cols
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,try {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var tty = require('tty')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var stdout = process.stdout
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,cols = !tty.isatty(stdout.fd) ? Infinity : process.stdout.getWindowSize()[0]
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,cols = (cols === 0) ? Infinity : cols
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,} catch (ex) { cols = Infinity }
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return cols
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,function trimToMaxWidth (str) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,var maxWidth = getMaxWidth()
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return str.split('\n').map(function (line) {
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"return line.slice(0, maxWidth)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,}).join('\n')
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"function highlightSearchTerms (str, terms) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"terms.forEach(function (arg, i) {"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,"str = addColorMarker(str, arg, i)"
2b8057be2e1b51e97b1f8f38d7f58edf3ce2c145,9232cee94d55af159f02d53540ec74e8b1b0ef44,deleted,1,return colorize(str).trim()
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,var lazyProperty = require('lazy-property')
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,var registryRefer
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,var registryLoaded
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,if (!registryRefer) {
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,registryRefer = [a].concat(args[0]).map(function (arg) {
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,if (registryLoaded) npm.registry.refer = registryRefer
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,"lazyProperty(npm, 'registry', function () {"
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,registryLoaded = true
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,var CachingRegClient = require('./cache/caching-client.js')
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,var registry = new CachingRegClient(npm.config)
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,registry.version = npm.version
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,registry.refer = registryRefer
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,return registry
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,added,0,})
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,var CachingRegClient = require('./cache/caching-client.js')
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,npm.registry.version = npm.version
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,if (!npm.registry.refer) {
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,npm.registry.refer = [a].concat(args[0]).map(function (arg) {
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,// at this point the configs are all set.
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,// go ahead and spin up the registry client.
d85d58d4a352660aeac5c98c4a257e5eb4070bb6,90b8427a308e2b27f76d7ebb454e27abbd745df7,deleted,1,npm.registry = new CachingRegClient(npm.config)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,const log = require('npmlog')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"log: log,"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,const lifecycle = require('npm-lifecycle')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,added,0,"lifecycle(pkg, stage, wd, opts).then(cb, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,exports.makeEnv = makeEnv
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,exports._incorrectWorkingDirectory = _incorrectWorkingDirectory
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var log = require('npmlog')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var spawn = require('./spawn')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var path = require('path')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var fs = require('graceful-fs')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var chain = require('slide').chain
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var Stream = require('stream').Stream
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var PATH = 'PATH'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var uidNumber = require('uid-number')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var umask = require('umask')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var which = require('which')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// windows calls it's path 'Path' usually, but this is not guaranteed."
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (process.platform === 'win32') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,PATH = 'Path'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,Object.keys(process.env).forEach(function (e) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (e.match(/^PATH$/i)) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,PATH = e
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,}
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,})
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function logid (pkg, stage) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return pkg._id + '~' + stage + ':'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"return lifecycle(pkg, stage, wd, opts, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function lifecycle (pkg, stage, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,while (pkg && pkg._data) pkg = pkg._data
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!pkg) return cb(new Error('Invalid package data'))
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.info('lifecycle', logid(pkg, stage), pkg._id)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!pkg.scripts) pkg.scripts = {}
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (opts.ignoreScripts) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'ignored because ignore-scripts is set to true', pkg._id)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,pkg.scripts = {}
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (stage === 'prepublish' && opts.ignorePrepublish) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'ignored because ignore-prepublish is set to true', pkg._id)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,delete pkg.scripts.prepublish
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!pkg.scripts[stage]) return cb()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"validWd(wd || path.resolve(opts.dir, pkg.name), function (er, wd) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (er) return cb(er)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"if ((wd.indexOf(opts.dir) !== 0 || _incorrectWorkingDirectory(wd, pkg)) &&"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,!opts.unsafePerm && pkg.scripts[stage]) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.warn('lifecycle', logid(pkg, stage), 'cannot run in wd',"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"'%s %s (wd=%s)', pkg._id, pkg.scripts[stage], wd"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return cb()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// set the env variables, then run scripts as a child process."
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var env = makeEnv(pkg, opts)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env.npm_lifecycle_event = stage
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env.npm_node_execpath = env.NODE = env.NODE || process.execPath
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env.npm_execpath = require.main.filename
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env.INIT_CWD = process.cwd()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// 'nobody' typically doesn't have permission to write to /tmp
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// even if it's never used, sh freaks out."
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!opts.unsafePerm) env.TMPDIR = wd
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"lifecycle_(pkg, stage, wd, opts, env, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function _incorrectWorkingDirectory (wd, pkg) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return wd.lastIndexOf(pkg.name) !== wd.length - pkg.name.length
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function lifecycle_ (pkg, stage, wd, opts, env, cb) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var pathArr = []
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var p = wd.split(/[\\\/]node_modules[\\\/]/)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var acc = path.resolve(p.shift())
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,p.forEach(function (pp) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"pathArr.unshift(path.join(acc, 'node_modules', '.bin'))"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"acc = path.join(acc, 'node_modules', pp)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// we also unshift the bundled node-gyp-bin folder so that
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// the bundled one will be used for installing things.
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"pathArr.unshift(path.join(__dirname, '..', '..', 'bin', 'node-gyp-bin'))"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (shouldPrependCurrentNodeDirToPATH(opts.scriptsPrependNodePath)) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// prefer current node interpreter in child scripts
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,pathArr.push(path.dirname(process.execPath))
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (env[PATH]) pathArr.push(env[PATH])
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env[PATH] = pathArr.join(process.platform === 'win32' ? ';' : ':')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var packageLifecycle = pkg.scripts && pkg.scripts.hasOwnProperty(stage)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (packageLifecycle) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// define this here so it's available to all scripts.
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env.npm_lifecycle_script = pkg.scripts[stage]
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.silly('lifecycle', logid(pkg, stage), 'no script for ' + stage + ', continuing')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function done (er) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (er) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (opts.force) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'forced, continuing', er)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er = null
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else if (opts.failOk) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.warn('lifecycle', logid(pkg, stage), 'continuing anyway', er.message)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,cb(er)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,chain(
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,[
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"packageLifecycle && [runPackageLifecycle, pkg, env, wd, opts],"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"[runHookLifecycle, pkg, env, wd, opts]"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"],"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,done
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function shouldPrependCurrentNodeDirToPATH (cfgsetting) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (cfgsetting === false) return false
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (cfgsetting === true) return true
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var isDifferentNodeInPath
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var isWindows = process.platform === 'win32'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var foundExecPath
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,try {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"foundExecPath = which.sync(path.basename(process.execPath), {pathExt: isWindows ? ';' : ':'})"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// Apply `fs.realpath()` here to avoid false positives when `node` is a symlinked executable.
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,isDifferentNodeInPath = fs.realpathSync(process.execPath).toUpperCase() !==
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,fs.realpathSync(foundExecPath).toUpperCase()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} catch (e) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,isDifferentNodeInPath = true
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (cfgsetting === 'warn-only') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (isDifferentNodeInPath && !shouldPrependCurrentNodeDirToPATH.hasWarned) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (foundExecPath) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.warn('lifecycle', 'The node binary used for scripts is', foundExecPath, 'but npm is using', process.execPath, 'itself. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.warn('lifecycle', 'npm is using', process.execPath, 'but there is no node binary in the current PATH. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,shouldPrependCurrentNodeDirToPATH.hasWarned = true
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return false
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return isDifferentNodeInPath
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function validWd (d, cb) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"fs.stat(d, function (er, st) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (er || !st.isDirectory()) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var p = path.dirname(d)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (p === d) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return cb(new Error('Could not find suitable wd'))
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"return validWd(p, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"return cb(null, d)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function runPackageLifecycle (pkg, env, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// run package lifecycle scripts in the package root, or the nearest parent."
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var stage = env.npm_lifecycle_event
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var cmd = env.npm_lifecycle_script
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var note = '\n> ' + pkg._id + ' ' + stage + ' ' + wd +
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,'\n> ' + cmd + '\n'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"runCmd(note, cmd, pkg, env, stage, wd, opts, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var running = false
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var queue = []
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function dequeue () {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,running = false
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (queue.length) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var r = queue.shift()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"runCmd.apply(null, r)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function runCmd (note, cmd, pkg, env, stage, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (running) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"queue.push([note, cmd, pkg, env, stage, wd, cb])"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,running = true
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,log.pause()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var unsafe = opts.unsafePerm
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var user = unsafe ? null : opts.user
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var group = unsafe ? null : opts.group
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (log.level !== 'silent') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,log.clearProgress()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,console.log(note)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,log.showProgress()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.verbose('lifecycle', logid(pkg, stage), 'unsafe-perm in lifecycle', unsafe)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,unsafe = true
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (unsafe) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"runCmd_(cmd, pkg, env, wd, opts, stage, unsafe, 0, 0, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"uidNumber(user, group, function (er, uid, gid) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"runCmd_(cmd, pkg, env, wd, opts, stage, unsafe, uid, gid, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function runCmd_ (cmd, pkg, env, wd, opts, stage, unsafe, uid, gid, cb_) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function cb (er) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cb_.apply(null, arguments)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,log.resume()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,process.nextTick(dequeue)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var conf = {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"cwd: wd,"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"env: env,"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"stdio: [ 0, 1, 2 ]"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!unsafe) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,conf.uid = uid ^ 0
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,conf.gid = gid ^ 0
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var sh = 'sh'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var shFlag = '-c'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var customShell = opts.scriptShell
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (customShell) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,sh = customShell
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else if (process.platform === 'win32') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,sh = process.env.comspec || 'cmd'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,shFlag = '/d /s /c'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,conf.windowsVerbatimArguments = true
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.verbose('lifecycle', logid(pkg, stage), 'PATH:', env[PATH])"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.verbose('lifecycle', logid(pkg, stage), 'CWD:', wd)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.silly('lifecycle', logid(pkg, stage), 'Args:', [shFlag, cmd])"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var proc = spawn(sh, [shFlag, cmd], conf)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"proc.on('error', procError)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"proc.on('close', function (code, signal) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.silly('lifecycle', logid(pkg, stage), 'Returned: code:', code, ' signal:', signal)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (signal) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.kill(process.pid, signal)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else if (code) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var er = new Error('Exit status ' + code)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.errno = code
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,procError(er)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.once('SIGTERM', procKill)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.once('SIGINT', procInterupt)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function procError (er) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'Failed to exec ' + stage + ' script')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.message = pkg._id + ' ' + stage + ': `' + cmd + '`\n' +
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.message
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (er.code !== 'EPERM') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.code = 'ELIFECYCLE'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"fs.stat(opts.dir, function (statError, d) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (statError && statError.code === 'ENOENT' && opts.dir.split(path.sep).slice(-1)[0] === 'node_modules') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"log.warn('', 'Local package.json exists, but node_modules missing, did you mean to install?')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.pkgid = pkg._id
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.stage = stage
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.script = cmd
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,er.pkgname = pkg.name
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.removeListener('SIGTERM', procKill)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.removeListener('SIGTERM', procInterupt)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.removeListener('SIGINT', procKill)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return cb(er)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function procKill () {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,proc.kill()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,function procInterupt () {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,proc.kill('SIGINT')
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"proc.on('exit', function () {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,process.exit()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"process.once('SIGINT', procKill)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function runHookLifecycle (pkg, env, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// check for a hook script, run if present."
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var hook = path.join(opts.dir, '.hooks', stage)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var cmd = hook
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"fs.stat(hook, function (er) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (er) return cb()
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,'\n> ' + cmd
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"runCmd(note, hook, pkg, env, stage, wd, opts, cb)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"function makeEnv (data, opts, prefix, env) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,prefix = prefix || 'npm_package_'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!env) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env = {}
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,for (var i in process.env) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!i.match(/^npm_/)) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env[i] = process.env[i]
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// express and others respect the NODE_ENV value.
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (opts.production) env.NODE_ENV = 'production'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else if (!data.hasOwnProperty('_lifecycleEnv')) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"Object.defineProperty(data, '_lifecycleEnv',"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,{
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"value: env,"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,enumerable: false
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,for (i in data) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (i.charAt(0) !== '_') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"var envKey = (prefix + i).replace(/[^a-zA-Z0-9_]/g, '_')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (i === 'readme') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,continue
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (data[i] && typeof data[i] === 'object') {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// quick and dirty detection for cyclical structures
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,JSON.stringify(data[i])
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"makeEnv(data[i], opts, envKey + '_', env)"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} catch (ex) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// usually these are package objects.
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,// just get the path and basic details.
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var d = data[i]
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,makeEnv(
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"{ name: d.name, version: d.version, path: d.path },"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"opts,"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"envKey + '_',"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env[envKey] = String(data[i])
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env[envKey] = env[envKey].indexOf('\n') !== -1
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,? JSON.stringify(env[envKey])
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,: env[envKey]
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (prefix !== 'npm_package_') return env
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,prefix = 'npm_config_'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var pkgConfig = {}
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var pkgVerConfig = {}
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var namePref = data.name + ':'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var verPref = data.name + '@' + data.version + ':'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,Object.keys(opts.config).forEach(function (i) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// in some rare cases (e.g. working with nerf darts), there are segmented"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"// ""private"" (underscore-prefixed) config names -- don't export"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (i.charAt(0) === '_' && i.indexOf('_' + namePref) !== 0 || i.match(/:_/)) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var value = opts.config[i]
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (value instanceof Stream || Array.isArray(value)) return
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (i.match(/umask/)) value = umask.toString(value)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (!value) value = ''
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,else if (typeof value === 'number') value = '' + value
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,else if (typeof value !== 'string') value = JSON.stringify(value)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,value = value.indexOf('\n') !== -1
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,? JSON.stringify(value)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,: value
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"i = i.replace(/^_+/, '')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var k
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,if (i.indexOf(namePref) === 0) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"k = i.substr(namePref.length).replace(/[^a-zA-Z0-9_]/g, '_')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,pkgConfig[k] = value
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,} else if (i.indexOf(verPref) === 0) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,"k = i.substr(verPref.length).replace(/[^a-zA-Z0-9_]/g, '_')"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,pkgVerConfig[k] = value
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env[envKey] = value
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,prefix = 'npm_package_config_'
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,";[pkgConfig, pkgVerConfig].forEach(function (conf) {"
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,for (var i in conf) {
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,var envKey = (prefix + i)
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,env[envKey] = conf[i]
a267ab4309883012a9d55934533c5915e9842277,324d9a803b667658cd8f4c760cbb27f4bd951a20,deleted,1,return env
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,added,0,const log = require('npmlog')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,added,0,"log: log,"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,added,0,const lifecycle = require('npm-lifecycle')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,added,0,"lifecycle(pkg, stage, wd, opts).then(cb, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,exports.makeEnv = makeEnv
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,exports._incorrectWorkingDirectory = _incorrectWorkingDirectory
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var log = require('npmlog')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var spawn = require('./spawn')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var path = require('path')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var fs = require('graceful-fs')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var chain = require('slide').chain
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var Stream = require('stream').Stream
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var PATH = 'PATH'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var uidNumber = require('uid-number')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var umask = require('umask')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var which = require('which')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// windows calls it's path 'Path' usually, but this is not guaranteed."
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (process.platform === 'win32') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,PATH = 'Path'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,Object.keys(process.env).forEach(function (e) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (e.match(/^PATH$/i)) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,PATH = e
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,}
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,})
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function logid (pkg, stage) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return pkg._id + '~' + stage + ':'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"return lifecycle(pkg, stage, wd, opts, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function lifecycle (pkg, stage, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,while (pkg && pkg._data) pkg = pkg._data
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!pkg) return cb(new Error('Invalid package data'))
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.info('lifecycle', logid(pkg, stage), pkg._id)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!pkg.scripts) pkg.scripts = {}
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (opts.ignoreScripts) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'ignored because ignore-scripts is set to true', pkg._id)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,pkg.scripts = {}
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (stage === 'prepublish' && opts.ignorePrepublish) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'ignored because ignore-prepublish is set to true', pkg._id)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,delete pkg.scripts.prepublish
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!pkg.scripts[stage]) return cb()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"validWd(wd || path.resolve(opts.dir, pkg.name), function (er, wd) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (er) return cb(er)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"if ((wd.indexOf(opts.dir) !== 0 || _incorrectWorkingDirectory(wd, pkg)) &&"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,!opts.unsafePerm && pkg.scripts[stage]) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.warn('lifecycle', logid(pkg, stage), 'cannot run in wd',"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"'%s %s (wd=%s)', pkg._id, pkg.scripts[stage], wd"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return cb()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// set the env variables, then run scripts as a child process."
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"var env = makeEnv(pkg, opts)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env.npm_lifecycle_event = stage
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env.npm_node_execpath = env.NODE = env.NODE || process.execPath
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env.npm_execpath = require.main.filename
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env.INIT_CWD = process.cwd()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// 'nobody' typically doesn't have permission to write to /tmp
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// even if it's never used, sh freaks out."
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!opts.unsafePerm) env.TMPDIR = wd
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"lifecycle_(pkg, stage, wd, opts, env, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function _incorrectWorkingDirectory (wd, pkg) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return wd.lastIndexOf(pkg.name) !== wd.length - pkg.name.length
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function lifecycle_ (pkg, stage, wd, opts, env, cb) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var pathArr = []
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var p = wd.split(/[\\\/]node_modules[\\\/]/)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var acc = path.resolve(p.shift())
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,p.forEach(function (pp) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"pathArr.unshift(path.join(acc, 'node_modules', '.bin'))"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"acc = path.join(acc, 'node_modules', pp)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// we also unshift the bundled node-gyp-bin folder so that
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// the bundled one will be used for installing things.
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"pathArr.unshift(path.join(__dirname, '..', '..', 'bin', 'node-gyp-bin'))"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (shouldPrependCurrentNodeDirToPATH(opts.scriptsPrependNodePath)) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// prefer current node interpreter in child scripts
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,pathArr.push(path.dirname(process.execPath))
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (env[PATH]) pathArr.push(env[PATH])
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env[PATH] = pathArr.join(process.platform === 'win32' ? ';' : ':')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var packageLifecycle = pkg.scripts && pkg.scripts.hasOwnProperty(stage)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (packageLifecycle) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// define this here so it's available to all scripts.
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env.npm_lifecycle_script = pkg.scripts[stage]
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} else {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.silly('lifecycle', logid(pkg, stage), 'no script for ' + stage + ', continuing')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function done (er) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (er) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (opts.force) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'forced, continuing', er)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er = null
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} else if (opts.failOk) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.warn('lifecycle', logid(pkg, stage), 'continuing anyway', er.message)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,cb(er)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,chain(
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,[
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"packageLifecycle && [runPackageLifecycle, pkg, env, wd, opts],"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"[runHookLifecycle, pkg, env, wd, opts]"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"],"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,done
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function shouldPrependCurrentNodeDirToPATH (cfgsetting) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (cfgsetting === false) return false
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (cfgsetting === true) return true
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var isDifferentNodeInPath
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var isWindows = process.platform === 'win32'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var foundExecPath
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,try {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"foundExecPath = which.sync(path.basename(process.execPath), {pathExt: isWindows ? ';' : ':'})"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// Apply `fs.realpath()` here to avoid false positives when `node` is a symlinked executable.
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,isDifferentNodeInPath = fs.realpathSync(process.execPath).toUpperCase() !==
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,fs.realpathSync(foundExecPath).toUpperCase()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} catch (e) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,isDifferentNodeInPath = true
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (cfgsetting === 'warn-only') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (isDifferentNodeInPath && !shouldPrependCurrentNodeDirToPATH.hasWarned) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (foundExecPath) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.warn('lifecycle', 'The node binary used for scripts is', foundExecPath, 'but npm is using', process.execPath, 'itself. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.warn('lifecycle', 'npm is using', process.execPath, 'but there is no node binary in the current PATH. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,shouldPrependCurrentNodeDirToPATH.hasWarned = true
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return false
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return isDifferentNodeInPath
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function validWd (d, cb) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"fs.stat(d, function (er, st) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (er || !st.isDirectory()) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var p = path.dirname(d)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (p === d) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return cb(new Error('Could not find suitable wd'))
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"return validWd(p, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"return cb(null, d)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function runPackageLifecycle (pkg, env, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// run package lifecycle scripts in the package root, or the nearest parent."
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var stage = env.npm_lifecycle_event
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var cmd = env.npm_lifecycle_script
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var note = '\n> ' + pkg._id + ' ' + stage + ' ' + wd +
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,'\n> ' + cmd + '\n'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"runCmd(note, cmd, pkg, env, stage, wd, opts, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var running = false
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var queue = []
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function dequeue () {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,running = false
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (queue.length) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var r = queue.shift()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"runCmd.apply(null, r)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function runCmd (note, cmd, pkg, env, stage, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (running) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"queue.push([note, cmd, pkg, env, stage, wd, cb])"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,running = true
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,log.pause()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var unsafe = opts.unsafePerm
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var user = unsafe ? null : opts.user
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var group = unsafe ? null : opts.group
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (log.level !== 'silent') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,log.clearProgress()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,console.log(note)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,log.showProgress()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.verbose('lifecycle', logid(pkg, stage), 'unsafe-perm in lifecycle', unsafe)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,unsafe = true
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (unsafe) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"runCmd_(cmd, pkg, env, wd, opts, stage, unsafe, 0, 0, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"uidNumber(user, group, function (er, uid, gid) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"runCmd_(cmd, pkg, env, wd, opts, stage, unsafe, uid, gid, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function runCmd_ (cmd, pkg, env, wd, opts, stage, unsafe, uid, gid, cb_) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function cb (er) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"cb_.apply(null, arguments)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,log.resume()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,process.nextTick(dequeue)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var conf = {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"cwd: wd,"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"env: env,"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"stdio: [ 0, 1, 2 ]"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!unsafe) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,conf.uid = uid ^ 0
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,conf.gid = gid ^ 0
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var sh = 'sh'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var shFlag = '-c'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var customShell = opts.scriptShell
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (customShell) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,sh = customShell
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} else if (process.platform === 'win32') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,sh = process.env.comspec || 'cmd'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,shFlag = '/d /s /c'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,conf.windowsVerbatimArguments = true
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.verbose('lifecycle', logid(pkg, stage), 'PATH:', env[PATH])"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.verbose('lifecycle', logid(pkg, stage), 'CWD:', wd)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.silly('lifecycle', logid(pkg, stage), 'Args:', [shFlag, cmd])"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"var proc = spawn(sh, [shFlag, cmd], conf)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"proc.on('error', procError)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"proc.on('close', function (code, signal) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.silly('lifecycle', logid(pkg, stage), 'Returned: code:', code, ' signal:', signal)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (signal) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.kill(process.pid, signal)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} else if (code) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var er = new Error('Exit status ' + code)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.errno = code
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,procError(er)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.once('SIGTERM', procKill)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.once('SIGINT', procInterupt)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function procError (er) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.info('lifecycle', logid(pkg, stage), 'Failed to exec ' + stage + ' script')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.message = pkg._id + ' ' + stage + ': `' + cmd + '`\n' +
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.message
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (er.code !== 'EPERM') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.code = 'ELIFECYCLE'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"fs.stat(opts.dir, function (statError, d) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (statError && statError.code === 'ENOENT' && opts.dir.split(path.sep).slice(-1)[0] === 'node_modules') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"log.warn('', 'Local package.json exists, but node_modules missing, did you mean to install?')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.pkgid = pkg._id
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.stage = stage
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.script = cmd
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,er.pkgname = pkg.name
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.removeListener('SIGTERM', procKill)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.removeListener('SIGTERM', procInterupt)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.removeListener('SIGINT', procKill)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return cb(er)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function procKill () {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,proc.kill()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,function procInterupt () {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,proc.kill('SIGINT')
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"proc.on('exit', function () {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,process.exit()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"process.once('SIGINT', procKill)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function runHookLifecycle (pkg, env, wd, opts, cb) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// check for a hook script, run if present."
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"var hook = path.join(opts.dir, '.hooks', stage)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var cmd = hook
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"fs.stat(hook, function (er) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (er) return cb()
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,'\n> ' + cmd
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"runCmd(note, hook, pkg, env, stage, wd, opts, cb)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"function makeEnv (data, opts, prefix, env) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,prefix = prefix || 'npm_package_'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!env) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env = {}
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,for (var i in process.env) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!i.match(/^npm_/)) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env[i] = process.env[i]
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// express and others respect the NODE_ENV value.
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (opts.production) env.NODE_ENV = 'production'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} else if (!data.hasOwnProperty('_lifecycleEnv')) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"Object.defineProperty(data, '_lifecycleEnv',"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,{
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"value: env,"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,enumerable: false
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,for (i in data) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (i.charAt(0) !== '_') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"var envKey = (prefix + i).replace(/[^a-zA-Z0-9_]/g, '_')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (i === 'readme') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,continue
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (data[i] && typeof data[i] === 'object') {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// quick and dirty detection for cyclical structures
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,JSON.stringify(data[i])
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"makeEnv(data[i], opts, envKey + '_', env)"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} catch (ex) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// usually these are package objects.
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,// just get the path and basic details.
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var d = data[i]
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,makeEnv(
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"{ name: d.name, version: d.version, path: d.path },"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"opts,"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"envKey + '_',"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env[envKey] = String(data[i])
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env[envKey] = env[envKey].indexOf('\n') !== -1
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,? JSON.stringify(env[envKey])
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,: env[envKey]
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (prefix !== 'npm_package_') return env
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,prefix = 'npm_config_'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var pkgConfig = {}
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var pkgVerConfig = {}
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var namePref = data.name + ':'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var verPref = data.name + '@' + data.version + ':'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,Object.keys(opts.config).forEach(function (i) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// in some rare cases (e.g. working with nerf darts), there are segmented"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"// ""private"" (underscore-prefixed) config names -- don't export"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (i.charAt(0) === '_' && i.indexOf('_' + namePref) !== 0 || i.match(/:_/)) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var value = opts.config[i]
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (value instanceof Stream || Array.isArray(value)) return
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (i.match(/umask/)) value = umask.toString(value)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (!value) value = ''
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,else if (typeof value === 'number') value = '' + value
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,else if (typeof value !== 'string') value = JSON.stringify(value)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,value = value.indexOf('\n') !== -1
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,? JSON.stringify(value)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,: value
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"i = i.replace(/^_+/, '')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var k
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,if (i.indexOf(namePref) === 0) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"k = i.substr(namePref.length).replace(/[^a-zA-Z0-9_]/g, '_')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,pkgConfig[k] = value
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,} else if (i.indexOf(verPref) === 0) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,"k = i.substr(verPref.length).replace(/[^a-zA-Z0-9_]/g, '_')"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,pkgVerConfig[k] = value
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env[envKey] = value
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,prefix = 'npm_package_config_'
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,";[pkgConfig, pkgVerConfig].forEach(function (conf) {"
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,for (var i in conf) {
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,var envKey = (prefix + i)
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,env[envKey] = conf[i]
a267ab4309883012a9d55934533c5915e9842277,56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,deleted,1,return env
