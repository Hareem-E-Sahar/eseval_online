fix_commit_hash,commit_hash,change_type,is_buggy_line,code_change_remove_common_tokens
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,63ad073efd0b20f59f02bc37182c0180cac3f405,added,0,user_id = req.environ['nova.context']['user']['id']
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,63ad073efd0b20f59f02bc37182c0180cac3f405,added,0,"delay = self.get_delay(action_name, user_id)"
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,63ad073efd0b20f59f02bc37182c0180cac3f405,deleted,1,username = req.headers['X-Auth-User']
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,63ad073efd0b20f59f02bc37182c0180cac3f405,deleted,1,"delay = self.get_delay(action_name, username)"
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,8138a35d3672e08640762b7533c1c527568d0b4f,added,0,user_id = req.environ['nova.context']['user']['id']
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,8138a35d3672e08640762b7533c1c527568d0b4f,added,0,"delay = self.get_delay(action_name, user_id)"
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,8138a35d3672e08640762b7533c1c527568d0b4f,deleted,1,username = req.headers['X-Auth-User']
a340d3fe1b8e1f657351c8a32ff74b3cbcc3a8ff,8138a35d3672e08640762b7533c1c527568d0b4f,deleted,1,"delay = self.get_delay(action_name, username)"
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,added,0,our_rules += ['-A %s -s %s -p udp --sport 67 --dport 68 '
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,added,0,"'-j ACCEPT' % (chain_name, dhcp_server)]"
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,added,0,our_rules += ['-A %s -s %s -p icmpv6 '
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,added,0,"'-j ACCEPT' % (chain_name, ra_server)]"
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,deleted,1,our_rules += ['-A %s -s %s -p udp --sport 67 --dport 68' %
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,deleted,1,"(chain_name, dhcp_server)]"
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,deleted,1,our_rules += ['-A %s -s %s -p icmpv6' %
7d66725e5a1e5438453aedcec809f8a25fae08d8,b945fed7779bddf799aa4a180d44745052d2da8c,deleted,1,"(chain_name, ra_server)]"
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.flags(vmwareapi_host_ip='test_url',"
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,e21763b15948603e618d4435335ef3785dc5660a,added,0,"vmwareapi_host_username='test_username',"
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,e21763b15948603e618d4435335ef3785dc5660a,added,0,vmware_host_password='test_pass')
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,FLAGS.vmwareapi_host_ip = 'test_url'
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,FLAGS.vmwareapi_host_username = 'test_username'
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,FLAGS.vmwareapi_host_password = 'test_pass'
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"RESP_NOT_XML_ERROR = 'Response is ""text/html"", not ""text/xml""'"
cbcda1ec466fd498fb8e9fe47c72b52c2d4b3dde,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"RESP_NOT_XML_ERROR = 'Response is ""text/html"", not ""text/xml'"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,"def rescue(self, req, id, body={}):"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,if 'rescue' in body and body['rescue'] and \
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,'adminPass' in body['rescue']:
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,"password = body[""rescue""][""adminPass""]"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,else:
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,password = utils.generate_password(FLAGS.password_length)
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,"self.compute_api.rescue(context, id, rescue_password=password)"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,return {'adminPass': password}
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,if 'rebuild' in info and 'adminPass' in info['rebuild']:
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,added,0,"password = info[""rebuild""][""adminPass""]"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,deleted,1,"def rescue(self, req, id):"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,deleted,1,"self.compute_api.rescue(context, id)"
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,deleted,1,return webob.Response(status_int=202)
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,deleted,1,password = utils.generate_password(16)
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,deleted,1,"password = info[""rebuild""].get(""adminPass"","
2c16115e236760f3933eadd3a5d7d20dda39866d,7f2a4fdf5e43620081e163fc46f2ca4fdefd18f3,deleted,1,utils.generate_password(16))
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,added,0,"def rescue_instance(self, context, instance_id, **kwargs):"
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,added,0,""""""""
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,added,0,Rescue an instance on this host.
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,added,0,:param rescue_password: password to set on rescue instance
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,added,0,"instance_ref.admin_pass = kwargs.get('rescue_password',"
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,added,0,utils.generate_password(FLAGS.password_length))
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,deleted,1,"flags.DEFINE_integer('password_length', 12,"
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,deleted,1,'Length of generated admin passwords')
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,deleted,1,"def rescue_instance(self, context, instance_id):"
2c16115e236760f3933eadd3a5d7d20dda39866d,c524508bc58aa561b81c3133526c981cce835a59,deleted,1,"""""""Rescue an instance on this host."""""""
882b1e475de1ef71d7d3f0b50a58f91569905a75,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,migration_ref['source_compute'])
882b1e475de1ef71d7d3f0b50a58f91569905a75,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,instance_ref['host'])
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def model_query(context, *args, **kwargs):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"""""""Query helper that accounts for context's `read_deleted` field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,:param context: context to query under
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,":param session: if present, the session to use"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,":param read_deleted: if present, overrides context's read_deleted field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,":param project_only: if present and context is user-type, then restrict"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,query to match the context's project_id.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,""""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,session = kwargs.get('session') or get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,read_deleted = kwargs.get('read_deleted') or context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,project_only = kwargs.get('project_only')
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,query = session.query(*args)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,if read_deleted == 'no':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,query = query.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,elif read_deleted == 'yes':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,pass  # omit the filter to include deleted and active
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,elif read_deleted == 'only':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,query = query.filter_by(deleted=True)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise Exception(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_(""Unrecognized read_deleted value '%s'"") % read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,if project_only and is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,query = query.filter_by(project_id=context.project_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return query
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Service, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"query = model_query(context, models.Service)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"filter_by(topic=""compute"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Service,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.coalesce(sort_value, 0),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"session=session, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"subq = model_query(context, models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.sum(models.Instance.vcpus).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"subq = model_query(context, models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.count(models.Network.id).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"subq = model_query(context, models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.sum(models.Volume.size).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Service).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Certificate, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Certificate, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def certificate_get_all_by_user_and_project(context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.FloatingIp, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"floating_ip_ref = model_query(context, models.FloatingIp,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.FloatingIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,@require_admin_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,def _floating_ip_get_all(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload_all('fixed_ip.instance'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,floating_ip_refs = _floating_ip_get_all(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,floating_ip_refs = _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"fixed_ip_ref = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def fixed_ip_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def fixed_ip_bulk_create(context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def fixed_ip_disassociate_all_by_timeout(context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"inner_q = model_query(context, models.Network.id, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.FixedIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# FIXME(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# results?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.FixedIp, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# NOTE(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,@require_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _virtual_interface_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.VirtualInterface, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('fixed_ips'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"vif_ref = _virtual_interface_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,vif_ref = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,vif_refs = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,vif_refs = _virtual_interface_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.sum(models.Instance.memory_mb),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _build_instance_get(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Instance, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,project_only=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Instance).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _instance_get_all_query(context, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Instance, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _instance_get_all_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _instance_get_all_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return _instance_get_all_query(context, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.KeyPair, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.KeyPair, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Network).count()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _network_ips_query(context, network_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(network_id=network_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return _network_ips_query(context, network_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"network_ref = network_get(context, network_id=network_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Network, read_deleted=""no"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Network, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"# FIXME(sirp): since this returns fixed_ips, this would be better named"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# fixed_ip_get_all_by_network.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _network_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"read_deleted=""no"")"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _network_get_query(context).filter_by(bridge=bridge).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _network_get_query(context).filter_by(uuid=uuid).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def network_get_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def network_get_all_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"network_ref = _network_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def queue_get_for(context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.IscsiTarget).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.AuthToken, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def auth_token_create(context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"rows = model_query(context, models.Quota, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"quotas = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"iscsi_target_ref = model_query(context, models.IscsiTarget,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"func.sum(models.Volume.size),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _volume_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Volume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,project_only=project_only).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('volume_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _volume_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _volume_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _volume_get_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Volume, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _volume_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _volume_get_query(context).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.IscsiTarget, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _volume_metadata_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.VolumeMetadata,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(volume_id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"rows = _volume_metadata_get_query(context, volume_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,for row in rows:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result[row['key']] = row['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_volume_metadata_get_query(context, volume_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _volume_metadata_get_query(context, volume_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Snapshot, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Snapshot).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Snapshot).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _block_device_mapping_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.BlockDeviceMapping, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _block_device_mapping_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _security_group_get_query(context, session=None, read_deleted=None,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,project_only=False):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SecurityGroup, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"read_deleted=read_deleted, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload_all('rules'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _security_group_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _security_group_get_query(context, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.SecurityGroupNotFoundForProject(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"project_id=project_id, security_group_id=group_name)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _security_group_rule_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SecurityGroupIngressRule,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,session=session)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.ProviderFirewallRule).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.ProviderFirewallRule).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.User, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def user_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.User).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def project_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Project, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Project).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"user = model_query(context, models.User).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Migration, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(status=status).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"filter_by(status=""FINISHED"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.ConsolePoolNotFoundForHostType(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"host=host, console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# NOTE(mdragon): consoles are meant to be transient.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.ConsoleNotFoundInPoolForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"pool_id=pool_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"query = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=console_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('pool'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,if instance_id is not None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = query.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.ConsoleNotFoundForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"console_id=console_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def instance_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _instance_type_get_query(context, session=None, read_deleted=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.InstanceTypes, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,read_deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"read_deleted = ""yes"" if inactive else ""no"""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"query = _instance_type_get_query(context, read_deleted=read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,query = query.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"inst_types = query.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _instance_type_get_query(context, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _dict_with_extra_specs(result)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"instance_type_ref = model_query(context, models.InstanceTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# FIXME(sirp): this should update deleted_at and updated_at as well
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _zone_get_by_id_query(context, zone_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Zone, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"zone = zone_get(context, zone_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_zone_get_by_id_query(context, zone_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _zone_get_by_id_query(context, zone_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.Zone, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _instance_metadata_get_query(context, instance_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.InstanceMetadata, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"rows = _instance_metadata_get_query(context, instance_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_instance_metadata_get_query(context, instance_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _instance_metadata_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"context, instance_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.AgentBuild, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"agent_build_ref = model_query(context, models.AgentBuild,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"session=session, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=agent_build_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.BandwidthUsage, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"bwusage = model_query(context, models.BandwidthUsage,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _instance_type_extra_specs_get_query(context, instance_type_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.InstanceTypeExtraSpecs,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,rows = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"context, instance_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,_instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"context, instance_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.InstanceTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"extra_specs_key=key, instance_type_id=instance_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def volume_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def volume_type_get_all(context, inactive=False, filters=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filters = filters or {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"rows = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# TODO(sirp): this patern of converting rows to a result with extra_specs
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"# is repeated quite a bit, might be worth creating a method for it"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result[row['name']] = _dict_with_extra_specs(row)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.VolumeTypes, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"volume_type_ref = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# FIXME(sirp): we should be setting deleted_at and updated_at here
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _volume_type_extra_specs_query(context, volume_type_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.VolumeTypeExtraSpecs, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"rows = _volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,result = _volume_type_extra_specs_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"context, volume_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.VolumeTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"extra_specs_key=key, volume_type_id=volume_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _vsa_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.VirtualStorageArray, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,options(joinedload('vsa_instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _vsa_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _vsa_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,return _vsa_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.S3Image, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=image_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(uuid=image_uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"backend_conf = model_query(context, models.SMBackendConf,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=sm_backend_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,raise exception.NotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_(""No backend config with id %(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"# FIXME(sirp): for consistency, shouldn't this just mark as deleted with"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# `purge` actually deleting the record?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"model_query(context, models.SMBackendConf, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,# FIXME(sirp): shouldn't this have a `first()` qualifier attached?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _sm_flavor_get_query(context, sm_flavor_label, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SMFlavors, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"sm_flavor = sm_flavor_get(context, sm_flavor_label)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_sm_flavor_get_query(context, sm_flavor_label).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def sm_flavor_get(context, sm_flavor_label):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _sm_flavor_get_query(context, sm_flavor_label).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_(""No sm_flavor called %(sm_flavor)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SMFlavors, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"def _sm_volume_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SMVolume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,filter_by(id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"sm_volume = sm_volume_get(context, volume_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_sm_volume_get_query(context, volume_id, session=session).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"result = _sm_volume_get_query(context, volume_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"_(""No sm_volume with id %(volume_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,added,0,"return model_query(context, models.SMVolume, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,def can_read_deleted(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"""""""Indicates if the context has access to deleted objects."""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not context:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return False
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(deleted=can_read_deleted(context)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,query = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(deleted=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,topic = 'compute'
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"return session.query(models.Service, func.coalesce(sort_value, 0)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"subq = session.query(models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,func.sum(models.Instance.vcpus).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"subq = session.query(models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,func.count(models.Network.id).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"subq = session.query(models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,func.sum(models.Volume.size).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def certificate_get_all_by_user_and_project(_context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = None
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if is_admin_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,elif is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,floating_ip_ref = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,floating_ip_refs = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,fixed_ip_ref = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def fixed_ip_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def fixed_ip_bulk_create(_context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def fixed_ip_disassociate_all_by_timeout(_context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,inner_q = session.query(models.Network.id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,rv = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not rv:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return rv
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,vif_ref = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('fixed_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,vif_refs = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"result = session.query(func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,func.sum(models.Instance.memory_mb)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"partial = _build_instance_get(context, session=session)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = partial.filter_by(uuid=uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = result.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = partial.filter_by(id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,partial = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,partial = partial.filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,partial = partial.filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return partial
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(user_id=user_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,read_deleted = can_read_deleted(context)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('fixed_ips.floating_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('security_groups')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('fixed_ips.network')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,query = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return query.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"network_ref = network_get(context, network_id=network_id, \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(deleted=False).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(bridge=bridge).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def network_get_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,rv = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def network_get_all_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,with session.begin():
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,network_ref = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def queue_get_for(_context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if session is None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,tk = session.query(models.AuthToken).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not tk:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return tk
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def auth_token_create(_context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,rows = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,quotas = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,iscsi_target_ref = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"result = session.query(func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,func.sum(models.Volume.size)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('volume_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,meta_results = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,meta_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,for i in meta_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,meta_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return meta_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,meta_result = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not meta_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return meta_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return []
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('rules')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"filter_by(deleted=can_read_deleted(context),).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.SecurityGroupNotFoundForProject(project_id=project_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,security_group_id=group_name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.SecurityGroupIngressRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=security_group_rule_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,# TODO(vish): Join to group and check for project_id
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(parent_group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload_all('grantee_group.instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.ProviderFirewallRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def user_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def project_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,user = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(status=status).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,results = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"filter_by(status=""FINISHED"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return results
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.ConsolePoolNotFoundForHostType(host=host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,# consoles are meant to be transient. (mdragon)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.ConsoleNotFoundInPoolForInstance(pool_id=pool_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,results = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('pool')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,query = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=console_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if instance_id:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = query.options(joinedload('pool')).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.ConsoleNotFoundForInstance(console_id=console_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def instance_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,partial = session.query(models.InstanceTypes)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,.options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,partial = partial.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,partial = partial.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"inst_types = partial.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,inst_type = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('extra_specs')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not inst_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return _dict_with_extra_specs(inst_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,instance_type_ref = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,zone = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not zone:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,raise exception.ZoneNotFound(zone_id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.Zone).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=zone_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.Zone).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,meta_results = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,meta_result = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,agent_build_ref = session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=agent_build_id). \
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session = session if session else get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,bwusage = session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,spec_results = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(instance_type_id=instance_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,spec_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,for i in spec_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,spec_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return spec_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,spec_result = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not spec_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,raise exception.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"InstanceTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return spec_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def volume_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def volume_type_get_all(context, inactive=False, filters={}):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,vol_types = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"order_by(""name"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,vol_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,for i in vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,vol_dict[i['name']] = _dict_with_extra_specs(i)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return vol_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,vol_type = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not vol_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return _dict_with_extra_specs(vol_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,volume_type_ref = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,spec_results = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(volume_type_id=volume_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,spec_result = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"VolumeTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,options(joinedload('vsa_instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,res = session.query(models.S3Image)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,.filter_by(id=image_id)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not res:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return res
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,.filter_by(uuid=image_uuid)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,backend_conf = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(id=sm_backend_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.NotFound(_(""No backend config with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"""%(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.SMBackendConf).filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.SMBackendConf).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,sm_flavor = session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not sm_flavor:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.NotFound(_(""No sm_flavor with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"""%(sm_flavor_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,filter_by(label=sm_flavor_label).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,delete()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"def sm_flavor_get(context, sm_flavor):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.SMFlavors).filter_by(label=sm_flavor)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.NotFound(_(""No sm_flavor called %(sm_flavor)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,% locals())
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.SMFlavors).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,sm_volume = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,if not sm_volume:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,"raise exception.NotFound(_(""No sm_volume with id %(volume_id)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,session.query(models.SMVolume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,result = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2218cb025adca1ded3e6596acc182b88742e3a51,deleted,1,return session.query(models.SMVolume).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def model_query(context, *args, **kwargs):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"""""""Query helper that accounts for context's `read_deleted` field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,:param context: context to query under
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,":param session: if present, the session to use"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,":param read_deleted: if present, overrides context's read_deleted field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,":param project_only: if present and context is user-type, then restrict"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,query to match the context's project_id.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,""""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,session = kwargs.get('session') or get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,read_deleted = kwargs.get('read_deleted') or context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,project_only = kwargs.get('project_only')
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,query = session.query(*args)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,if read_deleted == 'no':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,query = query.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,elif read_deleted == 'yes':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,pass  # omit the filter to include deleted and active
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,elif read_deleted == 'only':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,query = query.filter_by(deleted=True)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise Exception(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_(""Unrecognized read_deleted value '%s'"") % read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,if project_only and is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,query = query.filter_by(project_id=context.project_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return query
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Service, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"query = model_query(context, models.Service)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"filter_by(topic=""compute"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Service,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.coalesce(sort_value, 0),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"session=session, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"subq = model_query(context, models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.sum(models.Instance.vcpus).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"subq = model_query(context, models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.count(models.Network.id).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"subq = model_query(context, models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.sum(models.Volume.size).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Service).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Certificate, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Certificate, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def certificate_get_all_by_user_and_project(context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.FloatingIp, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"floating_ip_ref = model_query(context, models.FloatingIp,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.FloatingIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,@require_admin_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,def _floating_ip_get_all(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload_all('fixed_ip.instance'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,floating_ip_refs = _floating_ip_get_all(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,floating_ip_refs = _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"fixed_ip_ref = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def fixed_ip_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def fixed_ip_bulk_create(context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def fixed_ip_disassociate_all_by_timeout(context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"inner_q = model_query(context, models.Network.id, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.FixedIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# FIXME(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# results?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.FixedIp, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# NOTE(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,@require_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _virtual_interface_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.VirtualInterface, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('fixed_ips'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"vif_ref = _virtual_interface_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,vif_ref = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,vif_refs = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,vif_refs = _virtual_interface_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.sum(models.Instance.memory_mb),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _build_instance_get(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Instance, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,project_only=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Instance).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _instance_get_all_query(context, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Instance, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _instance_get_all_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _instance_get_all_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return _instance_get_all_query(context, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.KeyPair, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.KeyPair, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Network).count()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _network_ips_query(context, network_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(network_id=network_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return _network_ips_query(context, network_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"network_ref = network_get(context, network_id=network_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Network, read_deleted=""no"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Network, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"# FIXME(sirp): since this returns fixed_ips, this would be better named"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# fixed_ip_get_all_by_network.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _network_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"read_deleted=""no"")"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _network_get_query(context).filter_by(bridge=bridge).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _network_get_query(context).filter_by(uuid=uuid).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def network_get_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def network_get_all_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"network_ref = _network_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def queue_get_for(context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.IscsiTarget).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.AuthToken, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def auth_token_create(context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"rows = model_query(context, models.Quota, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"quotas = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"iscsi_target_ref = model_query(context, models.IscsiTarget,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"func.sum(models.Volume.size),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _volume_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Volume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,project_only=project_only).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('volume_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _volume_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _volume_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _volume_get_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Volume, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _volume_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _volume_get_query(context).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.IscsiTarget, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _volume_metadata_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.VolumeMetadata,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(volume_id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"rows = _volume_metadata_get_query(context, volume_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,for row in rows:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result[row['key']] = row['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_volume_metadata_get_query(context, volume_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _volume_metadata_get_query(context, volume_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Snapshot, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Snapshot).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Snapshot).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _block_device_mapping_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.BlockDeviceMapping, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _block_device_mapping_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _security_group_get_query(context, session=None, read_deleted=None,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,project_only=False):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SecurityGroup, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"read_deleted=read_deleted, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload_all('rules'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _security_group_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _security_group_get_query(context, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.SecurityGroupNotFoundForProject(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"project_id=project_id, security_group_id=group_name)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _security_group_rule_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SecurityGroupIngressRule,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,session=session)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.ProviderFirewallRule).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.ProviderFirewallRule).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.User, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def user_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.User).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def project_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Project, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Project).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"user = model_query(context, models.User).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Migration, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(status=status).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"filter_by(status=""FINISHED"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.ConsolePoolNotFoundForHostType(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"host=host, console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# NOTE(mdragon): consoles are meant to be transient.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.ConsoleNotFoundInPoolForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"pool_id=pool_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"query = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=console_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('pool'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,if instance_id is not None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = query.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.ConsoleNotFoundForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"console_id=console_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def instance_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _instance_type_get_query(context, session=None, read_deleted=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.InstanceTypes, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,read_deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"read_deleted = ""yes"" if inactive else ""no"""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"query = _instance_type_get_query(context, read_deleted=read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,query = query.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"inst_types = query.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _instance_type_get_query(context, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _dict_with_extra_specs(result)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"instance_type_ref = model_query(context, models.InstanceTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# FIXME(sirp): this should update deleted_at and updated_at as well
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _zone_get_by_id_query(context, zone_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Zone, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"zone = zone_get(context, zone_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_zone_get_by_id_query(context, zone_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _zone_get_by_id_query(context, zone_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.Zone, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _instance_metadata_get_query(context, instance_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.InstanceMetadata, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"rows = _instance_metadata_get_query(context, instance_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_instance_metadata_get_query(context, instance_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _instance_metadata_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"context, instance_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.AgentBuild, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"agent_build_ref = model_query(context, models.AgentBuild,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"session=session, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=agent_build_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.BandwidthUsage, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"bwusage = model_query(context, models.BandwidthUsage,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _instance_type_extra_specs_get_query(context, instance_type_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.InstanceTypeExtraSpecs,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,rows = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"context, instance_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,_instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"context, instance_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.InstanceTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"extra_specs_key=key, instance_type_id=instance_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def volume_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def volume_type_get_all(context, inactive=False, filters=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filters = filters or {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"rows = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# TODO(sirp): this patern of converting rows to a result with extra_specs
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"# is repeated quite a bit, might be worth creating a method for it"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result[row['name']] = _dict_with_extra_specs(row)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.VolumeTypes, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"volume_type_ref = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# FIXME(sirp): we should be setting deleted_at and updated_at here
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _volume_type_extra_specs_query(context, volume_type_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.VolumeTypeExtraSpecs, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"rows = _volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,result = _volume_type_extra_specs_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"context, volume_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.VolumeTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"extra_specs_key=key, volume_type_id=volume_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _vsa_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.VirtualStorageArray, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,options(joinedload('vsa_instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _vsa_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _vsa_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,return _vsa_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.S3Image, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=image_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(uuid=image_uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"backend_conf = model_query(context, models.SMBackendConf,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=sm_backend_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,raise exception.NotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_(""No backend config with id %(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"# FIXME(sirp): for consistency, shouldn't this just mark as deleted with"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# `purge` actually deleting the record?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"model_query(context, models.SMBackendConf, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,# FIXME(sirp): shouldn't this have a `first()` qualifier attached?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _sm_flavor_get_query(context, sm_flavor_label, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SMFlavors, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"sm_flavor = sm_flavor_get(context, sm_flavor_label)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_sm_flavor_get_query(context, sm_flavor_label).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def sm_flavor_get(context, sm_flavor_label):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _sm_flavor_get_query(context, sm_flavor_label).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_(""No sm_flavor called %(sm_flavor)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SMFlavors, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"def _sm_volume_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SMVolume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,filter_by(id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"sm_volume = sm_volume_get(context, volume_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_sm_volume_get_query(context, volume_id, session=session).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"result = _sm_volume_get_query(context, volume_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"_(""No sm_volume with id %(volume_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,added,0,"return model_query(context, models.SMVolume, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,def can_read_deleted(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"""""""Indicates if the context has access to deleted objects."""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not context:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return False
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(deleted=can_read_deleted(context)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,query = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(deleted=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,topic = 'compute'
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"return session.query(models.Service, func.coalesce(sort_value, 0)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"subq = session.query(models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,func.sum(models.Instance.vcpus).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"subq = session.query(models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,func.count(models.Network.id).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"subq = session.query(models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,func.sum(models.Volume.size).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def certificate_get_all_by_user_and_project(_context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = None
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if is_admin_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,elif is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,floating_ip_ref = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,floating_ip_refs = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,fixed_ip_ref = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def fixed_ip_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def fixed_ip_bulk_create(_context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def fixed_ip_disassociate_all_by_timeout(_context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,inner_q = session.query(models.Network.id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,rv = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not rv:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return rv
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,vif_ref = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('fixed_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,vif_refs = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"result = session.query(func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,func.sum(models.Instance.memory_mb)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"partial = _build_instance_get(context, session=session)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = partial.filter_by(uuid=uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = result.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = partial.filter_by(id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,partial = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,partial = partial.filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,partial = partial.filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return partial
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(user_id=user_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,read_deleted = can_read_deleted(context)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('fixed_ips.floating_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('security_groups')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('fixed_ips.network')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,query = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return query.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"network_ref = network_get(context, network_id=network_id, \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(deleted=False).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(bridge=bridge).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def network_get_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,rv = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def network_get_all_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,with session.begin():
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,network_ref = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def queue_get_for(_context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if session is None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,tk = session.query(models.AuthToken).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not tk:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return tk
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def auth_token_create(_context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,rows = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,quotas = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,iscsi_target_ref = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"result = session.query(func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,func.sum(models.Volume.size)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('volume_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,meta_results = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,meta_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,for i in meta_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,meta_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return meta_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,meta_result = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not meta_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return meta_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return []
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('rules')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"filter_by(deleted=can_read_deleted(context),).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.SecurityGroupNotFoundForProject(project_id=project_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,security_group_id=group_name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.SecurityGroupIngressRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=security_group_rule_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,# TODO(vish): Join to group and check for project_id
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(parent_group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload_all('grantee_group.instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.ProviderFirewallRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def user_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def project_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,user = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(status=status).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,results = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"filter_by(status=""FINISHED"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return results
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.ConsolePoolNotFoundForHostType(host=host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,# consoles are meant to be transient. (mdragon)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.ConsoleNotFoundInPoolForInstance(pool_id=pool_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,results = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('pool')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,query = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=console_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if instance_id:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = query.options(joinedload('pool')).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.ConsoleNotFoundForInstance(console_id=console_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def instance_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,partial = session.query(models.InstanceTypes)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,.options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,partial = partial.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,partial = partial.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"inst_types = partial.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,inst_type = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('extra_specs')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not inst_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return _dict_with_extra_specs(inst_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,instance_type_ref = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,zone = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not zone:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,raise exception.ZoneNotFound(zone_id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.Zone).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=zone_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.Zone).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,meta_results = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,meta_result = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,agent_build_ref = session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=agent_build_id). \
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session = session if session else get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,bwusage = session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,spec_results = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(instance_type_id=instance_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,spec_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,for i in spec_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,spec_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return spec_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,spec_result = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not spec_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,raise exception.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"InstanceTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return spec_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def volume_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def volume_type_get_all(context, inactive=False, filters={}):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,vol_types = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"order_by(""name"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,vol_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,for i in vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,vol_dict[i['name']] = _dict_with_extra_specs(i)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return vol_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,vol_type = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not vol_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return _dict_with_extra_specs(vol_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,volume_type_ref = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,spec_results = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(volume_type_id=volume_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,spec_result = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"VolumeTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,options(joinedload('vsa_instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,res = session.query(models.S3Image)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,.filter_by(id=image_id)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not res:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return res
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,.filter_by(uuid=image_uuid)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,backend_conf = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(id=sm_backend_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.NotFound(_(""No backend config with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"""%(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.SMBackendConf).filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.SMBackendConf).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,sm_flavor = session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not sm_flavor:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.NotFound(_(""No sm_flavor with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"""%(sm_flavor_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,filter_by(label=sm_flavor_label).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,delete()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"def sm_flavor_get(context, sm_flavor):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.SMFlavors).filter_by(label=sm_flavor)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.NotFound(_(""No sm_flavor called %(sm_flavor)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,% locals())
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.SMFlavors).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,sm_volume = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,if not sm_volume:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,"raise exception.NotFound(_(""No sm_volume with id %(volume_id)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,session.query(models.SMVolume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,result = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,879845496a50477ebc2709291c159ae1e8d5aa2a,deleted,1,return session.query(models.SMVolume).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def model_query(context, *args, **kwargs):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"""""""Query helper that accounts for context's `read_deleted` field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,:param context: context to query under
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,":param session: if present, the session to use"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,":param read_deleted: if present, overrides context's read_deleted field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,":param project_only: if present and context is user-type, then restrict"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,query to match the context's project_id.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,""""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,session = kwargs.get('session') or get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,read_deleted = kwargs.get('read_deleted') or context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,project_only = kwargs.get('project_only')
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,query = session.query(*args)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,if read_deleted == 'no':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,query = query.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,elif read_deleted == 'yes':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,pass  # omit the filter to include deleted and active
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,elif read_deleted == 'only':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,query = query.filter_by(deleted=True)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise Exception(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_(""Unrecognized read_deleted value '%s'"") % read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,if project_only and is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,query = query.filter_by(project_id=context.project_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return query
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Service, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"query = model_query(context, models.Service)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"filter_by(topic=""compute"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Service,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.coalesce(sort_value, 0),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"session=session, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"subq = model_query(context, models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.sum(models.Instance.vcpus).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"subq = model_query(context, models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.count(models.Network.id).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"subq = model_query(context, models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.sum(models.Volume.size).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Service).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Certificate, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Certificate, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def certificate_get_all_by_user_and_project(context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.FloatingIp, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"floating_ip_ref = model_query(context, models.FloatingIp,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.FloatingIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,@require_admin_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,def _floating_ip_get_all(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload_all('fixed_ip.instance'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,floating_ip_refs = _floating_ip_get_all(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,floating_ip_refs = _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"fixed_ip_ref = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def fixed_ip_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def fixed_ip_bulk_create(context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def fixed_ip_disassociate_all_by_timeout(context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"inner_q = model_query(context, models.Network.id, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.FixedIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# FIXME(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# results?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.FixedIp, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# NOTE(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,@require_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _virtual_interface_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.VirtualInterface, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('fixed_ips'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"vif_ref = _virtual_interface_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,vif_ref = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,vif_refs = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,vif_refs = _virtual_interface_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.sum(models.Instance.memory_mb),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _build_instance_get(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Instance, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,project_only=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Instance).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _instance_get_all_query(context, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Instance, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _instance_get_all_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _instance_get_all_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return _instance_get_all_query(context, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.KeyPair, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.KeyPair, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Network).count()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _network_ips_query(context, network_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(network_id=network_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return _network_ips_query(context, network_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"network_ref = network_get(context, network_id=network_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Network, read_deleted=""no"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Network, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"# FIXME(sirp): since this returns fixed_ips, this would be better named"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# fixed_ip_get_all_by_network.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _network_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"read_deleted=""no"")"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _network_get_query(context).filter_by(bridge=bridge).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _network_get_query(context).filter_by(uuid=uuid).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def network_get_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def network_get_all_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"network_ref = _network_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def queue_get_for(context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.IscsiTarget).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.AuthToken, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def auth_token_create(context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"rows = model_query(context, models.Quota, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"quotas = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"iscsi_target_ref = model_query(context, models.IscsiTarget,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"func.sum(models.Volume.size),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _volume_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Volume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,project_only=project_only).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('volume_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _volume_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _volume_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _volume_get_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Volume, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _volume_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _volume_get_query(context).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.IscsiTarget, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _volume_metadata_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.VolumeMetadata,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(volume_id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"rows = _volume_metadata_get_query(context, volume_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,for row in rows:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result[row['key']] = row['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_volume_metadata_get_query(context, volume_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _volume_metadata_get_query(context, volume_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Snapshot, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Snapshot).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Snapshot).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _block_device_mapping_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.BlockDeviceMapping, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _block_device_mapping_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _security_group_get_query(context, session=None, read_deleted=None,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,project_only=False):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SecurityGroup, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"read_deleted=read_deleted, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload_all('rules'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _security_group_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _security_group_get_query(context, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.SecurityGroupNotFoundForProject(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"project_id=project_id, security_group_id=group_name)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _security_group_rule_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SecurityGroupIngressRule,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,session=session)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.ProviderFirewallRule).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.ProviderFirewallRule).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.User, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def user_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.User).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def project_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Project, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Project).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"user = model_query(context, models.User).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Migration, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(status=status).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"filter_by(status=""FINISHED"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.ConsolePoolNotFoundForHostType(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"host=host, console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# NOTE(mdragon): consoles are meant to be transient.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.ConsoleNotFoundInPoolForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"pool_id=pool_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"query = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=console_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('pool'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,if instance_id is not None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = query.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.ConsoleNotFoundForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"console_id=console_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def instance_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _instance_type_get_query(context, session=None, read_deleted=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.InstanceTypes, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,read_deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"read_deleted = ""yes"" if inactive else ""no"""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"query = _instance_type_get_query(context, read_deleted=read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,query = query.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"inst_types = query.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _instance_type_get_query(context, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _dict_with_extra_specs(result)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"instance_type_ref = model_query(context, models.InstanceTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# FIXME(sirp): this should update deleted_at and updated_at as well
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _zone_get_by_id_query(context, zone_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Zone, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"zone = zone_get(context, zone_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_zone_get_by_id_query(context, zone_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _zone_get_by_id_query(context, zone_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.Zone, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _instance_metadata_get_query(context, instance_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.InstanceMetadata, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"rows = _instance_metadata_get_query(context, instance_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_instance_metadata_get_query(context, instance_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _instance_metadata_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"context, instance_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.AgentBuild, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"agent_build_ref = model_query(context, models.AgentBuild,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"session=session, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=agent_build_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.BandwidthUsage, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"bwusage = model_query(context, models.BandwidthUsage,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _instance_type_extra_specs_get_query(context, instance_type_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.InstanceTypeExtraSpecs,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,rows = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"context, instance_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"context, instance_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.InstanceTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"extra_specs_key=key, instance_type_id=instance_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def volume_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def volume_type_get_all(context, inactive=False, filters=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filters = filters or {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"rows = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# TODO(sirp): this patern of converting rows to a result with extra_specs
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"# is repeated quite a bit, might be worth creating a method for it"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result[row['name']] = _dict_with_extra_specs(row)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.VolumeTypes, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"volume_type_ref = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# FIXME(sirp): we should be setting deleted_at and updated_at here
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _volume_type_extra_specs_query(context, volume_type_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.VolumeTypeExtraSpecs, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"rows = _volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,result = _volume_type_extra_specs_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"context, volume_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.VolumeTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"extra_specs_key=key, volume_type_id=volume_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _vsa_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.VirtualStorageArray, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,options(joinedload('vsa_instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _vsa_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _vsa_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,return _vsa_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.S3Image, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=image_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(uuid=image_uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"backend_conf = model_query(context, models.SMBackendConf,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=sm_backend_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,raise exception.NotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_(""No backend config with id %(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"# FIXME(sirp): for consistency, shouldn't this just mark as deleted with"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# `purge` actually deleting the record?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"model_query(context, models.SMBackendConf, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,# FIXME(sirp): shouldn't this have a `first()` qualifier attached?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _sm_flavor_get_query(context, sm_flavor_label, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SMFlavors, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"sm_flavor = sm_flavor_get(context, sm_flavor_label)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_sm_flavor_get_query(context, sm_flavor_label).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def sm_flavor_get(context, sm_flavor_label):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _sm_flavor_get_query(context, sm_flavor_label).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_(""No sm_flavor called %(sm_flavor)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SMFlavors, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"def _sm_volume_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SMVolume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,filter_by(id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"sm_volume = sm_volume_get(context, volume_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_sm_volume_get_query(context, volume_id, session=session).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"result = _sm_volume_get_query(context, volume_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"_(""No sm_volume with id %(volume_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,"return model_query(context, models.SMVolume, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,def can_read_deleted(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"""""""Indicates if the context has access to deleted objects."""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not context:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return False
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(deleted=can_read_deleted(context)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,query = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(deleted=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,topic = 'compute'
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"return session.query(models.Service, func.coalesce(sort_value, 0)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"subq = session.query(models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,func.sum(models.Instance.vcpus).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"subq = session.query(models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,func.count(models.Network.id).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"subq = session.query(models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,func.sum(models.Volume.size).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def certificate_get_all_by_user_and_project(_context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = None
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if is_admin_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,elif is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,floating_ip_ref = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,floating_ip_refs = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,fixed_ip_ref = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def fixed_ip_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def fixed_ip_bulk_create(_context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def fixed_ip_disassociate_all_by_timeout(_context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,inner_q = session.query(models.Network.id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,rv = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not rv:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return rv
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,vif_ref = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('fixed_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,vif_refs = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"result = session.query(func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,func.sum(models.Instance.memory_mb)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"partial = _build_instance_get(context, session=session)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = partial.filter_by(uuid=uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = result.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = partial.filter_by(id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,partial = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,partial = partial.filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,partial = partial.filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return partial
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(user_id=user_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,read_deleted = can_read_deleted(context)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('fixed_ips.floating_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('security_groups')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('fixed_ips.network')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,query = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return query.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"network_ref = network_get(context, network_id=network_id, \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(deleted=False).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(bridge=bridge).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def network_get_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,rv = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def network_get_all_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,with session.begin():
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,network_ref = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def queue_get_for(_context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if session is None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,tk = session.query(models.AuthToken).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not tk:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return tk
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def auth_token_create(_context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,rows = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,quotas = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,iscsi_target_ref = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"result = session.query(func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,func.sum(models.Volume.size)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('volume_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,meta_results = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,meta_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,for i in meta_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,meta_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return meta_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,meta_result = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not meta_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return meta_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return []
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('rules')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"filter_by(deleted=can_read_deleted(context),).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.SecurityGroupNotFoundForProject(project_id=project_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,security_group_id=group_name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.SecurityGroupIngressRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=security_group_rule_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,# TODO(vish): Join to group and check for project_id
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(parent_group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload_all('grantee_group.instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.ProviderFirewallRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def user_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def project_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,user = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(status=status).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,results = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"filter_by(status=""FINISHED"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return results
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.ConsolePoolNotFoundForHostType(host=host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,# consoles are meant to be transient. (mdragon)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.ConsoleNotFoundInPoolForInstance(pool_id=pool_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,results = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('pool')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,query = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=console_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if instance_id:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = query.options(joinedload('pool')).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.ConsoleNotFoundForInstance(console_id=console_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def instance_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,partial = session.query(models.InstanceTypes)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,.options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,partial = partial.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,partial = partial.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"inst_types = partial.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,inst_type = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('extra_specs')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not inst_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return _dict_with_extra_specs(inst_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,instance_type_ref = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,zone = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not zone:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,raise exception.ZoneNotFound(zone_id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.Zone).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=zone_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.Zone).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,meta_results = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,meta_result = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,agent_build_ref = session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=agent_build_id). \
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session = session if session else get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,bwusage = session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,spec_results = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(instance_type_id=instance_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,spec_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,for i in spec_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,spec_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return spec_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,spec_result = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not spec_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,raise exception.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"InstanceTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return spec_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def volume_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def volume_type_get_all(context, inactive=False, filters={}):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,vol_types = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"order_by(""name"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,vol_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,for i in vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,vol_dict[i['name']] = _dict_with_extra_specs(i)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return vol_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,vol_type = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not vol_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return _dict_with_extra_specs(vol_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,volume_type_ref = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,spec_results = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(volume_type_id=volume_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,spec_result = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"VolumeTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,options(joinedload('vsa_instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,res = session.query(models.S3Image)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,.filter_by(id=image_id)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not res:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return res
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,.filter_by(uuid=image_uuid)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,backend_conf = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(id=sm_backend_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.NotFound(_(""No backend config with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"""%(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.SMBackendConf).filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.SMBackendConf).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,sm_flavor = session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not sm_flavor:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.NotFound(_(""No sm_flavor with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"""%(sm_flavor_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,filter_by(label=sm_flavor_label).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,delete()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"def sm_flavor_get(context, sm_flavor):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.SMFlavors).filter_by(label=sm_flavor)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.NotFound(_(""No sm_flavor called %(sm_flavor)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,% locals())
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.SMFlavors).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,sm_volume = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,if not sm_volume:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,"raise exception.NotFound(_(""No sm_volume with id %(volume_id)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,session.query(models.SMVolume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,result = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,return session.query(models.SMVolume).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def model_query(context, *args, **kwargs):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"""""""Query helper that accounts for context's `read_deleted` field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,:param context: context to query under
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,":param session: if present, the session to use"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,":param read_deleted: if present, overrides context's read_deleted field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,":param project_only: if present and context is user-type, then restrict"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,query to match the context's project_id.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,""""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,session = kwargs.get('session') or get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,read_deleted = kwargs.get('read_deleted') or context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,project_only = kwargs.get('project_only')
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,query = session.query(*args)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,if read_deleted == 'no':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,query = query.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,elif read_deleted == 'yes':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,pass  # omit the filter to include deleted and active
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,elif read_deleted == 'only':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,query = query.filter_by(deleted=True)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise Exception(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_(""Unrecognized read_deleted value '%s'"") % read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,if project_only and is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,query = query.filter_by(project_id=context.project_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return query
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Service, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"query = model_query(context, models.Service)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"filter_by(topic=""compute"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Service,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.coalesce(sort_value, 0),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"session=session, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"subq = model_query(context, models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.sum(models.Instance.vcpus).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"subq = model_query(context, models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.count(models.Network.id).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"subq = model_query(context, models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.sum(models.Volume.size).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Service).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Certificate, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Certificate, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def certificate_get_all_by_user_and_project(context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.FloatingIp, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"floating_ip_ref = model_query(context, models.FloatingIp,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.FloatingIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,@require_admin_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,def _floating_ip_get_all(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload_all('fixed_ip.instance'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,floating_ip_refs = _floating_ip_get_all(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,floating_ip_refs = _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"fixed_ip_ref = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def fixed_ip_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def fixed_ip_bulk_create(context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def fixed_ip_disassociate_all_by_timeout(context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"inner_q = model_query(context, models.Network.id, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.FixedIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# FIXME(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# results?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.FixedIp, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# NOTE(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,@require_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _virtual_interface_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.VirtualInterface, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('fixed_ips'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"vif_ref = _virtual_interface_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,vif_ref = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,vif_refs = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,vif_refs = _virtual_interface_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.sum(models.Instance.memory_mb),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _build_instance_get(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Instance, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,project_only=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Instance).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _instance_get_all_query(context, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Instance, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _instance_get_all_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _instance_get_all_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return _instance_get_all_query(context, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.KeyPair, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.KeyPair, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Network).count()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _network_ips_query(context, network_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(network_id=network_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return _network_ips_query(context, network_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"network_ref = network_get(context, network_id=network_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Network, read_deleted=""no"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Network, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"# FIXME(sirp): since this returns fixed_ips, this would be better named"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# fixed_ip_get_all_by_network.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _network_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"read_deleted=""no"")"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _network_get_query(context).filter_by(bridge=bridge).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _network_get_query(context).filter_by(uuid=uuid).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def network_get_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def network_get_all_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"network_ref = _network_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def queue_get_for(context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.IscsiTarget).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.AuthToken, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def auth_token_create(context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"rows = model_query(context, models.Quota, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"quotas = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"iscsi_target_ref = model_query(context, models.IscsiTarget,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"func.sum(models.Volume.size),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _volume_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Volume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,project_only=project_only).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('volume_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _volume_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _volume_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _volume_get_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Volume, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _volume_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _volume_get_query(context).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.IscsiTarget, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _volume_metadata_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.VolumeMetadata,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(volume_id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"rows = _volume_metadata_get_query(context, volume_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,for row in rows:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result[row['key']] = row['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_volume_metadata_get_query(context, volume_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _volume_metadata_get_query(context, volume_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Snapshot, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Snapshot).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Snapshot).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _block_device_mapping_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.BlockDeviceMapping, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _block_device_mapping_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _security_group_get_query(context, session=None, read_deleted=None,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,project_only=False):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SecurityGroup, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"read_deleted=read_deleted, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload_all('rules'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _security_group_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _security_group_get_query(context, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.SecurityGroupNotFoundForProject(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"project_id=project_id, security_group_id=group_name)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _security_group_rule_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SecurityGroupIngressRule,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,session=session)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.ProviderFirewallRule).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.ProviderFirewallRule).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.User, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def user_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.User).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def project_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Project, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Project).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"user = model_query(context, models.User).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Migration, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(status=status).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"filter_by(status=""FINISHED"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.ConsolePoolNotFoundForHostType(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"host=host, console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# NOTE(mdragon): consoles are meant to be transient.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.ConsoleNotFoundInPoolForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"pool_id=pool_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"query = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=console_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('pool'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,if instance_id is not None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = query.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.ConsoleNotFoundForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"console_id=console_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def instance_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _instance_type_get_query(context, session=None, read_deleted=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.InstanceTypes, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,read_deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"read_deleted = ""yes"" if inactive else ""no"""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"query = _instance_type_get_query(context, read_deleted=read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,query = query.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"inst_types = query.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _instance_type_get_query(context, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _dict_with_extra_specs(result)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"instance_type_ref = model_query(context, models.InstanceTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# FIXME(sirp): this should update deleted_at and updated_at as well
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _zone_get_by_id_query(context, zone_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Zone, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"zone = zone_get(context, zone_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_zone_get_by_id_query(context, zone_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _zone_get_by_id_query(context, zone_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.Zone, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _instance_metadata_get_query(context, instance_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.InstanceMetadata, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"rows = _instance_metadata_get_query(context, instance_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_instance_metadata_get_query(context, instance_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _instance_metadata_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"context, instance_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.AgentBuild, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"agent_build_ref = model_query(context, models.AgentBuild,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"session=session, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=agent_build_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.BandwidthUsage, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"bwusage = model_query(context, models.BandwidthUsage,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _instance_type_extra_specs_get_query(context, instance_type_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.InstanceTypeExtraSpecs,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,rows = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"context, instance_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,_instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"context, instance_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.InstanceTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"extra_specs_key=key, instance_type_id=instance_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def volume_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def volume_type_get_all(context, inactive=False, filters=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filters = filters or {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"rows = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# TODO(sirp): this patern of converting rows to a result with extra_specs
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"# is repeated quite a bit, might be worth creating a method for it"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result[row['name']] = _dict_with_extra_specs(row)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.VolumeTypes, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"volume_type_ref = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# FIXME(sirp): we should be setting deleted_at and updated_at here
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _volume_type_extra_specs_query(context, volume_type_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.VolumeTypeExtraSpecs, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"rows = _volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,result = _volume_type_extra_specs_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"context, volume_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.VolumeTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"extra_specs_key=key, volume_type_id=volume_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _vsa_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.VirtualStorageArray, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,options(joinedload('vsa_instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _vsa_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _vsa_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,return _vsa_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.S3Image, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=image_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(uuid=image_uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"backend_conf = model_query(context, models.SMBackendConf,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=sm_backend_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,raise exception.NotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_(""No backend config with id %(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"# FIXME(sirp): for consistency, shouldn't this just mark as deleted with"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# `purge` actually deleting the record?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"model_query(context, models.SMBackendConf, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,# FIXME(sirp): shouldn't this have a `first()` qualifier attached?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _sm_flavor_get_query(context, sm_flavor_label, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SMFlavors, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"sm_flavor = sm_flavor_get(context, sm_flavor_label)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_sm_flavor_get_query(context, sm_flavor_label).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def sm_flavor_get(context, sm_flavor_label):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _sm_flavor_get_query(context, sm_flavor_label).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_(""No sm_flavor called %(sm_flavor)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SMFlavors, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"def _sm_volume_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SMVolume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,filter_by(id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"sm_volume = sm_volume_get(context, volume_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_sm_volume_get_query(context, volume_id, session=session).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"result = _sm_volume_get_query(context, volume_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"_(""No sm_volume with id %(volume_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,added,0,"return model_query(context, models.SMVolume, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,def can_read_deleted(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"""""""Indicates if the context has access to deleted objects."""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not context:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return False
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(deleted=can_read_deleted(context)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,query = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(deleted=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,topic = 'compute'
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"return session.query(models.Service, func.coalesce(sort_value, 0)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"subq = session.query(models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,func.sum(models.Instance.vcpus).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"subq = session.query(models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,func.count(models.Network.id).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"subq = session.query(models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,func.sum(models.Volume.size).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def certificate_get_all_by_user_and_project(_context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = None
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if is_admin_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,elif is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,floating_ip_ref = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,floating_ip_refs = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,fixed_ip_ref = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def fixed_ip_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def fixed_ip_bulk_create(_context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def fixed_ip_disassociate_all_by_timeout(_context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,inner_q = session.query(models.Network.id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,rv = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not rv:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return rv
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,vif_ref = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('fixed_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,vif_refs = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"result = session.query(func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,func.sum(models.Instance.memory_mb)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"partial = _build_instance_get(context, session=session)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = partial.filter_by(uuid=uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = result.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = partial.filter_by(id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,partial = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,partial = partial.filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,partial = partial.filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return partial
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(user_id=user_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,read_deleted = can_read_deleted(context)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('fixed_ips.floating_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('security_groups')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('fixed_ips.network')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,query = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return query.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"network_ref = network_get(context, network_id=network_id, \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(deleted=False).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(bridge=bridge).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def network_get_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,rv = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def network_get_all_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,with session.begin():
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,network_ref = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def queue_get_for(_context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if session is None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,tk = session.query(models.AuthToken).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not tk:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return tk
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def auth_token_create(_context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,rows = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,quotas = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,iscsi_target_ref = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"result = session.query(func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,func.sum(models.Volume.size)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('volume_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,meta_results = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,meta_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,for i in meta_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,meta_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return meta_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,meta_result = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not meta_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return meta_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return []
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('rules')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"filter_by(deleted=can_read_deleted(context),).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.SecurityGroupNotFoundForProject(project_id=project_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,security_group_id=group_name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.SecurityGroupIngressRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=security_group_rule_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,# TODO(vish): Join to group and check for project_id
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(parent_group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload_all('grantee_group.instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.ProviderFirewallRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def user_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def project_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,user = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(status=status).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,results = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"filter_by(status=""FINISHED"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return results
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.ConsolePoolNotFoundForHostType(host=host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,# consoles are meant to be transient. (mdragon)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.ConsoleNotFoundInPoolForInstance(pool_id=pool_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,results = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('pool')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,query = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=console_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if instance_id:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = query.options(joinedload('pool')).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.ConsoleNotFoundForInstance(console_id=console_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def instance_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,partial = session.query(models.InstanceTypes)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,.options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,partial = partial.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,partial = partial.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"inst_types = partial.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,inst_type = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('extra_specs')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not inst_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return _dict_with_extra_specs(inst_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,instance_type_ref = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,zone = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not zone:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,raise exception.ZoneNotFound(zone_id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.Zone).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=zone_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.Zone).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,meta_results = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,meta_result = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,agent_build_ref = session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=agent_build_id). \
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session = session if session else get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,bwusage = session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,spec_results = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(instance_type_id=instance_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,spec_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,for i in spec_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,spec_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return spec_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,spec_result = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not spec_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,raise exception.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"InstanceTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return spec_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def volume_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def volume_type_get_all(context, inactive=False, filters={}):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,vol_types = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"order_by(""name"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,vol_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,for i in vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,vol_dict[i['name']] = _dict_with_extra_specs(i)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return vol_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,vol_type = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not vol_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return _dict_with_extra_specs(vol_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,volume_type_ref = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,spec_results = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(volume_type_id=volume_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,spec_result = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"VolumeTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,options(joinedload('vsa_instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,res = session.query(models.S3Image)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,.filter_by(id=image_id)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not res:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return res
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,.filter_by(uuid=image_uuid)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,backend_conf = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(id=sm_backend_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.NotFound(_(""No backend config with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"""%(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.SMBackendConf).filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.SMBackendConf).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,sm_flavor = session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not sm_flavor:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.NotFound(_(""No sm_flavor with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"""%(sm_flavor_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,filter_by(label=sm_flavor_label).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,delete()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"def sm_flavor_get(context, sm_flavor):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.SMFlavors).filter_by(label=sm_flavor)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.NotFound(_(""No sm_flavor called %(sm_flavor)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,% locals())
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.SMFlavors).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,sm_volume = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,if not sm_volume:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,"raise exception.NotFound(_(""No sm_volume with id %(volume_id)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,session.query(models.SMVolume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,result = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,865c3d57f8b84dfcc493ecead12816874b160e35,deleted,1,return session.query(models.SMVolume).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def model_query(context, *args, **kwargs):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"""""""Query helper that accounts for context's `read_deleted` field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,:param context: context to query under
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,":param session: if present, the session to use"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,":param read_deleted: if present, overrides context's read_deleted field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,":param project_only: if present and context is user-type, then restrict"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,query to match the context's project_id.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,""""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,session = kwargs.get('session') or get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,read_deleted = kwargs.get('read_deleted') or context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,project_only = kwargs.get('project_only')
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,query = session.query(*args)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,if read_deleted == 'no':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,query = query.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,elif read_deleted == 'yes':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,pass  # omit the filter to include deleted and active
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,elif read_deleted == 'only':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,query = query.filter_by(deleted=True)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise Exception(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_(""Unrecognized read_deleted value '%s'"") % read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,if project_only and is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,query = query.filter_by(project_id=context.project_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return query
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Service, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"query = model_query(context, models.Service)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"filter_by(topic=""compute"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Service,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.coalesce(sort_value, 0),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"session=session, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"subq = model_query(context, models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.sum(models.Instance.vcpus).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"subq = model_query(context, models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.count(models.Network.id).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"subq = model_query(context, models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.sum(models.Volume.size).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Service).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Certificate, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Certificate, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def certificate_get_all_by_user_and_project(context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.FloatingIp, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"floating_ip_ref = model_query(context, models.FloatingIp,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.FloatingIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,@require_admin_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,def _floating_ip_get_all(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload_all('fixed_ip.instance'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,floating_ip_refs = _floating_ip_get_all(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,floating_ip_refs = _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"fixed_ip_ref = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def fixed_ip_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def fixed_ip_bulk_create(context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def fixed_ip_disassociate_all_by_timeout(context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"inner_q = model_query(context, models.Network.id, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.FixedIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# FIXME(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# results?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.FixedIp, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# NOTE(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,@require_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _virtual_interface_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.VirtualInterface, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('fixed_ips'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"vif_ref = _virtual_interface_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,vif_ref = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,vif_refs = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,vif_refs = _virtual_interface_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.sum(models.Instance.memory_mb),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _build_instance_get(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Instance, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,project_only=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Instance).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _instance_get_all_query(context, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Instance, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _instance_get_all_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _instance_get_all_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return _instance_get_all_query(context, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.KeyPair, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.KeyPair, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Network).count()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _network_ips_query(context, network_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(network_id=network_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return _network_ips_query(context, network_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"network_ref = network_get(context, network_id=network_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Network, read_deleted=""no"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Network, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"# FIXME(sirp): since this returns fixed_ips, this would be better named"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# fixed_ip_get_all_by_network.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _network_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"read_deleted=""no"")"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _network_get_query(context).filter_by(bridge=bridge).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _network_get_query(context).filter_by(uuid=uuid).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def network_get_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def network_get_all_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"network_ref = _network_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def queue_get_for(context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.IscsiTarget).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.AuthToken, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def auth_token_create(context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"rows = model_query(context, models.Quota, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"quotas = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"iscsi_target_ref = model_query(context, models.IscsiTarget,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"func.sum(models.Volume.size),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _volume_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Volume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,project_only=project_only).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('volume_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _volume_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _volume_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _volume_get_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Volume, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _volume_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _volume_get_query(context).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.IscsiTarget, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _volume_metadata_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.VolumeMetadata,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(volume_id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"rows = _volume_metadata_get_query(context, volume_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,for row in rows:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result[row['key']] = row['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_volume_metadata_get_query(context, volume_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _volume_metadata_get_query(context, volume_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Snapshot, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Snapshot).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Snapshot).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _block_device_mapping_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.BlockDeviceMapping, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _block_device_mapping_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _security_group_get_query(context, session=None, read_deleted=None,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,project_only=False):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SecurityGroup, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"read_deleted=read_deleted, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload_all('rules'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _security_group_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _security_group_get_query(context, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.SecurityGroupNotFoundForProject(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"project_id=project_id, security_group_id=group_name)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _security_group_rule_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SecurityGroupIngressRule,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,session=session)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.ProviderFirewallRule).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.ProviderFirewallRule).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.User, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def user_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.User).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def project_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Project, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Project).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"user = model_query(context, models.User).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Migration, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(status=status).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"filter_by(status=""FINISHED"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.ConsolePoolNotFoundForHostType(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"host=host, console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# NOTE(mdragon): consoles are meant to be transient.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.ConsoleNotFoundInPoolForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"pool_id=pool_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"query = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=console_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('pool'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,if instance_id is not None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = query.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.ConsoleNotFoundForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"console_id=console_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def instance_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _instance_type_get_query(context, session=None, read_deleted=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.InstanceTypes, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,read_deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"read_deleted = ""yes"" if inactive else ""no"""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"query = _instance_type_get_query(context, read_deleted=read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,query = query.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"inst_types = query.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _instance_type_get_query(context, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _dict_with_extra_specs(result)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"instance_type_ref = model_query(context, models.InstanceTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# FIXME(sirp): this should update deleted_at and updated_at as well
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _zone_get_by_id_query(context, zone_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Zone, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"zone = zone_get(context, zone_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_zone_get_by_id_query(context, zone_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _zone_get_by_id_query(context, zone_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.Zone, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _instance_metadata_get_query(context, instance_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.InstanceMetadata, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"rows = _instance_metadata_get_query(context, instance_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_instance_metadata_get_query(context, instance_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _instance_metadata_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"context, instance_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.AgentBuild, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"agent_build_ref = model_query(context, models.AgentBuild,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"session=session, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=agent_build_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.BandwidthUsage, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"bwusage = model_query(context, models.BandwidthUsage,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _instance_type_extra_specs_get_query(context, instance_type_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.InstanceTypeExtraSpecs,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,rows = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"context, instance_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,_instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"context, instance_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.InstanceTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"extra_specs_key=key, instance_type_id=instance_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def volume_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def volume_type_get_all(context, inactive=False, filters=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filters = filters or {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"rows = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# TODO(sirp): this patern of converting rows to a result with extra_specs
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"# is repeated quite a bit, might be worth creating a method for it"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result[row['name']] = _dict_with_extra_specs(row)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.VolumeTypes, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"volume_type_ref = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# FIXME(sirp): we should be setting deleted_at and updated_at here
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _volume_type_extra_specs_query(context, volume_type_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.VolumeTypeExtraSpecs, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"rows = _volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,result = _volume_type_extra_specs_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"context, volume_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.VolumeTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"extra_specs_key=key, volume_type_id=volume_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _vsa_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.VirtualStorageArray, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,options(joinedload('vsa_instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _vsa_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _vsa_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,return _vsa_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.S3Image, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=image_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(uuid=image_uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"backend_conf = model_query(context, models.SMBackendConf,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=sm_backend_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,raise exception.NotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_(""No backend config with id %(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"# FIXME(sirp): for consistency, shouldn't this just mark as deleted with"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# `purge` actually deleting the record?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"model_query(context, models.SMBackendConf, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,# FIXME(sirp): shouldn't this have a `first()` qualifier attached?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _sm_flavor_get_query(context, sm_flavor_label, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SMFlavors, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"sm_flavor = sm_flavor_get(context, sm_flavor_label)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_sm_flavor_get_query(context, sm_flavor_label).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def sm_flavor_get(context, sm_flavor_label):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _sm_flavor_get_query(context, sm_flavor_label).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_(""No sm_flavor called %(sm_flavor)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SMFlavors, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"def _sm_volume_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SMVolume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,filter_by(id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"sm_volume = sm_volume_get(context, volume_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_sm_volume_get_query(context, volume_id, session=session).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"result = _sm_volume_get_query(context, volume_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"_(""No sm_volume with id %(volume_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,added,0,"return model_query(context, models.SMVolume, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,def can_read_deleted(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"""""""Indicates if the context has access to deleted objects."""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not context:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return False
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(deleted=can_read_deleted(context)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,query = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(deleted=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,topic = 'compute'
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"return session.query(models.Service, func.coalesce(sort_value, 0)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"subq = session.query(models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,func.sum(models.Instance.vcpus).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"subq = session.query(models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,func.count(models.Network.id).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"subq = session.query(models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,func.sum(models.Volume.size).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def certificate_get_all_by_user_and_project(_context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = None
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if is_admin_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,elif is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,floating_ip_ref = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,floating_ip_refs = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,fixed_ip_ref = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def fixed_ip_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def fixed_ip_bulk_create(_context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def fixed_ip_disassociate_all_by_timeout(_context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,inner_q = session.query(models.Network.id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,rv = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not rv:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return rv
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,vif_ref = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('fixed_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,vif_refs = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"result = session.query(func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,func.sum(models.Instance.memory_mb)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"partial = _build_instance_get(context, session=session)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = partial.filter_by(uuid=uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = result.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = partial.filter_by(id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,partial = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,partial = partial.filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,partial = partial.filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return partial
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(user_id=user_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,read_deleted = can_read_deleted(context)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('fixed_ips.floating_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('security_groups')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('fixed_ips.network')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,query = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return query.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"network_ref = network_get(context, network_id=network_id, \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(deleted=False).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(bridge=bridge).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def network_get_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,rv = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def network_get_all_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,with session.begin():
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,network_ref = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def queue_get_for(_context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if session is None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,tk = session.query(models.AuthToken).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not tk:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return tk
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def auth_token_create(_context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,rows = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,quotas = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,iscsi_target_ref = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"result = session.query(func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,func.sum(models.Volume.size)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('volume_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,meta_results = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,meta_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,for i in meta_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,meta_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return meta_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,meta_result = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not meta_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return meta_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return []
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('rules')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"filter_by(deleted=can_read_deleted(context),).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.SecurityGroupNotFoundForProject(project_id=project_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,security_group_id=group_name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.SecurityGroupIngressRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=security_group_rule_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,# TODO(vish): Join to group and check for project_id
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(parent_group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload_all('grantee_group.instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.ProviderFirewallRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def user_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def project_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,user = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(status=status).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,results = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"filter_by(status=""FINISHED"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return results
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.ConsolePoolNotFoundForHostType(host=host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,# consoles are meant to be transient. (mdragon)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.ConsoleNotFoundInPoolForInstance(pool_id=pool_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,results = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('pool')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,query = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=console_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if instance_id:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = query.options(joinedload('pool')).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.ConsoleNotFoundForInstance(console_id=console_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def instance_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,partial = session.query(models.InstanceTypes)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,.options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,partial = partial.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,partial = partial.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"inst_types = partial.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,inst_type = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('extra_specs')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not inst_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return _dict_with_extra_specs(inst_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,instance_type_ref = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,zone = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not zone:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,raise exception.ZoneNotFound(zone_id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.Zone).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=zone_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.Zone).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,meta_results = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,meta_result = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,agent_build_ref = session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=agent_build_id). \
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session = session if session else get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,bwusage = session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,spec_results = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(instance_type_id=instance_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,spec_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,for i in spec_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,spec_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return spec_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,spec_result = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not spec_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,raise exception.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"InstanceTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return spec_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def volume_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def volume_type_get_all(context, inactive=False, filters={}):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,vol_types = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"order_by(""name"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,vol_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,for i in vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,vol_dict[i['name']] = _dict_with_extra_specs(i)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return vol_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,vol_type = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not vol_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return _dict_with_extra_specs(vol_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,volume_type_ref = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,spec_results = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(volume_type_id=volume_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,spec_result = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"VolumeTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,options(joinedload('vsa_instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,res = session.query(models.S3Image)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,.filter_by(id=image_id)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not res:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return res
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,.filter_by(uuid=image_uuid)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,backend_conf = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(id=sm_backend_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.NotFound(_(""No backend config with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"""%(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.SMBackendConf).filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.SMBackendConf).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,sm_flavor = session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not sm_flavor:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.NotFound(_(""No sm_flavor with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"""%(sm_flavor_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,filter_by(label=sm_flavor_label).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,delete()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"def sm_flavor_get(context, sm_flavor):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.SMFlavors).filter_by(label=sm_flavor)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.NotFound(_(""No sm_flavor called %(sm_flavor)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,% locals())
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.SMFlavors).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,sm_volume = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,if not sm_volume:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,"raise exception.NotFound(_(""No sm_volume with id %(volume_id)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,session.query(models.SMVolume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,result = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,2714b2df0d21ecb08966c4d145d2d75fa1bb201d,deleted,1,return session.query(models.SMVolume).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def model_query(context, *args, **kwargs):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"""""""Query helper that accounts for context's `read_deleted` field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,:param context: context to query under
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,":param session: if present, the session to use"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,":param read_deleted: if present, overrides context's read_deleted field."
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,":param project_only: if present and context is user-type, then restrict"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,query to match the context's project_id.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,""""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,session = kwargs.get('session') or get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,read_deleted = kwargs.get('read_deleted') or context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,project_only = kwargs.get('project_only')
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,query = session.query(*args)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,if read_deleted == 'no':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,query = query.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,elif read_deleted == 'yes':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,pass  # omit the filter to include deleted and active
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,elif read_deleted == 'only':
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,query = query.filter_by(deleted=True)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise Exception(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_(""Unrecognized read_deleted value '%s'"") % read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,if project_only and is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,query = query.filter_by(project_id=context.project_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return query
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Service, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"query = model_query(context, models.Service)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Service, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"filter_by(topic=""compute"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Service,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.coalesce(sort_value, 0),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"session=session, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"subq = model_query(context, models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.sum(models.Instance.vcpus).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"subq = model_query(context, models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.count(models.Network.id).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"subq = model_query(context, models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.sum(models.Volume.size).label(label),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Service).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.ComputeNode, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Certificate, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Certificate, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def certificate_get_all_by_user_and_project(context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.FloatingIp, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"floating_ip_ref = model_query(context, models.FloatingIp,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.FloatingIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,@require_admin_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,def _floating_ip_get_all(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload_all('fixed_ip.instance'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,floating_ip_refs = _floating_ip_get_all(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,floating_ip_refs = _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _floating_ip_get_all(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.FloatingIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"fixed_ip_ref = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def fixed_ip_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def fixed_ip_bulk_create(context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def fixed_ip_disassociate_all_by_timeout(context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"inner_q = model_query(context, models.Network.id, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.FixedIp, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.FixedIp, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# FIXME(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# results?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.FixedIp, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# NOTE(sirp): shouldn't we just use project_only here to restrict the
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,@require_context
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _virtual_interface_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.VirtualInterface, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('fixed_ips'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"vif_ref = _virtual_interface_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,vif_ref = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,vif_refs = _virtual_interface_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,vif_refs = _virtual_interface_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.sum(models.Instance.memory_mb),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _build_instance_get(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Instance, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,project_only=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Instance).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _instance_get_all_query(context, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Instance, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _instance_get_all_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _instance_get_all_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return _instance_get_all_query(context, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.KeyPair, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.KeyPair, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Network).count()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _network_ips_query(context, network_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.FixedIp, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(network_id=network_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return _network_ips_query(context, network_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"network_ref = network_get(context, network_id=network_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Network, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Network, read_deleted=""no"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Network, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"# FIXME(sirp): since this returns fixed_ips, this would be better named"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# fixed_ip_get_all_by_network.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _network_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"read_deleted=""no"")"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _network_get_query(context).filter_by(bridge=bridge).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _network_get_query(context).filter_by(uuid=uuid).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def network_get_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def network_get_all_by_instance(context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _network_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"network_ref = _network_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def queue_get_for(context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.IscsiTarget).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.AuthToken, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def auth_token_create(context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"rows = model_query(context, models.Quota, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"quotas = model_query(context, models.Quota, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"iscsi_target_ref = model_query(context, models.IscsiTarget,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"func.sum(models.Volume.size),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _volume_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Volume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,project_only=project_only).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('volume_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _volume_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _volume_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _volume_get_query(context).filter_by(host=host).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Volume, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _volume_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _volume_get_query(context).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.IscsiTarget, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _volume_metadata_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.VolumeMetadata,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(volume_id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"rows = _volume_metadata_get_query(context, volume_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,for row in rows:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result[row['key']] = row['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_volume_metadata_get_query(context, volume_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _volume_metadata_get_query(context, volume_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Snapshot, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Snapshot).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Snapshot).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _block_device_mapping_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.BlockDeviceMapping, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _block_device_mapping_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _block_device_mapping_get_query(context).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _security_group_get_query(context, session=None, read_deleted=None,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,project_only=False):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SecurityGroup, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"read_deleted=read_deleted, project_only=project_only).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload_all('rules'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _security_group_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _security_group_get_query(context, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.SecurityGroupNotFoundForProject(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"project_id=project_id, security_group_id=group_name)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return _security_group_get_query(context, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _security_group_rule_get_query(context, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SecurityGroupIngressRule,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,session=session)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return _security_group_rule_get_query(context, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.ProviderFirewallRule).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.ProviderFirewallRule).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.User, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def user_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.User).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def project_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Project, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Project).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"user = model_query(context, models.User).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Migration, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(status=status).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Migration, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"filter_by(status=""FINISHED"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.ConsolePoolNotFoundForHostType(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"host=host, console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.ConsolePool, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# NOTE(mdragon): consoles are meant to be transient.
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.ConsoleNotFoundInPoolForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"pool_id=pool_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"query = model_query(context, models.Console, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=console_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('pool'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,if instance_id is not None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = query.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.ConsoleNotFoundForInstance(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"console_id=console_id, instance_id=instance_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def instance_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _instance_type_get_query(context, session=None, read_deleted=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.InstanceTypes, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,read_deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"read_deleted = ""yes"" if inactive else ""no"""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"query = _instance_type_get_query(context, read_deleted=read_deleted)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,query = query.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"inst_types = query.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _instance_type_get_query(context, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _dict_with_extra_specs(result)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"instance_type_ref = model_query(context, models.InstanceTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# FIXME(sirp): this should update deleted_at and updated_at as well
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _zone_get_by_id_query(context, zone_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Zone, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"zone = zone_get(context, zone_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_zone_get_by_id_query(context, zone_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _zone_get_by_id_query(context, zone_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.Zone, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _instance_metadata_get_query(context, instance_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.InstanceMetadata, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"rows = _instance_metadata_get_query(context, instance_id).all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_instance_metadata_get_query(context, instance_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _instance_metadata_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"context, instance_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.AgentBuild, read_deleted=""no"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"model_query(context, models.AgentBuild, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"agent_build_ref = model_query(context, models.AgentBuild,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"session=session, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=agent_build_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.BandwidthUsage, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"bwusage = model_query(context, models.BandwidthUsage,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _instance_type_extra_specs_get_query(context, instance_type_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.InstanceTypeExtraSpecs,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,rows = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"context, instance_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,_instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _instance_type_extra_specs_get_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"context, instance_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.InstanceTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"extra_specs_key=key, instance_type_id=instance_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def volume_type_create(context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def volume_type_get_all(context, inactive=False, filters=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filters = filters or {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"rows = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# TODO(sirp): this patern of converting rows to a result with extra_specs
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"# is repeated quite a bit, might be worth creating a method for it"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result[row['name']] = _dict_with_extra_specs(row)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.VolumeTypes, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"volume_type_ref = model_query(context, models.VolumeTypes,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# FIXME(sirp): we should be setting deleted_at and updated_at here
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _volume_type_extra_specs_query(context, volume_type_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.VolumeTypeExtraSpecs, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"rows = _volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_volume_type_extra_specs_query(context, volume_type_id).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,result = _volume_type_extra_specs_query(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"context, volume_type_id, session=session).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.VolumeTypeExtraSpecsNotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"extra_specs_key=key, volume_type_id=volume_type_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _vsa_get_query(context, session=None, project_only=False):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.VirtualStorageArray, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,options(joinedload('vsa_instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _vsa_get_query(context, session=session, project_only=True).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _vsa_get_query(context).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,return _vsa_get_query(context).filter_by(project_id=project_id).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.S3Image, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=image_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(uuid=image_uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"backend_conf = model_query(context, models.SMBackendConf,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=sm_backend_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,raise exception.NotFound(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_(""No backend config with id %(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"# FIXME(sirp): for consistency, shouldn't this just mark as deleted with"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# `purge` actually deleting the record?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"model_query(context, models.SMBackendConf, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,# FIXME(sirp): shouldn't this have a `first()` qualifier attached?
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SMBackendConf, read_deleted=""yes"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _sm_flavor_get_query(context, sm_flavor_label, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SMFlavors, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"sm_flavor = sm_flavor_get(context, sm_flavor_label)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_sm_flavor_get_query(context, sm_flavor_label).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def sm_flavor_get(context, sm_flavor_label):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _sm_flavor_get_query(context, sm_flavor_label).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_(""No sm_flavor called %(sm_flavor)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SMFlavors, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"def _sm_volume_get_query(context, volume_id, session=None):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SMVolume, session=session,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,filter_by(id=volume_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"sm_volume = sm_volume_get(context, volume_id)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_sm_volume_get_query(context, volume_id, session=session).delete()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"result = _sm_volume_get_query(context, volume_id).first()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"_(""No sm_volume with id %(volume_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,added,0,"return model_query(context, models.SMVolume, read_deleted=""yes"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,def can_read_deleted(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"""""""Indicates if the context has access to deleted objects."""""""
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not context:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return False
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return context.read_deleted
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not session:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session = get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(deleted=can_read_deleted(context)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,query = session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Service).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(deleted=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(disabled=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(topic=topic).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(host=host).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,topic = 'compute'
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('compute_node')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"return session.query(models.Service, func.coalesce(sort_value, 0)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"outerjoin((subq, models.Service.host == subq.c.host)).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,order_by(sort_value).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"subq = session.query(models.Instance.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,func.sum(models.Instance.vcpus).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"subq = session.query(models.Network.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,func.count(models.Network.id).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"subq = session.query(models.Volume.host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,func.sum(models.Volume.size).label(label)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.ComputeNode).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Certificate).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def certificate_get_all_by_user_and_project(_context, user_id, project_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = None
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if is_admin_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('fixed_ip')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('fixed_ip.instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,elif is_user_context(context):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,floating_ip_ref = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,floating_ip_refs = session.query(models.FloatingIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,fixed_ip_ref = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def fixed_ip_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def fixed_ip_bulk_create(_context, ips):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def fixed_ip_disassociate_all_by_timeout(_context, host, time):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,inner_q = session.query(models.Network.id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,rv = session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not rv:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return rv
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,vif_ref = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('fixed_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,vif_refs = session.query(models.VirtualInterface).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"result = session.query(func.count(models.Instance.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"func.sum(models.Instance.vcpus),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,func.sum(models.Instance.memory_mb)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"partial = _build_instance_get(context, session=session)"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = partial.filter_by(uuid=uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = result.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = partial.filter_by(id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,partial = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,partial = partial.filter_by(deleted=can_read_deleted(context))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,partial = partial.filter_by(project_id=context.project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return partial
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def instance_get_all_by_user(context, user_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(user_id=user_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,read_deleted = can_read_deleted(context)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('fixed_ips.floating_ips')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('security_groups')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('fixed_ips.network')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(deleted=read_deleted).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(project_id=project_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,query = session.query(models.Instance).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('instance_type'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return query.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(instance_id=instance_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.KeyPair).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,count()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.FixedIp).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(network_id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(allocated=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(allocated=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(reserved=False).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(reserved=True).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"network_ref = network_get(context, network_id=network_id, \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=network_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(deleted=False).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,models.Network.project_id == None)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter(models.Network.uuid.in_(network_uuids)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter(project_or_none).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter(models.FixedIp.instance_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter(models.FixedIp.virtual_interface_id != None).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(bridge=bridge).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(uuid=uuid).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def network_get_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,rv = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def network_get_all_by_instance(_context, instance_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,with session.begin():
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,# NOTE(vish): return networks that have host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,#             or that have a fixed ip with host set
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"host_filter = or_(models.Network.host == host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,models.FixedIp.host == host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,network_ref = session.query(models.Network).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def queue_get_for(_context, topic, physical_node_id):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if session is None:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,tk = session.query(models.AuthToken).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not tk:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return tk
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def auth_token_create(_context, token):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = {'project_id': project_id}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,rows = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,quotas = session.query(models.Quota).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,iscsi_target_ref = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"result = session.query(func.count(models.Volume.id),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,func.sum(models.Volume.size)).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('instance')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('volume_metadata')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('volume_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Volume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.IscsiTarget).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,meta_results = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(volume_id=volume_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,meta_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,for i in meta_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,meta_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return meta_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,meta_result = session.query(models.VolumeMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not meta_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return meta_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=snapshot_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Snapshot).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.BlockDeviceMapping).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(instance_id=values['instance_id']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(virtual_name=virtual_name).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter(models.BlockDeviceMapping.device_name !=
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,values['device_name']).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"update({'deleted': True,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"'deleted_at': utils.utcnow(),"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,'updated_at': literal_column('updated_at')})
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return []
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('rules')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.SecurityGroup).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"filter_by(deleted=can_read_deleted(context),).\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,else:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.SecurityGroupNotFoundForProject(project_id=project_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,security_group_id=group_name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.SecurityGroupIngressRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=security_group_rule_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,# TODO(vish): Join to group and check for project_id
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(parent_group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload_all('grantee_group.instances')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(group_id=security_group_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.ProviderFirewallRule).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def user_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def project_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Project).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,user = session.query(models.User).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(status=status).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,results = session.query(models.Migration).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"filter_by(status=""FINISHED"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return results
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.ConsolePoolNotFoundForHostType(host=host,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"console_type=console_type,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,compute_host=compute_host)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.ConsolePool).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,# consoles are meant to be transient. (mdragon)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.ConsoleNotFoundInPoolForInstance(pool_id=pool_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,instance_id=instance_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,results = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('pool')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,query = session.query(models.Console).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=console_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if instance_id:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = query.options(joinedload('pool')).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.ConsoleNotFoundForInstance(console_id=console_id,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,##################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def instance_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,partial = session.query(models.InstanceTypes)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,.options(joinedload('extra_specs'))
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,partial = partial.filter_by(deleted=False)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,partial = partial.filter(
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"inst_types = partial.order_by(""name"").all()"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,inst_type = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('extra_specs')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not inst_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return _dict_with_extra_specs(inst_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(flavorid=flavor_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,instance_type_ref = session.query(models.InstanceTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(name=name)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,zone = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not zone:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,raise exception.ZoneNotFound(zone_id=zone_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.Zone).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=zone_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.Zone).filter_by(id=zone_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.Zone).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,meta_results = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,meta_result = session.query(models.InstanceMetadata).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,agent_build_ref = session.query(models.AgentBuild).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=agent_build_id). \
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session = session if session else get_session()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,bwusage = session.query(models.BandwidthUsage).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,spec_results = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(instance_type_id=instance_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,spec_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,for i in spec_results:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,spec_dict[i['key']] = i['value']
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return spec_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,spec_result = session.query(models.InstanceTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not spec_result:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,raise exception.\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"InstanceTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,instance_type_id=instance_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return spec_result
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def volume_type_create(_context, values):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def volume_type_get_all(context, inactive=False, filters={}):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if inactive:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,vol_types = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"order_by(""name"").\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,vol_dict = {}
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,for i in vol_types:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,vol_dict[i['name']] = _dict_with_extra_specs(i)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return vol_dict
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,vol_type = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not vol_type:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return _dict_with_extra_specs(vol_type)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,volume_type_ref = session.query(models.VolumeTypes).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,spec_results = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(volume_type_id=volume_type_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session=None):
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,spec_result = session.query(models.VolumeTypeExtraSpecs).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"VolumeTypeExtraSpecsNotFound(extra_specs_key=key,"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,volume_type_id=volume_type_id)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,####################
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,options(joinedload('vsa_instance_type')).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=vsa_id).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.VirtualStorageArray).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,res = session.query(models.S3Image)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,.filter_by(id=image_id)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,.first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not res:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return res
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,.filter_by(uuid=image_uuid)\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,backend_conf = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(id=sm_backend_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.NotFound(_(""No backend config with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"""%(sm_backend_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.SMBackendConf).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.SMBackendConf).filter_by(sr_uuid=sr_uuid)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.SMBackendConf).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,sm_flavor = session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(label=sm_flavor_label)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not sm_flavor:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.NotFound(_(""No sm_flavor with id ""\"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"""%(sm_flavor_id)s"") % locals())"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.SMFlavors).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,filter_by(label=sm_flavor_label).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,delete()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"def sm_flavor_get(context, sm_flavor):"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.SMFlavors).filter_by(label=sm_flavor)
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.NotFound(_(""No sm_flavor called %(sm_flavor)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,% locals())
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.SMFlavors).all()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,sm_volume = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,if not sm_volume:
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,"raise exception.NotFound(_(""No sm_volume with id %(volume_id)s"") \"
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,session.query(models.SMVolume).\
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,result = session.query(models.SMVolume).filter_by(id=volume_id).first()
c40ee5cfe75e8b1209dc53fc7eb2097812efa54e,7bb9e4c598f829a16cc6444346e087ddb506182a,deleted,1,return session.query(models.SMVolume).all()
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,from nova.virt.disk import api as disk
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,self.container = None
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,disk.destroy_container(self.container)
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,disable_auto_fsck = False
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,disable_auto_fsck = True
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,"use_cow=FLAGS.use_cow_images,"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,disable_auto_fsck=disable_auto_fsck)
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,"self.container = disk.setup_container(basepath('disk'),"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,"container_dir=container_dir,"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,added,0,use_cow=FLAGS.use_cow_images)
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,from nova.virt import disk
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,"disk.destroy_container(target, instance, nbd=FLAGS.use_cow_images)"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,tune2fs = False
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,tune2fs = True
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,"nbd=FLAGS.use_cow_images,"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,tune2fs=tune2fs)
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,"disk.setup_container(basepath('disk'),"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,"container_dir=container_dir,"
5335b4ab0ef1f91203905764de6fcc7e53cb2934,914b0554a092d2b38f292942dc4d7ddea5d99b9a,deleted,1,nbd=FLAGS.use_cow_images)
ae1654bc5910dba5f02f49bc57a49442b9a5f8d6,6bd620fa3d378b4fe437e498ef17888bf632b9d6,added,0,"if isinstance(attr, unicode):"
ae1654bc5910dba5f02f49bc57a49442b9a5f8d6,6bd620fa3d378b4fe437e498ef17888bf632b9d6,deleted,1,if type(attr) is unicode:
ae1654bc5910dba5f02f49bc57a49442b9a5f8d6,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if isinstance(managed_object, str):"
ae1654bc5910dba5f02f49bc57a49442b9a5f8d6,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if type(managed_object) == type(""""):"
ae1654bc5910dba5f02f49bc57a49442b9a5f8d6,81f71efdcbeabd8a67054b6e9e432175ea47d785,added,0,"if isinstance(sub.get_payload(), list):"
ae1654bc5910dba5f02f49bc57a49442b9a5f8d6,81f71efdcbeabd8a67054b6e9e432175ea47d785,deleted,1,if type([]) == type(sub.get_payload()):
a8fd6bf24b8046fe900ded24ad54c1644d3494fd,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,info['gateway_v6'] = network['gateway_v6']
a8fd6bf24b8046fe900ded24ad54c1644d3494fd,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,info['gateway_v6'] = v6_subnet['gateway']
a8fd6bf24b8046fe900ded24ad54c1644d3494fd,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,info['gateway6'] = network['gateway_v6']
a8fd6bf24b8046fe900ded24ad54c1644d3494fd,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,info['gateway6'] = v6_subnet['gateway']
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"flat_vmdk_file_path = vmdk_file_path.replace("".vmdk"", ""-flat.vmdk"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_host_sk = _db_content[""HostSystem""].keys()[0]"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_mdo = _db_content[""HostSystem""][_host_sk]"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_session_info = {'uuid': str(uuid.uuid4()),"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'this_host': _db_content['host'].keys()[0]}
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_db_content['session'][self._session] = _session_info
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ref = (is_sr_create and
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_create_sr(cls, params) or"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,is_vlan_create and
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_create_vlan(params[1], params[2], params[3]) or"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_create_object(cls, params[1]))"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,flat_vmdk_file_path = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vmdk_file_path.replace("".vmdk"", ""-flat.vmdk"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_mdo = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_db_content[""HostSystem""][_db_content[""HostSystem""].keys()[0]]"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_db_content['session'][self._session] = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"{'uuid': str(uuid.uuid4()),"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'this_host': _db_content['host'].keys()[0]}
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ref = is_sr_create and \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_sr(cls, params) or \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,is_vlan_create and \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_vlan(params[1], params[2], params[3]) or \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object(cls, params[1])"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_urlparse = urlparse.urlparse(base_url)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"scheme, netloc, path, params, query, fragment = _urlparse"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(scheme, netloc, path, params, query, fragment) = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,urlparse.urlparse(base_url)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmwareapi_wsdl_loc_opt = cfg.StrOpt('vmwareapi_wsdl_loc',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default=None,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,help='VIM Service WSDL Location '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'e.g http://<server>/vimService.wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'Due to a bug in vSphere ESX 4.1 default wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'Refer readme-vmware to setup')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._service_content = self.RetrieveServiceContent(""ServiceInstance"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,request_mo = self._request_managed_object_builder(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,managed_object)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmwareapi_wsdl_loc_opt = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cfg.StrOpt('vmwareapi_wsdl_loc',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"default=None,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,help='VIM Service WSDL Location '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'e.g http://<server>/vimService.wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'Due to a bug in vSphere ESX 4.1 default wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'Refer readme-vmware to setup')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._service_content = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.RetrieveServiceContent(""ServiceInstance"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,request_mo = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._request_managed_object_builder(managed_object)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmwareapi_wsdl_loc_opt = cfg.StrOpt('vmwareapi_wsdl_loc',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"default=None,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,help='VIM Service WSDL Location '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'e.g http://<server>/vimService.wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'Due to a bug in vSphere ESX 4.1 default wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'Refer readme-vmware to setup')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._service_content = self.RetrieveServiceContent(""ServiceInstance"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,request_mo = self._request_managed_object_builder(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,managed_object)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmwareapi_wsdl_loc_opt = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cfg.StrOpt('vmwareapi_wsdl_loc',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"default=None,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,help='VIM Service WSDL Location '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'e.g http://<server>/vimService.wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'Due to a bug in vSphere ESX 4.1 default wsdl. '
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'Refer readme-vmware to setup')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._service_content = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self.RetrieveServiceContent(""ServiceInstance"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,request_mo = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._request_managed_object_builder(managed_object)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"obj_content = get_object_properties(vim, None, mobj, type, [property_name])"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,prop_filter_spec = client_factory.create('ns0:PropertyFilterSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,obj_content = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"get_object_properties(vim, None, mobj, type, [property_name])"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,prop_filter_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:PropertyFilterSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"obj_content = get_object_properties(vim, None, mobj, type, [property_name])"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,prop_filter_spec = client_factory.create('ns0:PropertyFilterSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,obj_content = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"get_object_properties(vim, None, mobj, type, [property_name])"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,prop_filter_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:PropertyFilterSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,virtual_device_config = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'ns0:VirtualDeviceConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,virtual_lsi = client_factory.create('ns0:VirtualLsiLogicController')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,network_spec = client_factory.create('ns0:VirtualDeviceConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"backing_name = ''.join(['ns0:VirtualEthernetCardDistributed',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'VirtualPortBackingInfo'])
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,backing = client_factory.create(backing_name)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,portgroup = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'ns0:DistributedVirtualSwitchPortConnection')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,backing = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'ns0:VirtualEthernetCardNetworkBackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,connectable_spec = client_factory.create('ns0:VirtualDeviceConnectInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if (device.__class__.__name__ == ""VirtualDisk"" and"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,device.backing.__class__.__name__ ==
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualDiskFlatVer2BackingInfo""):"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,create_vmdk_spec = client_factory.create('ns0:FileBackedVirtualDiskSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,disk_file_backing = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'ns0:VirtualDiskFlatVer2BackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,virtual_machine_config_spec = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'ns0:VirtualMachineConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,virtual_device_config = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:VirtualDeviceConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,virtual_lsi = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:VirtualLsiLogicController')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,network_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,backing_name = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'ns0:VirtualEthernetCardDistributedVirtualPortBackingInfo'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,backing = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create(backing_name)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,portgroup = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:DistributedVirtualSwitchPortConnection')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:VirtualEthernetCardNetworkBackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,connectable_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:VirtualDeviceConnectInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if device.__class__.__name__ == ""VirtualDisk"" and \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,device.backing.__class__.__name__ \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"== ""VirtualDiskFlatVer2BackingInfo"":"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_vmdk_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:FileBackedVirtualDiskSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,disk_file_backing = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:VirtualDiskFlatVer2BackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,virtual_machine_config_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,client_factory.create('ns0:VirtualMachineConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,virtual_device_config = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'ns0:VirtualDeviceConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,virtual_lsi = client_factory.create('ns0:VirtualLsiLogicController')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_spec = client_factory.create('ns0:VirtualDeviceConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"backing_name = ''.join(['ns0:VirtualEthernetCardDistributed',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'VirtualPortBackingInfo'])
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,backing = client_factory.create(backing_name)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,portgroup = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'ns0:DistributedVirtualSwitchPortConnection')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,backing = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'ns0:VirtualEthernetCardNetworkBackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,connectable_spec = client_factory.create('ns0:VirtualDeviceConnectInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if (device.__class__.__name__ == ""VirtualDisk"" and"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,device.backing.__class__.__name__ ==
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualDiskFlatVer2BackingInfo""):"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,create_vmdk_spec = client_factory.create('ns0:FileBackedVirtualDiskSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,disk_file_backing = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'ns0:VirtualDiskFlatVer2BackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,virtual_machine_config_spec = client_factory.create(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'ns0:VirtualMachineConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,virtual_device_config = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:VirtualDeviceConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,virtual_lsi = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:VirtualLsiLogicController')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,backing_name = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'ns0:VirtualEthernetCardDistributedVirtualPortBackingInfo'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,backing = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create(backing_name)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,portgroup = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:DistributedVirtualSwitchPortConnection')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:VirtualEthernetCardNetworkBackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,connectable_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:VirtualDeviceConnectInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if device.__class__.__name__ == ""VirtualDisk"" and \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,device.backing.__class__.__name__ \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"== ""VirtualDiskFlatVer2BackingInfo"":"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,create_vmdk_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:FileBackedVirtualDiskSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,disk_file_backing = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:VirtualDiskFlatVer2BackingInfo')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,virtual_machine_config_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,client_factory.create('ns0:VirtualMachineConfigSpec')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmware_vif_driver_opt = cfg.StrOpt('vmware_vif_driver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"default='nova.virt.vmwareapi.vif.VMWareVlanBridgeDriver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,help='The VMWare VIF driver to configure the VIFs.')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"_image_info = vmware_images.get_vmdk_size_and_properties(context,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"instance.image_ref,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"image_size, image_properties = _image_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_ref = network_utils.get_network_with_the_name(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session, network_name)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_vmdk_info = vm_util.get_vmdk_file_path_and_adapter_type(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"client_factory, hardware_devices)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmdk_file_path_before_snapshot, adapter_type = _vmdk_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(vmdk_file_path_before_snapshot, adapter_type, datastore_name,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,os_type) = _get_vm_and_vmdk_attribs()
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_ds_path = vm_util.split_datastore_path(vm_config_pathname)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"datastore_name, vmx_file_path = _ds_path"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"interface_str = "";"".join([info['mac'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ip_v4 and ip_v4['ip'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ip_v4 and ip_v4['netmask'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"info['gateway'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"info['broadcast'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dns])
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,machine_id_change_spec = vm_util.get_machine_id_change_spec(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"client_factory, machine_id_str)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""install"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LOG.info(_('Latest agent build for %(hypervisor)s/%(os)s'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LOG.info(_('No agent build found for %(hypervisor)s/%(os)s'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if (version and agent_build and
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"cmp_version(version, agent_build['version']) < 0):"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LOG.debug(_('Removing VDI %(vdi_ref)s'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_snapshot_info = self._create_snapshot(instance)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"template_vm_ref, template_vdi_uuids = _snapshot_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"_vdi_info = VMHelper.get_vdi_for_vm_safely(self._session, vm_ref)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vdi_ref, vm_vdi_rec = _vdi_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if (instance['auto_disk_config'] and
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance['root_gb'] > instance_type['root_gb']):
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""%(old_gb)dGB to %(new_gb)dGB"") % locals())"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"path = ""/console?ref=%s&session_id=%s"" % (str(vm_ref), session_id)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_('Creating VIF for VM %(vm_ref)s,'"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,' network %(network_ref)s.') % locals())
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_vif_driver_opt = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cfg.StrOpt('vmware_vif_driver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"default='nova.virt.vmwareapi.vif.VMWareVlanBridgeDriver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,help='The VMWare VIF driver to configure the VIFs.')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"image_size, image_properties = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmware_images.get_vmdk_size_and_properties(context,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"instance.image_ref, instance)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_ref = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_utils.get_network_with_the_name(self._session,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_name)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmdk_file_path_before_snapshot, adapter_type = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_util.get_vmdk_file_path_and_adapter_type(client_factory,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,hardware_devices)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmdk_file_path_before_snapshot, adapter_type, datastore_name,\"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os_type = _get_vm_and_vmdk_attribs()
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"datastore_name, vmx_file_path = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_util.split_datastore_path(vm_config_pathname)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"interface_str = ""%s;%s;%s;%s;%s;%s"" % \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(info['mac'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"ip_v4 and ip_v4['ip'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"ip_v4 and ip_v4['netmask'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"info['gateway'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"info['broadcast'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dns)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,machine_id_change_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_util.get_machine_id_change_spec(client_factory, machine_id_str)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""install"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG.info(_('Latest agent build for %(hypervisor)s/%(os)s' + \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG.info(_('No agent build found for %(hypervisor)s/%(os)s' + \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if version and agent_build and \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmp_version(version, agent_build['version']) < 0:"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG.debug(_('Removing VDI %(vdi_ref)s' +
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"template_vm_ref, template_vdi_uuids = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._create_snapshot(instance)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vdi_ref, vm_vdi_rec = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"VMHelper.get_vdi_for_vm_safely(self._session, vm_ref)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if instance['auto_disk_config'] and \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance['root_gb'] > instance_type['root_gb']:
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""%(old_gb)dGB to %(new_gb)dGB"") % locals())"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"path = ""/console?ref=%s&session_id=%s""\"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"% (str(vm_ref), session_id)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_('Creating VIF for VM %(vm_ref)s,' \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,' network %(network_ref)s.') % locals())
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmware_vif_driver_opt = cfg.StrOpt('vmware_vif_driver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default='nova.virt.vmwareapi.vif.VMWareVlanBridgeDriver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,help='The VMWare VIF driver to configure the VIFs.')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_image_info = vmware_images.get_vmdk_size_and_properties(context,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"instance.image_ref,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"image_size, image_properties = _image_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,network_ref = network_utils.get_network_with_the_name(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session, network_name)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_vmdk_info = vm_util.get_vmdk_file_path_and_adapter_type(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"client_factory, hardware_devices)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmdk_file_path_before_snapshot, adapter_type = _vmdk_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"(vmdk_file_path_before_snapshot, adapter_type, datastore_name,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,os_type) = _get_vm_and_vmdk_attribs()
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_ds_path = vm_util.split_datastore_path(vm_config_pathname)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"datastore_name, vmx_file_path = _ds_path"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"interface_str = "";"".join([info['mac'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ip_v4 and ip_v4['ip'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ip_v4 and ip_v4['netmask'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"info['gateway'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"info['broadcast'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,dns])
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,machine_id_change_spec = vm_util.get_machine_id_change_spec(
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"client_factory, machine_id_str)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""install"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,LOG.info(_('Latest agent build for %(hypervisor)s/%(os)s'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,LOG.info(_('No agent build found for %(hypervisor)s/%(os)s'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if (version and agent_build and
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cmp_version(version, agent_build['version']) < 0):"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,LOG.debug(_('Removing VDI %(vdi_ref)s'
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_snapshot_info = self._create_snapshot(instance)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"template_vm_ref, template_vdi_uuids = _snapshot_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_vdi_info = VMHelper.get_vdi_for_vm_safely(self._session, vm_ref)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vdi_ref, vm_vdi_rec = _vdi_info"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if (instance['auto_disk_config'] and
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance['root_gb'] > instance_type['root_gb']):
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(old_gb)dGB to %(new_gb)dGB"") % locals())"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"path = ""/console?ref=%s&session_id=%s"" % (str(vm_ref), session_id)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_('Creating VIF for VM %(vm_ref)s,'"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,' network %(network_ref)s.') % locals())
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmware_vif_driver_opt = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cfg.StrOpt('vmware_vif_driver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"default='nova.virt.vmwareapi.vif.VMWareVlanBridgeDriver',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,help='The VMWare VIF driver to configure the VIFs.')
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"image_size, image_properties = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vmware_images.get_vmdk_size_and_properties(context,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"instance.image_ref, instance)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,network_ref = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"network_utils.get_network_with_the_name(self._session,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,network_name)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vmdk_file_path_before_snapshot, adapter_type = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_util.get_vmdk_file_path_and_adapter_type(client_factory,"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,hardware_devices)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vmdk_file_path_before_snapshot, adapter_type, datastore_name,\"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,os_type = _get_vm_and_vmdk_attribs()
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"datastore_name, vmx_file_path = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_util.split_datastore_path(vm_config_pathname)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"interface_str = ""%s;%s;%s;%s;%s;%s"" % \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"(info['mac'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"ip_v4 and ip_v4['ip'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"ip_v4 and ip_v4['netmask'] or '',"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"info['gateway'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"info['broadcast'],"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,dns)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,machine_id_change_spec = \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_util.get_machine_id_change_spec(client_factory, machine_id_str)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""install"")"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG.info(_('Latest agent build for %(hypervisor)s/%(os)s' + \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG.info(_('No agent build found for %(hypervisor)s/%(os)s' + \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if version and agent_build and \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cmp_version(version, agent_build['version']) < 0:"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG.debug(_('Removing VDI %(vdi_ref)s' +
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"template_vm_ref, template_vdi_uuids = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._create_snapshot(instance)
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vdi_ref, vm_vdi_rec = \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"VMHelper.get_vdi_for_vm_safely(self._session, vm_ref)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if instance['auto_disk_config'] and \
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,instance['root_gb'] > instance_type['root_gb']:
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(old_gb)dGB to %(new_gb)dGB"") % locals())"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"path = ""/console?ref=%s&session_id=%s""\"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"% (str(vm_ref), session_id)"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Creating VIF for VM %(vm_ref)s,' \"
5adaf449dfcdb09c558afcfaf289eb27fcf590ba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,' network %(network_ref)s.') % locals())
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,# load tables for fk
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"instances = Table('instances', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"quotas = Table('quotas', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"instance_metadata_table = Table('instance_metadata', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('created_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('updated_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('deleted_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('deleted', Boolean(create_constraint=True, name=None)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('instance_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Integer(),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"ForeignKey('instances.id'),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('key',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"String(length=255, convert_unicode=False,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"assert_unicode=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"unicode_error=None, _warn_on_bytestring=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"Column('value',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"unicode_error=None, _warn_on_bytestring=False)))"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"quota_metadata_items = Column('metadata_items', Integer())"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,def downgrade(migrate_engine):
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,meta.bind = migrate_engine
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"instance_metadata_table = Table('instance_metadata', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,"for table in (instance_metadata_table, ):"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,table.drop()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,added,0,quotas.drop_column('metadata_items')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"# Just for the ForeignKey and column creation to succeed, these are not the"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,# actual definitions of instances or services.
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"instances = Table('instances', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"quotas = Table('quotas', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,#
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,# New Tables
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"instance_metadata_table = Table('instance_metadata', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('created_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('updated_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('deleted_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('deleted', Boolean(create_constraint=True, name=None)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('instance_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Integer(),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"ForeignKey('instances.id'),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('key',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"String(length=255, convert_unicode=False, assert_unicode=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"unicode_error=None, _warn_on_bytestring=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"Column('value',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"unicode_error=None, _warn_on_bytestring=False)))"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,# New columns
8e825c4024f9feb18ca5e2416484ef4096c3bb06,9a7213b615bcaa2127f76146d594f5247ea0d0a4,deleted,1,"quota_metadata_items = Column('metadata_items', Integer())"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,"instances = Table('instances', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,"instances_os_type = Column('os_type',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,"String(length=255, convert_unicode=False,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,"assert_unicode=None, unicode_error=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,"_warn_on_bytestring=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,added,0,nullable=True)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,"instances = Table('instances', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,"instances_os_type = Column('os_type',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,"String(length=255, convert_unicode=False,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,"assert_unicode=None, unicode_error=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,"_warn_on_bytestring=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,cdb1b16a6019fd68a7969666d754c4007607ae53,deleted,1,nullable=True)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"instances = Table('instances', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"compute_nodes = Table('compute_nodes', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('created_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('updated_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('deleted_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('deleted', Boolean(create_constraint=True, name=None)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('service_id', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('vcpus', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('memory_mb', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('local_gb', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('vcpus_used', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('memory_mb_used', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('local_gb_used', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('hypervisor_type',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Text(convert_unicode=False, assert_unicode=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"unicode_error=None, _warn_on_bytestring=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('hypervisor_version', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"Column('cpu_info',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,instances_launched_on = Column(
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"'launched_on',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,nullable=True)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,def downgrade(migrate_engine):
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,meta.bind = migrate_engine
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,"compute_nodes = Table('compute_nodes', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,compute_nodes.drop()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,added,0,instances.drop_column('launched_on')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"instances = Table('instances', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,#
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,# New Tables
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"compute_nodes = Table('compute_nodes', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('created_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('updated_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('deleted_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('deleted', Boolean(create_constraint=True, name=None)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('service_id', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('vcpus', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('memory_mb', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('local_gb', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('vcpus_used', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('memory_mb_used', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('local_gb_used', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('hypervisor_type',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Text(convert_unicode=False, assert_unicode=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"unicode_error=None, _warn_on_bytestring=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('hypervisor_version', Integer(), nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"Column('cpu_info',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,# Tables to alter
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,instances_launched_on = Column(
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,"'launched_on',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1caa7f189827b4721c2e9d3ddf753acd749d7916,deleted,1,nullable=True)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,"floating_ips = Table('floating_ips', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,"c_auto_assigned = Column('auto_assigned', Boolean, default=False)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,floating_ips.create_column(c_auto_assigned)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,def downgrade(migrate_engine):
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,meta.bind = migrate_engine
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,added,0,floating_ips.drop_column('auto_assigned')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,"c_auto_assigned = Column('auto_assigned', Boolean, default=False)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,"floating_ips = Table('floating_ips',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,"meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,"autoload=True,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,autoload_with=migrate_engine)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,4a2c973fe5c7cf68ff7f45a4927dc6d2e0a3986b,deleted,1,floating_ips.create_column(c_auto_assigned)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"from sqlalchemy import select, Boolean, Column, DateTime, ForeignKey"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"from sqlalchemy import Integer, MetaData, String"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,from sqlalchemy import Table
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"interface = Column('bridge_interface',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"String(length=255, convert_unicode=False,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"assert_unicode=None, unicode_error=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,_warn_on_bytestring=False))
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"virtual_interface_id = Column('virtual_interface_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,Integer())
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,#
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,# New Tables
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"virtual_interfaces = Table('virtual_interfaces', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('created_at', DateTime(timezone=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"default=utils.utcnow()),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('updated_at', DateTime(timezone=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"onupdate=utils.utcnow()),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('deleted_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('deleted', Boolean(create_constraint=True, name=None)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('address',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"assert_unicode=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"unicode_error=None, _warn_on_bytestring=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"unique=True),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('network_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Integer(),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"ForeignKey('networks.id')),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"Column('instance_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"ForeignKey('instances.id'),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,mysql_engine='InnoDB')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,meta.bind = migrate_engine
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,# grab tables and (column for dropping later)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"instances = Table('instances', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"networks = Table('networks', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"fixed_ips = Table('fixed_ips', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"virtual_interfaces = Table('virtual_interfaces', meta, autoload=True)"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"mac_address = Column('mac_address',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"unicode_error=None, _warn_on_bytestring=False))"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,instances.create_column(mac_address)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"s = select([instances.c.id, virtual_interfaces.c.address],"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,virtual_interfaces.c.instance_id == instances.c.id)
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,for row in s.execute():
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,u = instances.update().values(mac_address=row['address']).\
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,where(instances.c.id == row['id'])
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,networks.drop_column('bridge_interface')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,virtual_interfaces.drop()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,fixed_ips.drop_column('virtual_interface_id')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,from sqlalchemy import *
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,from migrate import *
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,meta = MetaData()
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# virtual interface table to add to DB
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"virtual_interfaces = Table('virtual_interfaces', meta,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('created_at', DateTime(timezone=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"default=utils.utcnow()),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('updated_at', DateTime(timezone=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"onupdate=utils.utcnow()),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('deleted_at', DateTime(timezone=False)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('deleted', Boolean(create_constraint=True, name=None)),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('id', Integer(), primary_key=True, nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('address',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"String(length=255, convert_unicode=False, assert_unicode=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"unicode_error=None, _warn_on_bytestring=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"unique=True),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('network_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Integer(),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"ForeignKey('networks.id')),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"Column('instance_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"ForeignKey('instances.id'),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"nullable=False),"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,mysql_engine='InnoDB')
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# bridge_interface column to add to networks table
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"interface = Column('bridge_interface',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"String(length=255, convert_unicode=False,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"assert_unicode=None, unicode_error=None,"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,_warn_on_bytestring=False))
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# virtual interface id column to add to fixed_ips table
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# foreignkey added in next migration
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"virtual_interface_id = Column('virtual_interface_id',"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,Integer())
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"LOG.error(_(""Can't downgrade without losing data""))"
8e825c4024f9feb18ca5e2416484ef4096c3bb06,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,raise Exception
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_x_server_url = 'X-Server-Management-Url'
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_server_url = 'server_management_url'
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,res.headers[_x_server_url] = token[_server_url]
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_x_storage_url = 'X-Storage-Url'
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_storage_url = 'storage_url'
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,res.headers[_x_storage_url] = token[_storage_url]
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_x_cdn_url = 'X-CDN-Management-Url'
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,_cdn_url = 'cdn_management_url'
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,res.headers[_x_cdn_url] = token[_cdn_url]
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,res.headers['X-Server-Management-Url'] = \
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,token['server_management_url']
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,res.headers['X-Storage-Url'] = token['storage_url']
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,res.headers['X-CDN-Management-Url'] = \
ade948dd77139390dc03f62564b0050df3ef54f3,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,token['cdn_management_url']
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,# NOTE(francois.charlier): in some cases the instance might be
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"# deleted before the IPs are released, so we need to get deleted"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,# instances too
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,read_deleted_context = context.elevated(read_deleted='yes')
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,context=read_deleted_context)
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"fixed_ips = self.db.fixed_ip_get_by_instance(read_deleted_context,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,instance_id)
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"self.disassociate_floating_ip(read_deleted_context, address,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"self.deallocate_floating_ip(read_deleted_context, address,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,# NOTE(francois.charlier): the instance may have been deleted already
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,# thus enabling `read_deleted`
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,admin_context = context.get_admin_context(read_deleted='yes')
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"self.db.fixed_ip_get_by_instance(read_deleted_context,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"self.deallocate_fixed_ip(read_deleted_context, fixed_ip['address'],"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,**kwargs)
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,added,0,"self.db.virtual_interface_delete_by_instance(read_deleted_context,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,context=context)
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"fixed_ips = self.db.fixed_ip_get_by_instance(context, instance_id)"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"self.disassociate_floating_ip(context, address,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"self.deallocate_floating_ip(context, address,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,admin_context = context.get_admin_context()
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"self.db.fixed_ip_get_by_instance(context,"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"self.deallocate_fixed_ip(context, fixed_ip['address'], **kwargs)"
5ad1dea4daf264fe11429288597d26dc4974fe05,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"self.db.virtual_interface_delete_by_instance(context, instance_id)"
2172e49e8359a62182f58d94d2a9c465a85d9a95,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,from nova.auth import manager
2172e49e8359a62182f58d94d2a9c465a85d9a95,64dd3000c4a9b88719e86d1090097e35398d3838,added,0,self.auth = manager.AuthManager()
2172e49e8359a62182f58d94d2a9c465a85d9a95,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,from nova import auth
2172e49e8359a62182f58d94d2a9c465a85d9a95,64dd3000c4a9b88719e86d1090097e35398d3838,deleted,1,self.auth = auth.manager.AuthManager()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# vim: tabstop=4 shiftwidth=4 softtabstop=4
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# Copyright (c) 2011 Citrix Systems, Inc."
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Copyright 2011 OpenStack LLC.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#    not use this file except in compliance with the License. You may obtain
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#    a copy of the License at
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#         http://www.apache.org/licenses/LICENSE-2.0
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"#    Unless required by applicable law or agreed to in writing, software"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#    License for the specific language governing permissions and limitations
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#    under the License.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Guest tools for ESX to set up network in the guest.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,On Windows we require pyWin32 installed on Python.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import array
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import gettext
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import logging
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import os
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import platform
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import socket
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import struct
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import subprocess
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import sys
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import time
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"gettext.install('nova', unicode=1)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,PLATFORM_WIN = 'win32'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,PLATFORM_LINUX = 'linux2'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ARCH_32_BIT = '32bit'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ARCH_64_BIT = '64bit'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,NO_MACHINE_ID = 'No machine id'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Logging
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"FORMAT = ""%(asctime)s - %(levelname)s - %(message)s"""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if sys.platform == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG_DIR = os.path.join(os.environ.get('ALLUSERSPROFILE'), 'openstack')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif sys.platform == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LOG_DIR = '/var/log/openstack'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LOG_DIR = 'logs'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not os.path.exists(LOG_DIR):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,os.mkdir(LOG_DIR)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG_FILENAME = os.path.join(LOG_DIR, 'openstack-guest-tools.log')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.basicConfig(filename=LOG_FILENAME, format=FORMAT)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if sys.hexversion < 0x3000000:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_byte = ord    # 2.x chr to integer
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_byte = int    # 3.x byte to integer
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,class ProcessExecutionError:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Process Execution Error Class."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, exit_code, stdout, stderr, cmd):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.exit_code = exit_code
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.stdout = stdout
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.stderr = stderr
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.cmd = cmd
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def __str__(self):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return str(self.exit_code)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _bytes2int(bytes):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Convert bytes to int."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,intgr = 0
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for byt in bytes:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,intgr = (intgr << 8) + _byte(byt)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return intgr
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _parse_network_details(machine_id):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"Parse the machine_id to get MAC, IP, Netmask and Gateway fields per NIC."
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"machine_id is of the form ('NIC_record#NIC_record#', '')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Each of the NIC will have record NIC_record in the form
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'MAC;IP;Netmask;Gateway;Broadcast;DNS' where ';' is field separator.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Each record is separated by '#' from next record.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.debug(_(""Received machine_id from vmtools : %s"") % machine_id[0])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_details = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if machine_id[1].strip() == ""1"":"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,pass
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for machine_id_str in machine_id[0].split('#'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_info_list = machine_id_str.split(';')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if len(network_info_list) % 6 != 0:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,break
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,no_grps = len(network_info_list) / 6
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,i = 0
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,while i < no_grps:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,k = i * 6
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_details.append((
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info_list[k].strip().lower(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info_list[k + 1].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info_list[k + 2].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info_list[k + 3].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info_list[k + 4].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info_list[k + 5].strip().split(',')))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,i += 1
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.debug(_(""NIC information from vmtools : %s"") % network_details)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return network_details
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_windows_network_adapters():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get the list of windows network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import win32com.client
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,wbem_locator = win32com.client.Dispatch('WbemScripting.SWbemLocator')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"wbem_service = wbem_locator.ConnectServer('.', 'root\cimv2')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,wbem_network_adapters = wbem_service.InstancesOf('Win32_NetworkAdapter')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_adapters = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for wbem_network_adapter in wbem_network_adapters:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if wbem_network_adapter.NetConnectionStatus == 2 or \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,wbem_network_adapter.NetConnectionStatus == 7:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_name = wbem_network_adapter.NetConnectionID
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,mac_address = wbem_network_adapter.MacAddress.lower()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,wbem_network_adapter_config = \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,wbem_network_adapter.associators_(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'Win32_NetworkAdapterSetting',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'Win32_NetworkAdapterConfiguration')[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ip_address = ''
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,subnet_mask = ''
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if wbem_network_adapter_config.IPEnabled:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ip_address = wbem_network_adapter_config.IPAddress[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,subnet_mask = wbem_network_adapter_config.IPSubnet[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#wbem_network_adapter_config.DefaultIPGateway[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_adapters.append({'name': adapter_name,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'mac-address': mac_address,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'ip-address': ip_address,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'subnet-mask': subnet_mask})
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return network_adapters
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_linux_network_adapters():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get the list of Linux network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import fcntl
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,max_bytes = 8096
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,arch = platform.architecture()[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if arch == ARCH_32_BIT:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,offset1 = 32
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,offset2 = 32
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif arch == ARCH_64_BIT:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,offset1 = 16
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,offset2 = 40
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"raise OSError(_(""Unknown architecture: %s"") % arch)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"names = array.array('B', '\0' * max_bytes)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"outbytes = struct.unpack('iL', fcntl.ioctl("
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sock.fileno(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"0x8912,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"struct.pack('iL', max_bytes, names.buffer_info()[0])))[0]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_names = \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"[names.tostring()[n_counter:n_counter + offset1].split('\0', 1)[0]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for n_counter in xrange(0, outbytes, offset2)]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for adapter_name in adapter_names:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ip_address = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"0x8915,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"struct.pack('256s', adapter_name))[20:24])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,subnet_mask = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"0x891b,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raw_mac_address = '%012x' % _bytes2int(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"0x8927,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"struct.pack('256s', adapter_name))[18:24])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"mac_address = "":"".join([raw_mac_address[m_counter:m_counter + 2]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for m_counter in range(0, len(raw_mac_address), 2)]).lower()"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_adapter_name_and_ip_address(network_adapters, mac_address):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get the adapter name based on the MAC address."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_name = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ip_address = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for network_adapter in network_adapters:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if network_adapter['mac-address'] == mac_address.lower():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_name = network_adapter['name']
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ip_address = network_adapter['ip-address']
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return adapter_name, ip_address"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_win_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get Windows network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_adapters = _get_windows_network_adapters()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return _get_adapter_name_and_ip_address(network_adapters, mac_address)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_linux_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get Linux network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_adapters = _get_linux_network_adapters()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _execute(cmd_list, process_input=None, check_exit_code=True):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Executes the command with the list of arguments specified."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,cmd = ' '.join(cmd_list)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.debug(_(""Executing command: '%s'"") % cmd)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,env = os.environ.copy()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"obj = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,result = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if process_input is not None:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,result = obj.communicate(process_input)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,result = obj.communicate()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,obj.stdin.close()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if obj.returncode:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.debug(_(""Result was %s"") % obj.returncode)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if check_exit_code and obj.returncode != 0:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(stdout, stderr) = result"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"raise ProcessExecutionError(exit_code=obj.returncode,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"stdout=stdout,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"stderr=stderr,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,cmd=cmd)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,time.sleep(0.1)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return result
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _windows_set_networking():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Set IP address for the windows VM."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,program_files = os.environ.get('PROGRAMFILES')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,program_files_x86 = os.environ.get('PROGRAMFILES(X86)')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmware_tools_bin = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'vmtoolsd.exe')):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmware_tools_bin = os.path.join(program_files, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'VMware Tools', 'vmtoolsd.exe')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"elif os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'VMwareService.exe')):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'VMware Tools', 'VMwareService.exe')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"elif program_files_x86 and os.path.exists(os.path.join(program_files_x86,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmware_tools_bin = os.path.join(program_files_x86, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if vmware_tools_bin:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"cmd = ['""' + vmware_tools_bin + '""', '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for network_detail in _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,check_exit_code=False)):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"mac_address, ip_address, subnet_mask, gateway, broadcast,\"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dns_servers = network_detail
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_name, current_ip_address = \"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_get_win_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if adapter_name and not ip_address == current_ip_address:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"cmd = ['netsh', 'interface', 'ip', 'set', 'address',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'name=""%s""' % adapter_name, 'source=static', ip_address,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"subnet_mask, gateway, '1']"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_execute(cmd)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Windows doesn't let you manually set the broadcast address
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for dns_server in dns_servers:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if dns_server:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"cmd = ['netsh', 'interface', 'ip', 'add', 'dns',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'name=""%s""' % adapter_name, dns_server]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.warn(_(""VMware Tools is not installed""))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _filter_duplicates(all_entries):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,final_list = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for entry in all_entries:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if entry and entry not in final_list:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,final_list.append(entry)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return final_list
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _set_rhel_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Set IPv4 network settings for RHEL distros."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,network_details = network_details or []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,all_dns_servers = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for network_detail in network_details:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,all_dns_servers.extend(dns_servers)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_get_linux_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file_name = \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'/etc/sysconfig/network-scripts/ifcfg-%s' % adapter_name
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Remove file
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,os.remove(interface_file_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Touch file
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"_execute(['touch', interface_file_name])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"interface_file = open(interface_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nDEVICE=%s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nUSERCTL=yes')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nONBOOT=yes')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nBOOTPROTO=static')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nBROADCAST=%s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nNETWORK=')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nGATEWAY=%s' % gateway)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nNETMASK=%s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nIPADDR=%s' % ip_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nMACADDR=%s' % mac_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.close()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if all_dns_servers:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dns_file_name = ""/etc/resolv.conf"""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,os.remove(dns_file_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"_execute(['touch', dns_file_name])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dns_file = open(dns_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dns_file.write(""; generated by OpenStack guest tools"")"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,unique_entries = _filter_duplicates(all_dns_servers)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for dns_server in unique_entries:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dns_file.write(""\nnameserver %s"" % dns_server)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dns_file.close()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"_execute(['/sbin/service', 'network', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _set_ubuntu_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Set IPv4 network settings for Ubuntu."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file_name = '/etc/network/interfaces'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for device, network_detail in enumerate(network_details):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if adapter_name:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nauto %s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\niface %s inet static' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nbroadcast %s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\ngateway %s' % gateway)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\nnetmask %s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file.write('\naddress %s\n' % ip_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.debug(_(""Successfully configured NIC %d with """
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""NIC info %s"") % (device, network_detail))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.debug(_(""Restarting networking....\n""))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"_execute(['/etc/init.d/networking', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _linux_set_networking():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Set IP address for the Linux VM."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if os.path.exists('/usr/sbin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmware_tools_bin = '/usr/sbin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif os.path.exists('/usr/bin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmware_tools_bin = '/usr/bin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif os.path.exists('/usr/sbin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmware_tools_bin = '/usr/sbin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif os.path.exists('/usr/bin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmware_tools_bin = '/usr/bin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"cmd = [vmware_tools_bin, '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_details = _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,check_exit_code=False))
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# TODO(sateesh): For other distros like suse, debian, BSD, etc."
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if(platform.dist()[0] == 'Ubuntu'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_set_ubuntu_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif (platform.dist()[0] == 'redhat'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_set_rhel_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"logging.warn(_(""Distro '%s' not supported"") % platform.dist()[0])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if __name__ == '__main__':
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,pltfrm = sys.platform
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if pltfrm == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_windows_set_networking()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif pltfrm == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_linux_set_networking()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"raise NotImplementedError(_(""Platform not implemented: '%s'"") % pltfrm)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# vim: tabstop=4 shiftwidth=4 softtabstop=4
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# Copyright (c) 2011 Citrix Systems, Inc."
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Copyright 2011 OpenStack LLC.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    not use this file except in compliance with the License. You may obtain
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    a copy of the License at
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#         http://www.apache.org/licenses/LICENSE-2.0
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    Unless required by applicable law or agreed to in writing, software"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    License for the specific language governing permissions and limitations
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    under the License.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Guest tools for ESX to set up network in the guest.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,On Windows we require pyWin32 installed on Python.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import array
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import gettext
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import logging
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import os
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import platform
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import socket
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import struct
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import subprocess
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import sys
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import time
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"gettext.install('nova', unicode=1)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,PLATFORM_WIN = 'win32'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,PLATFORM_LINUX = 'linux2'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ARCH_32_BIT = '32bit'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ARCH_64_BIT = '64bit'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,NO_MACHINE_ID = 'No machine id'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Logging
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"FORMAT = ""%(asctime)s - %(levelname)s - %(message)s"""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if sys.platform == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG_DIR = os.path.join(os.environ.get('ALLUSERSPROFILE'), 'openstack')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif sys.platform == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG_DIR = '/var/log/openstack'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,else:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG_DIR = 'logs'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not os.path.exists(LOG_DIR):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os.mkdir(LOG_DIR)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG_FILENAME = os.path.join(LOG_DIR, 'openstack-guest-tools.log')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.basicConfig(filename=LOG_FILENAME, format=FORMAT)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if sys.hexversion < 0x3000000:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_byte = ord    # 2.x chr to integer
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_byte = int    # 3.x byte to integer
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class ProcessExecutionError:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Process Execution Error Class."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, exit_code, stdout, stderr, cmd):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.exit_code = exit_code
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.stdout = stdout
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.stderr = stderr
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.cmd = cmd
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def __str__(self):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return str(self.exit_code)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _bytes2int(bytes):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Convert bytes to int."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,intgr = 0
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for byt in bytes:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,intgr = (intgr << 8) + _byte(byt)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return intgr
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _parse_network_details(machine_id):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"Parse the machine_id to get MAC, IP, Netmask and Gateway fields per NIC."
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"machine_id is of the form ('NIC_record#NIC_record#', '')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Each of the NIC will have record NIC_record in the form
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'MAC;IP;Netmask;Gateway;Broadcast;DNS' where ';' is field separator.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Each record is separated by '#' from next record.
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Received machine_id from vmtools : %s"") % machine_id[0])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_details = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if machine_id[1].strip() == ""1"":"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pass
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for machine_id_str in machine_id[0].split('#'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_info_list = machine_id_str.split(';')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if len(network_info_list) % 6 != 0:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,break
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,no_grps = len(network_info_list) / 6
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,i = 0
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,while i < no_grps:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,k = i * 6
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_details.append((
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k].strip().lower(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 1].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 2].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 3].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 4].strip(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 5].strip().split(',')))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,i += 1
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""NIC information from vmtools : %s"") % network_details)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return network_details
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_windows_network_adapters():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the list of windows network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import win32com.client
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_locator = win32com.client.Dispatch('WbemScripting.SWbemLocator')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"wbem_service = wbem_locator.ConnectServer('.', 'root\cimv2')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapters = wbem_service.InstancesOf('Win32_NetworkAdapter')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_adapters = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for wbem_network_adapter in wbem_network_adapters:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if wbem_network_adapter.NetConnectionStatus == 2 or \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapter.NetConnectionStatus == 7:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = wbem_network_adapter.NetConnectionID
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,mac_address = wbem_network_adapter.MacAddress.lower()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapter_config = \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapter.associators_(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'Win32_NetworkAdapterSetting',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'Win32_NetworkAdapterConfiguration')[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = ''
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = ''
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if wbem_network_adapter_config.IPEnabled:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = wbem_network_adapter_config.IPAddress[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = wbem_network_adapter_config.IPSubnet[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#wbem_network_adapter_config.DefaultIPGateway[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_adapters.append({'name': adapter_name,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'mac-address': mac_address,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'ip-address': ip_address,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'subnet-mask': subnet_mask})
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return network_adapters
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_linux_network_adapters():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the list of Linux network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import fcntl
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,max_bytes = 8096
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,arch = platform.architecture()[0]
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if arch == ARCH_32_BIT:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset1 = 32
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset2 = 32
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif arch == ARCH_64_BIT:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset1 = 16
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset2 = 40
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise OSError(_(""Unknown architecture: %s"") % arch)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"names = array.array('B', '\0' * max_bytes)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"outbytes = struct.unpack('iL', fcntl.ioctl("
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"sock.fileno(),"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x8912,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"struct.pack('iL', max_bytes, names.buffer_info()[0])))[0]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_names = \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"[names.tostring()[n_counter:n_counter + offset1].split('\0', 1)[0]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for n_counter in xrange(0, outbytes, offset2)]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for adapter_name in adapter_names:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x8915,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"struct.pack('256s', adapter_name))[20:24])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x891b,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raw_mac_address = '%012x' % _bytes2int(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x8927,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"struct.pack('256s', adapter_name))[18:24])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"mac_address = "":"".join([raw_mac_address[m_counter:m_counter + 2]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for m_counter in range(0, len(raw_mac_address), 2)]).lower()"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _get_adapter_name_and_ip_address(network_adapters, mac_address):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the adapter name based on the MAC address."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for network_adapter in network_adapters:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if network_adapter['mac-address'] == mac_address.lower():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = network_adapter['name']
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = network_adapter['ip-address']
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return adapter_name, ip_address"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_win_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get Windows network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_adapters = _get_windows_network_adapters()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return _get_adapter_name_and_ip_address(network_adapters, mac_address)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_linux_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get Linux network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_adapters = _get_linux_network_adapters()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _execute(cmd_list, process_input=None, check_exit_code=True):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Executes the command with the list of arguments specified."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cmd = ' '.join(cmd_list)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Executing command: '%s'"") % cmd)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,env = os.environ.copy()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"obj = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,result = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if process_input is not None:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,result = obj.communicate(process_input)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,result = obj.communicate()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,obj.stdin.close()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if obj.returncode:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Result was %s"") % obj.returncode)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if check_exit_code and obj.returncode != 0:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(stdout, stderr) = result"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise ProcessExecutionError(exit_code=obj.returncode,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"stdout=stdout,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"stderr=stderr,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cmd=cmd)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,time.sleep(0.1)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return result
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _windows_set_networking():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IP address for the windows VM."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,program_files = os.environ.get('PROGRAMFILES')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,program_files_x86 = os.environ.get('PROGRAMFILES(X86)')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = None
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'vmtoolsd.exe')):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmware_tools_bin = os.path.join(program_files, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'VMware Tools', 'vmtoolsd.exe')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'VMwareService.exe')):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'VMware Tools', 'VMwareService.exe')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif program_files_x86 and os.path.exists(os.path.join(program_files_x86,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmware_tools_bin = os.path.join(program_files_x86, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if vmware_tools_bin:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = ['""' + vmware_tools_bin + '""', '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for network_detail in _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,check_exit_code=False)):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"mac_address, ip_address, subnet_mask, gateway, broadcast,\"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dns_servers = network_detail
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_name, current_ip_address = \"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_get_win_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if adapter_name and not ip_address == current_ip_address:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'set', 'address',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'name=""%s""' % adapter_name, 'source=static', ip_address,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"subnet_mask, gateway, '1']"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_execute(cmd)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Windows doesn't let you manually set the broadcast address
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for dns_server in dns_servers:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if dns_server:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'add', 'dns',"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'name=""%s""' % adapter_name, dns_server]"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.warn(_(""VMware Tools is not installed""))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _filter_duplicates(all_entries):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,final_list = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for entry in all_entries:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if entry and entry not in final_list:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,final_list.append(entry)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return final_list
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _set_rhel_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IPv4 network settings for RHEL distros."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_details = network_details or []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,all_dns_servers = []
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for network_detail in network_details:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,all_dns_servers.extend(dns_servers)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_get_linux_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file_name = \
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'/etc/sysconfig/network-scripts/ifcfg-%s' % adapter_name
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Remove file
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os.remove(interface_file_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Touch file
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['touch', interface_file_name])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"interface_file = open(interface_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nDEVICE=%s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nUSERCTL=yes')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nONBOOT=yes')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nBOOTPROTO=static')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nBROADCAST=%s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nNETWORK=')
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nGATEWAY=%s' % gateway)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nNETMASK=%s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nIPADDR=%s' % ip_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nMACADDR=%s' % mac_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.close()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if all_dns_servers:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file_name = ""/etc/resolv.conf"""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os.remove(dns_file_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['touch', dns_file_name])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file = open(dns_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file.write(""; generated by OpenStack guest tools"")"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unique_entries = _filter_duplicates(all_dns_servers)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for dns_server in unique_entries:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file.write(""\nnameserver %s"" % dns_server)"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dns_file.close()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['/sbin/service', 'network', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _set_ubuntu_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IPv4 network settings for Ubuntu."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file_name = '/etc/network/interfaces'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for device, network_detail in enumerate(network_details):"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if adapter_name:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nauto %s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\niface %s inet static' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nbroadcast %s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\ngateway %s' % gateway)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nnetmask %s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\naddress %s\n' % ip_address)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Successfully configured NIC %d with """
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""NIC info %s"") % (device, network_detail))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Restarting networking....\n""))"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['/etc/init.d/networking', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _linux_set_networking():
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IP address for the Linux VM."""""""
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if os.path.exists('/usr/sbin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/sbin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif os.path.exists('/usr/bin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/bin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif os.path.exists('/usr/sbin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/sbin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif os.path.exists('/usr/bin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/bin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = [vmware_tools_bin, '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_details = _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,check_exit_code=False))
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# TODO(sateesh): For other distros like suse, debian, BSD, etc."
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if(platform.dist()[0] == 'Ubuntu'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_set_ubuntu_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif (platform.dist()[0] == 'redhat'):
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_set_rhel_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.warn(_(""Distro '%s' not supported"") % platform.dist()[0])"
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if __name__ == '__main__':
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pltfrm = sys.platform
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if pltfrm == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_windows_set_networking()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif pltfrm == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_linux_set_networking()
9a042d3c501477772ff65802819016ead430b719,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise NotImplementedError(_(""Platform not implemented: '%s'"") % pltfrm)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,# vim: tabstop=4 shiftwidth=4 softtabstop=4
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"# Copyright (c) 2011 Citrix Systems, Inc."
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,# Copyright 2011 OpenStack LLC.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#    not use this file except in compliance with the License. You may obtain
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#    a copy of the License at
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#         http://www.apache.org/licenses/LICENSE-2.0
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"#    Unless required by applicable law or agreed to in writing, software"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#    License for the specific language governing permissions and limitations
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#    under the License.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,""""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,Guest tools for ESX to set up network in the guest.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,On Windows we require pyWin32 installed on Python.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import array
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import gettext
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import logging
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import os
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import platform
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import socket
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import struct
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import subprocess
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import sys
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import time
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"gettext.install('nova', unicode=1)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,PLATFORM_WIN = 'win32'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,PLATFORM_LINUX = 'linux2'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ARCH_32_BIT = '32bit'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ARCH_64_BIT = '64bit'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,NO_MACHINE_ID = 'No machine id'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,# Logging
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"FORMAT = ""%(asctime)s - %(levelname)s - %(message)s"""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if sys.platform == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"LOG_DIR = os.path.join(os.environ.get('ALLUSERSPROFILE'), 'openstack')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif sys.platform == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,LOG_DIR = '/var/log/openstack'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,else:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,LOG_DIR = 'logs'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if not os.path.exists(LOG_DIR):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,os.mkdir(LOG_DIR)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"LOG_FILENAME = os.path.join(LOG_DIR, 'openstack-guest-tools.log')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.basicConfig(filename=LOG_FILENAME, format=FORMAT)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if sys.hexversion < 0x3000000:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_byte = ord    # 2.x chr to integer
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_byte = int    # 3.x byte to integer
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,class ProcessExecutionError:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Process Execution Error Class."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"def __init__(self, exit_code, stdout, stderr, cmd):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,self.exit_code = exit_code
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,self.stdout = stdout
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,self.stderr = stderr
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,self.cmd = cmd
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def __str__(self):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,return str(self.exit_code)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _bytes2int(bytes):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Convert bytes to int."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,intgr = 0
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for byt in bytes:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,intgr = (intgr << 8) + _byte(byt)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,return intgr
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _parse_network_details(machine_id):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"Parse the machine_id to get MAC, IP, Netmask and Gateway fields per NIC."
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"machine_id is of the form ('NIC_record#NIC_record#', '')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,Each of the NIC will have record NIC_record in the form
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,'MAC;IP;Netmask;Gateway;Broadcast;DNS' where ';' is field separator.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,Each record is separated by '#' from next record.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.debug(_(""Received machine_id from vmtools : %s"") % machine_id[0])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_details = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"if machine_id[1].strip() == ""1"":"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,pass
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for machine_id_str in machine_id[0].split('#'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_info_list = machine_id_str.split(';')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if len(network_info_list) % 6 != 0:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,break
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,no_grps = len(network_info_list) / 6
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,i = 0
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,while i < no_grps:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,k = i * 6
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_details.append((
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_info_list[k].strip().lower(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_info_list[k + 1].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_info_list[k + 2].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_info_list[k + 3].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_info_list[k + 4].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_info_list[k + 5].strip().split(',')))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,i += 1
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.debug(_(""NIC information from vmtools : %s"") % network_details)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,return network_details
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _get_windows_network_adapters():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Get the list of windows network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import win32com.client
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,wbem_locator = win32com.client.Dispatch('WbemScripting.SWbemLocator')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"wbem_service = wbem_locator.ConnectServer('.', 'root\cimv2')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,wbem_network_adapters = wbem_service.InstancesOf('Win32_NetworkAdapter')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_adapters = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for wbem_network_adapter in wbem_network_adapters:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if wbem_network_adapter.NetConnectionStatus == 2 or \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,wbem_network_adapter.NetConnectionStatus == 7:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,adapter_name = wbem_network_adapter.NetConnectionID
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,mac_address = wbem_network_adapter.MacAddress.lower()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,wbem_network_adapter_config = \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,wbem_network_adapter.associators_(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'Win32_NetworkAdapterSetting',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,'Win32_NetworkAdapterConfiguration')[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ip_address = ''
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,subnet_mask = ''
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if wbem_network_adapter_config.IPEnabled:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ip_address = wbem_network_adapter_config.IPAddress[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,subnet_mask = wbem_network_adapter_config.IPSubnet[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,#wbem_network_adapter_config.DefaultIPGateway[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_adapters.append({'name': adapter_name,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'mac-address': mac_address,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'ip-address': ip_address,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,'subnet-mask': subnet_mask})
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,return network_adapters
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _get_linux_network_adapters():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Get the list of Linux network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,import fcntl
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,max_bytes = 8096
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,arch = platform.architecture()[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if arch == ARCH_32_BIT:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,offset1 = 32
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,offset2 = 32
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif arch == ARCH_64_BIT:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,offset1 = 16
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,offset2 = 40
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"raise OSError(_(""Unknown architecture: %s"") % arch)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"names = array.array('B', '\0' * max_bytes)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"outbytes = struct.unpack('iL', fcntl.ioctl("
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"sock.fileno(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"0x8912,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"struct.pack('iL', max_bytes, names.buffer_info()[0])))[0]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,adapter_names = \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"[names.tostring()[n_counter:n_counter + offset1].split('\0', 1)[0]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"for n_counter in xrange(0, outbytes, offset2)]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for adapter_name in adapter_names:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ip_address = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"0x8915,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"struct.pack('256s', adapter_name))[20:24])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,subnet_mask = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"0x891b,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,raw_mac_address = '%012x' % _bytes2int(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"0x8927,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"struct.pack('256s', adapter_name))[18:24])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"mac_address = "":"".join([raw_mac_address[m_counter:m_counter + 2]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"for m_counter in range(0, len(raw_mac_address), 2)]).lower()"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"def _get_adapter_name_and_ip_address(network_adapters, mac_address):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Get the adapter name based on the MAC address."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,adapter_name = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ip_address = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for network_adapter in network_adapters:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if network_adapter['mac-address'] == mac_address.lower():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,adapter_name = network_adapter['name']
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,ip_address = network_adapter['ip-address']
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"return adapter_name, ip_address"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _get_win_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Get Windows network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_adapters = _get_windows_network_adapters()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"return _get_adapter_name_and_ip_address(network_adapters, mac_address)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _get_linux_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Get Linux network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_adapters = _get_linux_network_adapters()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"def _execute(cmd_list, process_input=None, check_exit_code=True):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Executes the command with the list of arguments specified."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,cmd = ' '.join(cmd_list)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.debug(_(""Executing command: '%s'"") % cmd)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,env = os.environ.copy()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"obj = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,result = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if process_input is not None:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,result = obj.communicate(process_input)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,result = obj.communicate()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,obj.stdin.close()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if obj.returncode:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.debug(_(""Result was %s"") % obj.returncode)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if check_exit_code and obj.returncode != 0:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"(stdout, stderr) = result"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"raise ProcessExecutionError(exit_code=obj.returncode,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"stdout=stdout,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"stderr=stderr,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,cmd=cmd)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,time.sleep(0.1)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,return result
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _windows_set_networking():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Set IP address for the windows VM."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,program_files = os.environ.get('PROGRAMFILES')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,program_files_x86 = os.environ.get('PROGRAMFILES(X86)')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,vmware_tools_bin = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"if os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,'vmtoolsd.exe')):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"vmware_tools_bin = os.path.join(program_files, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'VMware Tools', 'vmtoolsd.exe')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"elif os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,'VMwareService.exe')):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'VMware Tools', 'VMwareService.exe')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"elif program_files_x86 and os.path.exists(os.path.join(program_files_x86,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"vmware_tools_bin = os.path.join(program_files_x86, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if vmware_tools_bin:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"cmd = ['""' + vmware_tools_bin + '""', '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"for network_detail in _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,check_exit_code=False)):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"mac_address, ip_address, subnet_mask, gateway, broadcast,\"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,dns_servers = network_detail
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"adapter_name, current_ip_address = \"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_get_win_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if adapter_name and not ip_address == current_ip_address:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"cmd = ['netsh', 'interface', 'ip', 'set', 'address',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'name=""%s""' % adapter_name, 'source=static', ip_address,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"subnet_mask, gateway, '1']"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_execute(cmd)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,# Windows doesn't let you manually set the broadcast address
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for dns_server in dns_servers:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if dns_server:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"cmd = ['netsh', 'interface', 'ip', 'add', 'dns',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"'name=""%s""' % adapter_name, dns_server]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.warn(_(""VMware Tools is not installed""))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _filter_duplicates(all_entries):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,final_list = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for entry in all_entries:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if entry and entry not in final_list:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,final_list.append(entry)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,return final_list
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _set_rhel_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Set IPv4 network settings for RHEL distros."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,network_details = network_details or []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,all_dns_servers = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for network_detail in network_details:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,all_dns_servers.extend(dns_servers)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_get_linux_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file_name = \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,'/etc/sysconfig/network-scripts/ifcfg-%s' % adapter_name
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,# Remove file
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,os.remove(interface_file_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,# Touch file
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"_execute(['touch', interface_file_name])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"interface_file = open(interface_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nDEVICE=%s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nUSERCTL=yes')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nONBOOT=yes')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nBOOTPROTO=static')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nBROADCAST=%s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nNETWORK=')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nGATEWAY=%s' % gateway)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nNETMASK=%s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nIPADDR=%s' % ip_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nMACADDR=%s' % mac_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.close()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if all_dns_servers:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"dns_file_name = ""/etc/resolv.conf"""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,os.remove(dns_file_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"_execute(['touch', dns_file_name])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"dns_file = open(dns_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"dns_file.write(""; generated by OpenStack guest tools"")"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,unique_entries = _filter_duplicates(all_dns_servers)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,for dns_server in unique_entries:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"dns_file.write(""\nnameserver %s"" % dns_server)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,dns_file.close()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"_execute(['/sbin/service', 'network', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _set_ubuntu_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Set IPv4 network settings for Ubuntu."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file_name = '/etc/network/interfaces'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"for device, network_detail in enumerate(network_details):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if adapter_name:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nauto %s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\niface %s inet static' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nbroadcast %s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\ngateway %s' % gateway)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\nnetmask %s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,interface_file.write('\naddress %s\n' % ip_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.debug(_(""Successfully configured NIC %d with """
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""NIC info %s"") % (device, network_detail))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.debug(_(""Restarting networking....\n""))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"_execute(['/etc/init.d/networking', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,def _linux_set_networking():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"""""""Set IP address for the Linux VM."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if os.path.exists('/usr/sbin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,vmware_tools_bin = '/usr/sbin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif os.path.exists('/usr/bin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,vmware_tools_bin = '/usr/bin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif os.path.exists('/usr/sbin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,vmware_tools_bin = '/usr/sbin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif os.path.exists('/usr/bin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,vmware_tools_bin = '/usr/bin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"cmd = [vmware_tools_bin, '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"network_details = _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,check_exit_code=False))
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"# TODO(sateesh): For other distros like suse, debian, BSD, etc."
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if(platform.dist()[0] == 'Ubuntu'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_set_ubuntu_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif (platform.dist()[0] == 'redhat'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_set_rhel_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"logging.warn(_(""Distro '%s' not supported"") % platform.dist()[0])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if __name__ == '__main__':
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,pltfrm = sys.platform
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,if pltfrm == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_windows_set_networking()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,elif pltfrm == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,_linux_set_networking()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,added,0,"raise NotImplementedError(_(""Platform not implemented: '%s'"") % pltfrm)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# vim: tabstop=4 shiftwidth=4 softtabstop=4
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"# Copyright (c) 2011 Citrix Systems, Inc."
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Copyright 2011 OpenStack LLC.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    not use this file except in compliance with the License. You may obtain
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    a copy of the License at
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#         http://www.apache.org/licenses/LICENSE-2.0
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    Unless required by applicable law or agreed to in writing, software"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    License for the specific language governing permissions and limitations
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    under the License.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,""""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,Guest tools for ESX to set up network in the guest.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,On Windows we require pyWin32 installed on Python.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import array
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import gettext
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import logging
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import os
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import platform
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import socket
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import struct
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import subprocess
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import sys
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import time
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"gettext.install('nova', unicode=1)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,PLATFORM_WIN = 'win32'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,PLATFORM_LINUX = 'linux2'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ARCH_32_BIT = '32bit'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ARCH_64_BIT = '64bit'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,NO_MACHINE_ID = 'No machine id'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Logging
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"FORMAT = ""%(asctime)s - %(levelname)s - %(message)s"""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if sys.platform == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"LOG_DIR = os.path.join(os.environ.get('ALLUSERSPROFILE'), 'openstack')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif sys.platform == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,LOG_DIR = '/var/log/openstack'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,else:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,LOG_DIR = 'logs'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if not os.path.exists(LOG_DIR):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,os.mkdir(LOG_DIR)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"LOG_FILENAME = os.path.join(LOG_DIR, 'openstack-guest-tools.log')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.basicConfig(filename=LOG_FILENAME, format=FORMAT)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if sys.hexversion < 0x3000000:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_byte = ord    # 2.x chr to integer
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_byte = int    # 3.x byte to integer
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,class ProcessExecutionError:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Process Execution Error Class."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"def __init__(self, exit_code, stdout, stderr, cmd):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.exit_code = exit_code
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.stdout = stdout
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.stderr = stderr
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.cmd = cmd
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def __str__(self):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return str(self.exit_code)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _bytes2int(bytes):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Convert bytes to int."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,intgr = 0
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for byt in bytes:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,intgr = (intgr << 8) + _byte(byt)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return intgr
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _parse_network_details(machine_id):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"Parse the machine_id to get MAC, IP, Netmask and Gateway fields per NIC."
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"machine_id is of the form ('NIC_record#NIC_record#', '')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,Each of the NIC will have record NIC_record in the form
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'MAC;IP;Netmask;Gateway;Broadcast;DNS' where ';' is field separator.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,Each record is separated by '#' from next record.
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Received machine_id from vmtools : %s"") % machine_id[0])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_details = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"if machine_id[1].strip() == ""1"":"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,pass
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for machine_id_str in machine_id[0].split('#'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_info_list = machine_id_str.split(';')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if len(network_info_list) % 6 != 0:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,break
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,no_grps = len(network_info_list) / 6
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,i = 0
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,while i < no_grps:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,k = i * 6
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_details.append((
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k].strip().lower(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 1].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 2].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 3].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 4].strip(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 5].strip().split(',')))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,i += 1
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""NIC information from vmtools : %s"") % network_details)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return network_details
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_windows_network_adapters():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get the list of windows network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import win32com.client
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_locator = win32com.client.Dispatch('WbemScripting.SWbemLocator')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"wbem_service = wbem_locator.ConnectServer('.', 'root\cimv2')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_network_adapters = wbem_service.InstancesOf('Win32_NetworkAdapter')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_adapters = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for wbem_network_adapter in wbem_network_adapters:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if wbem_network_adapter.NetConnectionStatus == 2 or \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_network_adapter.NetConnectionStatus == 7:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name = wbem_network_adapter.NetConnectionID
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,mac_address = wbem_network_adapter.MacAddress.lower()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_network_adapter_config = \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_network_adapter.associators_(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'Win32_NetworkAdapterSetting',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'Win32_NetworkAdapterConfiguration')[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = ''
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,subnet_mask = ''
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if wbem_network_adapter_config.IPEnabled:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = wbem_network_adapter_config.IPAddress[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,subnet_mask = wbem_network_adapter_config.IPSubnet[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#wbem_network_adapter_config.DefaultIPGateway[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_adapters.append({'name': adapter_name,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'mac-address': mac_address,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'ip-address': ip_address,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'subnet-mask': subnet_mask})
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return network_adapters
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_linux_network_adapters():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get the list of Linux network adapters."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import fcntl
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,max_bytes = 8096
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,arch = platform.architecture()[0]
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if arch == ARCH_32_BIT:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset1 = 32
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset2 = 32
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif arch == ARCH_64_BIT:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset1 = 16
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset2 = 40
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"raise OSError(_(""Unknown architecture: %s"") % arch)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"names = array.array('B', '\0' * max_bytes)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"outbytes = struct.unpack('iL', fcntl.ioctl("
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"sock.fileno(),"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x8912,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"struct.pack('iL', max_bytes, names.buffer_info()[0])))[0]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_names = \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"[names.tostring()[n_counter:n_counter + offset1].split('\0', 1)[0]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for n_counter in xrange(0, outbytes, offset2)]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for adapter_name in adapter_names:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x8915,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"struct.pack('256s', adapter_name))[20:24])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,subnet_mask = socket.inet_ntoa(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x891b,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,raw_mac_address = '%012x' % _bytes2int(fcntl.ioctl(
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x8927,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"struct.pack('256s', adapter_name))[18:24])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"mac_address = "":"".join([raw_mac_address[m_counter:m_counter + 2]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for m_counter in range(0, len(raw_mac_address), 2)]).lower()"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"def _get_adapter_name_and_ip_address(network_adapters, mac_address):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get the adapter name based on the MAC address."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for network_adapter in network_adapters:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if network_adapter['mac-address'] == mac_address.lower():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name = network_adapter['name']
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = network_adapter['ip-address']
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"return adapter_name, ip_address"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_win_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get Windows network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_adapters = _get_windows_network_adapters()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"return _get_adapter_name_and_ip_address(network_adapters, mac_address)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_linux_adapter_name_and_ip_address(mac_address):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get Linux network adapter name."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_adapters = _get_linux_network_adapters()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"def _execute(cmd_list, process_input=None, check_exit_code=True):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Executes the command with the list of arguments specified."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,cmd = ' '.join(cmd_list)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Executing command: '%s'"") % cmd)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,env = os.environ.copy()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"obj = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,result = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if process_input is not None:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,result = obj.communicate(process_input)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,result = obj.communicate()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,obj.stdin.close()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if obj.returncode:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Result was %s"") % obj.returncode)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if check_exit_code and obj.returncode != 0:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"(stdout, stderr) = result"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"raise ProcessExecutionError(exit_code=obj.returncode,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"stdout=stdout,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"stderr=stderr,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,cmd=cmd)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,time.sleep(0.1)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return result
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _windows_set_networking():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IP address for the windows VM."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,program_files = os.environ.get('PROGRAMFILES')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,program_files_x86 = os.environ.get('PROGRAMFILES(X86)')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = None
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"if os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'vmtoolsd.exe')):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"vmware_tools_bin = os.path.join(program_files, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'VMware Tools', 'vmtoolsd.exe')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"elif os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'VMwareService.exe')):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'VMware Tools', 'VMwareService.exe')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"elif program_files_x86 and os.path.exists(os.path.join(program_files_x86,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'VMware', 'VMware Tools',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"vmware_tools_bin = os.path.join(program_files_x86, 'VMware',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if vmware_tools_bin:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = ['""' + vmware_tools_bin + '""', '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for network_detail in _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,check_exit_code=False)):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"mac_address, ip_address, subnet_mask, gateway, broadcast,\"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,dns_servers = network_detail
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"adapter_name, current_ip_address = \"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_get_win_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if adapter_name and not ip_address == current_ip_address:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'set', 'address',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'name=""%s""' % adapter_name, 'source=static', ip_address,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"subnet_mask, gateway, '1']"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_execute(cmd)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Windows doesn't let you manually set the broadcast address
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for dns_server in dns_servers:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if dns_server:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'add', 'dns',"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'name=""%s""' % adapter_name, dns_server]"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.warn(_(""VMware Tools is not installed""))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _filter_duplicates(all_entries):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,final_list = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for entry in all_entries:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if entry and entry not in final_list:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,final_list.append(entry)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return final_list
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _set_rhel_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IPv4 network settings for RHEL distros."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_details = network_details or []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,all_dns_servers = []
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for network_detail in network_details:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,all_dns_servers.extend(dns_servers)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_get_linux_adapter_name_and_ip_address(mac_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file_name = \
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'/etc/sysconfig/network-scripts/ifcfg-%s' % adapter_name
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Remove file
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,os.remove(interface_file_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Touch file
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['touch', interface_file_name])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"interface_file = open(interface_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nDEVICE=%s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nUSERCTL=yes')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nONBOOT=yes')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nBOOTPROTO=static')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nBROADCAST=%s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nNETWORK=')
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nGATEWAY=%s' % gateway)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nNETMASK=%s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nIPADDR=%s' % ip_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nMACADDR=%s' % mac_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.close()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if all_dns_servers:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file_name = ""/etc/resolv.conf"""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,os.remove(dns_file_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['touch', dns_file_name])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file = open(dns_file_name, 'w')"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file.write(""; generated by OpenStack guest tools"")"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,unique_entries = _filter_duplicates(all_dns_servers)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for dns_server in unique_entries:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file.write(""\nnameserver %s"" % dns_server)"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,dns_file.close()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['/sbin/service', 'network', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _set_ubuntu_networking(network_details=None):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IPv4 network settings for Ubuntu."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file_name = '/etc/network/interfaces'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for device, network_detail in enumerate(network_details):"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if adapter_name:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nauto %s' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\niface %s inet static' % adapter_name)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nbroadcast %s' % broadcast)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\ngateway %s' % gateway)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nnetmask %s' % subnet_mask)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\naddress %s\n' % ip_address)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Successfully configured NIC %d with """
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""NIC info %s"") % (device, network_detail))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Restarting networking....\n""))"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['/etc/init.d/networking', 'restart'])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _linux_set_networking():
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IP address for the Linux VM."""""""
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if os.path.exists('/usr/sbin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/sbin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif os.path.exists('/usr/bin/vmtoolsd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/bin/vmtoolsd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif os.path.exists('/usr/sbin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/sbin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif os.path.exists('/usr/bin/vmware-guestd'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/bin/vmware-guestd'
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = [vmware_tools_bin, '--cmd', 'machine.id.get']"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_details = _parse_network_details(_execute(cmd,"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,check_exit_code=False))
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"# TODO(sateesh): For other distros like suse, debian, BSD, etc."
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if(platform.dist()[0] == 'Ubuntu'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_set_ubuntu_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif (platform.dist()[0] == 'redhat'):
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_set_rhel_networking(network_details)
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.warn(_(""Distro '%s' not supported"") % platform.dist()[0])"
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if __name__ == '__main__':
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,pltfrm = sys.platform
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if pltfrm == PLATFORM_WIN:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_windows_set_networking()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif pltfrm == PLATFORM_LINUX:
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_linux_set_networking()
9a042d3c501477772ff65802819016ead430b719,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"raise NotImplementedError(_(""Platform not implemented: '%s'"") % pltfrm)"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"def _flush_libvirt_console(self, pty):"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"out, err = utils.execute('dd',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"'if=%s' % pty,"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"'iflag=nonblock',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"run_as_root=True,"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,check_exit_code=False)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,return out
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,virt_dom = self._lookup_by_name(instance['name'])
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,xml = virt_dom.XMLDesc(0)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,tree = ElementTree.fromstring(xml)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,# If the guest has a console logging to a file prefer to use that
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"node = tree.find(""./devices/console[@type='file']/source"")"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,if node is not None:
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"fpath = node.get(""path"")"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,return libvirt_utils.load_file(fpath)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"# else if there is a PTY, then try to read latest data from that"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"node = tree.find(""./devices/console[@type='pty']/source"")"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,if node is None:
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"raise exception.Error(_(""Guest does not have a console available""))"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"pty = node.get(""path"")"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,data = self._flush_libvirt_console(pty)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,added,0,"fpath = self._append_to_file(data, console_log)"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"def _flush_libvirt_console(self, virsh_output):"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"LOG.info(_('virsh said: %r'), virsh_output)"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,virsh_output = virsh_output[0].strip()
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,if virsh_output.startswith('/dev/'):
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"LOG.info(_(""cool, it's a device""))"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"out, err = utils.execute('dd',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"'if=%s' % virsh_output,"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"'iflag=nonblock',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"run_as_root=True,"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,check_exit_code=False)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,return out
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,else:
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,return ''
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,if FLAGS.libvirt_type == 'xen':
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,# Xen is special
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"virsh_output = utils.execute('virsh',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"'ttyconsole',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,instance['name'])
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,data = self._flush_libvirt_console(virsh_output)
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"fpath = self._append_to_file(data, console_log)"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,elif FLAGS.libvirt_type == 'lxc':
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,# LXC is also special
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"'-c',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,"'lxc:///',"
e3f77127fe65872a81280061157512886b84d469,a3d003d7ec92f3ae23a667954a790c71efdbfdbe,deleted,1,fpath = console_log
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,def service_get_all_network_sorted(context):
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Get all network services sorted by network count."
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,":returns: a list of (Service, network_count) tuples."
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,""""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return IMPL.service_get_all_network_sorted(context)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def compute_node_get_for_service(context, service_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Get all computeNodes."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.compute_node_get_for_service(context, service_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def compute_node_capacity_find(context, minimum_ram_mb, minimum_disk_gb):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.compute_node_capacity_find(context, minimum_ram_mb,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,minimum_disk_gb)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def virtual_interface_update(context, vif_id, values):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Update a virtual interface record in the database."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.virtual_interface_update(context, vif_id, values)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def virtual_interface_get_by_network(context, network_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Gets all virtual interfaces on network."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.virtual_interface_get_by_network(context, network_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def instance_stop(context, instance_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Stop the instance or raise if it does not exist."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.instance_stop(context, instance_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def instance_get_all_by_user(context, user_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Get all instances."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.instance_get_all_by_user(context, user_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def network_count_allocated_ips(context, network_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Return the number of allocated non-reserved ips in the network."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.network_count_allocated_ips(context, network_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def network_count_available_ips(context, network_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Return the number of available ips in the network."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.network_count_available_ips(context, network_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,def network_disassociate_all(context):
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Disassociate all networks from projects."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return IMPL.network_disassociate_all(context)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,def security_group_destroy_all(context):
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Deletes a security group."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return IMPL.security_group_destroy_all(context)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def provider_fw_rule_get_all_by_cidr(context, cidr):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Get all provider-level firewall rules."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.provider_fw_rule_get_all_by_cidr(context, cidr)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def project_get_networks_v6(context, project_id):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.project_get_networks_v6(context, project_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def bw_usage_get_all_by_filters(context, filters):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Return bandwidth usage that matches all filters."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return IMPL.bw_usage_get_all_by_filters(context, filters)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,@require_admin_context
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session = get_session()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,with session.begin():
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,topic = 'network'
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,label = 'network_count'
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"subq = model_query(context, models.Network.host,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"func.count(models.Network.id).label(label),"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"session=session, read_deleted=""no"").\"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,group_by(models.Network.host).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,subquery()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return _service_get_all_topic_subquery(context,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"session,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"topic,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"subq,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,label)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def compute_node_get_by_service(context, service_id, session=None):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,if not session:
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"result = model_query(context, models.ComputeNode, session=session).\"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(service_id=service_id).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,first()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,if not result:
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"raise exception.ComputeHostNotFound(host=""ServiceID=%s"" % service_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return result
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return model_query(context, models.ComputeNode).\"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,options(joinedload('service')).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# Note: these operations use with_lockmode() ... so this will only work
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# reliably with engines that support row-level locking
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"# (postgres, mysql+innodb and above)."
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Get all enabled hosts with enough ram and disk."""""""
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return session.query(models.ComputeNode).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter(models.ComputeNode.free_ram_mb >= minimum_ram_mb).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter(models.ComputeNode.free_disk_gb >= minimum_disk_gb).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter(models.Service.disabled == False).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(deleted=False).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,with_lockmode('update').all()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,@require_context
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Update a virtual interface record in the database."
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,:param vif_id: = id of virtual interface to update
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,:param values: = values to update
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"vif_ref = virtual_interface_get(context, vif_id, session=session)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,vif_ref.update(values)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,vif_ref.save(session=session)
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return vif_ref
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""""""Gets all virtual_interface on network."
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,:param network_id: = network to retrieve vifs for
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,vif_refs = _virtual_interface_query(context).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(network_id=network_id).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,all()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return vif_refs
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session.query(models.Instance).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(id=instance_id).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"update({'host': None,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"'vm_state': vm_states.STOPPED,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"'task_state': None,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,'updated_at': literal_column('updated_at')})
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session.query(models.SecurityGroupInstanceAssociation).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(instance_id=instance_id).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,update({'updated_at': literal_column('updated_at')})
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session.query(models.InstanceMetadata).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return _instance_get_all_query(context).filter_by(user_id=user_id).all()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return _network_ips_query(context, network_id).\"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(allocated=True).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,count()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(allocated=False).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(reserved=False).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session.query(models.Network).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"update({'project_id': None,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"def security_group_destroy_all(context, session=None):"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session.query(models.SecurityGroup).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"update({'deleted': True,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"'deleted_at': utils.utcnow(),"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,session.query(models.SecurityGroupIngressRule).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return model_query(context, models.ProviderFirewallRule).\"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filter_by(cidr=cidr).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"return project_get_networks(context, project_id)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,query_prefix = session.query(models.BandwidthUsage).\
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,order_by(desc(models.BandwidthUsage.created_at))
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"# Make a copy of the filters dictionary to use going forward, as we'll"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# be modifying it and we shouldn't affect the caller's use of it.
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,filters = filters.copy()
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# Filters for exact matches that we can do along with the SQL query.
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"exact_match_filter_names = [""instance_id"", ""mac"","
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"""start_period"", ""last_refreshed"", ""bw_in"", ""bw_out""]"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,# Filter the query
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"query_prefix = exact_filter(query_prefix, models.BandwidthUsage,"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,"filters, exact_match_filter_names)"
6fd9d326d97b24ee203b0cf3074074864283178d,1845c5df145251f1e90709a91cc02ee5ec787e2f,deleted,1,return query_prefix.all()
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,import collections
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,from nova.rpc import common as rpc_common
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,from nova import utils
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,if FLAGS.memcached_servers:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,import memcache
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,else:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,from nova.common import memorycache as memcache
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,self.metadata_mapper = {
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'user-data': self.user_data,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,'meta-data': {
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'instance-id': self.instance_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'instance-type': self.instance_type,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'ami-id': self.ami_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'kernel-id': self.kernel_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'ramdisk-id': self.ramdisk_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'block-device-mapping': self.block_device_mapping,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'hostname': self.hostname,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'public-hostname': self.hostname,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'local-hostname': self.hostname,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'local-ipv4': self.local_ipv4,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'public-ipv4': self.public_ipv4,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'security-groups': self.security_groups,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'public-keys': self.public_keys,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'ami-launch-index': self.ami_launch_index,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'reservation-id': self.reservation_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'placement': self.placement,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'instance-action': self.instance_action,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"'ami-manifest-path': self.ami_manifest_path,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,}
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"self._cache = memcache.Client(FLAGS.memcached_servers, debug=0)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def _format_instance_mapping(self, instance_ref):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,ctxt = context.get_admin_context()
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def get_instance(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"""""""get instance_ref for a given fixed_ip, raising"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,exception.NotFound if unable to find instance
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,this will attempt to use memcache or fake memcache (an in-memory
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,cache) to remove the DB query + RPC query for batched calls (eg
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,cloud-init making dozens of queries on boot)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,""""""""
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,cache_key = 'metadata-%s' % address
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,instance_dict = self._cache.get(cache_key)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,if instance_dict:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return instance_dict
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,except rpc_common.RemoteError:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,raise exception.FixedIpNotFoundForAddress(address=address)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"instance_ref = db.instance_get(ctxt, fixed_ip['instance_id'])"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,instance_dict = utils.to_primitive(instance_ref)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"self._cache.set(cache_key, instance_dict, 15)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def user_data(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,instance_ref = self.get_instance(address)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return base64.b64decode(instance_ref['user_data'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def instance_id(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return ec2utils.id_to_ec2_id(instance_ref['id'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def instance_type(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return instance_ref['instance_type']['name']
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def ami_id(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return ec2utils.image_ec2_id(instance_ref['image_ref'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def kernel_id(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,kernel_id = instance_ref.get('kernel_id')
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,if kernel_id:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"return ec2utils.image_ec2_id(kernel_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,ec2utils.image_type('kernel'))
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def ramdisk_id(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,ramdisk_id = instance_ref.get('ramdisk_id')
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,if ramdisk_id:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"return ec2utils.image_ec2_id(ramdisk_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,ec2utils.image_type('ramdisk'))
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def ami_launch_index(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return instance_ref['launch_index']
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def block_device_mapping(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return self._format_instance_mapping(instance_ref)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def hostname(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"return ""%s.%s"" % (instance_ref['hostname'], FLAGS.dhcp_domain)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def local_ipv4(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return address
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def public_ipv4(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return floating_ip
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def reservation_id(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return instance_ref['reservation_id']
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def placement(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,host = instance_ref['host']
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,# note(ja): original code had ctx.elevated?
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"services = db.service_get_all_by_host(ctxt, host)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"zone = ec2utils.get_availability_zone_by_host(services, host)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return {'availability-zone': zone}
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def security_groups(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"groups = db.security_group_get_by_instance(ctxt,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,instance_ref['id'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return [g['name'] for g in groups]
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def public_keys(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"return {'0': {'_name': instance_ref['key_name'],"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,'openssh-key': instance_ref['key_data']}}
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def ami_manifest_path(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return 'Not Implemented'
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def instance_action(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return 'none'
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def format_data(self, data):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"def lookup(self, path, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,data = self.metadata_mapper
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,# FIXME(ja): should we check that we are at the end
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,# of the path as well before we just return?
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"if isinstance(data, collections.Callable):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,# lazy evaluation
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,data = data(address)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"data = self.lookup(req.path_info,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,remote_address)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"except (exception.NotFound, exception.FixedIpNotFoundForAddress):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,"LOG.error(_('Failed to get metadata for ip: %s'), remote_address)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return webob.exc.HTTPNotFound()
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,except:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return webob.exc.HTTPInternalServerError(explanation=unicode(msg))
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,added,0,return self.format_data(data)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"def _format_instance_mapping(self, ctxt, instance_ref):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"def get_metadata(self, address):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"instance_ref = db.instance_get(ctxt, fixed_ip['instance_id'])"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,except exception.NotFound:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,return None
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"hostname = ""%s.%s"" % (instance_ref['hostname'], FLAGS.dhcp_domain)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,host = instance_ref['host']
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"services = db.service_get_all_by_host(ctxt.elevated(), host)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"availability_zone = ec2utils.get_availability_zone_by_host(services,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,host)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,ec2_id = ec2utils.id_to_ec2_id(instance_ref['id'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,image_ec2_id = ec2utils.image_ec2_id(instance_ref['image_ref'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"security_groups = db.security_group_get_by_instance(ctxt,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,instance_ref['id'])
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,security_groups = [x['name'] for x in security_groups]
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"mappings = self._format_instance_mapping(ctxt, instance_ref)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,data = {
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'user-data': base64.b64decode(instance_ref['user_data']),"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,'meta-data': {
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'ami-id': image_ec2_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'ami-launch-index': instance_ref['launch_index'],"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'ami-manifest-path': 'FIXME',"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'block-device-mapping': mappings,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'hostname': hostname,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'instance-action': 'none',"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'instance-id': ec2_id,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'instance-type': instance_ref['instance_type']['name'],"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'local-hostname': hostname,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'local-ipv4': address,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'placement': {'availability-zone': availability_zone},"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'public-hostname': hostname,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'public-ipv4': floating_ip,"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'reservation-id': instance_ref['reservation_id'],"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,'security-groups': security_groups}}
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,data['meta-data']['public-keys'] = {
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"'0': {'_name': instance_ref['key_name'],"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,'openssh-key': instance_ref['key_data']}}
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"for image_type in ['kernel', 'ramdisk']:"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,if instance_ref.get('%s_id' % image_type):
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,ec2_id = ec2utils.image_ec2_id(
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"instance_ref['%s_id' % image_type],"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,ec2utils.image_type(image_type))
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,data['meta-data']['%s-id' % image_type] = ec2_id
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,if False:  # TODO(vish): store ancestor ids
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,data['ancestor-ami-ids'] = []
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,if False:  # TODO(vish): store product codes
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,data['product-codes'] = []
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,return data
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"def print_data(self, data):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"def lookup(self, path, data):"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,meta_data = self.get_metadata(remote_address)
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,except Exception:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,exc = webob.exc.HTTPInternalServerError(explanation=unicode(msg))
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,return exc
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,if meta_data is None:
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"LOG.error(_('Failed to get metadata for ip: %s'), remote_address)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,raise webob.exc.HTTPNotFound()
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,"data = self.lookup(req.path_info, meta_data)"
1bcf5f5431d3c9620596f5329d7654872235c7ee,f188b5a02d34751e89fae60b4d3b1ef144f138d7,deleted,1,return self.print_data(data)
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"shared = self.mounted_on_same_shared_storage(context, instance_ref,"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,dest)
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,if block_migration:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,if shared:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,elif not shared:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"reason = _(""Live migration can not be used """
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"""without shared storage."")"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"raise exception.InvalidSharedStorage(reason=reason, path=dest)"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"filename = rpc.call(context, dst_t,"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"{""method"": 'create_shared_storage_test_file'})"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"{""method"": 'check_shared_storage_test_file',"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"""args"": {'filename': filename}})"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"rpc.cast(context, dst_t,"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,"{""method"": 'cleanup_shared_storage_test_file',"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,added,0,return ret
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,try:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"self.mounted_on_same_shared_storage(context, instance_ref, dest)"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,if block_migration:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,# FIXME(comstud): See LP891756.
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,except exception.FileNotFound:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,if not block_migration:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,src = instance_ref['host']
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,ipath = FLAGS.instances_path
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"LOG.error(_(""Cannot confirm tmpfile at %(ipath)s is on """
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"""same shared storage between %(src)s """
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"""and %(dest)s."") % locals())"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,raise
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,filename = None
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,# create tmpfile at dest host
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"filename = rpc.call(context, dst_t,"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"{""method"": 'create_shared_storage_test_file'})"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"{""method"": 'check_shared_storage_test_file',"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"""args"": {'filename': filename}})"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,if not ret:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,raise exception.FileNotFound(file_path=filename)
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,# Should only be None for tests?
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,if filename is not None:
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"rpc.call(context, dst_t,"
30aec4a3f67144d55caded298c691503a6a57ed1,52285565fb421d34e7efcdb5cf89d10431319f8f,deleted,1,"{""method"": 'cleanup_shared_storage_test_file',"
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,"from win32console import (GetStdHandle, STD_OUT_HANDLE,"
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,"FOREGROUND_RED, FOREGROUND_GREEN,"
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,"FOREGROUND_BLUE, FOREGROUND_INTENSITY)"
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,print _('Missing EC2 environment variables. Please '
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,'source the appropriate novarc file before '
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,"from win32console import GetStdHandle, STD_OUT_HANDLE, \"
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,"FOREGROUND_RED, FOREGROUND_BLUE, FOREGROUND_GREEN, \"
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,FOREGROUND_INTENSITY
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,print _('Missing EC2 environment variables. Please ' \
61c5597a09945982f093412cd134850346b82e3b,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,'source the appropriate novarc file before ' \
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for adapter in wbem_network_adapters:
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if (adapter.NetConnectionStatus == 2 or
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter.NetConnectionStatus == 7):
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_name = adapter.NetConnectionID
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,mac_address = adapter.MacAddress.lower()
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,config = adapter.associators_(
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if config.IPEnabled:
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ip_address = config.IPAddress[0]
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,subnet_mask = config.IPSubnet[0]
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#config.DefaultIPGateway[0]
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_names = [names.tostring()[n_cnt:n_cnt + offset1].split('\0', 1)[0]"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for n_cnt in xrange(0, outbytes, offset2)]"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(mac_address, ip_address, subnet_mask, gateway, broadcast,"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dns_servers) = network_detail
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,name_and_ip = _get_win_adapter_name_and_ip_address(mac_address)
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_name, current_ip_address = name_and_ip"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,name_and_ip = _get_linux_adapter_name_and_ip_address(mac_address)
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,interface_file_name = ('/etc/sysconfig/network-scripts/ifcfg-%s' %
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_name)
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for wbem_network_adapter in wbem_network_adapters:
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if wbem_network_adapter.NetConnectionStatus == 2 or \
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapter.NetConnectionStatus == 7:
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = wbem_network_adapter.NetConnectionID
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,mac_address = wbem_network_adapter.MacAddress.lower()
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapter_config = \
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapter.associators_(
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if wbem_network_adapter_config.IPEnabled:
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = wbem_network_adapter_config.IPAddress[0]
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = wbem_network_adapter_config.IPSubnet[0]
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#wbem_network_adapter_config.DefaultIPGateway[0]
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_names = \
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"[names.tostring()[n_counter:n_counter + offset1].split('\0', 1)[0]"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for n_counter in xrange(0, outbytes, offset2)]"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"mac_address, ip_address, subnet_mask, gateway, broadcast,\"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dns_servers = network_detail
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_name, current_ip_address = \"
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_get_win_adapter_name_and_ip_address(mac_address)
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_get_linux_adapter_name_and_ip_address(mac_address)
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file_name = \
61c5597a09945982f093412cd134850346b82e3b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'/etc/sysconfig/network-scripts/ifcfg-%s' % adapter_name
6228acd7ff3b20460d8c6fae9ab7c773ab38529a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,from nova import context
6228acd7ff3b20460d8c6fae9ab7c773ab38529a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,from nova import db
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"return db.instance_create(self.context, inst)"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,instance = self._create_instance()
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"self.console.add_console(self.context, instance['id'])"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"instance = db.instance_get(self.context, instance['id'])"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"db.instance_destroy(self.context, instance['uuid'])"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"cons1 = self.console.add_console(self.context, instance['id'])"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"cons2 = self.console.add_console(self.context, instance['id'])"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,added,0,"console_id = self.console.add_console(self.context, instance['id'])"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"return db.instance_create(self.context, inst)['id']"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,instance_id = self._create_instance()
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"self.console.add_console(self.context, instance_id)"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"instance = db.instance_get(self.context, instance_id)"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"db.instance_destroy(self.context, instance_id)"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"cons1 = self.console.add_console(self.context, instance_id)"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"cons2 = self.console.add_console(self.context, instance_id)"
1c5df791b5024b1934f728df4797f2a722a51d6e,d4793e9f678d3388fcbacacb027fa81195aa3f34,deleted,1,"console_id = self.console.add_console(self.context, instance_id)"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,from nova.openstack.common import timeutils
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,timeout = FLAGS.instance_build_timeout
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,if timeout == 0:
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,"if timeutils.is_older_than(instance['created_at'], timeout):"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,launched_at=timeutils.utcnow())
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,terminated_at=timeutils.utcnow())
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,"launched_at=timeutils.utcnow(),"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,interval = FLAGS.reclaim_instance_interval
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,if interval <= 0:
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,old_enough = (not instance.deleted_at or
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,"timeutils.is_older_than(instance.deleted_at,"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,interval))
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,timeout = FLAGS.running_deleted_instance_timeout
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,timeout))
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,added,0,now = timeutils.utcnow()
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,if FLAGS.instance_build_timeout == 0:
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,"if utils.is_older_than(instance['created_at'],"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,FLAGS.instance_build_timeout):
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,launched_at=utils.utcnow())
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,terminated_at=utils.utcnow())
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,"launched_at=utils.utcnow(),"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,if FLAGS.reclaim_instance_interval <= 0:
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,old_enough = (not instance.deleted_at or utils.is_older_than(
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,"instance.deleted_at,"
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,FLAGS.reclaim_instance_interval))
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,FLAGS.running_deleted_instance_timeout))
9ff3121bd90133fb3b37c0e10407b5f7ade26b90,fe576e28a6ed8e15d4cdb96313d9f58426715bb0,deleted,1,now = utils.utcnow()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,def get_host_capabilities(self):
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"""""""Returns an instance of config.LibvirtConfigCaps representing"
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"the capabilities of the host"""""""
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,xmlstr = self._conn.getCapabilities()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,caps = config.LibvirtConfigCaps()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,caps.parse_str(xmlstr)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,return caps
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,caps = self.get_host_capabilities()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,cpu_info['arch'] = caps.host.cpu.arch
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,cpu_info['model'] = caps.host.cpu.model
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,cpu_info['vendor'] = caps.host.cpu.vendor
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,topology['sockets'] = caps.host.cpu.sockets
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,topology['cores'] = caps.host.cpu.cores
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,topology['threads'] = caps.host.cpu.threads
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,features = list()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,for f in caps.host.cpu.features:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,features.append(f.name)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,guest_arches = list()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,for g in caps.guests:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,guest_arches.append(g.arch)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,cpu_info['permitted_instance_types'] = guest_arches
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# TODO(berrange): why do we bother converting the
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# libvirt capabilities XML into a special JSON format ?
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# The data format is different across all the drivers
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# so we could just return the raw capabilties XML
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# which 'compare_cpu' could use directly
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,#
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"# That said, arch_filter.py now seems to rely on"
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# the libvirt drivers format which suggests this
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# data format needs to be standardized across drivers
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,xml = self._conn.getCapabilities()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,xml = etree.fromstring(xml)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,nodes = xml.findall('.//host/cpu')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,if len(nodes) != 1:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"reason = _(""'<cpu>' must be 1, but %d\n"") % len(nodes)"
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,reason += xml.serialize()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,raise exception.InvalidCPUInfo(reason=reason)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,arch_nodes = xml.findall('.//host/cpu/arch')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,if arch_nodes:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,cpu_info['arch'] = arch_nodes[0].text
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,model_nodes = xml.findall('.//host/cpu/model')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,if model_nodes:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,cpu_info['model'] = model_nodes[0].text
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,vendor_nodes = xml.findall('.//host/cpu/vendor')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,if vendor_nodes:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,cpu_info['vendor'] = vendor_nodes[0].text
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,topology_nodes = xml.findall('.//host/cpu/topology')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,if topology_nodes:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,topology_node = topology_nodes[0]
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"keys = ['cores', 'sockets', 'threads']"
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,tkeys = topology_node.keys()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,if set(tkeys) != set(keys):
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"ks = ', '.join(keys)"
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"reason = _(""topology (%(topology)s) must have %(ks)s"")"
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,raise exception.InvalidCPUInfo(reason=reason % locals())
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,for key in keys:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,topology[key] = topology_node.get(key)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,feature_nodes = xml.findall('.//host/cpu/feature')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,features = list()
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,for nodes in feature_nodes:
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,features.append(nodes.get('name'))
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,arch_nodes = xml.findall('.//guest/arch')
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,guest_cpu_arches = list(node.get('name') for node in arch_nodes)
b4abb92b815988a4700313274ac7182f374a2286,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,cpu_info['permitted_instance_types'] = guest_cpu_arches
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"""""""Ensure that an instance's filtering rules are enabled."
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"When migrating an instance, we need the filtering rules to"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,be configured on the destination host before starting the
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,migration.
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"Also, when restarting the compute service, we need to ensure"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,that filtering rules exist for all running services.
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,# nwfilters may be defined in a separate thread in the case
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,"# of libvirt non-blocking mode, so we wait for completion"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,added,0,msg = _('The firewall filter for %s does not exist')
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"""""""Setting up filtering rules and waiting for its completion."
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"To migrate an instance, filtering rules to hypervisors"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,and firewalls are inevitable on destination host.
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"( Waiting only for filterling rules to hypervisor,"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,since filtering rules to firewall rules can be set faster).
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"Concretely, the below method must be called."
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"- setup_basic_filtering (for nova-basic, etc.)"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"- prepare_instance_filter(for nova-instance-instance-xxx, etc.)"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"to_xml may have to be called since it defines PROJNET, PROJMASK."
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"but libvirt migrates those value through migrateToURI(),"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"so , no need to be called."
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,Don't use thread for this method since migration should
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,not be started when setting-up filtering rules operations
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,are not completed.
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,:params instance_ref: nova.db.sqlalchemy.models.Instance object
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,"# If any instances never launch at destination host,"
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,# basic-filtering must be set here.
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,# setting up nova-instance-instance-xx mainly.
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,# wait for completion
a29442d81ead759e1b33d01ef1603fa677fa86bf,41a9ad538cc70d4f8f39eb51c1d137917967b04c,deleted,1,msg = _('Timeout migrating for %s. nwfilter not found.')
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,try:
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,virt_dom.undefineFlags(
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,libvirt.VIR_DOMAIN_UNDEFINE_MANAGED_SAVE)
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,except libvirt.libvirtError as e:
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,"LOG.debug(_(""Error from libvirt during undefineFlags."""
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,""" Retrying with undefine""), instance=instance)"
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,added,0,virt_dom.undefine()
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,# NOTE(derekh): we can switch to undefineFlags and
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,# VIR_DOMAIN_UNDEFINE_MANAGED_SAVE once we require 0.9.4
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,if virt_dom.hasManagedSaveImage(0):
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,virt_dom.managedSaveRemove(0)
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,except libvirt.libvirtError as e:
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,errcode = e.get_error_code()
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,"LOG.error(_(""Error from libvirt during saved instance """
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,"""removal. Code=%(errcode)s Error=%(e)s"") %"
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,"locals(), instance=instance)"
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,try:
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,# NOTE(justinsb): We remove the domain definition.
aeacea16a30f85dfb307803a4b46a602cabc8eb5,be386ee614777212da2a14ebd8211f4b3d90ce66,deleted,1,virt_dom.undefine()
f2cf3fc0cd37a00e3508d8c60f37952fe249aef5,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,from win32console import STD_OUTPUT_HANDLE
f2cf3fc0cd37a00e3508d8c60f37952fe249aef5,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,self.screenBuffer = GetStdHandle(STD_OUTPUT_HANDLE)
f2cf3fc0cd37a00e3508d8c60f37952fe249aef5,498638ce36228615ecf8d98f99c0227f4f86963d,added,0,win32console.STD_OUTPUT_HANDLE)
f2cf3fc0cd37a00e3508d8c60f37952fe249aef5,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,from win32console import STD_OUT_HANDLE
f2cf3fc0cd37a00e3508d8c60f37952fe249aef5,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,self.screenBuffer = GetStdHandle(STD_OUT_HANDLE)
f2cf3fc0cd37a00e3508d8c60f37952fe249aef5,498638ce36228615ecf8d98f99c0227f4f86963d,deleted,1,win32console.STD_OUT_HANDLE)
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"# Copyright (c) 2012 VMware, Inc."
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"vmwareapi_host_password='test_pass',"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"vnc_enabled=False,"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,use_linked_clone=False)
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self._check_vm_info(info, power_state.SUSPENDED)"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_power_on(self):
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_vm()
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,info = self.conn.get_info({'name': 1})
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self._check_vm_info(info, power_state.RUNNING)"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.conn.power_off(self.instance)
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self._check_vm_info(info, power_state.SHUTDOWN)"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.conn.power_on(self.instance)
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_power_on_non_existent(self):
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_instance_in_the_db()
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(exception.InstanceNotFound, self.conn.power_on,"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.instance)
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_power_off(self):
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_power_off_non_existent(self):
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(exception.InstanceNotFound, self.conn.power_off,"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_power_off_suspended(self):
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.conn.suspend(self.instance)
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(exception.InstancePowerOffFailure,"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.conn.power_off, self.instance)"
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vmwareapi_host_password='test_pass')
24d609447399e468937f8a278854690864ffabcd,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self._check_vm_info(info, power_state.PAUSED)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# Copyright (c) 2012 VMware, Inc."
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vmwareapi_host_ip:         IP address of VMware ESX server.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vmwareapi_host_username:   Username for connection to VMware ESX Server.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vmwareapi_host_password:   Password for connection to VMware ESX Server.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vmwareapi_task_poll_interval: The interval (seconds) used for polling of
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,remote tasks
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,(default: 5.0).
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vmwareapi_api_retry_count: The API retry count in case of failure such as
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,network failures (socket errors etc.)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,(default: 10).
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vnc_port:                  VNC starting port (default: 5900)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vnc_port_total:            Total number of VNC ports (default: 10000)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:vnc_password:              VNC password
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:use_linked_clone:          Whether to use linked clone (default: True)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cfg.IntOpt('vnc_port',"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default=5900,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"help='VNC starting port'),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cfg.IntOpt('vnc_port_total',"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default=10000,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"help='Total number of VNC ports'),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cfg.StrOpt('vnc_password',"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default=None,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"help='VNC password'),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cfg.BoolOpt('use_linked_clone',"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default=True,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"help='Whether to use linked clone'),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops = vmops.VMwareVMOps(self._session, self.virtapi,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._volumeops)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops.spawn(context, instance, image_meta, network_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_info)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def rescue(self, context, instance, network_info, image_meta,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,rescue_password):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Rescue the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops.rescue(context, instance, network_info, image_meta)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def unrescue(self, instance, network_info):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Unrescue the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._vmops.unrescue(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def power_off(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Power off the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._vmops.power_off(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def power_on(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Power on the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._vmops.power_on(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def migrate_disk_and_power_off(self, context, instance, dest,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"instance_type, network_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_info=None):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"Transfers the disk of a running instance in multiple phases, turning"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,off the instance before the end.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return self._vmops.migrate_disk_and_power_off(context, instance,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"dest, instance_type)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def confirm_migration(self, migration, instance, network_info):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Confirms a resize, destroying the source VM."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops.confirm_migration(migration, instance, network_info)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def finish_revert_migration(self, instance, network_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Finish reverting a resize, powering back on the instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._vmops.finish_revert_migration(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def finish_migration(self, context, migration, instance, disk_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"network_info, image_meta, resize_instance=False,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Completes a resize, turning on the migrated instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops.finish_migration(context, migration, instance, disk_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"network_info, image_meta, resize_instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def live_migration(self, context, instance_ref, dest,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"post_method, recover_method, block_migration=False,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,migrate_data=None):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Live migration of an instance to another host."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops.live_migration(context, instance_ref, dest,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"post_method, recover_method,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_migration)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def poll_rebooting_instances(self, timeout, instances):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Poll for rebooting instances."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._vmops.poll_rebooting_instances(timeout, instances)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_vnc_console(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Return link to instance's VNC console."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return self._vmops.get_vnc_console(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,:vmwareapi_host_ip:        IPAddress of VMware ESX server.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,:vmwareapi_host_username:  Username for connection to VMware ESX Server.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,:vmwareapi_host_password:  Password for connection to VMware ESX Server.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,:vmwareapi_task_poll_interval:  The interval (seconds) used for polling of
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,remote tasks
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,(default: 1.0).
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,:vmwareapi_api_retry_count:  The API retry count in case of failure such as
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,network failures (socket errors etc.)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,(default: 10).
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._vmops = vmops.VMwareVMOps(self._session)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._vmops.spawn(context, instance, image_meta, network_info)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova import block_device
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.compute import api as compute
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova import context as nova_context
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.openstack.common import excutils
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.openstack.common import timeutils
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.virt import driver
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"CONF.import_opt('vnc_enabled', 'nova.vnc')"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'suspended': power_state.SUSPENDED}
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,VMWARE_PREFIX = 'vmware'
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,RESIZE_TOTAL_STEPS = 4
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, session, virtapi, volumeops):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.compute_api = compute.API()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._virtapi = virtapi
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._volumeops = volumeops
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._instance_path_base = VMWARE_PREFIX + CONF.base_dir_name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._default_root_device = 'vda'
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._rescue_suffix = '-rescue'
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._poll_rescue_last_ran = None
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Ignoring the orphaned or inaccessible VMs
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def spawn(self, context, instance, image_meta, network_info,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_info=None):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,2. For flat disk
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,2.1. Create a dummy vmdk of the size of the disk file that is to be
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,uploaded. This is required just to create the metadata file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,2.2. Delete the -flat.vmdk file created in the above step and retain
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,the metadata .vmdk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,2.3. Upload the disk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,3. For sparse disk
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,3.1. Upload the disk file to a -sparse.vmdk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,3.2. Copy/Clone the -sparse.vmdk file to a thin vmdk.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,3.3. Delete the -sparse.vmdk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,4. Attach the disk to the VM by reconfiguring the same.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,5. Power on the VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance['name'])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstanceExists(name=instance['name'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds = vm_util.get_datastore_ref_and_name(self._session)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,data_store_ref = ds[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,data_store_name = ds[1]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"instance['image_ref'],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"disk_type = image_properties.get(""vmware_disktype"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""preallocated"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return vmdk_file_size_in_kb, os_type, adapter_type, disk_type"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(vmdk_file_size_in_kb, os_type, adapter_type,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,disk_type) = _get_image_properties()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_folder_ref, res_pool_ref = self._get_vmfolder_and_res_pool_refs()"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if network_info is None:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return vif_infos
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Creating VM on the ESX host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""CreateVM_Task"", vm_folder_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"config=config_spec, pool=res_pool_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Created VM on the ESX host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# Set the vnc configuration of the instance, vnc port starts from 5900"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if CONF.vnc_enabled:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vnc_port = self._get_vnc_port(vm_ref)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vnc_pass = CONF.vnc_password or ''
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._set_vnc_config(client_factory, instance, vnc_port, vnc_pass)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""%(vmdk_file_size_in_kb)s KB and adapter type """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""%(adapter_type)s on the ESX host local store """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""%(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmdk_file_size_in_kb, adapter_type,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,disk_type)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"datacenter=dc_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""" KB and type %(disk_type)s on """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""the ESX host local store %(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""disk_type"": disk_type,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _delete_disk_file(vmdk_path):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Deleting the file %(vmdk_path)s """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"{""vmdk_path"": vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Delete the vmdk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,datacenter=dc_ref)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Deleted the file %(vmdk_path)s on the """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"{'image_ref': instance['image_ref'],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# For flat disk, upload the -flat.vmdk file whose meta-data file"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# we just created above
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# For sparse disk, upload the -sparse.vmdk file to be copied into"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# a flat vmdk
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,upload_vmdk_name = sparse_uploaded_vmdk_name \
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if disk_type == ""sparse"" else flat_uploaded_vmdk_name"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"data_center_name=self._get_datacenter_ref_and_name()[1],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,file_path=upload_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Downloaded image file data %(image_ref)s to """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""%(upload_vmdk_name)s on the ESX data store """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'upload_vmdk_name': upload_vmdk_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _copy_virtual_disk():
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Copy a sparse virtual disk to a thin virtual disk."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Copy a sparse virtual disk to a thin virtual disk. This is also
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# done to generate the meta-data file whose specifics
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# depend on the size of the disk, thin/thick provisioning and the"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# storage adapter type.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Copying Virtual Disk of size """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""%(data_store_name)s to disk type %(disk_type)s"") %"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"{""vmdk_file_size_in_kb"": vmdk_file_size_in_kb,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""adapter_type"": adapter_type,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""data_store_name"": data_store_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""disk_type"": disk_type},"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmdk_copy_spec = vm_util.get_vmdk_create_spec(client_factory,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmdk_copy_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""CopyVirtualDisk_Task"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"service_content.virtualDiskManager,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sourceName=sparse_uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sourceDatacenter=self._get_datacenter_ref_and_name()[0],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"destName=uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,destSpec=vmdk_copy_spec)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], vmdk_copy_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Copied Virtual Disk of size %(vmdk_file_size_in_kb)s"""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""data_store_name"": data_store_name},"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance=instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ebs_root = self._volume_in_mapping(self._default_root_device,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_info)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not ebs_root:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,linked_clone = CONF.use_linked_clone
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if linked_clone:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,upload_folder = self._instance_path_base
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,upload_name = instance['image_ref']
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,upload_folder = instance['name']
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,upload_name = instance['name']
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The vmdk meta-data file
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"uploaded_vmdk_name = ""%s/%s.vmdk"" % (upload_folder, upload_name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"uploaded_vmdk_path = vm_util.build_datastore_path(data_store_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not (linked_clone and self._check_if_folder_file_exists(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"data_store_ref, data_store_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"upload_folder, upload_name + "".vmdk"")):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Naming the VM files in correspondence with the VM instance
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The flat vmdk file name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"flat_uploaded_vmdk_name = ""%s/%s-flat.vmdk"" % ("
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"upload_folder, upload_name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The sparse vmdk file name for sparse disk image
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sparse_uploaded_vmdk_name = ""%s/%s-sparse.vmdk"" % ("
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,flat_uploaded_vmdk_path = vm_util.build_datastore_path(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"data_store_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,flat_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,sparse_uploaded_vmdk_path = vm_util.build_datastore_path(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,sparse_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_ref = self._get_datacenter_ref_and_name()[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if disk_type != ""sparse"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Create a flat virtual disk and retain the metadata file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_create_virtual_disk()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_delete_disk_file(flat_uploaded_vmdk_path)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,cookies = \
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session._get_vim().client.options.transport.cookiejar
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_fetch_image_on_esx_datastore()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if disk_type == ""sparse"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Copy the sparse virtual disk to a thin virtual disk.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"disk_type = ""thin"""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_copy_virtual_disk()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,_delete_disk_file(sparse_uploaded_vmdk_path)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# linked clone base disk exists
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Attach the vmdk uploaded to the VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._volumeops.attach_disk_to_vm(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref, instance,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_type, disk_type, uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmdk_file_size_in_kb, linked_clone)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Attach the root disk to the VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,root_disk = driver.block_device_info_get_mapping(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_info)[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,connection_info = root_disk['connection_info']
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._volumeops.attach_volume(connection_info, instance['name'],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._default_root_device)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstanceNotFound(instance_id=instance['uuid'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmdk_file_path_before_snapshot)[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=""%s-snapshot"" % instance['name'],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_type,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _delete(self, instance, network_info):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Destroy a VM instance. Steps followed are:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"1. Power off the VM, if it is in poweredOn state."
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,2. Destroy the VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,try:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance['name'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if vm_ref is None:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""instance not present""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.power_off(instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Destroying the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,destroy_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Destroy_Task"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], destroy_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Destroyed the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"except Exception, excep:"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.warn(_(""In vmwareapi:vmops:delete, got this exception"""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""" while destroying the VM: %s"") % str(excep),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if network_info:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.unplug_vifs(instance, network_info)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"except Exception, exc:"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.exception(exc, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""UnregisterVM"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=dir_ds_compliant_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,datacenter=self._get_datacenter_ref_and_name()[0])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"reason = _(""instance is powered off and cannot be suspended."")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""VM was already in suspended state. So returning """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""without doing anything""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def rescue(self, context, instance, network_info, image_meta):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Rescue the specified instance."
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,- shutdown the instance VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,- spawn a rescue VM (the vm name-label will be instance-N-rescue).
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance['name'] = instance['name'] + self._rescue_suffix
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.spawn(context, instance, image_meta, network_info)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Attach vmdk to the rescue VM
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"hardware_devices = self._session._call_method(vim_util,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""get_dynamic_property"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualMachine"", ""config.hardware.device"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmdk_path, controller_key, adapter_type, disk_type, unit_number \"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,= vm_util.get_vmdk_path_and_adapter_type(hardware_devices)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Figure out the correct unit number
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,unit_number = unit_number + 1
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"rescue_vm_ref = vm_util.get_vm_ref_from_name(self._session,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"rescue_vm_ref, instance,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_type, disk_type, vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"controller_key=controller_key,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,unit_number=unit_number)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def unrescue(self, instance):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Unrescue the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance_orig_name = instance['name']
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.destroy(instance, None)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance['name'] = instance_orig_name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.power_on(instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def power_off(self, instance):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Power off the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"pwr_state = self._session._call_method(vim_util,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualMachine"", ""runtime.powerState"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Only PoweredOn VMs can be powered off.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if pwr_state == ""poweredOn"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Powering off the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,poweroff_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""PowerOffVM_Task"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], poweroff_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Powered off the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Raise Exception if VM is suspended
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"elif pwr_state == ""suspended"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"reason = _(""instance is suspended and cannot be powered off."")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstancePowerOffFailure(reason=reason)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""VM was already in powered off state. So returning """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def power_on(self, instance):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Power on the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""VM was already in powered on state. So returning """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Only PoweredOff and Suspended VMs can be powered on.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Powering on the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,poweron_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""PowerOnVM_Task"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], poweron_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Powered on the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_orig_vm_name_label(self, instance):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return instance['name'] + '-orig'
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _update_instance_progress(self, context, instance, step, total_steps):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Update instance progress percent to reflect current step number"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# Divide the action's workflow into discrete steps and ""bump"" the"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# instance's progress field as each step is completed.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# For a first cut this should be fine, however, for large VM images,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# the clone disk step begins to dominate the equation. A
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# better approximation would use the percentage of the VM image that
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# has been streamed to the destination host.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,progress = round(float(step) / total_steps * 100)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance_uuid = instance['uuid']
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Updating instance '%(instance_uuid)s' progress to"""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""" %(progress)d"") % locals(), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._virtapi.instance_update(context, instance_uuid,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,{'progress': progress})
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def migrate_disk_and_power_off(self, context, instance, dest,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance_type):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"Transfers the disk of a running instance in multiple phases, turning"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,off the instance before the end.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# 0. Zero out the progress to begin
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._update_instance_progress(context, instance,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"step=0,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,total_steps=RESIZE_TOTAL_STEPS)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstanceNotFound(instance_id=instance['name'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,host_ref = self._get_host_ref_from_name(dest)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if host_ref is None:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.HostNotFound(host=dest)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# 1. Power off the instance
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"step=1,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# 2. Rename the original VM with suffix '-orig'
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,name_label = self._get_orig_vm_name_label(instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Renaming the VM to %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,rename_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Rename_Task"", vm_ref, newName=name_label)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], rename_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Renamed the VM to %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"step=2,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Get the clone vm spec
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_ref = vm_util.get_datastore_ref_and_name(self._session)[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,client_factory = self._session._get_vim().client.factory
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"rel_spec = vm_util.relocate_vm_spec(client_factory, ds_ref, host_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"clone_spec = vm_util.clone_vm_spec(client_factory, rel_spec)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# 3. Clone VM on ESX host
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Cloning VM to host %s"") % dest, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vm_clone_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""CloneVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"folder=vm_folder_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=instance['name'],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,spec=clone_spec)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], vm_clone_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Cloned VM to host %s"") % dest, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"step=3,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def confirm_migration(self, migration, instance, network_info):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Confirms a resize, destroying the source VM."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance_name = self._get_orig_vm_name_label(instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Destroy the original VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.warn(_(""In vmwareapi:vmops:confirm_migration, got this """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""exception while destroying the VM: %s"") % str(excep))"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def finish_revert_migration(self, instance):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Finish reverting a resize, powering back on the instance."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The original vm was suffixed with '-orig'; find it using
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# the old suffix, remove the suffix, then power it back on."
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, name_label)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstanceNotFound(instance_id=name_label)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Renaming the VM from %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Rename_Task"", vm_ref, newName=instance['name'])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Renamed the VM from %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def finish_migration(self, context, migration, instance, disk_info,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"network_info, image_meta, resize_instance=False):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Completes a resize, turning on the migrated instance."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# 4. Start VM
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"step=4,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def live_migration(self, context, instance_ref, dest,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"post_method, recover_method, block_migration=False):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Spawning live_migration operation for distributing high-load."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_ref.name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstanceNotFound(instance_id=instance_ref.name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Migrating VM to host %s"") % dest, instance=instance_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vm_migrate_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""MigrateVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"host=host_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"priority=""defaultPriority"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance_ref['uuid'], vm_migrate_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,except Exception:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,with excutils.save_and_reraise_exception():
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"recover_method(context, instance_ref, dest, block_migration)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"post_method(context, instance_ref, dest, block_migration)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Migrated VM to host %s"") % dest, instance=instance_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def poll_rebooting_instances(self, timeout, instances):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Poll for rebooting instances."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ctxt = nova_context.get_admin_context()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"instances_info = dict(instance_count=len(instances),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,timeout=timeout)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if instances_info[""instance_count""] > 0:"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.info(_(""Found %(instance_count)d hung reboots """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""older than %(timeout)d seconds"") % instances_info)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for instance in instances:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.info(_(""Automatically hard rebooting %d"") % instance['uuid'])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.compute_api.reboot(ctxt, instance, ""HARD"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_vnc_console(self, instance):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Return connection info for a vnc console."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return {'host': CONF.vmwareapi_host_ip,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'port': self._get_vnc_port(vm_ref),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'internal_access_path': None}
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,@staticmethod
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_vnc_port(vm_ref):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Return VNC port for an VM."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_id = int(vm_ref.value.replace('vm-', ''))"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,port = CONF.vnc_port + vm_id % CONF.vnc_port_total
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return port
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _set_vnc_config(self, client_factory, instance, port, password):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Set the vnc configuration of the VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vnc_config_spec = vm_util.get_vnc_config_spec(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"client_factory, port, password)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Reconfiguring VM instance to enable vnc on """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""port - %(port)s"") % {'port': port},"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"reconfig_task = self._session._call_method(self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""ReconfigVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,spec=vnc_config_spec)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'], reconfig_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Reconfigured VM instance to enable vnc on """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_datacenter_ref_and_name(self):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_host_ref_from_name(self, host_name):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get reference to the host with the name specified."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"host_objs = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""HostSystem"", [""name""])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for host in host_objs:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if host.propSet[0].val == host_name:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return host.obj
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return None
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _get_vmfolder_and_res_pool_refs(self):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get the Vm folder ref from the datacenter."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dc_objs = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Datacenter"", [""vmFolder""])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# There is only one default datacenter in a standalone ESX host
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vm_folder_ref = dc_objs[0].propSet[0].val
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Get the resource pool. Taking the first resource pool coming our
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# way. Assuming that is the default resource pool.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"res_pool_ref = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""ResourcePool"")[0].obj"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return vm_folder_ref, res_pool_ref"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _path_file_exists(self, ds_browser, ds_path, file_name):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Check if the path and file exists on the datastore."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"search_spec = vm_util.search_datastore_spec(client_factory, file_name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"search_task = self._session._call_method(self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""SearchDatastore_Task"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ds_browser,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"datastorePath=ds_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,searchSpec=search_spec)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Wait till the state changes from queued or running.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# If an error state is returned, it means that the path doesn't exist."
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,while True:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"task_info = self._session._call_method(vim_util,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""get_dynamic_property"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"search_task, ""Task"", ""info"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if task_info.state in ['queued', 'running']:"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,time.sleep(2)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,continue
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,break
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if task_info.state == ""error"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return False, False"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"file_exists = (getattr(task_info.result, 'file', False) and"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,task_info.result.file[0].path == file_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return True, file_exists"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _check_if_folder_file_exists(self, ds_ref, ds_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"folder_name, file_name):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_browser = vim_util.get_dynamic_property(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ds_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Datastore"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""browser"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# Check if the folder exists or not. If not, create one"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Check if the file exists or not.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"folder_path = vm_util.build_datastore_path(ds_name, folder_name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"folder_exists, file_exists = self._path_file_exists(ds_browser,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"folder_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,file_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not folder_exists:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._mkdir(vm_util.build_datastore_path(ds_name, folder_name))"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return file_exists
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _volume_in_mapping(mount_device, block_device_info):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_list = [block_device.strip_dev(vol['mount_device'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for vol in
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,driver.block_device_info_get_mapping(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_info)]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,swap = driver.block_device_info_get_swap(block_device_info)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if driver.swap_is_usable(swap):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_list.append(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device.strip_dev(swap['device_name']))
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_list += [block_device.strip_dev(ephemeral['device_name'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for ephemeral in
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,driver.block_device_info_get_ephemerals(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""block_device_list %s""), block_device_list)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return block_device.strip_dev(mount_device) in block_device_list
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'suspended': power_state.PAUSED}
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, session):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Ignoring the oprhaned or inaccessible VMs
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def spawn(self, context, instance, image_meta, network_info):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,2. Create a dummy vmdk of the size of the disk file that is to be
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,uploaded. This is required just to create the metadata file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,3. Delete the -flat.vmdk file created in the above step and retain
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,the metadata .vmdk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,4. Upload the disk file.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,5. Attach the disk to the VM by reconfiguring the same.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,6. Power on the VM.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_ref = self._get_vm_ref_from_the_name(instance.name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.InstanceExists(name=instance.name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_datastore_ref():
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the datastore list and choose the first local storage."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"data_stores = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""Datastore"", [""summary.type"", ""summary.name""])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for elem in data_stores:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ds_name = None
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ds_type = None
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for prop in elem.propSet:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if prop.name == ""summary.type"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ds_type = prop.val
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif prop.name == ""summary.name"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ds_name = prop.val
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Local storage identifier
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if ds_type == ""VMFS"":"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,data_store_name = ds_name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return data_store_name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if data_store_name is None:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"msg = _(""Couldn't get a local Datastore reference"")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.error(msg, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.NovaException(msg)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,data_store_name = _get_datastore_ref()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"instance.image_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return vmdk_file_size_in_kb, os_type, adapter_type"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmdk_file_size_in_kb, os_type, adapter_type = _get_image_properties()"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_vmfolder_and_res_pool_mors():
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the Vm folder ref from the datacenter."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dc_objs = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""Datacenter"", [""vmFolder""])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# There is only one default datacenter in a standalone ESX host
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_folder_mor = dc_objs[0].propSet[0].val
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Get the resource pool. Taking the first resource pool coming our
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# way. Assuming that is the default resource pool.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"res_pool_mor = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""ResourcePool"")[0].obj"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return vm_folder_mor, res_pool_mor"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_folder_mor, res_pool_mor = _get_vmfolder_and_res_pool_mors()"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Creating VM on the ESX  host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""CreateVM_Task"", vm_folder_mor,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"config=config_spec, pool=res_pool_mor)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Created VM on the ESX  host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Naming the VM files in correspondence with the VM instance name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# The flat vmdk file name
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"flat_uploaded_vmdk_name = ""%s/%s-flat.vmdk"" % (instance.name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance.name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# The vmdk meta-data file
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"uploaded_vmdk_name = ""%s/%s.vmdk"" % (instance.name, instance.name)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"flat_uploaded_vmdk_path = vm_util.build_datastore_path(data_store_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,flat_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"uploaded_vmdk_path = vm_util.build_datastore_path(data_store_name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""%(vmdk_file_size_in_kb)s KB and adapter type  """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""%(adapter_type)s on the ESX host local store"""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""" %(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmdk_file_size_in_kb, adapter_type)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"datacenter=self._get_datacenter_name_and_ref()[0],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""" KB on the ESX host local store """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""%(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_create_virtual_disk()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _delete_disk_file():
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Deleting the file %(flat_uploaded_vmdk_path)s """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"{""flat_uploaded_vmdk_path"": flat_uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Delete the -flat.vmdk file created. .vmdk file is retained.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,name=flat_uploaded_vmdk_path)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Deleted the file %(flat_uploaded_vmdk_path)s on the """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_delete_disk_file()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cookies = self._session._get_vim().client.options.transport.cookiejar
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"{'image_ref': instance.image_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Upload the -flat.vmdk file whose meta-data file we just created
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# above
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"data_center_name=self._get_datacenter_name_and_ref()[1],"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,file_path=flat_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Downloaded image file data %(image_ref)s to the ESX """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""data store %(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_fetch_image_on_esx_datastore()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _attach_vmdk_to_the_vm():
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Attach the vmdk uploaded to the VM. VM reconfigure is done
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,to do so.
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmdk_attach_config_spec = vm_util.get_vmdk_attach_config_spec(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"client_factory,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_type, ""preallocated"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"uploaded_vmdk_path, vmdk_file_size_in_kb)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Reconfiguring VM instance to attach the image disk""),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance=instance)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,reconfig_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""ReconfigVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,spec=vmdk_attach_config_spec)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._wait_for_task(instance['uuid'], reconfig_task)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Reconfigured VM instance to attach the image disk""),"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_attach_vmdk_to_the_vm()
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.InstanceNotFound(instance_id=instance.id)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmdk_file_path_before_snapshot)[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"name=""%s-snapshot"" % instance.name,"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dc_ref = self._get_datacenter_name_and_ref()[0]
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""UnregisterVM"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self.unplug_vifs(instance, network_info)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,name=dir_ds_compliant_path)
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"reason = _(""instance is powered off and can not be suspended."")"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""VM was already in suspended state. So returning """
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""without doing anything""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_ref = self._get_vm_ref_from_the_name(instance['name'])
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_datacenter_name_and_ref(self):
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _get_vm_ref_from_the_name(self, vm_name):"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get reference to the VM with the name specified."""""""
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vms = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""VirtualMachine"", [""name""])"
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for vm in vms:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if vm.propSet[0].val == vm_name:
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return vm.obj
24d609447399e468937f8a278854690864ffabcd,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return None
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova import block_device
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.compute import api as compute
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova import context as nova_context
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.openstack.common import excutils
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.openstack.common import timeutils
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.virt import driver
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"CONF.import_opt('vnc_enabled', 'nova.vnc')"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'suspended': power_state.SUSPENDED}
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,VMWARE_PREFIX = 'vmware'
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,RESIZE_TOTAL_STEPS = 4
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, session, virtapi, volumeops):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.compute_api = compute.API()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._virtapi = virtapi
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._volumeops = volumeops
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._instance_path_base = VMWARE_PREFIX + CONF.base_dir_name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._default_root_device = 'vda'
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._rescue_suffix = '-rescue'
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._poll_rescue_last_ran = None
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Ignoring the orphaned or inaccessible VMs
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def spawn(self, context, instance, image_meta, network_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_info=None):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,2. For flat disk
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,2.1. Create a dummy vmdk of the size of the disk file that is to be
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,uploaded. This is required just to create the metadata file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,2.2. Delete the -flat.vmdk file created in the above step and retain
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,the metadata .vmdk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,2.3. Upload the disk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,3. For sparse disk
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,3.1. Upload the disk file to a -sparse.vmdk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,3.2. Copy/Clone the -sparse.vmdk file to a thin vmdk.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,3.3. Delete the -sparse.vmdk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,4. Attach the disk to the VM by reconfiguring the same.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,5. Power on the VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance['name'])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.InstanceExists(name=instance['name'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ds = vm_util.get_datastore_ref_and_name(self._session)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,data_store_ref = ds[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,data_store_name = ds[1]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"instance['image_ref'],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"disk_type = image_properties.get(""vmware_disktype"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""preallocated"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return vmdk_file_size_in_kb, os_type, adapter_type, disk_type"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"(vmdk_file_size_in_kb, os_type, adapter_type,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,disk_type) = _get_image_properties()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_folder_ref, res_pool_ref = self._get_vmfolder_and_res_pool_refs()"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if network_info is None:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return vif_infos
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Creating VM on the ESX host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""CreateVM_Task"", vm_folder_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"config=config_spec, pool=res_pool_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Created VM on the ESX host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# Set the vnc configuration of the instance, vnc port starts from 5900"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if CONF.vnc_enabled:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vnc_port = self._get_vnc_port(vm_ref)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vnc_pass = CONF.vnc_password or ''
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._set_vnc_config(client_factory, instance, vnc_port, vnc_pass)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(vmdk_file_size_in_kb)s KB and adapter type """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(adapter_type)s on the ESX host local store """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmdk_file_size_in_kb, adapter_type,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,disk_type)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"datacenter=dc_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""" KB and type %(disk_type)s on """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""the ESX host local store %(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""disk_type"": disk_type,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _delete_disk_file(vmdk_path):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Deleting the file %(vmdk_path)s """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"{""vmdk_path"": vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Delete the vmdk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"name=vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datacenter=dc_ref)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Deleted the file %(vmdk_path)s on the """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"{'image_ref': instance['image_ref'],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# For flat disk, upload the -flat.vmdk file whose meta-data file"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# we just created above
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# For sparse disk, upload the -sparse.vmdk file to be copied into"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# a flat vmdk
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,upload_vmdk_name = sparse_uploaded_vmdk_name \
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if disk_type == ""sparse"" else flat_uploaded_vmdk_name"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"data_center_name=self._get_datacenter_ref_and_name()[1],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,file_path=upload_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Downloaded image file data %(image_ref)s to """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(upload_vmdk_name)s on the ESX data store """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"'upload_vmdk_name': upload_vmdk_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _copy_virtual_disk():
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Copy a sparse virtual disk to a thin virtual disk."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Copy a sparse virtual disk to a thin virtual disk. This is also
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# done to generate the meta-data file whose specifics
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# depend on the size of the disk, thin/thick provisioning and the"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# storage adapter type.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Copying Virtual Disk of size """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(data_store_name)s to disk type %(disk_type)s"") %"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"{""vmdk_file_size_in_kb"": vmdk_file_size_in_kb,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""adapter_type"": adapter_type,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""data_store_name"": data_store_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""disk_type"": disk_type},"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmdk_copy_spec = vm_util.get_vmdk_create_spec(client_factory,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_copy_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""CopyVirtualDisk_Task"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"service_content.virtualDiskManager,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"sourceName=sparse_uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"sourceDatacenter=self._get_datacenter_ref_and_name()[0],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"destName=uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,destSpec=vmdk_copy_spec)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], vmdk_copy_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Copied Virtual Disk of size %(vmdk_file_size_in_kb)s"""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""data_store_name"": data_store_name},"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance=instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ebs_root = self._volume_in_mapping(self._default_root_device,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_info)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if not ebs_root:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,linked_clone = CONF.use_linked_clone
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if linked_clone:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,upload_folder = self._instance_path_base
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,upload_name = instance['image_ref']
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,upload_folder = instance['name']
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,upload_name = instance['name']
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# The vmdk meta-data file
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"uploaded_vmdk_name = ""%s/%s.vmdk"" % (upload_folder, upload_name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"uploaded_vmdk_path = vm_util.build_datastore_path(data_store_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if not (linked_clone and self._check_if_folder_file_exists(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"data_store_ref, data_store_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"upload_folder, upload_name + "".vmdk"")):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Naming the VM files in correspondence with the VM instance
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# The flat vmdk file name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"flat_uploaded_vmdk_name = ""%s/%s-flat.vmdk"" % ("
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"upload_folder, upload_name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# The sparse vmdk file name for sparse disk image
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"sparse_uploaded_vmdk_name = ""%s/%s-sparse.vmdk"" % ("
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,flat_uploaded_vmdk_path = vm_util.build_datastore_path(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"data_store_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,flat_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,sparse_uploaded_vmdk_path = vm_util.build_datastore_path(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,sparse_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,dc_ref = self._get_datacenter_ref_and_name()[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if disk_type != ""sparse"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Create a flat virtual disk and retain the metadata file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_virtual_disk()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_delete_disk_file(flat_uploaded_vmdk_path)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,cookies = \
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session._get_vim().client.options.transport.cookiejar
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_fetch_image_on_esx_datastore()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if disk_type == ""sparse"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Copy the sparse virtual disk to a thin virtual disk.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"disk_type = ""thin"""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_copy_virtual_disk()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_delete_disk_file(sparse_uploaded_vmdk_path)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# linked clone base disk exists
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Attach the vmdk uploaded to the VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._volumeops.attach_disk_to_vm(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref, instance,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"adapter_type, disk_type, uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmdk_file_size_in_kb, linked_clone)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Attach the root disk to the VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,root_disk = driver.block_device_info_get_mapping(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_info)[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,connection_info = root_disk['connection_info']
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._volumeops.attach_volume(connection_info, instance['name'],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._default_root_device)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.InstanceNotFound(instance_id=instance['uuid'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_file_path_before_snapshot)[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"name=""%s-snapshot"" % instance['name'],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"adapter_type,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _delete(self, instance, network_info):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,Destroy a VM instance. Steps followed are:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"1. Power off the VM, if it is in poweredOn state."
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,2. Destroy the VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,try:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance['name'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if vm_ref is None:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""instance not present""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.power_off(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Destroying the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,destroy_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Destroy_Task"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], destroy_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Destroyed the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"except Exception, excep:"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.warn(_(""In vmwareapi:vmops:delete, got this exception"""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""" while destroying the VM: %s"") % str(excep),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if network_info:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.unplug_vifs(instance, network_info)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"except Exception, exc:"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.exception(exc, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""UnregisterVM"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"name=dir_ds_compliant_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datacenter=self._get_datacenter_ref_and_name()[0])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"reason = _(""instance is powered off and cannot be suspended."")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""VM was already in suspended state. So returning """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""without doing anything""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def rescue(self, context, instance, network_info, image_meta):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Rescue the specified instance."
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,- shutdown the instance VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,- spawn a rescue VM (the vm name-label will be instance-N-rescue).
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance['name'] = instance['name'] + self._rescue_suffix
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.spawn(context, instance, image_meta, network_info)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Attach vmdk to the rescue VM
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"hardware_devices = self._session._call_method(vim_util,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""get_dynamic_property"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualMachine"", ""config.hardware.device"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmdk_path, controller_key, adapter_type, disk_type, unit_number \"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,= vm_util.get_vmdk_path_and_adapter_type(hardware_devices)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Figure out the correct unit number
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,unit_number = unit_number + 1
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"rescue_vm_ref = vm_util.get_vm_ref_from_name(self._session,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"rescue_vm_ref, instance,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"adapter_type, disk_type, vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"controller_key=controller_key,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,unit_number=unit_number)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def unrescue(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Unrescue the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance_orig_name = instance['name']
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.destroy(instance, None)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance['name'] = instance_orig_name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.power_on(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def power_off(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Power off the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"pwr_state = self._session._call_method(vim_util,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualMachine"", ""runtime.powerState"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Only PoweredOn VMs can be powered off.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if pwr_state == ""poweredOn"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Powering off the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,poweroff_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""PowerOffVM_Task"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], poweroff_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Powered off the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Raise Exception if VM is suspended
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"elif pwr_state == ""suspended"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"reason = _(""instance is suspended and cannot be powered off."")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.InstancePowerOffFailure(reason=reason)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""VM was already in powered off state. So returning """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def power_on(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Power on the specified instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""VM was already in powered on state. So returning """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Only PoweredOff and Suspended VMs can be powered on.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Powering on the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,poweron_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""PowerOnVM_Task"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], poweron_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Powered on the VM""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _get_orig_vm_name_label(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return instance['name'] + '-orig'
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _update_instance_progress(self, context, instance, step, total_steps):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Update instance progress percent to reflect current step number"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# Divide the action's workflow into discrete steps and ""bump"" the"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# instance's progress field as each step is completed.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,#
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# For a first cut this should be fine, however, for large VM images,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# the clone disk step begins to dominate the equation. A
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# better approximation would use the percentage of the VM image that
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# has been streamed to the destination host.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,progress = round(float(step) / total_steps * 100)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance_uuid = instance['uuid']
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Updating instance '%(instance_uuid)s' progress to"""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""" %(progress)d"") % locals(), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._virtapi.instance_update(context, instance_uuid,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,{'progress': progress})
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def migrate_disk_and_power_off(self, context, instance, dest,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance_type):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"Transfers the disk of a running instance in multiple phases, turning"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,off the instance before the end.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# 0. Zero out the progress to begin
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._update_instance_progress(context, instance,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"step=0,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,total_steps=RESIZE_TOTAL_STEPS)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.InstanceNotFound(instance_id=instance['name'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_ref = self._get_host_ref_from_name(dest)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if host_ref is None:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.HostNotFound(host=dest)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# 1. Power off the instance
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"step=1,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# 2. Rename the original VM with suffix '-orig'
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,name_label = self._get_orig_vm_name_label(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Renaming the VM to %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,rename_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Rename_Task"", vm_ref, newName=name_label)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], rename_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Renamed the VM to %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"step=2,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Get the clone vm spec
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ds_ref = vm_util.get_datastore_ref_and_name(self._session)[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,client_factory = self._session._get_vim().client.factory
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"rel_spec = vm_util.relocate_vm_spec(client_factory, ds_ref, host_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"clone_spec = vm_util.clone_vm_spec(client_factory, rel_spec)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# 3. Clone VM on ESX host
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Cloning VM to host %s"") % dest, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_clone_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""CloneVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"folder=vm_folder_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"name=instance['name'],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,spec=clone_spec)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], vm_clone_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Cloned VM to host %s"") % dest, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"step=3,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def confirm_migration(self, migration, instance, network_info):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Confirms a resize, destroying the source VM."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance_name = self._get_orig_vm_name_label(instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Destroy the original VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.warn(_(""In vmwareapi:vmops:confirm_migration, got this """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""exception while destroying the VM: %s"") % str(excep))"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def finish_revert_migration(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Finish reverting a resize, powering back on the instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# The original vm was suffixed with '-orig'; find it using
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# the old suffix, remove the suffix, then power it back on."
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, name_label)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.InstanceNotFound(instance_id=name_label)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Renaming the VM from %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Rename_Task"", vm_ref, newName=instance['name'])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Renamed the VM from %s"") % name_label,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def finish_migration(self, context, migration, instance, disk_info,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"network_info, image_meta, resize_instance=False):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Completes a resize, turning on the migrated instance."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# 4. Start VM
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"step=4,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def live_migration(self, context, instance_ref, dest,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"post_method, recover_method, block_migration=False):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Spawning live_migration operation for distributing high-load."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_ref.name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,raise exception.InstanceNotFound(instance_id=instance_ref.name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Migrating VM to host %s"") % dest, instance=instance_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_migrate_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""MigrateVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host=host_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"priority=""defaultPriority"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance_ref['uuid'], vm_migrate_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,except Exception:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,with excutils.save_and_reraise_exception():
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"recover_method(context, instance_ref, dest, block_migration)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"post_method(context, instance_ref, dest, block_migration)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Migrated VM to host %s"") % dest, instance=instance_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def poll_rebooting_instances(self, timeout, instances):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Poll for rebooting instances."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ctxt = nova_context.get_admin_context()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"instances_info = dict(instance_count=len(instances),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,timeout=timeout)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if instances_info[""instance_count""] > 0:"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.info(_(""Found %(instance_count)d hung reboots """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""older than %(timeout)d seconds"") % instances_info)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for instance in instances:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.info(_(""Automatically hard rebooting %d"") % instance['uuid'])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.compute_api.reboot(ctxt, instance, ""HARD"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_vnc_console(self, instance):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Return connection info for a vnc console."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return {'host': CONF.vmwareapi_host_ip,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"'port': self._get_vnc_port(vm_ref),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'internal_access_path': None}
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,@staticmethod
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_vnc_port(vm_ref):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Return VNC port for an VM."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_id = int(vm_ref.value.replace('vm-', ''))"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,port = CONF.vnc_port + vm_id % CONF.vnc_port_total
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return port
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _set_vnc_config(self, client_factory, instance, port, password):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,Set the vnc configuration of the VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vnc_config_spec = vm_util.get_vnc_config_spec(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"client_factory, port, password)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Reconfiguring VM instance to enable vnc on """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""port - %(port)s"") % {'port': port},"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"reconfig_task = self._session._call_method(self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""ReconfigVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,spec=vnc_config_spec)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'], reconfig_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Reconfigured VM instance to enable vnc on """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_datacenter_ref_and_name(self):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _get_host_ref_from_name(self, host_name):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get reference to the host with the name specified."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_objs = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""HostSystem"", [""name""])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for host in host_objs:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if host.propSet[0].val == host_name:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return host.obj
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return None
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_vmfolder_and_res_pool_refs(self):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get the Vm folder ref from the datacenter."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"dc_objs = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Datacenter"", [""vmFolder""])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# There is only one default datacenter in a standalone ESX host
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_folder_ref = dc_objs[0].propSet[0].val
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Get the resource pool. Taking the first resource pool coming our
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# way. Assuming that is the default resource pool.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"res_pool_ref = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""ResourcePool"")[0].obj"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return vm_folder_ref, res_pool_ref"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _path_file_exists(self, ds_browser, ds_path, file_name):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Check if the path and file exists on the datastore."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"search_spec = vm_util.search_datastore_spec(client_factory, file_name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"search_task = self._session._call_method(self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""SearchDatastore_Task"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds_browser,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"datastorePath=ds_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,searchSpec=search_spec)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Wait till the state changes from queued or running.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# If an error state is returned, it means that the path doesn't exist."
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,while True:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"task_info = self._session._call_method(vim_util,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""get_dynamic_property"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"search_task, ""Task"", ""info"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if task_info.state in ['queued', 'running']:"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,time.sleep(2)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,continue
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,break
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if task_info.state == ""error"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return False, False"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"file_exists = (getattr(task_info.result, 'file', False) and"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,task_info.result.file[0].path == file_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return True, file_exists"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _check_if_folder_file_exists(self, ds_ref, ds_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"folder_name, file_name):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ds_browser = vim_util.get_dynamic_property(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Datastore"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""browser"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# Check if the folder exists or not. If not, create one"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Check if the file exists or not.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"folder_path = vm_util.build_datastore_path(ds_name, folder_name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"folder_exists, file_exists = self._path_file_exists(ds_browser,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"folder_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,file_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if not folder_exists:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._mkdir(vm_util.build_datastore_path(ds_name, folder_name))"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return file_exists
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _volume_in_mapping(mount_device, block_device_info):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_list = [block_device.strip_dev(vol['mount_device'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for vol in
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,driver.block_device_info_get_mapping(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_info)]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,swap = driver.block_device_info_get_swap(block_device_info)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if driver.swap_is_usable(swap):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_list.append(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device.strip_dev(swap['device_name']))
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,block_device_list += [block_device.strip_dev(ephemeral['device_name'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for ephemeral in
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,driver.block_device_info_get_ephemerals(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""block_device_list %s""), block_device_list)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return block_device.strip_dev(mount_device) in block_device_list
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'suspended': power_state.PAUSED}
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, session):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Ignoring the oprhaned or inaccessible VMs
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def spawn(self, context, instance, image_meta, network_info):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,2. Create a dummy vmdk of the size of the disk file that is to be
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,uploaded. This is required just to create the metadata file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,3. Delete the -flat.vmdk file created in the above step and retain
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,the metadata .vmdk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,4. Upload the disk file.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,5. Attach the disk to the VM by reconfiguring the same.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,6. Power on the VM.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_ref = self._get_vm_ref_from_the_name(instance.name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.InstanceExists(name=instance.name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _get_datastore_ref():
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get the datastore list and choose the first local storage."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"data_stores = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""Datastore"", [""summary.type"", ""summary.name""])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for elem in data_stores:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ds_name = None
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ds_type = None
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for prop in elem.propSet:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if prop.name == ""summary.type"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ds_type = prop.val
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif prop.name == ""summary.name"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ds_name = prop.val
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Local storage identifier
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if ds_type == ""VMFS"":"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,data_store_name = ds_name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return data_store_name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if data_store_name is None:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"msg = _(""Couldn't get a local Datastore reference"")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.error(msg, instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.NovaException(msg)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,data_store_name = _get_datastore_ref()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"instance.image_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return vmdk_file_size_in_kb, os_type, adapter_type"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vmdk_file_size_in_kb, os_type, adapter_type = _get_image_properties()"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _get_vmfolder_and_res_pool_mors():
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get the Vm folder ref from the datacenter."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"dc_objs = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""Datacenter"", [""vmFolder""])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# There is only one default datacenter in a standalone ESX host
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_folder_mor = dc_objs[0].propSet[0].val
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Get the resource pool. Taking the first resource pool coming our
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# way. Assuming that is the default resource pool.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"res_pool_mor = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""ResourcePool"")[0].obj"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return vm_folder_mor, res_pool_mor"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_folder_mor, res_pool_mor = _get_vmfolder_and_res_pool_mors()"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Creating VM on the ESX  host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""CreateVM_Task"", vm_folder_mor,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"config=config_spec, pool=res_pool_mor)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Created VM on the ESX  host""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Naming the VM files in correspondence with the VM instance name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# The flat vmdk file name
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"flat_uploaded_vmdk_name = ""%s/%s-flat.vmdk"" % (instance.name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,instance.name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# The vmdk meta-data file
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"uploaded_vmdk_name = ""%s/%s.vmdk"" % (instance.name, instance.name)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"flat_uploaded_vmdk_path = vm_util.build_datastore_path(data_store_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,flat_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"uploaded_vmdk_path = vm_util.build_datastore_path(data_store_name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(vmdk_file_size_in_kb)s KB and adapter type  """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(adapter_type)s on the ESX host local store"""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""" %(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vmdk_file_size_in_kb, adapter_type)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"datacenter=self._get_datacenter_name_and_ref()[0],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""" KB on the ESX host local store """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_create_virtual_disk()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _delete_disk_file():
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleting the file %(flat_uploaded_vmdk_path)s """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"{""flat_uploaded_vmdk_path"": flat_uploaded_vmdk_path,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Delete the -flat.vmdk file created. .vmdk file is retained.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,name=flat_uploaded_vmdk_path)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleted the file %(flat_uploaded_vmdk_path)s on the """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_delete_disk_file()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,cookies = self._session._get_vim().client.options.transport.cookiejar
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"{'image_ref': instance.image_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Upload the -flat.vmdk file whose meta-data file we just created
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# above
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"data_center_name=self._get_datacenter_name_and_ref()[1],"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,file_path=flat_uploaded_vmdk_name)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Downloaded image file data %(image_ref)s to the ESX """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""data store %(data_store_name)s"") %"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_fetch_image_on_esx_datastore()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _attach_vmdk_to_the_vm():
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,Attach the vmdk uploaded to the VM. VM reconfigure is done
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,to do so.
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmdk_attach_config_spec = vm_util.get_vmdk_attach_config_spec(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"client_factory,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"adapter_type, ""preallocated"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"uploaded_vmdk_path, vmdk_file_size_in_kb)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfiguring VM instance to attach the image disk""),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,instance=instance)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,reconfig_task = self._session._call_method(
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._session._get_vim(),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""ReconfigVM_Task"", vm_ref,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,spec=vmdk_attach_config_spec)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._session._wait_for_task(instance['uuid'], reconfig_task)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfigured VM instance to attach the image disk""),"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_attach_vmdk_to_the_vm()
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.InstanceNotFound(instance_id=instance.id)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmdk_file_path_before_snapshot)[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"name=""%s-snapshot"" % instance.name,"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,dc_ref = self._get_datacenter_name_and_ref()[0]
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""UnregisterVM"", vm_ref)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.unplug_vifs(instance, network_info)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,name=dir_ds_compliant_path)
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"reason = _(""instance is powered off and can not be suspended."")"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""VM was already in suspended state. So returning """
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""without doing anything""), instance=instance)"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_ref = self._get_vm_ref_from_the_name(instance['name'])
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _get_datacenter_name_and_ref(self):
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _get_vm_ref_from_the_name(self, vm_name):"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get reference to the VM with the name specified."""""""
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vms = self._session._call_method(vim_util, ""get_objects"","
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""VirtualMachine"", [""name""])"
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for vm in vms:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if vm.propSet[0].val == vm_name:
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return vm.obj
24d609447399e468937f8a278854690864ffabcd,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return None
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,import mox
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,import urllib2
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,from nova.virt.vmwareapi import vm_util
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,class fake_vm_ref(object):
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,def __init__(self):
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.value = 4
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._type = 'VirtualMachine'
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,class fake_http_resp(object):
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.code = 200
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,def read(self):
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,"return ""console log"""
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,vm_ref = fake_vm_ref()
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,result = fake_http_resp()
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_instance_in_the_db()
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.mox.StubOutWithMock(vm_util, 'get_vm_ref_from_name')"
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.mox.StubOutWithMock(urllib2, 'urlopen')"
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,"vm_util.get_vm_ref_from_name(mox.IgnoreArg(), self.instance['name']).\"
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,AndReturn(vm_ref)
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,urllib2.urlopen(mox.IgnoreArg()).AndReturn(result)
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.mox.ReplayAll()
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.conn.get_console_output(self.instance)
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,pass
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"param_list = {""id"": str(vm_ref.value)}"
2e16432ae0337101c80d8ba6fbdf2e8a9c8d85e7,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"param_list = {""id"": str(vm_ref)}"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref(self._session, instance)"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,upload_folder = instance['uuid']
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._volumeops.attach_volume(connection_info, instance['uuid'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=""%s-snapshot"" % instance['uuid'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"rescue_vm_ref = vm_util.get_vm_ref_from_uuid(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance['uuid'])
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if rescue_vm_ref is None:
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"rescue_vm_ref = vm_util.get_vm_ref_from_name(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_uuid(self._session, instance['uuid'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if vm_ref is None:
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_name)"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Rename_Task"", vm_ref, newName=instance['uuid'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref = vm_util.get_vm_ref(self._session, instance_ref)"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance['name'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if vm_ref:
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.InstanceExists(name=instance['name'])
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,upload_folder = instance['name']
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._volumeops.attach_volume(connection_info, instance['name'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if vm_ref is None:
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.InstanceNotFound(instance_id=instance['uuid'])
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"name=""%s-snapshot"" % instance['name'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance['name'])
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""instance not present""), instance=instance)"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"rescue_vm_ref = vm_util.get_vm_ref_from_name(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.InstanceNotFound(instance_id=instance['name'])
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_name)"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""Rename_Task"", vm_ref, newName=instance['name'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_ref.name)"
e517e5668ab20214432e06ef87f7b16776edaf7c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.InstanceNotFound(instance_id=instance_ref.name)
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref(self._session, instance)"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,upload_folder = instance['uuid']
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._volumeops.attach_volume(connection_info, instance['uuid'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"name=""%s-snapshot"" % instance['uuid'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"rescue_vm_ref = vm_util.get_vm_ref_from_uuid(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance['uuid'])
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if rescue_vm_ref is None:
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"rescue_vm_ref = vm_util.get_vm_ref_from_name(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_uuid(self._session, instance['uuid'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if vm_ref is None:
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_name)"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Rename_Task"", vm_ref, newName=instance['uuid'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_ref = vm_util.get_vm_ref(self._session, instance_ref)"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance['name'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if vm_ref:
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.InstanceExists(name=instance['name'])
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,upload_folder = instance['name']
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._volumeops.attach_volume(connection_info, instance['name'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if vm_ref is None:
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.InstanceNotFound(instance_id=instance['uuid'])
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"name=""%s-snapshot"" % instance['name'],"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,instance['name'])
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""instance not present""), instance=instance)"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"rescue_vm_ref = vm_util.get_vm_ref_from_name(self._session,"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.InstanceNotFound(instance_id=instance['name'])
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_name)"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""Rename_Task"", vm_ref, newName=instance['name'])"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_ref = vm_util.get_vm_ref_from_name(self._session, instance_ref.name)"
e517e5668ab20214432e06ef87f7b16776edaf7c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.InstanceNotFound(instance_id=instance_ref.name)
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, obj_name=None):"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.obj_name = obj_name
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.device = kwargs.get(""virtual_device"")"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""config.hardware.device"", [disk, controller,"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.device[0]])
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return DataObject(obj_name)
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""extra_config"": config_spec.extraConfig,"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""virtual_device"": config_spec.deviceChange}"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,pass
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,nic = VirtualPCNet32()
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""config.hardware.device"", [disk, controller, nic])"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return DataObject()
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""extra_config"": config_spec.extraConfig}"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Keep compatible with other Hyper vif model parameter.
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if vif_info['vif_model'] == ""e1000"":"
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vif_info['vif_model'] = ""VirtualE1000"""
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vif = 'ns0:' + vif_info['vif_model']
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,net_device = client_factory.create(vif)
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Get the recommended card type for the VM based on the guest OS of the VM
088995fc2c792d6d029abd0e45d5c0cf09a5125a,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,net_device = client_factory.create('ns0:VirtualPCNet32')
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,import collections
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class Property(object):
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=None, val=None):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.name = name
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.val = val
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class ManagedObjectReference(object):
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""A managed object reference is a remote identifier."""""""
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, value=""object-123"", _type=""ManagedObject""):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(ManagedObjectReference, self)"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Managed Object Reference value attributes
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# typically have values like vm-123 or
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# host-232 and not UUID.
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Managed Object Reference _type
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# attributes hold the name of the type
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# of the vCenter object the value
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# attribute is the identifier for
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._type = _type
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class ObjectContent(object):
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""ObjectContent array holds dynamic properties."""""""
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# This class is a *fake* of a class sent back to us by
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# SOAP. It has its own names. These names are decided
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# for us by the API we are *faking* here.
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, obj_ref, prop_list=None, missing_list=None):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.obj = obj_ref
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if not isinstance(prop_list, collections.Iterable):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,prop_list = []
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if not isinstance(missing_list, collections.Iterable):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,missing_list = []
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# propSet is the name your Python code will need to
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# use since this is the name that the API will use
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.propSet = prop_list
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# missingSet is the name your python code will
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# need to use since this is the name that the
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# API we are talking to will use.
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.missingSet = missing_list
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Managed Object base class."""""""
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# A managed object is a local representation of a
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# remote object that you can reference using the
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# object reference.
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if value is None:
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,value = 'obj-123'
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"obj_ref = ManagedObjectReference(value, name)"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# we use __setattr__ here because below the
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# default setter has been altered for this class.
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# TODO(hartsocks): this is adds unnecessary complexity to the class
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,elem = Property()
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# TODO(hartsocks): remove this
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# in a real ManagedObject you have to iterate the propSet
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# in a real ManagedObject, the propSet is a *set* not a list"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set('runtime.host',"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ManagedObjectReference(value='host-123', _type=""HostSystem""))"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, obj_ref=None, value='host-123'):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(HostSystem, self).__init__(""HostSystem"", obj_ref, value)"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class Prop(object):
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def __init__(self):
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.name = None
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.val = None
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class Obj(object):
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, name, value):"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._type = name
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Managed Data Object base class."""""""
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"obj_ref = Obj(name, value)"
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,elem = Prop()
271fc68c1852e3764b7c64d71cd28ac3f803ecba,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(HostSystem, self).__init__(""HostSystem"")"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,try:
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,"group_ref = self.db.security_group_create(context, group)"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,except exception.SecurityGroupExists:
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,msg = _('Security group %s already exists') % name
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,self.raise_group_already_exists(msg)
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,security_group_ref.save(session=session)
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,except db_exc.DBDuplicateEntry:
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,raise exception.SecurityGroupExists(
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,"project_id=values['project_id'],"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,security_group_name=values['name'])
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,name = security_group_ref['name']
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,project_id = security_group_ref['project_id']
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,"project_id=project_id,"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,security_group_name=name)
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,added,0,return security_group_ref
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"if self.db.security_group_exists(context,"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"context.project_id, name):"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,msg = _('Security group %s already exists') % name
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,self.raise_group_already_exists(msg)
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"group_ref = self.db.security_group_create(context, group)"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"def security_group_exists(context, project_id, group_name):"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"""""""Indicates if a group name exists in a project."""""""
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"return IMPL.security_group_exists(context, project_id, group_name)"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,security_group_ref.save(session=session)
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,@require_context
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,try:
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,"group = security_group_get_by_name(context, project_id, group_name)"
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,return group is not None
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,except exception.NotFound:
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,return False
231c97007c6290f22807c0d4a605d9d95d4eb3af,9196b74080d5effd8dcfacce9de7d2dd37fcba1b,deleted,1,return security_group_ref
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova import utils
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if CONF.vmware.wsdl_location:
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return CONF.vmware.wsdl_location
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# calculate default WSDL location if no override supplied
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return Vim.get_soap_url(protocol, host_name) + ""/vimService.wsdl"""
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if utils.is_valid_ipv6(host_name):
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return '%s://[%s]/sdk' % (protocol, host_name)"
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,wsdl_url = CONF.vmware.wsdl_location
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if wsdl_url is None:
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# calculate default WSDL location if no override supplied
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"wsdl_url = '%s://%s/sdk/vimService.wsdl' % (protocol, host_name)"
a3815312a4b5bf1a1aff7e81839224c2de572e15,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return wsdl_url
9579ece88962ec86bd54d7930c764105e38f5db6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""fake-ds""):"
9579ece88962ec86bd54d7930c764105e38f5db6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""summary.name"", name)"
9579ece88962ec86bd54d7930c764105e38f5db6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def __init__(self):
9579ece88962ec86bd54d7930c764105e38f5db6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""summary.name"", ""fake-ds"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_object(obj_ref):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get object for the give reference."""""""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return _db_content[obj_ref.type][obj_ref]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _convert_to_array_of_mor(mors):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Wraps the given array into a DataObject."""""""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,array_of_mors = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,array_of_mors.ManagedObjectReference = mors
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return array_of_mors
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_object_refs(obj_type):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get object References of the type."""""""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,lst_objs = []
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for key in _db_content[obj_type]:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,lst_objs.append(key)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return lst_objs
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _update_object(table, table_obj):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Update objects of the type."""""""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_db_content[table][table_obj.obj] = table_obj
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class Prop(object):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""ManagedObject"", value=None):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Managed Object Reference type
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.type = name
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._type = name
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_counter = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, mo_id_prefix=""obj""):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"object.__setattr__(self, 'mo_id', self._generate_moid(mo_id_prefix))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"object.__setattr__(self, 'obj',"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ManagedObjectReference(self.__class__.__name__,"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.mo_id))
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,elem = Prop()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'name': self.__class__.__name__})
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _generate_moid(self, prefix):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Generates a new Managed Object ID."""""""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.__class__._counter += 1
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return prefix + ""-"" + str(self.__class__._counter)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(VirtualMachine, self).__init__(""vm"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""name"", kwargs.get(""name"", 'test-vm'))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds_do = kwargs.get(""ds"", None)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""datastore"", _convert_to_array_of_mor(ds_do))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set('runtime.host', kwargs.get(""runtime_host"", None))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(Network, self).__init__(""network"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""test-rpool""):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(ResourcePool, self).__init__(""rp"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""name"", name)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""test_cluster""):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(ClusterComputeResource, self).__init__(""domain"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""host"", None)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""datastore"", None)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""resourcePool"", None)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numHosts = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numCpuCores = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numCpuThreads = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numEffectiveHosts = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.totalMemory = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.effectiveMemory = 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""summary"", summary)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _add_resource_pool(self, r_pool):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if r_pool:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"r_pools = self.get(""resourcePool"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if r_pools is None:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,r_pools = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,r_pools.ManagedObjectReference = []
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""resourcePool"", r_pools)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,r_pools.ManagedObjectReference.append(r_pool)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _add_host(self, host_sys):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if host_sys:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"hosts = self.get(""host"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if hosts is None:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,hosts = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,hosts.ManagedObjectReference = []
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""host"", hosts)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,hosts.ManagedObjectReference.append(host_sys)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Update summary every time a new host is added
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._update_summary()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _add_datastore(self, datastore):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if datastore:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"datastores = self.get(""datastore"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if datastores is None:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datastores = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datastores.ManagedObjectReference = []
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""datastore"", datastores)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datastores.ManagedObjectReference.append(datastore)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Method to update summary of a cluster upon host addition
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _update_summary(self):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"summary = self.get(""summary"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Compute the aggregate stats
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numHosts = len(hosts.ManagedObjectReference)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for host_ref in hosts.ManagedObjectReference:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_sys = _get_object(host_ref)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"connected = host_sys.get(""connected"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_summary = host_sys.get(""summary"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numCpuCores += host_summary.hardware.numCpuCores
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numCpuThreads += host_summary.hardware.numCpuThreads
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.totalMemory += host_summary.hardware.memorySize
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,free_memory = (host_summary.hardware.memorySize / (1024 * 1024)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,- host_summary.quickStats.overallMemoryUsage)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.effectiveMemory += free_memory if connected else 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,summary.numEffectiveHosts += 1 if connected else 0
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(Datastore, self).__init__(""ds"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""networkSystem""):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(HostNetworkSystem, self).__init__(""ns"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""ha-host"", connected=True):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(HostSystem, self).__init__(""host"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""summary.hardware"", hardware)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""connected"", connected)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""ha-datacenter""):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"super(Datacenter, self).__init__(""dc"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cluster._add_host(_get_object_refs(""HostSystem"")[0])"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cluster._add_datastore(_get_object_refs(""Datastore"")[0])"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,about_info = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"about_info.name = ""VMware vCenter Server"""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"about_info.version = ""5.1.0"""
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,service_content.about = about_info
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds = _db_content[""Datastore""].keys()[0]"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host = _db_content[""HostSystem""].keys()[0]"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""ds"": [ds],"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""runtime_host"": host,"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# data objects of the type in the inventory
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo_refs = _db_content[type]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo_refs = [obj_ref]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for mdo_ref in mdo_refs:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo = _db_content[type][mdo_ref]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,prop_list = []
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for prop_name in properties:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"prop = Prop(prop_name, mdo.get(prop_name))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,prop_list.append(prop)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"obj_content = ObjectContent(mdo.obj, prop_list)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,lst_ret_objs.add_object(obj_content)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class Property(object):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, value=""object-123"", _type=""ManagedObject""):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Managed Object Reference _type
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._type = _type
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, name=""ManagedObject"", obj_ref=None, value=None):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(ManagedObject, self).__setattr__('objName', name)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# A managed object is a local representation of a
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# remote object that you can reference using the
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# object reference.
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if obj_ref is None:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if value is None:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,value = 'obj-123'
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"obj_ref = ManagedObjectReference(value, name)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# we use __setattr__ here because below the
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# default setter has been altered for this class.
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"object.__setattr__(self, 'obj', obj_ref)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,elem = Property()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'name': self.objName})
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(VirtualMachine, self).__init__(""VirtualMachine"", value='vm-10')"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""name"", kwargs.get(""name""))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ds_do = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"ds_do.ManagedObjectReference = [kwargs.get(""ds"").obj]"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""datastore"", ds_do)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set('runtime.host',"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"ManagedObjectReference(value='host-123', _type=""HostSystem""))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(Network, self).__init__(""Network"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def __init__(self):
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(ResourcePool, self).__init__(""ResourcePool"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""name"", ""ResPool"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, **kwargs):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(ClusterComputeResource, self).__init__(""ClusterComputeResource"","
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"value=""domain-test"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,r_pool = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"obj = _get_objects(""ResourcePool"").objects[0].obj"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,r_pool.ManagedObjectReference = [obj]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""resourcePool"", r_pool)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_sys = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"obj = _get_objects(""HostSystem"").objects[0].obj"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_sys.ManagedObjectReference = [obj]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""host"", host_sys)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""name"", ""test_cluster"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,datastore = DataObject()
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"obj = _get_objects(""Datastore"").objects[0].obj"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,datastore.ManagedObjectReference = [obj]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""datastore"", datastore)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(Datastore, self).__init__(""Datastore"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(HostNetworkSystem, self).__init__(""HostNetworkSystem"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""name"", ""networkSystem"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, obj_ref=None, value='host-123'):"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(HostSystem, self).__init__(""HostSystem"", obj_ref, value)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""name"", ""ha-host"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(Datacenter, self).__init__(""Datacenter"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""name"", ""ha-datacenter"")"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"ds = _db_content[""Datastore""][_db_content[""Datastore""].keys()[0]]"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""ds"": ds,"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# dataobjects of the type in the inventory
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for mdo_ref in _db_content[type]:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,mdo = _db_content[type][mdo_ref]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Create a temp Managed object which has the same ref
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# as the parent object and copies just the properties
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# asked for. We need .obj along with the propSet of
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# just the properties asked for
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"temp_mdo = ManagedObject(mdo.objName, mdo.obj)"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for prop in properties:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"temp_mdo.set(prop, mdo.get(prop))"
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_ret_objs.add_object(temp_mdo)
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if obj_ref in _db_content[type]:
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,mdo = _db_content[type][obj_ref]
cf681ca4673160cca8c141e0890664efaaff5b89,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"temp_mdo = ManagedObject(mdo.objName, obj_ref)"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not (self._host_ip or CONF.vmware.host_username is None or
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,CONF.vmware.host_password is None):
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"raise Exception(_(""Must specify host_ip, """
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""host_username """
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""and host_password to use """
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session = VMwareAPISession(scheme=scheme)
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Sets up a session with the VC/ESX host and handles all
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, host_ip=CONF.vmware.host_ip,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"username=CONF.vmware.host_username,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"password=CONF.vmware.host_password,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"retry_count=CONF.vmware.api_retry_count,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"scheme=""https""):"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._host_username = username
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._host_password = password
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._api_retry_count = retry_count
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Creates a session with the VC/ESX host."""""""
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,delay = 1
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Login and setup the session with the host for making
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.critical(_(""Unable to connect to server at %(server)s, """
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""sleeping for %(seconds)s seconds""),"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"{'server': self._host_ip, 'seconds': delay})"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,time.sleep(delay)
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"delay = min(2 * delay, 60)"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# May not have been able to connect to VC, so vim is still None"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if self.vim:
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.vim.Logout(self.vim.get_service_content().sessionManager)
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if retry_count > self._api_retry_count:
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,host_username = CONF.vmware.host_username
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,host_password = CONF.vmware.host_password
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,api_retry_count = CONF.vmware.api_retry_count
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not self._host_ip or host_username is None or host_password is None:
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise Exception(_(""Must specify vmwareapi_host_ip,"""
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""vmwareapi_host_username """
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""and vmwareapi_host_password to use"""
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session = VMwareAPISession(self._host_ip,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"host_username, host_password,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"api_retry_count, scheme=scheme)"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Sets up a session with the ESX host and handles all
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, host_ip, host_username, host_password,"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"api_retry_count, scheme=""https""):"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._host_username = host_username
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._host_password = host_password
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.api_retry_count = api_retry_count
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Creates a session with the ESX host."""""""
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Login and setup the session with the ESX host for making
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.critical(_(""In vmwareapi:_create_session, """
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""got this exception: %s"") % excep)"
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise exception.NovaException(excep)
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.vim.Logout(self.vim.get_service_content().sessionManager)
fc4d28a0095b6944e194d148dc2292739c06de8e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if retry_count > self.api_retry_count:
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if not (self._host_ip or CONF.vmware.host_username is None or
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,CONF.vmware.host_password is None):
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"raise Exception(_(""Must specify host_ip, """
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""host_username """
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""and host_password to use """
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session = VMwareAPISession(scheme=scheme)
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,Sets up a session with the VC/ESX host and handles all
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, host_ip=CONF.vmware.host_ip,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"username=CONF.vmware.host_username,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"password=CONF.vmware.host_password,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"retry_count=CONF.vmware.api_retry_count,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"scheme=""https""):"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._host_username = username
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._host_password = password
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._api_retry_count = retry_count
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Creates a session with the VC/ESX host."""""""
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,delay = 1
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Login and setup the session with the host for making
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.critical(_(""Unable to connect to server at %(server)s, """
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""sleeping for %(seconds)s seconds""),"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"{'server': self._host_ip, 'seconds': delay})"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,time.sleep(delay)
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"delay = min(2 * delay, 60)"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# May not have been able to connect to VC, so vim is still None"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if self.vim:
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.vim.Logout(self.vim.get_service_content().sessionManager)
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if retry_count > self._api_retry_count:
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_username = CONF.vmware.host_username
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_password = CONF.vmware.host_password
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,api_retry_count = CONF.vmware.api_retry_count
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if not self._host_ip or host_username is None or host_password is None:
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"raise Exception(_(""Must specify vmwareapi_host_ip,"""
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""vmwareapi_host_username """
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""and vmwareapi_host_password to use"""
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._session = VMwareAPISession(self._host_ip,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_username, host_password,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"api_retry_count, scheme=scheme)"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,Sets up a session with the ESX host and handles all
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, host_ip, host_username, host_password,"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"api_retry_count, scheme=""https""):"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._host_username = host_username
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._host_password = host_password
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.api_retry_count = api_retry_count
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Creates a session with the ESX host."""""""
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Login and setup the session with the ESX host for making
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.critical(_(""In vmwareapi:_create_session, """
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""got this exception: %s"") % excep)"
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise exception.NovaException(excep)
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.vim.Logout(self.vim.get_service_content().sessionManager)
fc4d28a0095b6944e194d148dc2292739c06de8e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if retry_count > self.api_retry_count:
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"values = {'name': 'fake_name',"
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"'image_ref': ""fake_image_uuid"","
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"'kernel_id': ""fake_kernel_uuid"","
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"'ramdisk_id': ""fake_ramdisk_uuid"","
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_instance_dir_disk_created(self):
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"""""""Test image file isn't cached when use_linked_clone is False."""""""
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_vm()
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,inst_file_path = '[fake-ds] fake-uuid/fake_name.vmdk'
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,cache_file_path = '[fake-ds] vmware_base/fake_image_uuid.vmdk'
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertEqual(vmwareapi_fake.get_file(inst_file_path), True)"
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertEqual(vmwareapi_fake.get_file(cache_file_path), False)"
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_cache_dir_disk_created(self):
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"""""""Test image disk is cached when use_linked_clone is True."""""""
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.flags(use_linked_clone=True, group='vmware')"
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,file_path = '[fake-ds] vmware_base/fake_image_uuid.vmdk'
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertEqual(vmwareapi_fake.get_file(file_path), True)"
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"values = {'name': '1',"
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"'image_ref': ""1"","
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"'kernel_id': ""1"","
b3a012e958a0fcf5b04ba470b194bc03a48673ce,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"'ramdisk_id': ""1"","
022a4da0507924f57b563e7a5a09ea9d01e63c0e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova import utils
022a4da0507924f57b563e7a5a09ea9d01e63c0e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if utils.is_valid_ipv6(host):
022a4da0507924f57b563e7a5a09ea9d01e63c0e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = ""%s://[%s]/folder/%s"" % (scheme, host, file_path)"
022a4da0507924f57b563e7a5a09ea9d01e63c0e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
022a4da0507924f57b563e7a5a09ea9d01e63c0e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = ""%s://%s/folder/%s"" % (scheme, host, file_path)"
022a4da0507924f57b563e7a5a09ea9d01e63c0e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = ""%s://%s/folder/%s"" % (scheme, host, file_path)"
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"elif adapter_type == ""lsiLogicsas"":"
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,virtual_controller = client_factory.create(
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'ns0:VirtualLsiLogicSASController')
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"adapter_type_dict[device.key] = ""lsiLogicsas"""
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_copy_virtual_disk_spec(client_factory, adapter_type=""lsiLogic"","
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,dest_spec.adapterType = get_vmdk_adapter_type(adapter_type)
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,create_vmdk_spec.adapterType = get_vmdk_adapter_type(adapter_type)
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_vmdk_adapter_type(adapter_type):
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Return the adapter type to be used in vmdk descriptor."
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,Adapter type in vmdk descriptor is same for LSI-SAS & LSILogic
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,because Virtual Disk Manager API does not recognize the newer controller
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,types.
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""""""""
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if adapter_type == ""lsiLogicsas"":"
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vmdk_adapter_type = ""lsiLogic"""
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_adapter_type = adapter_type
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return vmdk_adapter_type
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"adapter_type_dict[device.key] = ""lsiLogic"""
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def get_copy_virtual_disk_spec(client_factory, adapter_type=""lsilogic"","
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,dest_spec.adapterType = adapter_type
16a9853fe3924ccaf987b2a1628f27bb9c03b950,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_vmdk_spec.adapterType = adapter_type
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"property_dict = get_dynamic_properties(vim, mobj, type, [property_name])"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return property_dict.get(property_name)
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_dynamic_properties(vim, mobj, type, property_names):"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Gets the specified properties of the Managed Object."""""""
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"obj_content = get_object_properties(vim, None, mobj, type, property_names)"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,property_dict = {}
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,dynamic_properties = obj_content.objects[0].propSet
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if dynamic_properties:
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for prop in dynamic_properties:
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,property_dict[prop.name] = prop.val
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return property_dict
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_about_info(vim):
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get the About Info from the service content."""""""
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return vim.get_service_content().about
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"obj_content = get_object_properties(vim, None, mobj, type, [property_name])"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,property_value = None
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,dynamic_property = obj_content.objects[0].propSet
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if dynamic_property:
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,property_value = dynamic_property[0].val
92983257bb8e19dff54cc8a2188cc692dcafe5b8,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return property_value
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"property_dict = get_dynamic_properties(vim, mobj, type, [property_name])"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return property_dict.get(property_name)
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_dynamic_properties(vim, mobj, type, property_names):"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Gets the specified properties of the Managed Object."""""""
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"obj_content = get_object_properties(vim, None, mobj, type, property_names)"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,property_dict = {}
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dynamic_properties = obj_content.objects[0].propSet
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if dynamic_properties:
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for prop in dynamic_properties:
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,property_dict[prop.name] = prop.val
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return property_dict
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def get_about_info(vim):
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get the About Info from the service content."""""""
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return vim.get_service_content().about
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"obj_content = get_object_properties(vim, None, mobj, type, [property_name])"
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,property_value = None
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dynamic_property = obj_content.objects[0].propSet
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if dynamic_property:
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,property_value = dynamic_property[0].val
92983257bb8e19dff54cc8a2188cc692dcafe5b8,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return property_value
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_get_diagnostics(self):
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Simply tests that the VMwareESXDriver doesn't implement the
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,# get_diagnostics API.
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(NotImplementedError, self.conn.get_diagnostics, None)"
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Tests that the VMwareVCDriver doesn't implement get_diagnostics.
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_instance_in_the_db()
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(NotImplementedError,"
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.conn.get_diagnostics,"
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.instance)
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_diagnostics(self):
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,pass
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_diagnostics_non_existent_vm(self):
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._create_instance_in_the_db()
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertRaises(exception.InstanceNotFound,"
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.conn.get_diagnostics,"
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.instance)
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return self._vmops.get_diagnostics(instance)
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return _vmops.get_diagnostics(instance)
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._vmops.get_info(instance)
db68dc8670fc8943dfc142ebb0f3f1f405c04e4b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return _vmops.get_info(instance)
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Tests that the VMwareESXDriver does not implement the pause method.
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(NotImplementedError, self.conn.pause, instance=None)"
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Tests that the VMwareESXDriver does not implement the unpause method.
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(NotImplementedError, self.conn.unpause,"
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,instance=None)
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_pause(self):
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Tests that the VMwareVCDriver does not implement the pause method.
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_instance_in_the_db()
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.assertRaises(NotImplementedError, self.conn.pause, self.instance)"
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_unpause(self):
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Tests that the VMwareVCDriver does not implement the unpause method.
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.instance)
dced1df98e385ebb0615d3789f67d95add49c637,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,pass
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,try:
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"compute.API().create(self.context, min_count=1, max_count=1,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"instance_type=inst_type, image_href=image_uuid)"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"except exception.QuotaError, e:"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"expected_kwargs = {'code': 413, 'resource': 'cores', 'req': 1,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'used': 4, 'allowed': 4, 'overs': 'cores,instances'}"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.assertEqual(e.kwargs, expected_kwargs)"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,else:
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,self.fail('Expected QuotaError exception')
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'used': 4, 'allowed': 4, 'overs': 'cores'}"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"db.instance_destroy(self.context, instance['uuid'])"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,def test_many_cores_with_unlimited_quota(self):
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,# Setting cores quota to unlimited:
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,self.flags(quota_cores=-1)
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,instance = self._create_instance(cores=4)
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,inst_type = flavors.get_flavor_by_name('m1.small')
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,image_uuid = 'cedef40a-ed67-4d10-800e-17455edce175'
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"sqa_api.quota_reserve(context, self.resources, self.quotas,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.quotas, self.deltas, self.expire, 0, 0)"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"except exception.OverQuota, e:"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"expected_kwargs = {'code': 500,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'usages': {'instances': {'reserved': 0, 'in_use': 4},"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'ram': {'reserved': 0, 'in_use': 10240},"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'fixed_ips': {'reserved': 0, 'in_use': 4},"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'cores': {'reserved': 0, 'in_use': 8}},"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'headroom': {'cores': 2, 'ram': 0, 'fixed_ips': 1,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'instances': 1},"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'overs': ['cores', 'fixed_ips', 'instances', 'ram'],"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'quotas': {'cores': 10, 'ram': 10240,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"'fixed_ips': 5, 'instances': 5}}"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,self.fail('Expected OverQuota failure')
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,def test_quota_reserve_cores_unlimited(self):
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"# Requesting 8 cores, quota_cores set to unlimited:"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"context = self._init_usages(1, 8, 1 * 1024, 1)"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.assertEqual(self.sync_called, set([]))"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[0][""in_use""] = 1"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[0][""reserved""] = 0"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[1][""in_use""] = 8"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[1][""reserved""] = 0"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[2][""in_use""] = 1 * 1024"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[2][""reserved""] = 0"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[3][""in_use""] = 1"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[3][""reserved""] = 0"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.compare_usage(self.usages, self.usages_list)"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.assertEqual(self.usages_created, {})"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.assertEqual(self.reservations_created, {})"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,def test_quota_reserve_ram_unlimited(self):
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"# Requesting 10*1024 ram, quota_ram set to unlimited:"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,self.flags(quota_ram=-1)
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"context = self._init_usages(1, 1, 10 * 1024, 1)"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[1][""in_use""] = 1"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,added,0,"self.usages_list[2][""in_use""] = 10 * 1024"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"self.assertRaises(exception.QuotaError, compute.API().create,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"self.context,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"min_count=1,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"max_count=1,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"instance_type=inst_type,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,image_href=image_uuid)
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"self.assertRaises(exception.OverQuota,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"sqa_api.quota_reserve,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"context, self.resources, self.quotas,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"self.quotas, self.deltas, self.expire,"
30fa37e7776831d6f8022f52d3d92f62189fb702,dff6c134cb5b540ac1344faf9f0cbe7d19a8c9e7,deleted,1,"0, 0)"
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._create_vm()
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,self._test_snapshot()
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,def test_snapshot_using_file_manager(self):
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,uuid_str = uuidutils.generate_uuid()
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.mox.StubOutWithMock(uuidutils,"
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,'generate_uuid')
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,uuidutils.generate_uuid().AndReturn(uuid_str)
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.mox.StubOutWithMock(vmops.VMwareVMOps,"
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,'_delete_datastore_file')
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,# Check calls for delete vmdk and -flat.vmdk pair
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.conn._vmops._delete_datastore_file(
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,"mox.IgnoreArg(),"
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,"""[fake-ds] vmware-tmp/%s-flat.vmdk"" % uuid_str,"
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,mox.IgnoreArg()).AndReturn(None)
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,"""[fake-ds] vmware-tmp/%s.vmdk"" % uuid_str,"
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.mox.ReplayAll()
7910385825ccfa705785af360fcd5717656e3557,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._create_vm()
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.openstack.common import uuidutils
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session = uuidutils.generate_uuid()
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,import uuid
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._session = str(uuid.uuid4())
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif attr_name == ""DeleteVirtualDisk_Task"":"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return lambda *args, **kwargs: self._delete_disk(attr_name,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"*args, **kwargs)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.openstack.common import uuidutils
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _extend_virtual_disk(self, instance, requested_size, name, dc_ref):"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"datacenter=dc_ref,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _delete_datastore_file(self, instance, datastore_path, dc_ref):"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Deleting the datastore file %s"") % datastore_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance=instance)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vim = self._session._get_vim()
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,file_delete_task = self._session._call_method(
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._get_vim(),"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""DeleteDatastoreFile_Task"","
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vim.get_service_content().fileManager,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=datastore_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,datacenter=dc_ref)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._wait_for_task(instance['uuid'],"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,file_delete_task)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Deleted the datastore file""), instance=instance)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._delete_datastore_file(instance,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"flat_uploaded_vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_ref)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sparse_uploaded_vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,random_name = uuidutils.generate_uuid()
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dest_vmdk_file_path = vm_util.build_datastore_path(datastore_name,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dest_vmdk_data_file_path = vm_util.build_datastore_path(datastore_name,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""vmware-tmp/%s-flat.vmdk"" % random_name)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"destName=dest_vmdk_file_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# The data file is the one occupying space, and likelier to see"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# deletion problems, so prioritize its deletion first. In the"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# unlikely event that its deletion fails, the small descriptor file"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# is retained too by design since it makes little sense to remove
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# it when the data disk it refers to still lingers.
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for f in dest_vmdk_data_file_path, dest_vmdk_file_path:"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._delete_datastore_file(instance, f, dc_ref)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import uuid
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _extend_virtual_disk(self, instance, requested_size, name,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,datacenter):
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"datacenter=datacenter,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _delete_disk_file(vmdk_path):
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Deleting the file %(vmdk_path)s """
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""on the ESX host local"""
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""store %(data_store_name)s"") %"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"{""vmdk_path"": vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""data_store_name"": data_store_name},"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance=instance)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Delete the vmdk file.
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmdk_delete_task = self._session._call_method(
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._get_vim(),"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""DeleteDatastoreFile_Task"","
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"service_content.fileManager,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"name=vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,datacenter=dc_ref)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._wait_for_task(instance['uuid'], vmdk_delete_task)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Deleted the file %(vmdk_path)s on the """
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""ESX host local store %(data_store_name)s"") %"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_delete_disk_file(flat_uploaded_vmdk_path)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_delete_disk_file(sparse_uploaded_vmdk_path)
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,random_name = str(uuid.uuid4())
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dest_vmdk_file_location = vm_util.build_datastore_path(datastore_name,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"destName=dest_vmdk_file_location,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Delete the temporary vmdk created above.
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Deleting temporary vmdk file %s"")"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"% dest_vmdk_file_location, instance=instance)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,remove_disk_task = self._session._call_method(
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""DeleteVirtualDisk_Task"","
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"service_content.virtualDiskManager,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"name=dest_vmdk_file_location,"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._wait_for_task(instance['uuid'], remove_disk_task)"
7910385825ccfa705785af360fcd5717656e3557,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Deleted temporary vmdk file %s"")"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.openstack.common import uuidutils
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _extend_virtual_disk(self, instance, requested_size, name, dc_ref):"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"datacenter=dc_ref,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _delete_datastore_file(self, instance, datastore_path, dc_ref):"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Deleting the datastore file %s"") % datastore_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,instance=instance)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vim = self._session._get_vim()
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,file_delete_task = self._session._call_method(
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._get_vim(),"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""DeleteDatastoreFile_Task"","
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vim.get_service_content().fileManager,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"name=datastore_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datacenter=dc_ref)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session._wait_for_task(instance['uuid'],"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,file_delete_task)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Deleted the datastore file""), instance=instance)"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._delete_datastore_file(instance,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"flat_uploaded_vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,dc_ref)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"sparse_uploaded_vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,random_name = uuidutils.generate_uuid()
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"dest_vmdk_file_path = vm_util.build_datastore_path(datastore_name,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"dest_vmdk_data_file_path = vm_util.build_datastore_path(datastore_name,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""vmware-tmp/%s-flat.vmdk"" % random_name)"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"destName=dest_vmdk_file_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# The data file is the one occupying space, and likelier to see"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# deletion problems, so prioritize its deletion first. In the"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# unlikely event that its deletion fails, the small descriptor file"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# is retained too by design since it makes little sense to remove
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# it when the data disk it refers to still lingers.
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"for f in dest_vmdk_data_file_path, dest_vmdk_file_path:"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._delete_datastore_file(instance, f, dc_ref)"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,import uuid
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _extend_virtual_disk(self, instance, requested_size, name,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,datacenter):
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"datacenter=datacenter,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _delete_disk_file(vmdk_path):
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleting the file %(vmdk_path)s """
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""on the ESX host local"""
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""store %(data_store_name)s"") %"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"{""vmdk_path"": vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""data_store_name"": data_store_name},"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,instance=instance)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Delete the vmdk file.
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmdk_delete_task = self._session._call_method(
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._session._get_vim(),"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""DeleteDatastoreFile_Task"","
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"service_content.fileManager,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"name=vmdk_path,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,datacenter=dc_ref)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._session._wait_for_task(instance['uuid'], vmdk_delete_task)"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleted the file %(vmdk_path)s on the """
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""ESX host local store %(data_store_name)s"") %"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_delete_disk_file(flat_uploaded_vmdk_path)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_delete_disk_file(sparse_uploaded_vmdk_path)
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,random_name = str(uuid.uuid4())
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"dest_vmdk_file_location = vm_util.build_datastore_path(datastore_name,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"destName=dest_vmdk_file_location,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Delete the temporary vmdk created above.
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleting temporary vmdk file %s"")"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"% dest_vmdk_file_location, instance=instance)"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,remove_disk_task = self._session._call_method(
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""DeleteVirtualDisk_Task"","
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"service_content.virtualDiskManager,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"name=dest_vmdk_file_location,"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self._session._wait_for_task(instance['uuid'], remove_disk_task)"
7910385825ccfa705785af360fcd5717656e3557,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleted temporary vmdk file %s"")"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def reset(vc=False):
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,cleanup()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds_ref1 = create_datastore('ds1', 1024, 500)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if vc:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,create_host()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds_ref2 = create_datastore('ds2', 1024, 500)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"create_datacenter('dc1', ds_ref1)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"create_datacenter('dc2', ds_ref2)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"create_cluster('test_cluster', ds_ref1)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"create_cluster('test_cluster2', ds_ref2)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# We fake the datastore by keeping the file references as a list of
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# names in the db
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if c == 'files':
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_db_content[c] = []
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_db_content[c] = {}
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""fake-ds"", capacity=1024, free=500):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""summary.capacity"", capacity * unit.Gi)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""summary.freeSpace"", free * unit.Gi)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, name=""ha-datacenter"", ds_ref=None):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datastore = DataObject()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,datastore.ManagedObjectReference = [ds_ref]
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""datastore"", datastore)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def create_datacenter(name, ds_ref=None):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"data_center = Datacenter(name, ds_ref)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def create_datastore(name, capacity, free):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"data_store = Datastore(name, capacity, free)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return data_store.obj
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def create_cluster(name, ds_ref):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,cluster._add_datastore(ds_ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def reset():
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for c in _CLASSES:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# We fake the datastore by keeping the file references as a list of
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# names in the db
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if c == 'files':
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_db_content[c] = []
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,else:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_db_content[c] = {}
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_host()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_datacenter()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_datastore()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_cluster('test_cluster')
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,create_cluster('test_cluster2')
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, name=""fake-ds""):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""summary.capacity"", unit.Ti)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""summary.freeSpace"", 500 * unit.Gi)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, name=""ha-datacenter""):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def create_datacenter():
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,data_center = Datacenter()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def create_datastore():
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,data_store = Datastore()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def create_cluster(name):
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cluster._add_datastore(_get_object_refs(""Datastore"")[0])"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,import collections
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"DcInfo = collections.namedtuple('DcInfo',"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"['ref', 'name', 'vmFolder'])"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._datastore_dc_mapping = {}
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_info = self.get_datacenter_ref_and_name(data_store_ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""CreateVM_Task"", dc_info.vmFolder,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"datacenter=dc_info.ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"data_center_name=dc_info.name,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sourceDatacenter=dc_info.ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_info.ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"root_vmdk_path, dc_info.ref)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dc_info.name,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"data_store_name, dc_name, upload_folder, cookies):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""vmware-tmp""),"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return ds_ref
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_ref = _check_if_tmp_folder_exists()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_info = self.get_datacenter_ref_and_name(ds_ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"destDatacenter=dc_info.ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._delete_datastore_file(instance, f, dc_info.ref)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"lst_properties = [""config.files.vmPathName"", ""runtime.powerState"","
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""datastore""]"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'config.files.vmPathName': None,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'datastore': None}
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_ref_ret = query['datastore']
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_ref = ds_ref_ret.ManagedObjectReference[0]
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,datacenter=dc_info.ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"folder=dc_info.vmFolder,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_datacenter_ref_and_name(self, ds_ref):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,map = self._datastore_dc_mapping.get(ds_ref.value)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not map:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dc_obj = self._session._call_method(vim_util, ""get_objects"","
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Datacenter"", [""name""])"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_util._cancel_retrieve_if_necessary(self._session, dc_obj)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"map = DcInfo(ref=dc_obj.objects[0].obj,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=dc_obj.objects[0].propSet[0].val,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmFolder=self._get_vmfolder_ref())
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._datastore_dc_mapping[ds_ref.value] = map
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return map
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _mkdir(self, ds_path, ds_ref):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=ds_path, datacenter=dc_info.ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._mkdir(vm_util.build_datastore_path(ds_name, folder_name),"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _update_datacenter_cache_from_objects(self, dcs):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Updates the datastore/datacenter cache."""""""
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,while dcs:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,token = vm_util._get_token(dcs)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for dco in dcs.objects:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,name = None
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmFolder = None
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_ref = dco.obj
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_refs = []
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for p in dco.propSet:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if p.name == 'name':
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,name = p.val
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if p.name == 'datastore':
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,datastore_refs = p.val.ManagedObjectReference
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for ds in datastore_refs:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_refs.append(ds.value)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if p.name == 'vmFolder':
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vmFolder = p.val
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for ds_ref in ds_refs:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._datastore_dc_mapping[ds_ref] = DcInfo(ref=dc_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=name, vmFolder=vmFolder)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if token:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dcs = self._session._call_method(vim_util,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""continue_to_get_objects"","
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,token)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,break
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Get the datacenter name and the reference."""""""
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,dc_info = self._datastore_dc_mapping.get(ds_ref.value)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not dc_info:
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"dcs = self._session._call_method(vim_util, ""get_objects"","
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""Datacenter"", [""name"", ""datastore"", ""vmFolder""])"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._update_datacenter_cache_from_objects(dcs)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return dc_info
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_folder_ref = self._get_vmfolder_ref()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""CreateVM_Task"", vm_folder_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"datacenter=dc_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"data_center_name=self._get_datacenter_ref_and_name()[1],"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"sourceDatacenter=self._get_datacenter_ref_and_name()[0],"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dc_ref = self._get_datacenter_ref_and_name()[0]
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dc_ref)
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"root_vmdk_path, dc_ref)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"sourceDatacenter=dc_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"data_store_name, upload_folder, cookies):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dc_name = self._get_datacenter_ref_and_name()[1]
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""vmware-tmp""))"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_check_if_tmp_folder_exists()
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"destDatacenter=dc_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._delete_datastore_file(instance, f, dc_ref)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"lst_properties = [""config.files.vmPathName"", ""runtime.powerState""]"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'config.files.vmPathName': None}
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,datacenter=self._get_datacenter_ref_and_name()[0])
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"folder=vm_folder_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_datacenter_ref_and_name(self):
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dc_obj = self._session._call_method(vim_util, ""get_objects"","
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""Datacenter"", [""name""])"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_util._cancel_retrieve_if_necessary(self._session, dc_obj)"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return dc_obj.objects[0].obj, dc_obj.objects[0].propSet[0].val"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _mkdir(self, ds_path):"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"name=ds_path, datacenter=dc_ref,"
a25b2ac5f440f7ace4678b21ada6ebf5ce5dff3c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._mkdir(vm_util.build_datastore_path(ds_name, folder_name))"
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if hasattr(self, 'vim') and self.vim:"
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.vim.Logout(self.vim.get_service_content().sessionManager)
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Logout to avoid un-necessary increase in session count at the
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# ESX host
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,try:
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# May not have been able to connect to VC, so vim is still None"
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if self.vim:
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.vim.Logout(self.vim.get_service_content().sessionManager)
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,except Exception as excep:
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# It is just cautionary on our part to do a logout in del just
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# to ensure that the session is not left active.
be5d39eacc84c11f96357a624ffa1cdeda8a568d,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG.debug(excep)
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(self, 'vim') and self.vim:"
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.vim.Logout(self.vim.get_service_content().sessionManager)
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Logout to avoid un-necessary increase in session count at the
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# ESX host
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,try:
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"# May not have been able to connect to VC, so vim is still None"
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if self.vim:
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.vim.Logout(self.vim.get_service_content().sessionManager)
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,except Exception as excep:
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# It is just cautionary on our part to do a logout in del just
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# to ensure that the session is not left active.
be5d39eacc84c11f96357a624ffa1cdeda8a568d,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG.debug(excep)
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_ref_ret = self._session._call_method(
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vim_util, ""get_dynamic_property"", vm_ref, ""VirtualMachine"","
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""datastore"")"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ds_browser = self._session._call_method(
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vim_util, ""get_dynamic_property"", ds_ref, ""Datastore"","
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""browser"")"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vim_util, ""get_dynamic_property"", ds_ref, ""Datastore"", ""browser"")"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ds_ref_ret = vim_util.get_dynamic_property(
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._get_vim(),"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_ref,"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""VirtualMachine"","
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""datastore"")"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ds_browser = vim_util.get_dynamic_property(
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"ds_ref,"
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""Datastore"","
c47b4f388cb40d5792a206ac42ebdaebd5bde0d1,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""browser"")"
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_vm_create_spec(client_factory, instance, name, data_store_name,"
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,config_spec.name = name
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_vmdk_volume_disk(hardware_devices, path=None):"
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if not path or path == device.backing.fileName:
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return device
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def get_vm_create_spec(client_factory, instance, data_store_name,"
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,config_spec.name = instance['uuid']
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def get_vmdk_volume_disk(hardware_devices):
88861df2b95a9c66a1a9d1969ad9e560786bb848,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return device
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,TIME_BETWEEN_API_CALL_RETRIES = 1.0
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session = None
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if self._session:
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,sessionId=[self._session.key])
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session = session
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _session_is_active(self):
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,active = False
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,try:
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,active = self.vim.SessionIsActive(
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.vim.get_service_content().sessionManager,"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"sessionID=self._session.key,"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,userName=self._session.userName)
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,except Exception as e:
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.warning(_(""Unable to validate session %s!""),"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session.key)
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return active
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# way to differentiate. We thus check if the session is
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# active
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if self._session_is_active():
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.warning(_(""Session %s is inactive!""),"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,except error_util.SessionConnectionException as excep:
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# For exceptions with connections we create the session
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,exc = excep
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._create_session()
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.critical(_(""In vmwareapi: _call_method (session=%s)""),"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._session.key, exc_info=True)"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,TIME_BETWEEN_API_CALL_RETRIES = 2.0
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._session_id = None
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if self._session_id:
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,sessionId=[self._session_id])
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._session_id = session.key
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,last_fault_list = []
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# way to differentiate.
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# So if the previous response was also am empty response
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"# and after creating a new session, we get the same empty"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"# response, then we are sure of the response being supposed"
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# to be empty.
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if error_util.FAULT_NOT_AUTHENTICATED in last_fault_list:
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,last_fault_list = excep.fault_list
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.critical(_(""In vmwareapi:_call_method, """
55296828a7d7a03736a21d846da15571ca22ec9e,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""got this exception: %s"") % exc)"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,TIME_BETWEEN_API_CALL_RETRIES = 1.0
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session = None
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if self._session:
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,sessionId=[self._session.key])
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session = session
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _session_is_active(self):
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,active = False
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,try:
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,active = self.vim.SessionIsActive(
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.vim.get_service_content().sessionManager,"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"sessionID=self._session.key,"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,userName=self._session.userName)
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,except Exception as e:
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.warning(_(""Unable to validate session %s!""),"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session.key)
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return active
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# way to differentiate. We thus check if the session is
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# active
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if self._session_is_active():
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.warning(_(""Session %s is inactive!""),"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,except error_util.SessionConnectionException as excep:
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# For exceptions with connections we create the session
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,exc = excep
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._create_session()
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.critical(_(""In vmwareapi: _call_method (session=%s)""),"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session.key, exc_info=True)"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,TIME_BETWEEN_API_CALL_RETRIES = 2.0
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._session_id = None
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if self._session_id:
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,sessionId=[self._session_id])
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._session_id = session.key
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,last_fault_list = []
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# way to differentiate.
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# So if the previous response was also am empty response
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# and after creating a new session, we get the same empty"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# response, then we are sure of the response being supposed"
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# to be empty.
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if error_util.FAULT_NOT_AUTHENTICATED in last_fault_list:
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,last_fault_list = excep.fault_list
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.critical(_(""In vmwareapi:_call_method, """
55296828a7d7a03736a21d846da15571ca22ec9e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""got this exception: %s"") % exc)"
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_vmdk_path_and_adapter_type(hardware_devices, uuid=None):"
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if uuid:
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if uuid in device.backing.fileName:
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_file_path = device.backing.fileName
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def get_vmdk_path_and_adapter_type(hardware_devices):
9ceee09594cd35c264cab3e3b3d1d80aaa3fdbc4,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmdk_file_path = device.backing.fileName
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _stop_loop(self, loop):"
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,loop.stop()
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,try:
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ret_val = done.wait()
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,except Exception:
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,finally:
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._stop_loop(loop)
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ret_val = done.wait()
1c1570ff7ac8470d7dba28c893300835b22e0966,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,loop.stop()
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, controllerKey=0, unitNumber=0):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.controllerKey = controllerKey
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.unitNumber = unitNumber
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class VirtualIDEController(DataObject):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, key=0):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.key = key
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, key=0, scsiCtlrUnitNumber=0):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.scsiCtlrUnitNumber = scsiCtlrUnitNumber
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,controller_key = val.deviceChange[0].device.controllerKey
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,filename = val.deviceChange[0].device.backing.fileName
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def __init__(self):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.unitNumber = 0
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,pass
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,controller_key = val.deviceChange[1].device.controllerKey
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,filename = val.deviceChange[1].device.backing.fileName
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return (vmdk_file_path, adapter_type, disk_type)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _find_controller_slot(controller_keys, taken, max_unit_number):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for controller_key in controller_keys:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for unit_number in range(max_unit_number):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if not unit_number in taken.get(controller_key, []):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return controller_key, unit_number"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _is_ide_controller(device):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return device.__class__.__name__ == 'VirtualIDEController'
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _is_scsi_controller(device):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return device.__class__.__name__ in ['VirtualLsiLogicController',"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'VirtualLsiLogicSASController',"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'VirtualBusLogicController']
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _find_allocated_slots(devices):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""""""""
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Return dictionary which maps controller_key to list of allocated unit
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,numbers for that controller_key.
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,taken = {}
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for device in devices:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if hasattr(device, 'controllerKey') and hasattr(device, 'unitNumber'):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"unit_numbers = taken.setdefault(device.controllerKey, [])"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,unit_numbers.append(device.unitNumber)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if _is_scsi_controller(device):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# the SCSI controller sits on its own bus
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"unit_numbers = taken.setdefault(device.key, [])"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,unit_numbers.append(device.scsiCtlrUnitNumber)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return taken
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def allocate_controller_key_and_unit_number(client_factory, devices,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_type):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,This function inspects the current set of hardware devices and returns
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,controller_key and unit_number that can be used for attaching a new virtual
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,disk to adapter with the given adapter_type.
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if devices.__class__.__name__ == ""ArrayOfVirtualDevice"":"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,devices = devices.VirtualDevice
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,taken = _find_allocated_slots(devices)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ret = None
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if adapter_type == 'ide':
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,ide_keys = [dev.key for dev in devices if _is_ide_controller(dev)]
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ret = _find_controller_slot(ide_keys, taken, 2)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"elif adapter_type in ['lsiLogic', 'lsiLogicsas', 'busLogic']:"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,scsi_keys = [dev.key for dev in devices if _is_scsi_controller(dev)]
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"ret = _find_controller_slot(scsi_keys, taken, 16)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if ret:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return ret[0], ret[1], None"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# create new controller with the specified type and return its spec
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,controller_key = -101
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"controller_spec = create_controller_spec(client_factory, controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_type)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return controller_key, 0, controller_spec"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_type=""lsiLogic"","
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# The controller Key pertains to the Key of the LSI Logic Controller, which"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# controls this Hard Disk
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# For IDE devices, there are these two default controllers created in the"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# VM having keys 200 and 201
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if controller_key is None:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if adapter_type == ""ide"":"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,controller_key = 200
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,else:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,controller_key = -101
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"controller_spec = create_controller_spec(client_factory,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,device_config_spec.append(controller_spec)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unit_number = 0
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if device.unitNumber > unit_number:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unit_number = device.unitNumber
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return (vmdk_file_path, vmdk_controller_key, adapter_type,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"disk_type, unit_number)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return (vmdk_file_path, adapter_type, disk_type)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _find_controller_slot(controller_keys, taken, max_unit_number):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for controller_key in controller_keys:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for unit_number in range(max_unit_number):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if not unit_number in taken.get(controller_key, []):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return controller_key, unit_number"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _is_ide_controller(device):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return device.__class__.__name__ == 'VirtualIDEController'
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _is_scsi_controller(device):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return device.__class__.__name__ in ['VirtualLsiLogicController',"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"'VirtualLsiLogicSASController',"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,'VirtualBusLogicController']
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _find_allocated_slots(devices):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""""""""
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,Return dictionary which maps controller_key to list of allocated unit
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,numbers for that controller_key.
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,taken = {}
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for device in devices:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(device, 'controllerKey') and hasattr(device, 'unitNumber'):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"unit_numbers = taken.setdefault(device.controllerKey, [])"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,unit_numbers.append(device.unitNumber)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if _is_scsi_controller(device):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# the SCSI controller sits on its own bus
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"unit_numbers = taken.setdefault(device.key, [])"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,unit_numbers.append(device.scsiCtlrUnitNumber)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return taken
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def allocate_controller_key_and_unit_number(client_factory, devices,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,adapter_type):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,This function inspects the current set of hardware devices and returns
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,controller_key and unit_number that can be used for attaching a new virtual
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,disk to adapter with the given adapter_type.
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if devices.__class__.__name__ == ""ArrayOfVirtualDevice"":"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,devices = devices.VirtualDevice
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,taken = _find_allocated_slots(devices)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ret = None
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if adapter_type == 'ide':
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ide_keys = [dev.key for dev in devices if _is_ide_controller(dev)]
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ret = _find_controller_slot(ide_keys, taken, 2)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"elif adapter_type in ['lsiLogic', 'lsiLogicsas', 'busLogic']:"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,scsi_keys = [dev.key for dev in devices if _is_scsi_controller(dev)]
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ret = _find_controller_slot(scsi_keys, taken, 16)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if ret:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return ret[0], ret[1], None"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# create new controller with the specified type and return its spec
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,controller_key = -101
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"controller_spec = create_controller_spec(client_factory, controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,adapter_type)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return controller_key, 0, controller_spec"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"adapter_type=""lsiLogic"","
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"# The controller Key pertains to the Key of the LSI Logic Controller, which"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# controls this Hard Disk
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"# For IDE devices, there are these two default controllers created in the"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# VM having keys 200 and 201
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if controller_key is None:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if adapter_type == ""ide"":"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,controller_key = 200
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,else:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,controller_key = -101
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"controller_spec = create_controller_spec(client_factory,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,device_config_spec.append(controller_spec)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,unit_number = 0
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if device.unitNumber > unit_number:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,unit_number = device.unitNumber
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return (vmdk_file_path, vmdk_controller_key, adapter_type,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"disk_type, unit_number)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,uploaded_iso_path)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"datastore, file_path):"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"devices = self._session._call_method(vim_util,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""get_dynamic_property"", vm_ref,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualMachine"", ""config.hardware.device"")"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(controller_key, unit_number,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,controller_spec) = vm_util.allocate_controller_key_and_unit_number(
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"client_factory,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"devices,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'ide')
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,cdrom_attach_config_spec = vm_util.get_cdrom_attach_config_spec(
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"controller_key, unit_number)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if controller_spec:
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,cdrom_attach_config_spec.deviceChange.append(controller_spec)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,spec=cdrom_attach_config_spec)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"hw_devices = self._session._call_method(vim_util,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(vmdk_file_path_before_snapshot, adapter_type,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,disk_type) = vm_util.get_vmdk_path_and_adapter_type(
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"hw_devices, uuid=instance['uuid'])"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"(vmdk_path, adapter_type,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_type, disk_type, vmdk_path)"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"uploaded_iso_path,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,1 if adapter_type in ['ide'] else 0)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"datastore, file_path,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cdrom_unit_number):
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmdk_attach_config_spec = vm_util.get_cdrom_attach_config_spec(
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cdrom_unit_number)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,spec=vmdk_attach_config_spec)
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"hardware_devices = self._session._call_method(vim_util,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(vmdk_file_path_before_snapshot, controller_key, adapter_type,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"disk_type, unit_number) = vm_util.get_vmdk_path_and_adapter_type("
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"hardware_devices, uuid=instance['uuid'])"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(vmdk_path, controller_key, adapter_type, disk_type,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unit_number) = vm_util.get_vmdk_path_and_adapter_type(
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Figure out the correct unit number
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unit_number = unit_number + 1
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_type, disk_type, vmdk_path,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"controller_key=controller_key,"
ecdc5728ca849fd19d01c2a69cf07bf0989e8567,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unit_number=unit_number)
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _convert_to_array_of_opt_val(optvals):
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Wraps the given array into a DataObject."""""""
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,array_of_optv = DataObject()
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,array_of_optv.OptionValue = optvals
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return array_of_optv
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"exconfig_do = kwargs.get(""extra_config"", None)"
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""config.extraConfig"","
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_convert_to_array_of_opt_val(exconfig_do))
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if exconfig_do:
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for optval in exconfig_do:
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set('config.extraConfig[""%s""]' % optval.key, optval)"
f024b5f9fa0c6b772c597298792b94d01c075384,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""config.extraConfig"", kwargs.get(""extra_config"", None))"
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Creating directory with path %s""), ds_path)"
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,try:
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session._call_method(
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._get_vim(), ""MakeDirectory"","
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Created directory with path %s""), ds_path)"
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,except error_util.FileAlreadyExistsException:
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Multiple processes/threads are trying to create """
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""directory %(ds_path)s on %(ds)s.""),"
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"{'ds_path': ds_path, 'ds': dc_info.name})"
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Creating directory with path %s"") % ds_path)"
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._call_method(self._session._get_vim(), ""MakeDirectory"","
743b74d59d3279478c512a0a559642b1d05284bc,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Created directory with path %s"") % ds_path)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _create_vm_snapshot(self, instance, vm_ref):"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Creating Snapshot of the VM instance""), instance=instance)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,snapshot_task = self._session._call_method(
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._session._get_vim(),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""CreateSnapshot_Task"", vm_ref,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"name=""%s-snapshot"" % instance['uuid'],"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"description=""Taking Snapshot of the VM"","
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"memory=False,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,quiesce=True)
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session._wait_for_task(snapshot_task)
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Created Snapshot of the VM instance""), instance=instance)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"task_info = self._session._call_method(vim_util,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""get_dynamic_property"","
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"snapshot_task, ""Task"", ""info"")"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,snapshot = task_info.result
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return snapshot
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _delete_vm_snapshot(self, instance, vm_ref, snapshot):"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Deleting Snapshot of the VM instance""), instance=instance)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,delete_snapshot_task = self._session._call_method(
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""RemoveSnapshot_Task"", snapshot,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"removeChildren=False, consolidate=True)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session._wait_for_task(delete_snapshot_task)
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Deleted Snapshot of the VM instance""), instance=instance)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"snapshot = self._create_vm_snapshot(instance, vm_ref)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Consolidate the snapshotted disk to a temporary vmdk.
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_('Copying snapshotted disk %s.'),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vmdk_file_path_before_snapshot,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_('Copied snapshotted disk %s.'),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Note(vui): handle snapshot cleanup on exceptions.
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._delete_vm_snapshot(instance, vm_ref, snapshot)"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _create_vm_snapshot():
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Create a snapshot of the VM
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Creating Snapshot of the VM instance""),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance=instance)
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,snapshot_task = self._session._call_method(
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._session._get_vim(),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""CreateSnapshot_Task"", vm_ref,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"name=""%s-snapshot"" % instance['uuid'],"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"description=""Taking Snapshot of the VM"","
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"memory=False,"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,quiesce=True)
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._session._wait_for_task(snapshot_task)
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Created Snapshot of the VM instance""),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_create_vm_snapshot()
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# Copy the contents of the disk (or disks, if there were snapshots"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# done earlier) to a temporary vmdk file.
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_('Copying disk data before snapshot of the VM'),"
c91842af547f9d70ac2a538477d89da1e3efafa9,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(_(""Copied disk data before snapshot of the VM""),"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,lst_vm_names = self._get_valid_vms_from_retrieve_result(vms)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _get_valid_vms_from_retrieve_result(self, retrieve_result):"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Returns list of valid vms from RetrieveResult object."""""""
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,lst_vm_names = []
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,while retrieve_result:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,token = vm_util._get_token(retrieve_result)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for vm in retrieve_result.objects:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_name = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,conn_state = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for prop in vm.propSet:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if prop.name == ""name"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_name = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"elif prop.name == ""runtime.connectionState"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,conn_state = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Ignoring the orphaned or inaccessible VMs
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if conn_state not in [""orphaned"", ""inaccessible""]:"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,lst_vm_names.append(vm_name)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if token:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"retrieve_result = self._session._call_method(vim_util,"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""continue_to_get_objects"","
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,token)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,break
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return lst_vm_names
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def list_instances(self):
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Lists the VM instances that are registered with vCenter cluster."""""""
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"properties = ['name', 'runtime.connectionState']"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Getting list of instances from cluster %s""),"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._cluster)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vms = []
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,root_res_pool = self._session._call_method(
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vim_util, ""get_dynamic_property"", self._cluster,"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"'ClusterComputeResource', 'resourcePool')"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if root_res_pool:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vms = self._session._call_method(
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vim_util, 'get_inner_objects', root_res_pool, 'vm',"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"'VirtualMachine', properties)"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(_(""Got total of %s instances"") % str(len(lst_vm_names)))"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_vm_names = []
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,while vms:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,token = vm_util._get_token(vms)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for vm in vms.objects:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_name = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,conn_state = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for prop in vm.propSet:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if prop.name == ""name"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_name = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif prop.name == ""runtime.connectionState"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,conn_state = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Ignoring the orphaned or inaccessible VMs
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if conn_state not in [""orphaned"", ""inaccessible""]:"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_vm_names.append(vm_name)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if token:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vms = self._session._call_method(vim_util,"
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""continue_to_get_objects"","
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,token)
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,else:
923c38c51fcd858daa4e909121d0142bd1fc3f08,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,break
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,lst_vm_names = self._get_valid_vms_from_retrieve_result(vms)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_valid_vms_from_retrieve_result(self, retrieve_result):"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Returns list of valid vms from RetrieveResult object."""""""
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,lst_vm_names = []
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,while retrieve_result:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,token = vm_util._get_token(retrieve_result)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for vm in retrieve_result.objects:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vm_name = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,conn_state = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,for prop in vm.propSet:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if prop.name == ""name"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vm_name = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"elif prop.name == ""runtime.connectionState"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,conn_state = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Ignoring the orphaned or inaccessible VMs
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"if conn_state not in [""orphaned"", ""inaccessible""]:"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,lst_vm_names.append(vm_name)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if token:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"retrieve_result = self._session._call_method(vim_util,"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""continue_to_get_objects"","
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,token)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,break
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return lst_vm_names
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def list_instances(self):
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Lists the VM instances that are registered with vCenter cluster."""""""
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"properties = ['name', 'runtime.connectionState']"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Getting list of instances from cluster %s""),"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._cluster)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vms = []
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,root_res_pool = self._session._call_method(
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vim_util, ""get_dynamic_property"", self._cluster,"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'ClusterComputeResource', 'resourcePool')"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if root_res_pool:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vms = self._session._call_method(
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vim_util, 'get_inner_objects', root_res_pool, 'vm',"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'VirtualMachine', properties)"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.debug(_(""Got total of %s instances"") % str(len(lst_vm_names)))"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,lst_vm_names = []
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,while vms:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,token = vm_util._get_token(vms)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for vm in vms.objects:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_name = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,conn_state = None
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for prop in vm.propSet:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if prop.name == ""name"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vm_name = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif prop.name == ""runtime.connectionState"":"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,conn_state = prop.val
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Ignoring the orphaned or inaccessible VMs
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if conn_state not in [""orphaned"", ""inaccessible""]:"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,lst_vm_names.append(vm_name)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if token:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vms = self._session._call_method(vim_util,"
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""continue_to_get_objects"","
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,token)
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,else:
923c38c51fcd858daa4e909121d0142bd1fc3f08,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,break
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(val, 'name') and val.name:"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""name"", val.name)"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(val, 'extraConfig'):"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,extraConfigs = _merge_extraconfig(
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.get(""config.extraConfig"").OptionValue,"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,val.extraConfig)
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.get(""config.extraConfig"").OptionValue = extraConfigs"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(val, 'instanceUuid') and val.instanceUuid is not None:"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if val.instanceUuid == """":"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,val.instanceUuid = uuidutils.generate_uuid()
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""summary.config.instanceUuid"", val.instanceUuid)"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,pass
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _merge_extraconfig(existing, changes):"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Imposes the changes in extraConfig over the existing extraConfig."""""""
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,existing = existing or []
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if (changes):
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for c in changes:
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if len([x for x in existing if x.key == c.key]) > 0:
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,extraConf = [x for x in existing if x.key == c.key][0]
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,extraConf.value = c.value
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,existing.append(c)
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return existing
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Creates and registers a VM object with the Host System."""""""
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,source_vmref = args[0]
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,source_vm_mdo = _get_vm_mdo(source_vmref)
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"clone_spec = kwargs.get(""spec"")"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"ds = _db_content[""Datastore""].keys()[0]"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host = _db_content[""HostSystem""].keys()[0]"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_dict = {
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""name"": kwargs.get(""name""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""ds"": source_vm_mdo.get(""datastore""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""runtime_host"": source_vm_mdo.get(""runtime.host""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""powerstate"": source_vm_mdo.get(""runtime.powerState""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""vmPathName"": source_vm_mdo.get(""config.files.vmPathName""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""numCpu"": source_vm_mdo.get(""summary.config.numCpu""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""mem"": source_vm_mdo.get(""summary.config.memorySizeMB""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""extra_config"": source_vm_mdo.get(""config.extraConfig"").OptionValue,"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""virtual_device"": source_vm_mdo.get(""config.hardware.device""),"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""instanceUuid"": source_vm_mdo.get(""summary.config.instanceUuid"")}"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if clone_spec.config is not None:
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Impose the config changes specified in the config property
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if (hasattr(clone_spec.config, 'instanceUuid') and"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,clone_spec.config.instanceUuid is not None):
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_dict[""instanceUuid""] = clone_spec.config.instanceUuid"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(clone_spec.config, 'extraConfig'):"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"extraConfigs = _merge_extraconfig(vm_dict[""extra_config""],"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,clone_spec.config.extraConfig)
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_dict[""extra_config""] = extraConfigs"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,virtual_machine = VirtualMachine(**vm_dict)
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_create_object(""VirtualMachine"", virtual_machine)"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"task_mdo = create_task(method, ""success"")"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return task_mdo.obj
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# Case of Reconfig of VM to set extra params
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""config.extraConfig"", val.extraConfig)"
91ddf85abb8a516cfa2da346b393aa7234660f6c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return self._just_return_task(method)
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"cfg.IntOpt('host_port',"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"default=443,"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"help='Port for connection to VMware ESX/VC host.'),"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_port=CONF.vmware.host_port,"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._host_port = host_port
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return vim.Vim(protocol=self._scheme, host=self._host_ip,"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,port=self._host_port)
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return vim.Vim(protocol=self._scheme, host=self._host_ip)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host=""localhost"","
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,port=443):
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host    : ESX IPAddress or Hostname
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,port    : port for connection
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.wsdl_url = Vim.get_wsdl_url(protocol, host, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.url = Vim.get_soap_url(protocol, host, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_wsdl_url(protocol, host_name, port):"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,:param port: port for connection
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return Vim.get_soap_url(protocol, host_name, port) + ""/vimService.wsdl"""
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_soap_url(protocol, host_name, port):"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return '%s://[%s]:%d/sdk' % (protocol, host_name, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return '%s://%s:%d/sdk' % (protocol, host_name, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host=""localhost""):"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host    : ESX IPAddress[:port] or ESX Hostname[:port]
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.wsdl_url = Vim.get_wsdl_url(protocol, host)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.url = Vim.get_soap_url(protocol, host)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def get_wsdl_url(protocol, host_name):"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return Vim.get_soap_url(protocol, host_name) + ""/vimService.wsdl"""
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def get_soap_url(protocol, host_name):"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return '%s://[%s]/sdk' % (protocol, host_name)"
4640542cc502a442d4807822d75d3fa3eff0a33b,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return '%s://%s/sdk' % (protocol, host_name)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"host=""localhost"","
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,port=443):
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,host    : ESX IPAddress or Hostname
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,port    : port for connection
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.wsdl_url = Vim.get_wsdl_url(protocol, host, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.url = Vim.get_soap_url(protocol, host, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_wsdl_url(protocol, host_name, port):"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,:param port: port for connection
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return Vim.get_soap_url(protocol, host_name, port) + ""/vimService.wsdl"""
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_soap_url(protocol, host_name, port):"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return '%s://[%s]:%d/sdk' % (protocol, host_name, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return '%s://%s:%d/sdk' % (protocol, host_name, port)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"host=""localhost""):"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,host    : ESX IPAddress[:port] or ESX Hostname[:port]
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self.wsdl_url = Vim.get_wsdl_url(protocol, host)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self.url = Vim.get_soap_url(protocol, host)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_wsdl_url(protocol, host_name):"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return Vim.get_soap_url(protocol, host_name) + ""/vimService.wsdl"""
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_soap_url(protocol, host_name):"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return '%s://[%s]/sdk' % (protocol, host_name)"
4640542cc502a442d4807822d75d3fa3eff0a33b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return '%s://%s/sdk' % (protocol, host_name)"
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,spec_type = spec_set.propSet[0].type
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo_refs = _db_content[spec_type]
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,elif obj_ref.type != spec_type:
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo = _db_content[spec_type][mdo_ref]
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,type = spec_set.propSet[0].type
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,mdo_refs = _db_content[type]
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,elif obj_ref.type != type:
822f3069cd485215e863bc142b0e05d7bd1d52e6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,mdo = _db_content[type][mdo_ref]
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,from nova.openstack.common.gettextutils import _LW
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,from nova.scheduler.filters import utils
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"LOG.warning(_LW(""VCPUs not set; assuming CPU collection broken""))"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,aggregate_vals = utils.aggregate_values_from_db(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"filter_properties['context'],"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"host_state.host,"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,'cpu_allocation_ratio')
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,ratio = utils.validate_num_values(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"aggregate_vals, CONF.cpu_allocation_ratio, cast_to=float)"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"LOG.warning(_LW(""Could not decode cpu_allocation_ratio: '%s'""), e)"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,from nova import db
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,from nova.openstack.common.gettextutils import _
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"LOG.warning(_(""VCPUs not set; assuming CPU collection broken""))"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,context = filter_properties['context']
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,metadata = db.aggregate_metadata_get_by_host(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"context, host_state.host, key='cpu_allocation_ratio')"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"aggregate_vals = metadata.get('cpu_allocation_ratio', set())"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,num_values = len(aggregate_vals)
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,if num_values == 0:
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,return CONF.cpu_allocation_ratio
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,if num_values > 1:
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"LOG.warning(_(""%(num_values)d ratio values found, """
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"""of which the minimum value will be used.""),"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,{'num_values': num_values})
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,ratio = float(min(aggregate_vals))
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"LOG.warning(_(""Could not decode cpu_allocation_ratio: '%s'""), e)"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,from nova.openstack.common.gettextutils import _LW
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,from nova.scheduler.filters import utils
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,aggregate_vals = utils.aggregate_values_from_db(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"filter_properties['context'],"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"host_state.host,"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,'ram_allocation_ratio')
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,ratio = utils.validate_num_values(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"aggregate_vals, CONF.ram_allocation_ratio, cast_to=float)"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"LOG.warning(_LW(""Could not decode ram_allocation_ratio: '%s'""), e)"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,from nova import db
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,from nova.openstack.common.gettextutils import _
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,context = filter_properties['context']
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,metadata = db.aggregate_metadata_get_by_host(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"context, host_state.host, key='ram_allocation_ratio')"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"aggregate_vals = metadata.get('ram_allocation_ratio', set())"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,num_values = len(aggregate_vals)
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,if num_values == 0:
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,return CONF.ram_allocation_ratio
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,if num_values > 1:
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"LOG.warning(_(""%(num_values)d ratio values found, """
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"""of which the minimum value will be used.""),"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,{'num_values': num_values})
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,ratio = float(min(aggregate_vals))
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"LOG.warning(_(""Could not decode ram_allocation_ratio: '%s'""), e)"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,from nova.scheduler.filters import utils
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"# TODO(uni): DB query in filter is a performance hit, especially for"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,# system with lots of hosts. Will need a general solution here to fix
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,# all filters with aggregate DB call things.
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,aggregate_vals = utils.aggregate_values_from_db(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,"filter_properties['context'], host_state.host, 'instance_type')"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,if not aggregate_vals:
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,return True
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,added,0,return instance_type['name'] in aggregate_vals
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,context = filter_properties['context']
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,metadata = db.aggregate_metadata_get_by_host(
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,"context, host_state.host, key='instance_type')"
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,return (len(metadata) == 0 or
878f767b9e1cdc2b57858c41d973dd087f37bbaa,60ad1946567136445e83446d3774726f161c813e,deleted,1,instance_type['name'] in metadata['instance_type'])
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""%(text)s: _db_content => %(content)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Session is faulty"")"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,LOG.debug('Raising NotImplemented')
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Calling %(name)s %(impl)s',"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Calling getter %s', name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Calling setter %s', name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""%(text)s: _db_content => %(content)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Session is faulty""))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG.debug(_('Raising NotImplemented'))
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Calling %(name)s %(impl)s'),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Calling getter %s'), name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Calling setter %s'), name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""No networks configured on host!"")"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Configured networks: %s"", vm_networks)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Network %s not found on host!"", network_name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Creating Port Group with name %s on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""the ESX host"", pg_name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Port Group %s already exists."", pg_name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Created Port Group with name %s on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""No networks configured on host!""))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Configured networks: %s""), vm_networks)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Network %s not found on host!""), network_name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Creating Port Group with name %s on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""the ESX host"") % pg_name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Port Group %s already exists.""), pg_name)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Created Port Group with name %s on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Exception during HTTP connection close in """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VMwareHTTPWrite. Exception is %s"", excep)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,from nova.openstack.common.gettextutils import _
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Exception during HTTP connection close in """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""VMwareHTTPWrite. Exception is %s"") % excep)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""get_info called for instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Creating differencing VHD. Parent: """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(base_vhd_path)s, Target: %(root_vhd_path)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Copying VHD image %(base_vhd_path)s to target: """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(root_vhd_path)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Resizing VHD %(root_vhd_path)s to new """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""size %(root_vhd_size)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Creating nic for instance', instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Instance not found"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Rebooting instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Pause instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Unpause instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Suspend instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Resume instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Power off instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Power on instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Successfully changed state of VM %(vm_name)s"""
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""" to: %(req_state)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Getting list of instances"")"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Got total of %s instances"", str(len(lst_vm_names)))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Extending root virtual disk to %s"", requested_size)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Extended root virtual disk"")"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Unable to delete %(ds)s. There may be more than """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""one process or thread that tries to delete the file. """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""Exception: %(ex)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""File %s already exists"", dest_folder)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Create blank virtual disk on %s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Blank virtual disk created on %s."","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Copying root disk of size %sGb"", root_gb)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Reconfiguring VM instance %(instance_name)s to attach """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""cdrom %(file_path)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Reconfigured VM instance %(instance_name)s to attach """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Creating Snapshot of the VM instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Created Snapshot of the VM instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Deleting Snapshot of the VM instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Deleted Snapshot of the VM instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Copying snapshotted disk %s.',"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Copied snapshotted disk %s.',"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Uploading image %s"", image_id,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Uploaded image %s"", image_id,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Rebooting guest OS of VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Rebooted guest OS of VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Doing hard reboot of VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Did hard reboot of VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Powering off the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Powered off the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Unregistering the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Unregistered the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Deleting contents of the VM from """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""datastore %(datastore_name)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"{'datastore_name': datastore_name},"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Deleted contents of the VM from """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Destroying instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Rescue VM configured"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Rescue VM destroyed"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Instance destroyed"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Suspending the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Suspended the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""VM was already in suspended state. So returning """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""without doing anything"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Resuming the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Resumed the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""VM was already in powered off state. So returning """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Updating instance '%(instance_uuid)s' progress to"""
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""" %(progress)d"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""instance not present"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Destroying the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Destroyed the VM"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Migrating VM to host %s"", dest, instance=instance_ref)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Migrated VM to host %s"", dest, instance=instance_ref)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Reconfiguring VM instance to set the machine id"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Reconfigured VM instance to set the machine id"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Reconfiguring VM instance to enable vnc on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""port - %(port)s"", {'port': port},"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Reconfigured VM instance to enable vnc on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Folder %s created."", path)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Image aging disabled. Aging will not be done."")"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Will copy while retaining adapter type """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""%(adapter_type)s and disk type %(disk_type)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"{""disk_type"": disk_type,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""adapter_type"": adapter_type})"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Getting list of instances from cluster %s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""VM %(uuid)s is currently on host %(host_name)s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Importing image upload handler: %s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Starting instance"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Block device information present: %s"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Using PV kernel: %s"", use_pv_kernel, instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Auto configuring disk, attempting to """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""resize root disk..."", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Waiting for instance state to become running',"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Skip agent setup, not enabled."", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Skip agent setup, unable to contact agent."","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Detected agent version: %s', version, instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Finished snapshot and upload for VM"","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Updating progress to %d"", progress,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""VM was already shutdown."", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Clean shutdown did not complete successfully, """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""trying hard shutdown."", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Migrated root base vhds"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Migrated all base vhds."", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Read-only migrated for disk: %s"", userdevice,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Not resizing the root volume."","
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Destroying VDIs"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Using RAW or VHD, skipping kernel and ramdisk """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""deletion"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""kernel/ramdisk files removed"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Injecting network info to xenstore"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Creating vifs"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Creating VIF for network %s',"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug('Created VIF %(vif_ref)s, network %(network_ref)s',"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Injecting hostname (%s) into xenstore"", hostname,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"LOG.debug(""Removing hostname from xenstore"", instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""get_info called for instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Creating differencing VHD. Parent: """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(base_vhd_path)s, Target: %(root_vhd_path)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Copying VHD image %(base_vhd_path)s to target: """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(root_vhd_path)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Resizing VHD %(root_vhd_path)s to new """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""size %(root_vhd_size)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Creating nic for instance'), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Instance not found""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Rebooting instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Pause instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Unpause instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Suspend instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Resume instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Power off instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Power on instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Successfully changed state of VM %(vm_name)s"""
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""" to: %(req_state)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Getting list of instances""))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Got total of %s instances"") % str(len(lst_vm_names)))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Extending root virtual disk to %s""), requested_size)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Extended root virtual disk""))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Unable to delete %(ds)s. There may be more than """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""one process or thread that tries to delete the file. """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""Exception: %(ex)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""File %s already exists""), dest_folder)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Create blank virtual disk on %s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Blank virtual disk created on %s.""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Copying root disk of size %sGb""), root_gb)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfiguring VM instance %(instance_name)s to attach """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""cdrom %(file_path)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfigured VM instance %(instance_name)s to attach """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Creating Snapshot of the VM instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Created Snapshot of the VM instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleting Snapshot of the VM instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleted Snapshot of the VM instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Copying snapshotted disk %s.'),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Copied snapshotted disk %s.'),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Uploading image %s"") % image_id,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Uploaded image %s"") % image_id,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Rebooting guest OS of VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Rebooted guest OS of VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Doing hard reboot of VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Did hard reboot of VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Powering off the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Powered off the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Unregistering the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Unregistered the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleting contents of the VM from """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""datastore %(datastore_name)s"") %"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"{'datastore_name': datastore_name},"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Deleted contents of the VM from """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Destroying instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Rescue VM configured""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Rescue VM destroyed""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Instance destroyed""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Suspending the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Suspended the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""VM was already in suspended state. So returning """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""without doing anything""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Resuming the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Resumed the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""VM was already in powered off state. So returning """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Updating instance '%(instance_uuid)s' progress to"""
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""" %(progress)d""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""instance not present""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Destroying the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Destroyed the VM""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Migrating VM to host %s"") % dest, instance=instance_ref)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Migrated VM to host %s"") % dest, instance=instance_ref)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfiguring VM instance to set the machine id""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfigured VM instance to set the machine id""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfiguring VM instance to enable vnc on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""port - %(port)s"") % {'port': port},"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Reconfigured VM instance to enable vnc on """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Folder %s created.""), path)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Image aging disabled. Aging will not be done.""))"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Will copy while retaining adapter type """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""%(adapter_type)s and disk type %(disk_type)s"") %"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"{""disk_type"": disk_type,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""adapter_type"": adapter_type})"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Getting list of instances from cluster %s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""VM %(uuid)s is currently on host %(host_name)s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Importing image upload handler: %s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Starting instance""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Block device information present: %s""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Using PV kernel: %s""), use_pv_kernel, instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Auto configuring disk, attempting to """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""resize root disk...""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Waiting for instance state to become running'),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Skip agent setup, not enabled.""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Skip agent setup, unable to contact agent.""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Detected agent version: %s'), version, instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Finished snapshot and upload for VM""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Updating progress to %d""), progress,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""VM was already shutdown.""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Clean shutdown did not complete successfully, """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""trying hard shutdown.""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Migrated root base vhds""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Migrated all base vhds.""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Read-only migrated for disk: %s""), userdevice,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Not resizing the root volume.""),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Destroying VDIs""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Using RAW or VHD, skipping kernel and ramdisk """
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""deletion""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""kernel/ramdisk files removed""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Injecting network info to xenstore""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Creating vifs""), instance=instance)"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Creating VIF for network %s'),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_('Created VIF %(vif_ref)s, network %(network_ref)s'),"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Injecting hostname (%s) into xenstore""), hostname,"
cfd0846498c21f250321482316b32d4519ed622c,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(_(""Removing hostname from xenstore""), instance=instance)"
5aa4331cc8d9c0e4615f9859395a9ae8c6d40f09,e21763b15948603e618d4435335ef3785dc5660a,added,0,from nova.tests.virt.vmwareapi import fake
5aa4331cc8d9c0e4615f9859395a9ae8c6d40f09,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,from nova.virt.vmwareapi import fake
5aa4331cc8d9c0e4615f9859395a9ae8c6d40f09,e21763b15948603e618d4435335ef3785dc5660a,added,0,from nova.tests.virt.vmwareapi import fake as vmwareapi_fake
5aa4331cc8d9c0e4615f9859395a9ae8c6d40f09,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,from nova.virt.vmwareapi import fake as vmwareapi_fake
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,from nova.openstack.common import log as logging
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,LOG = logging.getLogger(__name__)
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,if not availability_zone:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,return True
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,context = filter_properties['context']
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,metadata = db.aggregate_metadata_get_by_host(
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,"context, host_state.host, key='availability_zone')"
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,if 'availability_zone' in metadata:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,hosts_passes = availability_zone in metadata['availability_zone']
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,host_az = metadata['availability_zone']
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,else:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,hosts_passes = availability_zone == CONF.default_availability_zone
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,host_az = CONF.default_availability_zone
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,if not hosts_passes:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,"LOG.debug(""Availability Zone '%(az)s' requested. """
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,"""%(host_state)s has AZs: %(host_az)s"","
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,"{'host_state': host_state,"
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,"'az': availability_zone,"
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,'host_az': host_az})
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,added,0,return hosts_passes
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,if availability_zone:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,context = filter_properties['context']
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,metadata = db.aggregate_metadata_get_by_host(
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,"context, host_state.host, key='availability_zone')"
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,if 'availability_zone' in metadata:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,return availability_zone in metadata['availability_zone']
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,else:
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,return availability_zone == CONF.default_availability_zone
9a0f85953638a64c7589ffbbd798106f8d7e44b2,60ad1946567136445e83446d3774726f161c813e,deleted,1,return True
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,cluster_name = 'test_cluster'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,cluster_name2 = 'test_cluster2'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.flags(cluster_name=[cluster_name, cluster_name2],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,"host_ip='test_url',"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,"self.conn = driver.VMwareVCDriver(None, False)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.node_name = self.conn._resources.keys()[0]
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.node_name2 = self.conn._resources.keys()[1]
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,if cluster_name2 in self.node_name2:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.ds = 'ds1'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,else:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.ds = 'ds2'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,self.vnc_host = 'ha-host'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,added,0,vmwareapi_fake.reset()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,from nova.virt import fake
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.flags(host_ip='test_url',"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"datastore_regex='.*',"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.node_name = 'test_url'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.ds = 'ds1'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.conn = driver.VMwareESXDriver(fake.FakeVirtAPI)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.vnc_host = 'test_url'
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_spawn_attach_volume_vmdk(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._spawn_attach_volume_vmdk()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_spawn_attach_volume_vmdk_no_image_ref(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._spawn_attach_volume_vmdk(set_image_ref=False)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_pause(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,# Tests that the VMwareESXDriver does not implement the pause method.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertRaises(NotImplementedError, self.conn.pause, instance=None)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_unpause(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,# Tests that the VMwareESXDriver does not implement the unpause method.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertRaises(NotImplementedError, self.conn.unpause,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,instance=None)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_confirm_migration(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._create_vm()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertRaises(NotImplementedError,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.conn.confirm_migration, self.context,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.instance, None)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_finish_revert_migration_power_on(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._test_finish_revert_migration(power_on=True)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_finish_revert_migration_power_off(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self._test_finish_revert_migration(power_on=False)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_get_console_pool_info(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"info = self.conn.get_console_pool_info(""console_type"")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(info['address'], 'test_url')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(info['username'], 'test_username')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(info['password'], 'test_pass')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_ip_addr(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(self.conn.get_host_ip_addr(), ""test_url"")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"class VMwareAPIHostTestCase(test.NoDBTestCase,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,test_driver.DriverAPITestHelper):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"""""""Unit tests for Vmware API host calls."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def setUp(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"super(VMwareAPIHostTestCase, self).setUp()"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.flags(image_cache_subdirectory_name='vmware_base')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vm_util.vm_refs_cache_reset()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"host_username='test_username',"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"host_password='test_pass', group='vmware')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vmwareapi_fake.reset()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,stubs.set_stubs(self.stubs)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.conn = driver.VMwareESXDriver(False)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def tearDown(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"super(VMwareAPIHostTestCase, self).tearDown()"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vmwareapi_fake.cleanup()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_public_api_signatures(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,self.assertPublicAPISignatures(self.conn)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_state(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,stats = self.conn.get_host_stats()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['vcpus'], 16)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['disk_total'], 1024)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['disk_available'], 500)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['disk_used'], 1024 - 500)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['host_memory_total'], 1024)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['host_memory_free'], 1024 - 500)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['hypervisor_version'], 5000000)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"supported_instances = [('i686', 'vmware', 'hvm'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"('x86_64', 'vmware', 'hvm')]"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(stats['supported_instances'], supported_instances)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"def _test_host_action(self, method, action, expected=None):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"result = method('host', action)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual(result, expected)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_reboot(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self._test_host_action(self.conn.host_power_action, 'reboot')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_shutdown(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self._test_host_action(self.conn.host_power_action, 'shutdown')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_startup(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self._test_host_action(self.conn.host_power_action, 'startup')"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_maintenance_on(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self._test_host_action(self.conn.host_maintenance_mode, True)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_host_maintenance_off(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self._test_host_action(self.conn.host_maintenance_mode, False)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,def test_get_host_uptime(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,result = self.conn.get_host_uptime('host')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"self.assertEqual('Please refer to test_url for the uptime', result)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vmwareapi_fake.reset(vc=True)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,@mock.patch('nova.virt.vmwareapi.driver.VMwareVCDriver.__init__')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"def test_init_host_and_cleanup_host(self, mock_init):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vcdriver = self._setup_mocks_for_session(mock_init)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"vcdriver.init_host(""foo"")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vcdriver._session._create_session.assert_called_once_with()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"vcdriver.cleanup_host(""foo"")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vcdriver._session.vim.client.service.Logout.assert_called_once_with(
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,mock.ANY)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,@mock.patch('nova.virt.vmwareapi.driver.LOG')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"def test_cleanup_host_with_no_login(self, mock_init, mock_logger):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,# Not logged in...
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,# observe that no exceptions were thrown
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,mock_sc = mock.Mock()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vcdriver._session.vim.retrieve_service_content.return_value = mock_sc
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"web_fault = suds.WebFault(mock.Mock(), mock.Mock())"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,vcdriver._session.vim.client.service.Logout.side_effect = web_fault
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,# assert that the mock Logout method was never called
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,mock_logger.debug.assert_called_once_with(mock.ANY)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,A connection to the VMware vCenter platform.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"from nova.i18n import _, _LC, _LW"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,help='Hostname or IP address for connection to VMware VC '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"help='Port for connection to VMware VC host.'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"help='Username for connection to VMware VC host.'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"help='Password for connection to VMware VC host.',"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"help='Name of a VMware Cluster ComputeResource.'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The following class was removed in the transition from Icehouse to
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# Juno, but may still be referenced in configuration files.  The"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# following stub allow those configurations to work while logging a
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# deprecation warning.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def _do_deprecation_warning(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LOG.warn(_LW('The VMware ESX driver is now deprecated and has been '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'removed in the Juno release. The VC driver will remain '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'and continue to be supported.'))
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, virtapi, read_only=False, scheme=""https""):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._do_deprecation_warning()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,class VMwareVCDriver(driver.ComputeDriver):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""The VC host connection object."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The vCenter driver includes API that acts on ESX hosts or groups
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# of ESX hosts in clusters or non-cluster logical-groupings.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,#
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# vCenter is not a hypervisor itself, it works with multiple"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# hypervisor host machines and their guests. This fact can
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# subtly alter how vSphere and OpenStack interoperate.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"super(VMwareVCDriver, self).__init__(virtapi)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Get the list of clusters to be used
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._cluster_names = CONF.vmware.cluster_name
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self.dict_mors = vm_util.get_all_cluster_refs_by_name(self._session,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._cluster_names)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if not self.dict_mors:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"raise exception.NotFound(_(""All clusters specified %s were not"""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""" found in the vCenter"")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,% self._cluster_names)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# Check if there are any clusters that were specified in the nova.conf
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# but are not in the vCenter, for missing clusters log a warning."
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"clusters_found = [v.get('name') for k, v in self.dict_mors.iteritems()]"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,missing_clusters = set(self._cluster_names) - set(clusters_found)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if missing_clusters:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.warn(_LW(""The following clusters could not be found in the """
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""vCenter %s"") % list(missing_clusters))"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# The _resources is used to maintain the vmops, volumeops and vcstate"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# objects per cluster
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._resources = {}
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._resource_keys = set()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._virtapi = virtapi
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._update_resources()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# The following initialization is necessary since the base class does
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# not use VC state.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,first_cluster = self._resources.keys()[0]
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._vmops = self._resources.get(first_cluster).get('vmops')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._volumeops = self._resources.get(first_cluster).get('volumeops')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._vc_state = self._resources.get(first_cluster).get('vcstate')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"LOG.warn(_LW('Instance cannot be found in host, or in an unknown'"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'state.'), instance=instance)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,instance['uuid'])
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,block_device_info)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# vCenter does not actually run the VNC service
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_available_resources(self, host_stats):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return {'vcpus': host_stats['vcpus'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'memory_mb': host_stats['host_memory_total'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'local_gb': host_stats['disk_total'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'vcpus_used': 0,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'memory_mb_used': host_stats['host_memory_total'] -
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"host_stats['host_memory_free'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'local_gb_used': host_stats['disk_used'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'hypervisor_type': host_stats['hypervisor_type'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'hypervisor_version': host_stats['hypervisor_version'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'hypervisor_hostname': host_stats['hypervisor_hostname'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'cpu_info': jsonutils.dumps(host_stats['cpu_info']),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'supported_instances': jsonutils.dumps(
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"host_stats['supported_instances']),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,}
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Sets up a session with the VC host and handles all"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Creates a session with the VC host."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,A connection to the VMware ESX/vCenter platform.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import suds
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"from nova.i18n import _, _LC"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,help='Hostname or IP address for connection to VMware ESX/VC '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"help='Port for connection to VMware ESX/VC host.'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"help='Username for connection to VMware ESX/VC host.'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"help='Password for connection to VMware ESX/VC host.',"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,help='Name of a VMware Cluster ComputeResource. Used only if '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'compute_driver is vmwareapi.VMwareVCDriver.'),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# VMwareAPI has both ESXi and vCenter API sets.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# The ESXi API are a proper sub-set of the vCenter API.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# That is to say, nearly all valid ESXi calls are"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# valid vCenter calls. There are some small edge-case
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# exceptions regarding VNC, CIM, User management & SSO."
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _do_deprecation_warning(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG.warning(_('The VMware ESX driver is now deprecated and will be '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'removed in the Juno release. The VC driver will remain '
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'and continue to be supported.'))
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"super(VMwareESXDriver, self).__init__(virtapi)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._do_deprecation_warning()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._host_ip = CONF.vmware.host_ip
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not (self._host_ip or CONF.vmware.host_username is None or
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,CONF.vmware.host_password is None):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise Exception(_(""Must specify host_ip, """
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""host_username """
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""and host_password to use """
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""compute_driver=vmwareapi.VMwareESXDriver or """
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""vmwareapi.VMwareVCDriver""))"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._volumeops = volumeops.VMwareVolumeOps(self._session)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops = vmops.VMwareVMOps(self._session, self.virtapi,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._volumeops,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,datastore_regex=self._datastore_regex)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._host = host.Host(self._session)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._host_state = None
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,@property
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def host_state(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not self._host_state:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._host_state = host.HostState(self._session,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._host_ip)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._host_state
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def init_host(self, host):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vim = self._session.vim
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if vim is None:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._session._create_session()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def cleanup_host(self, host):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# NOTE(hartsocks): we lean on the init_host to force the vim object
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# to not be None.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,service_content = vim.get_service_content()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,session_manager = service_content.sessionManager
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,try:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vim.client.service.Logout(session_manager)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,except suds.WebFault:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(""No vSphere session was open during cleanup_host."")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def list_instances(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""List VM instances."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._vmops.list_instances()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def spawn(self, context, instance, image_meta, injected_files,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"admin_password, network_info=None, block_device_info=None):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Create VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.spawn(context, instance, image_meta, injected_files,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"admin_password, network_info, block_device_info)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def snapshot(self, context, instance, image_id, update_task_state):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Create snapshot from a running VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.snapshot(context, instance, image_id, update_task_state)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def reboot(self, context, instance, network_info, reboot_type,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"block_device_info=None, bad_volumes_callback=None):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Reboot VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.reboot(instance, network_info)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def destroy(self, context, instance, network_info, block_device_info=None,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"destroy_disks=True, migrate_data=None):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Destroy VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Destroy gets triggered when Resource Claim in resource_tracker
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# is not successful. When resource claim is not successful,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# node is not set in instance. Perform destroy only if node is set
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not instance['node']:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.destroy(instance, destroy_disks)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def pause(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Pause VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.pause(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def unpause(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Unpause paused VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.unpause(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def suspend(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Suspend the specified instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.suspend(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def resume(self, context, instance, network_info, block_device_info=None):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Resume the suspended VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.resume(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def rescue(self, context, instance, network_info, image_meta,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,rescue_password):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Rescue the specified instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.rescue(context, instance, network_info, image_meta)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def unrescue(self, instance, network_info):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Unrescue the specified instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.unrescue(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def power_off(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Power off the specified instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.power_off(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def power_on(self, context, instance, network_info,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,block_device_info=None):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Power on the specified instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops.power_on(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.warn(_('Instance cannot be found in host, or in an unknown'"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'state.'), instance=instance)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance['uuid'])
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,block_device_info)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def poll_rebooting_instances(self, timeout, instances):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Poll for rebooting instances."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.poll_rebooting_instances(timeout, instances)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_info(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Return info about the VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._vmops.get_info(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_diagnostics(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Return data about VM diagnostics."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,data = self._vmops.get_diagnostics(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return data
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_instance_diagnostics(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,data = self._vmops.get_instance_diagnostics(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_vnc_console(self, context, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Return link to instance's VNC console."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._vmops.get_vnc_console(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_volume_connector(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Return volume connector information."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._volumeops.get_volume_connector(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def get_host_ip_addr(self):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Retrieves the IP address of the ESX host."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._host_ip
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def attach_volume(self, context, connection_info, instance, mountpoint,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"disk_bus=None, device_type=None, encryption=None):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Attach volume storage to VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self._volumeops.attach_volume(connection_info,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"instance,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,mountpoint)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def detach_volume(self, connection_info, instance, mountpoint,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,encryption=None):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Detach volume storage to VM instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self._volumeops.detach_volume(connection_info,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_console_pool_info(self, console_type):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get info about the host on which the VM resides."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return {'address': CONF.vmware.host_ip,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'username': CONF.vmware.host_username,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'password': CONF.vmware.host_password}
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _get_available_resources(self, host_stats):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return {'vcpus': host_stats['vcpus'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'memory_mb': host_stats['host_memory_total'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'local_gb': host_stats['disk_total'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'vcpus_used': 0,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'memory_mb_used': host_stats['host_memory_total'] -
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"host_stats['host_memory_free'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'local_gb_used': host_stats['disk_used'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'hypervisor_type': host_stats['hypervisor_type'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'hypervisor_version': host_stats['hypervisor_version'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'hypervisor_hostname': host_stats['hypervisor_hostname'],"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'cpu_info': jsonutils.dumps(host_stats['cpu_info']),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'supported_instances': jsonutils.dumps(
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"host_stats['supported_instances']),"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,}
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_available_resource(self, nodename):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Retrieve resource information."
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"This method is called when nova-compute launches, and"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,as part of a periodic task that records the results in the DB.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,:returns: dictionary describing resources
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,host_stats = self.get_host_stats(refresh=True)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Updating host information
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._get_available_resources(host_stats)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_host_stats(self, refresh=False):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Return the current state of the host."
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"If 'refresh' is True, run the update first."
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self.host_state.get_host_stats(refresh=refresh)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def host_power_action(self, host, action):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Reboots, shuts down or powers up the host."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self._host.host_power_action(host, action)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def host_maintenance_mode(self, host, mode):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Start/Stop host maintenance window. On start, it triggers"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,guest VMs evacuation.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self._host.host_maintenance_mode(host, mode)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def set_host_enabled(self, host, enabled):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Sets the specified host's ability to accept new instances."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self._host.set_host_enabled(host, enabled)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_host_uptime(self, host):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return 'Please refer to %s for the uptime' % CONF.vmware.host_ip
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def inject_network_info(self, instance, nw_info):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""inject network info for specified instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.inject_network_info(instance, nw_info)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def manage_image_cache(self, context, all_instances):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Manage the local cache of images."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.manage_image_cache(context, all_instances)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def instance_exists(self, instance):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Efficient override of base instance_exists method."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self._vmops.instance_exists(instance)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def attach_interface(self, instance, image_meta, vif):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Attach an interface to the instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.attach_interface(instance, image_meta, vif)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def detach_interface(self, instance, vif):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Detach an interface from the instance."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self._vmops.detach_interface(instance, vif)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class VMwareVCDriver(VMwareESXDriver):
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""The VC host connection object."""""""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# The vCenter driver includes several additional VMware vSphere
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# capabilities that include API that act on hosts or groups of
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# hosts in clusters or non-cluster logical-groupings.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# vCenter is not a hypervisor itself, it works with multiple"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# hypervisor host machines and their guests. This fact can
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# subtly alter how vSphere and OpenStack interoperate.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Driver validated by VMware's Minesweeper CI
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pass
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, virtapi, scheme=""https""):"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"super(VMwareVCDriver, self).__init__(virtapi, scheme)"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Get the list of clusters to be used
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._cluster_names = CONF.vmware.cluster_name
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"self.dict_mors = vm_util.get_all_cluster_refs_by_name(self._session,"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._cluster_names)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not self.dict_mors:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise exception.NotFound(_(""All clusters specified %s were not"""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""" found in the vCenter"")"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,% self._cluster_names)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Check if there are any clusters that were specified in the nova.conf
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# but are not in the vCenter, for missing clusters log a warning."
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"clusters_found = [v.get('name') for k, v in self.dict_mors.iteritems()]"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,missing_clusters = set(self._cluster_names) - set(clusters_found)
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if missing_clusters:
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.warn(_(""The following clusters could not be found in the"""
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""" vCenter %s"") % list(missing_clusters))"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# The _resources is used to maintain the vmops, volumeops and vcstate"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# objects per cluster
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._resources = {}
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._resource_keys = set()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._virtapi = virtapi
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._update_resources()
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# The following initialization is necessary since the base class does
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# not use VC state.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,first_cluster = self._resources.keys()[0]
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vmops = self._resources.get(first_cluster).get('vmops')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._volumeops = self._resources.get(first_cluster).get('volumeops')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._vc_state = self._resources.get(first_cluster).get('vcstate')
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# In this situation, ESXi and vCenter require different"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# API logic to create a valid VNC console connection object.
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# In specific, vCenter does not actually run the VNC service"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Sets up a session with the VC/ESX host and handles all"
1deb31f85a8f5d1e261b2cf1eddc537a5da7f60b,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Creates a session with the VC/ESX host."""""""
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class FakeService(DataObject):
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Fake service class."""""""
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def Logout(self, session_manager):"
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,pass
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class FakeClient(DataObject):
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Fake client class."""""""
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def __init__(self):
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Creates a namespace object."""""""
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.service = FakeService()
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.client = FakeClient()
49d4defee6b5182eca31431ae8273d3a523f3e61,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.client = DataObject()
d7f097d69e86d8a6cdf957364998637cdd139907,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def fake_get_vmdk_size_and_properties(context, image_id, instance):"
d7f097d69e86d8a6cdf957364998637cdd139907,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Fakes the file size and properties fetch for the image file."""""""
d7f097d69e86d8a6cdf957364998637cdd139907,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"props = {""vmware_ostype"": constants.DEFAULT_OS_TYPE,"
d7f097d69e86d8a6cdf957364998637cdd139907,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""vmware_adaptertype"": constants.DEFAULT_ADAPTER_TYPE}"
d7f097d69e86d8a6cdf957364998637cdd139907,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return _FAKE_FILE_SIZE, props"
d7f097d69e86d8a6cdf957364998637cdd139907,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,from nova.virt.vmwareapi import vmware_images
d7f097d69e86d8a6cdf957364998637cdd139907,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"stubs.Set(vmware_images, 'get_vmdk_size_and_properties',"
d7f097d69e86d8a6cdf957364998637cdd139907,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,fake.fake_get_vmdk_size_and_properties)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,Utility functions for Image transfer and manipulation.
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from oslo.config import cfg
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.openstack.common import strutils
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.openstack.common import units
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.virt.vmwareapi import constants
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# NOTE(mdbooth): We use use_linked_clone below, but don't have to import it"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# because nova.virt.vmwareapi.driver is imported first. In fact, it is not"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# possible to import it here, as nova.virt.vmwareapi.driver calls"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# CONF.register_opts() after the import chain which imports this module. This
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# is not a problem as long as the import order doesn't change.
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,CONF = cfg.CONF
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,LINKED_CLONE_PROPERTY = 'vmware_linked_clone'
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,class VMwareImage(object):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, image_id,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"file_size=0,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"os_type=constants.DEFAULT_OS_TYPE,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"adapter_type=constants.DEFAULT_ADAPTER_TYPE,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"disk_type=constants.DEFAULT_DISK_TYPE,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"file_type=constants.DEFAULT_DISK_FORMAT,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"linked_clone=None,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,vif_model=constants.DEFAULT_VIF_MODEL):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""VMwareImage holds values for use in building VMs."
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,image_id (str): uuid of the image
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,file_size (int): size of file in bytes
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,os_type (str): name of guest os (use vSphere names only)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_type (str): name of the adapter's type
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"disk_type (str): type of disk in thin, thick, etc"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,file_type (str): vmdk or iso
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"linked_clone(bool): use linked clone, or don't"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,""""""""
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.image_id = image_id
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.file_size = file_size
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.os_type = os_type
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.adapter_type = adapter_type
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.disk_type = disk_type
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.file_type = file_type
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# NOTE(vui): This should be removed when we restore the
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# descriptor-based validation.
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if (self.file_type is not None and
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.file_type not in constants.DISK_FORMATS_ALL):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InvalidDiskFormat(disk_format=self.file_type)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if linked_clone is not None:
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.linked_clone = linked_clone
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.linked_clone = CONF.vmware.use_linked_clone
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self.vif_model = vif_model
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,@property
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def file_size_in_kb(self):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return self.file_size / units.Ki
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def file_size_in_gb(self):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return self.file_size / units.Gi
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def is_sparse(self):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return self.disk_type == constants.DISK_TYPE_SPARSE
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,def is_iso(self):
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return self.file_type == constants.DISK_FORMAT_ISO
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,@classmethod
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def from_image(cls, image_id, image_meta=None):"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Returns VMwareImage, the subset of properties the driver uses."
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,:param image_id - image id of image
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,:param image_meta - image metadata we are working with
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,:return: vmware image object
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,:rtype: nova.virt.vmwareapi.vmware_images.VmwareImage
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if image_meta is None:
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,image_meta = {}
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"properties = image_meta.get(""properties"", {})"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"# calculate linked_clone flag, allow image properties to override the"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# global property set in the configurations.
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"image_linked_clone = properties.get(LINKED_CLONE_PROPERTY,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,CONF.vmware.use_linked_clone)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,# catch any string values that need to be interpreted as boolean values
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,linked_clone = strutils.bool_from_string(image_linked_clone)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,props = {
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'image_id': image_id,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'linked_clone': linked_clone
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,}
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if 'size' in image_meta:
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,props['file_size'] = image_meta['size']
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if 'disk_format' in image_meta:
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,props['file_type'] = image_meta['disk_format']
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,props_map = {
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'vmware_ostype': 'os_type',"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'vmware_adaptertype': 'adapter_type',"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"'vmware_disktype': 'disk_type',"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,'hw_vif_model': 'vif_model'
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"for k, v in props_map.iteritems():"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if k in properties:
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,props[v] = properties[k]
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return cls(**props)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Utility functions for Image transfer.
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_vmdk_size_and_properties(context, image, instance):"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get size of the vmdk file that is to be downloaded for attach in spawn."
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Need this to create the dummy virtual disk for the meta-data file. The
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,geometry of the disk created depends on the size.
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(""Getting image size for the image %s"", image,"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,instance=instance)
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"meta_data = IMAGE_API.get(context, image)"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"size, properties = meta_data[""size""], meta_data[""properties""]"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(""Got image size of %(size)s for the image %(image)s"","
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"{'size': size, 'image': image}, instance=instance)"
d7f097d69e86d8a6cdf957364998637cdd139907,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return size, properties"
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,"#    Copyright (c) 2011 Citrix Systems, Inc."
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,#
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,#    not use this file except in compliance with the License. You may obtain
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,#    a copy of the License at
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,#         http://www.apache.org/licenses/LICENSE-2.0
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,"#    Unless required by applicable law or agreed to in writing, software"
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,#    License for the specific language governing permissions and limitations
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,#    under the License.
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,""""""""
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,:mod:`glance` -- Stubs for Glance
8a50755b9df445a07140f385f1ff32db20bf683b,6f9408d7ac38d5c857e1e1cdd92c49e000742734,deleted,1,=================================
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,if errcode == libvirt.VIR_ERR_NO_DOMAIN:
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,# Domain already gone. This can safely be ignored.
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,is_okay = True
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,elif errcode == libvirt.VIR_ERR_OPERATION_INVALID:
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,try:
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,dom_info = virt_dom.info()
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,except libvirt.libvirtError as ex:
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,error_code = ex.get_error_code()
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,if error_code == libvirt.VIR_ERR_NO_DOMAIN:
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,raise exception.InstanceNotFound(instance_id=instance['name'])
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,msg = (_('Error from libvirt while getting domain info for '
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,'%(instance_name)s: [Error Code %(error_code)s] %(ex)s') %
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,"{'instance_name': instance['name'],"
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,"'error_code': error_code,"
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,'ex': ex})
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,added,0,raise exception.NovaException(msg)
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,deleted,1,if errcode == libvirt.VIR_ERR_OPERATION_INVALID:
c860280a92c2d0e32897d71aa4c6f083ee13345c,c6923ec603288e1d46fdb80e874c8e71361442f5,deleted,1,dom_info = virt_dom.info()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# Copyright (c) 2011 Citrix Systems, Inc."
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Copyright 2011 OpenStack Foundation
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    not use this file except in compliance with the License. You may obtain
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    a copy of the License at
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#         http://www.apache.org/licenses/LICENSE-2.0
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    Unless required by applicable law or agreed to in writing, software"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    License for the specific language governing permissions and limitations
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#    under the License.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Guest tools for ESX to set up network in the guest.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,On Windows we require pyWin32 installed on Python.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import array
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import logging
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import os
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import platform
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import socket
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import struct
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import subprocess
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import sys
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import time
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,from nova.i18n import _
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,PLATFORM_WIN = 'win32'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,PLATFORM_LINUX = 'linux2'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ARCH_32_BIT = '32bit'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ARCH_64_BIT = '64bit'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,NO_MACHINE_ID = 'No machine id'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Logging
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"FORMAT = ""%(asctime)s - %(levelname)s - %(message)s"""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if sys.platform == PLATFORM_WIN:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG_DIR = os.path.join(os.environ.get('ALLUSERSPROFILE'), 'openstack')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif sys.platform == PLATFORM_LINUX:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG_DIR = '/var/log/openstack'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,else:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG_DIR = 'logs'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not os.path.exists(LOG_DIR):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os.mkdir(LOG_DIR)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG_FILENAME = os.path.join(LOG_DIR, 'openstack-guest-tools.log')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.basicConfig(filename=LOG_FILENAME, format=FORMAT)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if sys.hexversion < 0x3000000:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_byte = ord    # 2.x chr to integer
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_byte = int    # 3.x byte to integer
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class ProcessExecutionError:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Process Execution Error Class."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, exit_code, stdout, stderr, cmd):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.exit_code = exit_code
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.stdout = stdout
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.stderr = stderr
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.cmd = cmd
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def __str__(self):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return str(self.exit_code)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _bytes2int(bytes):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Convert bytes to int."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,intgr = 0
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for byt in bytes:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,intgr = (intgr << 8) + _byte(byt)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return intgr
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _parse_network_details(machine_id):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"Parse the machine_id to get MAC, IP, Netmask and Gateway fields per NIC."
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"machine_id is of the form ('NIC_record#NIC_record#', '')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Each of the NIC will have record NIC_record in the form
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'MAC;IP;Netmask;Gateway;Broadcast;DNS' where ';' is field separator.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,Each record is separated by '#' from next record.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Received machine_id from vmtools : %s"") % machine_id[0])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_details = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if machine_id[1].strip() == ""1"":"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pass
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for machine_id_str in machine_id[0].split('#'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_info_list = machine_id_str.split(';')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if len(network_info_list) % 6 != 0:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,break
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,no_grps = len(network_info_list) / 6
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,i = 0
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,while i < no_grps:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,k = i * 6
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_details.append((
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k].strip().lower(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 1].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 2].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 3].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 4].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_info_list[k + 5].strip().split(',')))"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,i += 1
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""NIC information from vmtools : %s"") % network_details)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return network_details
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_windows_network_adapters():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the list of windows network adapters."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import win32com.client
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_locator = win32com.client.Dispatch('WbemScripting.SWbemLocator')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"wbem_service = wbem_locator.ConnectServer('.', 'root\cimv2')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,wbem_network_adapters = wbem_service.InstancesOf('Win32_NetworkAdapter')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_adapters = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for adapter in wbem_network_adapters:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if (adapter.NetConnectionStatus == 2 or
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter.NetConnectionStatus == 7):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = adapter.NetConnectionID
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,mac_address = adapter.MacAddress.lower()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,config = adapter.associators_(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'Win32_NetworkAdapterSetting',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'Win32_NetworkAdapterConfiguration')[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = ''
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = ''
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if config.IPEnabled:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = config.IPAddress[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = config.IPSubnet[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,#config.DefaultIPGateway[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_adapters.append({'name': adapter_name,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'mac-address': mac_address,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'ip-address': ip_address,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'subnet-mask': subnet_mask})
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return network_adapters
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_linux_network_adapters():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the list of Linux network adapters."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import fcntl
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,max_bytes = 8096
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,arch = platform.architecture()[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if arch == ARCH_32_BIT:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset1 = 32
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset2 = 32
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif arch == ARCH_64_BIT:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset1 = 16
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,offset2 = 40
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise OSError(_(""Unknown architecture: %s"") % arch)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"names = array.array('B', '\0' * max_bytes)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"outbytes = struct.unpack('iL', fcntl.ioctl("
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"sock.fileno(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x8912,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"struct.pack('iL', max_bytes, names.buffer_info()[0])))[0]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_names = [names.tostring()[n_cnt:n_cnt + offset1].split('\0', 1)[0]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for n_cnt in xrange(0, outbytes, offset2)]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for adapter_name in adapter_names:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = socket.inet_ntoa(fcntl.ioctl(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x8915,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"struct.pack('256s', adapter_name))[20:24])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,subnet_mask = socket.inet_ntoa(fcntl.ioctl(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x891b,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raw_mac_address = '%012x' % _bytes2int(fcntl.ioctl(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"0x8927,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"struct.pack('256s', adapter_name))[18:24])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"mac_address = "":"".join([raw_mac_address[m_counter:m_counter + 2]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for m_counter in range(0, len(raw_mac_address), 2)]).lower()"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _get_adapter_name_and_ip_address(network_adapters, mac_address):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the adapter name based on the MAC address."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for network_adapter in network_adapters:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if network_adapter['mac-address'] == mac_address.lower():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name = network_adapter['name']
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,ip_address = network_adapter['ip-address']
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return adapter_name, ip_address"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_win_adapter_name_and_ip_address(mac_address):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get Windows network adapter name."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_adapters = _get_windows_network_adapters()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return _get_adapter_name_and_ip_address(network_adapters, mac_address)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _get_linux_adapter_name_and_ip_address(mac_address):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get Linux network adapter name."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_adapters = _get_linux_network_adapters()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _execute(cmd_list, process_input=None, check_exit_code=True):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Executes the command with the list of arguments specified."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cmd = ' '.join(cmd_list)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Executing command: '%s'"") % cmd)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,env = os.environ.copy()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"obj = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,result = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if process_input is not None:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,result = obj.communicate(process_input)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,result = obj.communicate()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,obj.stdin.close()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if obj.returncode:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Result was %s"") % obj.returncode)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if check_exit_code and obj.returncode != 0:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(stdout, stderr) = result"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise ProcessExecutionError(exit_code=obj.returncode,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"stdout=stdout,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"stderr=stderr,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cmd=cmd)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,time.sleep(0.1)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return result
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _windows_set_networking():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IP address for the windows VM."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,program_files = os.environ.get('PROGRAMFILES')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,program_files_x86 = os.environ.get('PROGRAMFILES(X86)')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'vmtoolsd.exe')):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmware_tools_bin = os.path.join(program_files, 'VMware',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'VMware Tools', 'vmtoolsd.exe')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'VMwareService.exe')):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'VMware Tools', 'VMwareService.exe')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif program_files_x86 and os.path.exists(os.path.join(program_files_x86,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'VMware', 'VMware Tools',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vmware_tools_bin = os.path.join(program_files_x86, 'VMware',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if vmware_tools_bin:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = ['""' + vmware_tools_bin + '""', '--cmd', 'machine.id.get']"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for network_detail in _parse_network_details(_execute(cmd,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,check_exit_code=False)):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"(mac_address, ip_address, subnet_mask, gateway, broadcast,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dns_servers) = network_detail
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,name_and_ip = _get_win_adapter_name_and_ip_address(mac_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"adapter_name, current_ip_address = name_and_ip"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if adapter_name and not ip_address == current_ip_address:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'set', 'address',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'name=""%s""' % adapter_name, 'source=static', ip_address,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"subnet_mask, gateway, '1']"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_execute(cmd)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Windows doesn't let you manually set the broadcast address
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for dns_server in dns_servers:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if dns_server:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'add', 'dns',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"'name=""%s""' % adapter_name, dns_server]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.warn(_(""VMware Tools is not installed""))"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _filter_duplicates(all_entries):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,final_list = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for entry in all_entries:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if entry and entry not in final_list:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,final_list.append(entry)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return final_list
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _set_rhel_networking(network_details=None):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IPv4 network settings for RHEL distros."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,network_details = network_details or []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,all_dns_servers = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for network_detail in network_details:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,all_dns_servers.extend(dns_servers)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,name_and_ip = _get_linux_adapter_name_and_ip_address(mac_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file_name = ('/etc/sysconfig/network-scripts/ifcfg-%s' %
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Remove file
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os.remove(interface_file_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# Touch file
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['touch', interface_file_name])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"interface_file = open(interface_file_name, 'w')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nDEVICE=%s' % adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nUSERCTL=yes')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nONBOOT=yes')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nBOOTPROTO=static')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nBROADCAST=%s' % broadcast)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nNETWORK=')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nGATEWAY=%s' % gateway)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nNETMASK=%s' % subnet_mask)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nIPADDR=%s' % ip_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nMACADDR=%s' % mac_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.close()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if all_dns_servers:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file_name = ""/etc/resolv.conf"""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,os.remove(dns_file_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['touch', dns_file_name])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file = open(dns_file_name, 'w')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file.write(""; generated by OpenStack guest tools"")"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,unique_entries = _filter_duplicates(all_dns_servers)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for dns_server in unique_entries:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"dns_file.write(""\nnameserver %s"" % dns_server)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,dns_file.close()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['/sbin/service', 'network', 'restart'])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _set_ubuntu_networking(network_details=None):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IPv4 network settings for Ubuntu."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file_name = '/etc/network/interfaces'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"for device, network_detail in enumerate(network_details):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if adapter_name:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nauto %s' % adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\niface %s inet static' % adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nbroadcast %s' % broadcast)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\ngateway %s' % gateway)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\nnetmask %s' % subnet_mask)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,interface_file.write('\naddress %s\n' % ip_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Successfully configured NIC %(device)d with """
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""NIC info %(detail)s""), {'device': device,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'detail': network_detail})
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.debug(_(""Restarting networking....\n""))"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"_execute(['/etc/init.d/networking', 'restart'])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def _linux_set_networking():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set IP address for the Linux VM."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if os.path.exists('/usr/sbin/vmtoolsd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/sbin/vmtoolsd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif os.path.exists('/usr/bin/vmtoolsd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/bin/vmtoolsd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif os.path.exists('/usr/sbin/vmware-guestd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/sbin/vmware-guestd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif os.path.exists('/usr/bin/vmware-guestd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,vmware_tools_bin = '/usr/bin/vmware-guestd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cmd = [vmware_tools_bin, '--cmd', 'machine.id.get']"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"network_details = _parse_network_details(_execute(cmd,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,check_exit_code=False))
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"# TODO(sateesh): For other distros like suse, debian, BSD, etc."
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if(platform.dist()[0] == 'Ubuntu'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_set_ubuntu_networking(network_details)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif (platform.dist()[0] == 'redhat'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_set_rhel_networking(network_details)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"logging.warn(_(""Distro '%s' not supported"") % platform.dist()[0])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if __name__ == '__main__':
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pltfrm = sys.platform
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if pltfrm == PLATFORM_WIN:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_windows_set_networking()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,elif pltfrm == PLATFORM_LINUX:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_linux_set_networking()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"raise NotImplementedError(_(""Platform not implemented: '%s'"") % pltfrm)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"# Copyright (c) 2011 Citrix Systems, Inc."
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Copyright 2011 OpenStack Foundation
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    not use this file except in compliance with the License. You may obtain
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    a copy of the License at
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#         http://www.apache.org/licenses/LICENSE-2.0
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    Unless required by applicable law or agreed to in writing, software"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    License for the specific language governing permissions and limitations
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#    under the License.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,""""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,Guest tools for ESX to set up network in the guest.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,On Windows we require pyWin32 installed on Python.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import array
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import logging
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import os
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import platform
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import socket
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import struct
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import subprocess
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import sys
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import time
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,from nova.i18n import _
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,PLATFORM_WIN = 'win32'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,PLATFORM_LINUX = 'linux2'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ARCH_32_BIT = '32bit'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ARCH_64_BIT = '64bit'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,NO_MACHINE_ID = 'No machine id'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Logging
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"FORMAT = ""%(asctime)s - %(levelname)s - %(message)s"""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if sys.platform == PLATFORM_WIN:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"LOG_DIR = os.path.join(os.environ.get('ALLUSERSPROFILE'), 'openstack')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif sys.platform == PLATFORM_LINUX:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,LOG_DIR = '/var/log/openstack'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,else:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,LOG_DIR = 'logs'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if not os.path.exists(LOG_DIR):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,os.mkdir(LOG_DIR)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"LOG_FILENAME = os.path.join(LOG_DIR, 'openstack-guest-tools.log')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.basicConfig(filename=LOG_FILENAME, format=FORMAT)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if sys.hexversion < 0x3000000:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_byte = ord    # 2.x chr to integer
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_byte = int    # 3.x byte to integer
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,class ProcessExecutionError:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Process Execution Error Class."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"def __init__(self, exit_code, stdout, stderr, cmd):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.exit_code = exit_code
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.stdout = stdout
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.stderr = stderr
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,self.cmd = cmd
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def __str__(self):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return str(self.exit_code)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _bytes2int(bytes):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Convert bytes to int."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,intgr = 0
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for byt in bytes:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,intgr = (intgr << 8) + _byte(byt)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return intgr
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _parse_network_details(machine_id):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"Parse the machine_id to get MAC, IP, Netmask and Gateway fields per NIC."
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"machine_id is of the form ('NIC_record#NIC_record#', '')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,Each of the NIC will have record NIC_record in the form
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'MAC;IP;Netmask;Gateway;Broadcast;DNS' where ';' is field separator.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,Each record is separated by '#' from next record.
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Received machine_id from vmtools : %s"") % machine_id[0])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_details = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"if machine_id[1].strip() == ""1"":"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,pass
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for machine_id_str in machine_id[0].split('#'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_info_list = machine_id_str.split(';')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if len(network_info_list) % 6 != 0:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,break
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,no_grps = len(network_info_list) / 6
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,i = 0
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,while i < no_grps:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,k = i * 6
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_details.append((
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k].strip().lower(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 1].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 2].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 3].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 4].strip(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_info_list[k + 5].strip().split(',')))"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,i += 1
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""NIC information from vmtools : %s"") % network_details)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return network_details
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_windows_network_adapters():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get the list of windows network adapters."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import win32com.client
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_locator = win32com.client.Dispatch('WbemScripting.SWbemLocator')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"wbem_service = wbem_locator.ConnectServer('.', 'root\cimv2')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,wbem_network_adapters = wbem_service.InstancesOf('Win32_NetworkAdapter')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_adapters = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for adapter in wbem_network_adapters:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if (adapter.NetConnectionStatus == 2 or
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter.NetConnectionStatus == 7):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name = adapter.NetConnectionID
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,mac_address = adapter.MacAddress.lower()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,config = adapter.associators_(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'Win32_NetworkAdapterSetting',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'Win32_NetworkAdapterConfiguration')[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = ''
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,subnet_mask = ''
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if config.IPEnabled:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = config.IPAddress[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,subnet_mask = config.IPSubnet[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,#config.DefaultIPGateway[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_adapters.append({'name': adapter_name,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'mac-address': mac_address,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'ip-address': ip_address,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'subnet-mask': subnet_mask})
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return network_adapters
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_linux_network_adapters():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get the list of Linux network adapters."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,import fcntl
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,max_bytes = 8096
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,arch = platform.architecture()[0]
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if arch == ARCH_32_BIT:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset1 = 32
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset2 = 32
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif arch == ARCH_64_BIT:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset1 = 16
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,offset2 = 40
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"raise OSError(_(""Unknown architecture: %s"") % arch)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"names = array.array('B', '\0' * max_bytes)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"outbytes = struct.unpack('iL', fcntl.ioctl("
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"sock.fileno(),"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x8912,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"struct.pack('iL', max_bytes, names.buffer_info()[0])))[0]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"adapter_names = [names.tostring()[n_cnt:n_cnt + offset1].split('\0', 1)[0]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for n_cnt in xrange(0, outbytes, offset2)]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for adapter_name in adapter_names:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = socket.inet_ntoa(fcntl.ioctl(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x8915,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"struct.pack('256s', adapter_name))[20:24])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,subnet_mask = socket.inet_ntoa(fcntl.ioctl(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x891b,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,raw_mac_address = '%012x' % _bytes2int(fcntl.ioctl(
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"0x8927,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"struct.pack('256s', adapter_name))[18:24])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"mac_address = "":"".join([raw_mac_address[m_counter:m_counter + 2]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for m_counter in range(0, len(raw_mac_address), 2)]).lower()"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"def _get_adapter_name_and_ip_address(network_adapters, mac_address):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get the adapter name based on the MAC address."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for network_adapter in network_adapters:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if network_adapter['mac-address'] == mac_address.lower():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name = network_adapter['name']
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,ip_address = network_adapter['ip-address']
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"return adapter_name, ip_address"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_win_adapter_name_and_ip_address(mac_address):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get Windows network adapter name."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_adapters = _get_windows_network_adapters()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"return _get_adapter_name_and_ip_address(network_adapters, mac_address)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _get_linux_adapter_name_and_ip_address(mac_address):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Get Linux network adapter name."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_adapters = _get_linux_network_adapters()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"def _execute(cmd_list, process_input=None, check_exit_code=True):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Executes the command with the list of arguments specified."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,cmd = ' '.join(cmd_list)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Executing command: '%s'"") % cmd)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,env = os.environ.copy()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"obj = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,result = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if process_input is not None:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,result = obj.communicate(process_input)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,result = obj.communicate()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,obj.stdin.close()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if obj.returncode:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Result was %s"") % obj.returncode)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if check_exit_code and obj.returncode != 0:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"(stdout, stderr) = result"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"raise ProcessExecutionError(exit_code=obj.returncode,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"stdout=stdout,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"stderr=stderr,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,cmd=cmd)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,time.sleep(0.1)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return result
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _windows_set_networking():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IP address for the windows VM."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,program_files = os.environ.get('PROGRAMFILES')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,program_files_x86 = os.environ.get('PROGRAMFILES(X86)')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = None
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"if os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'vmtoolsd.exe')):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"vmware_tools_bin = os.path.join(program_files, 'VMware',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'VMware Tools', 'vmtoolsd.exe')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"elif os.path.exists(os.path.join(program_files, 'VMware', 'VMware Tools',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'VMwareService.exe')):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'VMware Tools', 'VMwareService.exe')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"elif program_files_x86 and os.path.exists(os.path.join(program_files_x86,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'VMware', 'VMware Tools',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"vmware_tools_bin = os.path.join(program_files_x86, 'VMware',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if vmware_tools_bin:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = ['""' + vmware_tools_bin + '""', '--cmd', 'machine.id.get']"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for network_detail in _parse_network_details(_execute(cmd,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,check_exit_code=False)):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"(mac_address, ip_address, subnet_mask, gateway, broadcast,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,dns_servers) = network_detail
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,name_and_ip = _get_win_adapter_name_and_ip_address(mac_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"adapter_name, current_ip_address = name_and_ip"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if adapter_name and not ip_address == current_ip_address:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'set', 'address',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'name=""%s""' % adapter_name, 'source=static', ip_address,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"subnet_mask, gateway, '1']"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_execute(cmd)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Windows doesn't let you manually set the broadcast address
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for dns_server in dns_servers:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if dns_server:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = ['netsh', 'interface', 'ip', 'add', 'dns',"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"'name=""%s""' % adapter_name, dns_server]"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.warn(_(""VMware Tools is not installed""))"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _filter_duplicates(all_entries):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,final_list = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for entry in all_entries:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if entry and entry not in final_list:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,final_list.append(entry)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,return final_list
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _set_rhel_networking(network_details=None):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IPv4 network settings for RHEL distros."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,network_details = network_details or []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,all_dns_servers = []
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for network_detail in network_details:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,all_dns_servers.extend(dns_servers)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,name_and_ip = _get_linux_adapter_name_and_ip_address(mac_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file_name = ('/etc/sysconfig/network-scripts/ifcfg-%s' %
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Remove file
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,os.remove(interface_file_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,# Touch file
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['touch', interface_file_name])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"interface_file = open(interface_file_name, 'w')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nDEVICE=%s' % adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nUSERCTL=yes')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nONBOOT=yes')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nBOOTPROTO=static')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nBROADCAST=%s' % broadcast)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nNETWORK=')
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nGATEWAY=%s' % gateway)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nNETMASK=%s' % subnet_mask)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nIPADDR=%s' % ip_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nMACADDR=%s' % mac_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.close()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if all_dns_servers:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file_name = ""/etc/resolv.conf"""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,os.remove(dns_file_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['touch', dns_file_name])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file = open(dns_file_name, 'w')"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file.write(""; generated by OpenStack guest tools"")"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,unique_entries = _filter_duplicates(all_dns_servers)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,for dns_server in unique_entries:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"dns_file.write(""\nnameserver %s"" % dns_server)"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,dns_file.close()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['/sbin/service', 'network', 'restart'])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _set_ubuntu_networking(network_details=None):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IPv4 network settings for Ubuntu."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file_name = '/etc/network/interfaces'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"for device, network_detail in enumerate(network_details):"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if adapter_name:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nauto %s' % adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\niface %s inet static' % adapter_name)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nbroadcast %s' % broadcast)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\ngateway %s' % gateway)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\nnetmask %s' % subnet_mask)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,interface_file.write('\naddress %s\n' % ip_address)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Successfully configured NIC %(device)d with """
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""NIC info %(detail)s""), {'device': device,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,'detail': network_detail})
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.debug(_(""Restarting networking....\n""))"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"_execute(['/etc/init.d/networking', 'restart'])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,def _linux_set_networking():
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"""""""Set IP address for the Linux VM."""""""
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if os.path.exists('/usr/sbin/vmtoolsd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/sbin/vmtoolsd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif os.path.exists('/usr/bin/vmtoolsd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/bin/vmtoolsd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif os.path.exists('/usr/sbin/vmware-guestd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/sbin/vmware-guestd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif os.path.exists('/usr/bin/vmware-guestd'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,vmware_tools_bin = '/usr/bin/vmware-guestd'
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"cmd = [vmware_tools_bin, '--cmd', 'machine.id.get']"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"network_details = _parse_network_details(_execute(cmd,"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,check_exit_code=False))
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"# TODO(sateesh): For other distros like suse, debian, BSD, etc."
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if(platform.dist()[0] == 'Ubuntu'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_set_ubuntu_networking(network_details)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif (platform.dist()[0] == 'redhat'):
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_set_rhel_networking(network_details)
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"logging.warn(_(""Distro '%s' not supported"") % platform.dist()[0])"
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if __name__ == '__main__':
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,pltfrm = sys.platform
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,if pltfrm == PLATFORM_WIN:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_windows_set_networking()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,elif pltfrm == PLATFORM_LINUX:
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,_linux_set_networking()
3ef4f63ea7a55d56d297a82f0dc9532122d9711c,ba08f5f97a660b2b8f5b623c447e23d608a0d46d,deleted,1,"raise NotImplementedError(_(""Platform not implemented: '%s'"") % pltfrm)"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_base_url(self, scheme, host, file_path):"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,if utils.is_valid_ipv6(host):
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = ""%s://[%s]/folder/%s"" % (scheme, host,"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,urllib.pathname2url(file_path))
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,else:
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = ""%s://%s/folder/%s"" % (scheme, host,"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return base_url
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = self._get_base_url(scheme, host, file_path)"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if utils.is_valid_ipv6(host):
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = ""%s://[%s]/folder/%s"" % (scheme, host, file_path)"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,else:
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = ""%s://%s/folder/%s"" % (scheme, host, file_path)"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = ""%s://%s/folder/%s"" % (scheme, host,"
160fd56da63aecf9063cdce93c67de8061d5260e,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,urllib.pathname2url(file_path))
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def _get_base_url(self, scheme, host, port, file_path):"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = (""%s://[%s]:%s/folder/%s"""
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"% (scheme, host, port, urllib.pathname2url(file_path)))"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = (""%s://%s:%s/folder/%s"""
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, host, port, data_center_name, datastore_name, cookies,"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = self._get_base_url(scheme, host, port, file_path)"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _get_base_url(self, scheme, host, file_path):"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = ""%s://[%s]/folder/%s"" % (scheme, host,"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,urllib.pathname2url(file_path))
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = ""%s://%s/folder/%s"" % (scheme, host,"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, host, data_center_name, datastore_name, cookies,"
2009eab057d9cb1f1036dbbaed9ab6ff89aa6799,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = self._get_base_url(scheme, host, file_path)"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from oslo.vmware.objects import datastore as ds_obj
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_device_capacity(device):
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# Devices pre-vSphere-5.5 only reports capacityInKB, which has"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# rounding inaccuracies. Use that only if the more accurate
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# attribute is absent.
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if hasattr(device, 'capacityInBytes'):"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return device.capacityInBytes
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,else:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return device.capacityInKB * units.Ki
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _get_device_disk_type(device):
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if getattr(device.backing, 'thinProvisioned', False):"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return constants.DISK_TYPE_THIN
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if getattr(device.backing, 'eagerlyScrub', False):"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return constants.DISK_TYPE_EAGER_ZEROED_THICK
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return constants.DEFAULT_DISK_TYPE
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,capacity_in_bytes = 0
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_device = None
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,# Determine if we need to get the details of the root disk
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,root_disk = None
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,root_device = None
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if uuid:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,root_disk = '%s.vmdk' % uuid
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,path = ds_obj.DatastorePath.parse(device.backing.fileName)
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if root_disk and path.basename == root_disk:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,root_device = device
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_device = device
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if root_disk:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_device = root_device
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if vmdk_device:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_file_path = vmdk_device.backing.fileName
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,capacity_in_bytes = _get_device_capacity(vmdk_device)
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vmdk_controller_key = vmdk_device.controllerKey
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,disk_type = _get_device_disk_type(vmdk_device)
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,adapter_type = adapter_type_dict.get(vmdk_controller_key)
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,capacity_in_bytes = None
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if uuid:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if uuid in device.backing.fileName:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmdk_file_path = device.backing.fileName
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,else:
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vmdk_controller_key = device.controllerKey
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"# Devices pre-vSphere-5.5 only reports capacityInKB, which has"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# rounding inaccuracies. Use that only if the more accurate
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# attribute is absent.
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if hasattr(device, 'capacityInBytes'):"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,capacity_in_bytes = device.capacityInBytes
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,capacity_in_bytes = device.capacityInKB * units.Ki
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if getattr(device.backing, 'thinProvisioned', False):"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"disk_type = ""thin"""
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if getattr(device.backing, 'eagerlyScrub', False):"
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"disk_type = ""eagerZeroedThick"""
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,disk_type = constants.DEFAULT_DISK_TYPE
a55300fb43dd1987e1aca5a8de815b32b0b05677,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"adapter_type = adapter_type_dict.get(vmdk_controller_key, """")"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,write_file_handle = rw_handles.FileWriteHandle(
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,read_file_handle = rw_handles.ImageReadHandle(read_iter)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,from nova.virt.vmwareapi import read_write_util
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,write_file_handle = read_write_util.VMwareHTTPWriteFile(
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,read_file_handle = read_write_util.GlanceFileRead(read_iter)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from oslo.vmware import rw_handles
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,class VMwareHTTPReadFile(rw_handles.FileHandle):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""VMware file read handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def __init__(self, host, port, data_center_name, datastore_name, cookies,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"file_path, scheme=""https""):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._base_url = self._get_base_url(scheme, host, port, file_path)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"param_list = {""dcPath"": data_center_name, ""dsName"": datastore_name}"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._base_url = self._base_url + ""?"" + urllib.urlencode(param_list)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"self._conn = self._create_read_connection(self._base_url,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,cookies=cookies)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"rw_handles.FileHandle.__init__(self, self._conn)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return self._file_handle.read(rw_handles.READ_CHUNKSIZE)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = ""%s://[%s]:%s/folder/%s"" % (scheme, host, port,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,urllib.pathname2url(file_path))
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"base_url = ""%s://%s:%s/folder/%s"" % (scheme, host, port,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"return self._file_handle.headers.get(""Content-Length"", -1)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import httplib
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import urllib2
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,import six.moves.urllib.parse as urlparse
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,from nova.openstack.common import log as logging
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG = logging.getLogger(__name__)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"USER_AGENT = ""OpenStack-ESX-Adapter"""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,READ_CHUNKSIZE = 65536
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class GlanceFileRead(object):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Glance file read handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, glance_read_iter):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.glance_read_iter = glance_read_iter
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.iter = self.get_next()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def read(self, chunk_size):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Read an item from the queue."
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,The chunk size is ignored for the Client ImageBodyIterator
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,uses its own CHUNKSIZE.
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,try:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self.iter.next()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,except StopIteration:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return """""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def get_next(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the next item from the image iterator."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for data in self.glance_read_iter:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,yield data
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def close(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""A dummy close just to maintain consistency."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pass
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class VMwareHTTPFile(object):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Base class for HTTP file."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, file_handle):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.eof = False
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.file_handle = file_handle
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def set_eof(self, eof):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Set the end of file marker."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.eof = eof
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def get_eof(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Check if the end of file has been reached."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self.eof
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Close the file handle."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.file_handle.close()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,except Exception as exc:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,LOG.exception(exc)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _build_vim_cookie_headers(self, vim_cookies):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Build ESX host session cookie headers."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cookie_header = """""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,for vim_cookie in vim_cookies:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cookie_header = vim_cookie.name + ""="" + vim_cookie.value"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,break
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return cookie_header
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def write(self, data):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Write data to the file."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,raise NotImplementedError()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Read a chunk of data."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,def get_size(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get size of the file to be read."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = (""%s://[%s]:%s/folder/%s"""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"% (scheme, host, port, urllib.pathname2url(file_path)))"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = (""%s://%s:%s/folder/%s"""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class VMwareHTTPWriteFile(VMwareHTTPFile):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""VMware file write handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, host, port, data_center_name, datastore_name, cookies,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"file_path, file_size, scheme=""https""):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = self._get_base_url(scheme, host, port, file_path)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"param_list = {""dcPath"": data_center_name, ""dsName"": datastore_name}"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"base_url = base_url + ""?"" + urllib.urlencode(param_list)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,_urlparse = urlparse.urlparse(base_url)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"scheme, netloc, path, params, query, fragment = _urlparse"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if scheme == ""http"":"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,conn = httplib.HTTPConnection(netloc)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif scheme == ""https"":"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,conn = httplib.HTTPSConnection(netloc)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"conn.putrequest(""PUT"", path + ""?"" + query)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"conn.putheader(""User-Agent"", USER_AGENT)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"conn.putheader(""Content-Length"", file_size)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"conn.putheader(""Cookie"", self._build_vim_cookie_headers(cookies))"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,conn.endheaders()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.conn = conn
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"VMwareHTTPFile.__init__(self, conn)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Write to the file."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.file_handle.send(data)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Get the response and close the connection."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self.conn.getresponse()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,except Exception:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"LOG.debug(""Exception during HTTP connection close in """
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""VMwareHTTPWrite"", exc_info=True)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"super(VMwareHTTPWriteFile, self).close()"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class VMwareHTTPReadFile(VMwareHTTPFile):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""VMware file read handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"file_path, scheme=""https""):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"headers = {'User-Agent': USER_AGENT,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,'Cookie': self._build_vim_cookie_headers(cookies)}
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"request = urllib2.Request(base_url, None, headers)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,conn = urllib2.urlopen(request)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# We are ignoring the chunk size passed for we want the pipe to hold
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# data items of the chunk-size that Glance Client uses for read
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,# while writing.
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self.file_handle.read(READ_CHUNKSIZE)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self.file_handle.headers.get(""Content-Length"", -1)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from oslo.vmware import rw_handles
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,class VMwareHTTPReadFile(rw_handles.FileHandle):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""VMware file read handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __init__(self, host, port, data_center_name, datastore_name, cookies,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"file_path, scheme=""https""):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._base_url = self._get_base_url(scheme, host, port, file_path)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"param_list = {""dcPath"": data_center_name, ""dsName"": datastore_name}"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._base_url = self._base_url + ""?"" + urllib.urlencode(param_list)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self._conn = self._create_read_connection(self._base_url,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,cookies=cookies)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"rw_handles.FileHandle.__init__(self, self._conn)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return self._file_handle.read(rw_handles.READ_CHUNKSIZE)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"base_url = ""%s://[%s]:%s/folder/%s"" % (scheme, host, port,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,urllib.pathname2url(file_path))
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"base_url = ""%s://%s:%s/folder/%s"" % (scheme, host, port,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return self._file_handle.headers.get(""Content-Length"", -1)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,import httplib
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,import urllib2
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,import six.moves.urllib.parse as urlparse
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,from nova.openstack.common import log as logging
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG = logging.getLogger(__name__)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"USER_AGENT = ""OpenStack-ESX-Adapter"""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,READ_CHUNKSIZE = 65536
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class GlanceFileRead(object):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Glance file read handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, glance_read_iter):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.glance_read_iter = glance_read_iter
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.iter = self.get_next()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def read(self, chunk_size):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Read an item from the queue."
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,The chunk size is ignored for the Client ImageBodyIterator
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,uses its own CHUNKSIZE.
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,try:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return self.iter.next()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,except StopIteration:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return """""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def get_next(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get the next item from the image iterator."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for data in self.glance_read_iter:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,yield data
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def close(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""A dummy close just to maintain consistency."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,pass
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class VMwareHTTPFile(object):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Base class for HTTP file."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, file_handle):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.eof = False
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.file_handle = file_handle
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def set_eof(self, eof):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Set the end of file marker."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.eof = eof
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def get_eof(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Check if the end of file has been reached."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return self.eof
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Close the file handle."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.file_handle.close()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,except Exception as exc:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,LOG.exception(exc)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _build_vim_cookie_headers(self, vim_cookies):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Build ESX host session cookie headers."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cookie_header = """""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for vim_cookie in vim_cookies:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cookie_header = vim_cookie.name + ""="" + vim_cookie.value"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,break
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return cookie_header
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def write(self, data):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Write data to the file."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,raise NotImplementedError()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Read a chunk of data."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def get_size(self):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get size of the file to be read."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"base_url = (""%s://[%s]:%s/folder/%s"""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"% (scheme, host, port, urllib.pathname2url(file_path)))"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"base_url = (""%s://%s:%s/folder/%s"""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class VMwareHTTPWriteFile(VMwareHTTPFile):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""VMware file write handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, host, port, data_center_name, datastore_name, cookies,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"file_path, file_size, scheme=""https""):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"base_url = self._get_base_url(scheme, host, port, file_path)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"param_list = {""dcPath"": data_center_name, ""dsName"": datastore_name}"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"base_url = base_url + ""?"" + urllib.urlencode(param_list)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_urlparse = urlparse.urlparse(base_url)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"scheme, netloc, path, params, query, fragment = _urlparse"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if scheme == ""http"":"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,conn = httplib.HTTPConnection(netloc)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif scheme == ""https"":"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,conn = httplib.HTTPSConnection(netloc)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"conn.putrequest(""PUT"", path + ""?"" + query)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"conn.putheader(""User-Agent"", USER_AGENT)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"conn.putheader(""Content-Length"", file_size)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"conn.putheader(""Cookie"", self._build_vim_cookie_headers(cookies))"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,conn.endheaders()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.conn = conn
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"VMwareHTTPFile.__init__(self, conn)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Write to the file."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.file_handle.send(data)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get the response and close the connection."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.conn.getresponse()
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,except Exception:
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"LOG.debug(""Exception during HTTP connection close in """
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""VMwareHTTPWrite"", exc_info=True)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(VMwareHTTPWriteFile, self).close()"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class VMwareHTTPReadFile(VMwareHTTPFile):
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""VMware file read handler class."""""""
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"file_path, scheme=""https""):"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"headers = {'User-Agent': USER_AGENT,"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,'Cookie': self._build_vim_cookie_headers(cookies)}
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"request = urllib2.Request(base_url, None, headers)"
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,conn = urllib2.urlopen(request)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# We are ignoring the chunk size passed for we want the pipe to hold
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# data items of the chunk-size that Glance Client uses for read
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,# while writing.
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return self.file_handle.read(READ_CHUNKSIZE)
1eb7fd233d29d2eb6c7c3c50b306c1a8602eb01f,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return self.file_handle.headers.get(""Content-Length"", -1)"
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,added,0,xml_dom = etree.fromstring(xml)
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,added,0,"graphic = xml_dom.find(""./devices/graphics[@type='vnc']"")"
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,added,0,if graphic is not None:
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,added,0,return graphic.get('port')
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,added,0,"graphic = xml_dom.find(""./devices/graphics[@type='spice']"")"
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,added,0,"return (graphic.get('port'), graphic.get('tlsPort'))"
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,from xml.dom import minidom
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,dom = minidom.parseString(xml)
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,for graphic in dom.getElementsByTagName('graphics'):
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,if graphic.getAttribute('type') == 'vnc':
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,return graphic.getAttribute('port')
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,# TODO(sleepsonthefloor): use etree instead of minidom
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,if graphic.getAttribute('type') == 'spice':
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,"return (graphic.getAttribute('port'),"
8aa429897c640434d974d90ea002d7fe8217519d,7825b7ce81dec97e997d296c3e30b5d143948abc,deleted,1,graphic.getAttribute('tlsPort'))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"class Volume(BASE, NovaBase):"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"""""""Represents a block storage device that can be attached to a VM."""""""
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,__tablename__ = 'volumes'
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,__table_args__ = (
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"Index('volumes_instance_uuid_idx', 'instance_uuid'),"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"id = Column(String(36), primary_key=True, nullable=False)"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"deleted = Column(String(36), default="""")"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,@property
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,def name(self):
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,return CONF.volume_name_template % self.id
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,ec2_id = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,user_id = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,project_id = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,snapshot_id = Column(String(36))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,host = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,size = Column(Integer)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,availability_zone = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,instance_uuid = Column(String(36))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,mountpoint = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,attach_time = Column(DateTime)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,status = Column(String(255))  # TODO(vish): enum?
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,attach_status = Column(String(255))  # TODO(vish): enum
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,scheduled_at = Column(DateTime)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,launched_at = Column(DateTime)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,terminated_at = Column(DateTime)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,display_name = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,display_description = Column(String(255))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,provider_location = Column(String(256))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,provider_auth = Column(String(256))
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,volume_type_id = Column(Integer)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"class IscsiTarget(BASE, NovaBase):"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"""""""Represents an iscsi target for a given host."""""""
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,__tablename__ = 'iscsi_targets'
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"Index('iscsi_targets_volume_id_fkey', 'volume_id'),"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"Index('iscsi_targets_host_volume_id_deleted_idx', 'host', 'volume_id',"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,'deleted')
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"id = Column(Integer, primary_key=True, nullable=False)"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,target_num = Column(Integer)
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"volume_id = Column(String(36), ForeignKey('volumes.id'))"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"volume = orm.relationship(Volume,"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"backref=orm.backref('iscsi_target', uselist=False),"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"foreign_keys=volume_id,"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,"primaryjoin='and_(IscsiTarget.volume_id==Volume.id,'"
0951cf3d194edbee213673a525c1291245958264,71c41338e4aac98ec03eec1c90ee99e43d51bcb7,deleted,1,'IscsiTarget.deleted==0)')
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,try:
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_props = self._session._call_method(vutil,"
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""get_object_properties_dict"","
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"vm_ref,"
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,lst_properties)
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,except vexc.ManagedObjectNotFoundException:
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,raise exception.InstanceNotFound(instance_id=instance.uuid)
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_props = self._session._call_method(vutil,"
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""get_object_properties_dict"","
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"vm_ref,"
ca6a563715428bfe56e85e1a67e77da99de2939a,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,lst_properties)
080cbb722c375daba93840c7505939dfbcc97e9b,bcc002809894f39c84dca5c46034468ed0469c2b,added,0,"'qpid=WARN', 'sqlalchemy=WARN', 'suds=INFO',"
080cbb722c375daba93840c7505939dfbcc97e9b,bcc002809894f39c84dca5c46034468ed0469c2b,deleted,1,"'qpid=WARN', 'sqlalchemy=WARN',"
d995e2eb9614cbe9a4b7d541cfd38da1b9daf4ee,f200587ce068482ab94e777154de3ac777269fa0,added,0,req = fakes.HTTPRequest.blank(path)
d995e2eb9614cbe9a4b7d541cfd38da1b9daf4ee,f200587ce068482ab94e777154de3ac777269fa0,deleted,1,import webob
d995e2eb9614cbe9a4b7d541cfd38da1b9daf4ee,f200587ce068482ab94e777154de3ac777269fa0,deleted,1,req = webob.Request.blank(path)
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return hardware.InstanceInfo(state=state)
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"lst_properties = [""runtime.powerState""]"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,state=constants.POWER_STATES[vm_props['runtime.powerState']])
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return hardware.InstanceInfo(state=state,"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"max_mem_kb=info['MemoryUsage'],"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"mem_kb=info['MemoryUsage'],"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"num_cpu=info['NumberOfProcessors'],"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,cpu_time_ns=info['UpTime'])
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"lst_properties = [""summary.config.numCpu"","
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""summary.config.memorySizeMB"","
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""runtime.powerState""]"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"max_mem = int(vm_props.get('summary.config.memorySizeMB', 0)) * 1024"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"num_cpu = int(vm_props.get('summary.config.numCpu', 0))"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"state=constants.POWER_STATES[vm_props['runtime.powerState']],"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"max_mem_kb=max_mem,"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"mem_kb=max_mem,"
5db9389c01b0cb6eeacf57c22550876ffcd1a87c,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,num_cpu=num_cpu)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,from nova.api import wsgi
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"for hdr, val in self._headers.items():"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"if not isinstance(val, six.text_type):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,val = six.text_type(val)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if six.PY2:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# In Py2.X Headers must be byte strings
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,response.headers[hdr] = encodeutils.safe_encode(val)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,else:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# In Py3.X Headers must be utf-8 strings
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,response.headers[hdr] = encodeutils.safe_decode(
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,encodeutils.safe_encode(val))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Deal with content_type
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"if not isinstance(content_type, six.text_type):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,content_type = six.text_type(content_type)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,response.headers['Content-Type'] = encodeutils.safe_encode(
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,content_type)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,response.headers['Content-Type'] = encodeutils.safe_decode(
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,encodeutils.safe_encode(content_type))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"#    Licensed under the Apache License, Version 2.0 (the ""License""); you may"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,#    not use this file except in compliance with the License. You may obtain
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,#    a copy of the License at
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,#
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,#         http://www.apache.org/licenses/LICENSE-2.0
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"#    Unless required by applicable law or agreed to in writing, software"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"#    distributed under the License is distributed on an ""AS IS"" BASIS, WITHOUT"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,#    License for the specific language governing permissions and limitations
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,#    under the License.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""WSGI primitives used throughout the nova WSGI apps."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import os
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import sys
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,from oslo_log import log as logging
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,from paste import deploy
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import routes.middleware
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import six
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import webob
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import nova.conf
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,from nova import exception
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"from nova.i18n import _, _LE"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,CONF = nova.conf.CONF
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,LOG = logging.getLogger(__name__)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,class Request(webob.Request):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def __init__(self, environ, *args, **kwargs):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if CONF.wsgi.secure_proxy_ssl_header:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,scheme = environ.get(CONF.wsgi.secure_proxy_ssl_header)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if scheme:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,environ['wsgi.url_scheme'] = scheme
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"super(Request, self).__init__(environ, *args, **kwargs)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,class Application(object):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Base WSGI application wrapper. Subclasses need to implement __call__."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,@classmethod
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def factory(cls, global_config, **local_config):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Used for paste app factories in paste.deploy config files."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"Any local configuration (that is, values under the [app:APPNAME]"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,section of the paste config) will be passed into the `__init__` method
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,as kwargs.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,A hypothetical configuration would look like:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,[app:wadl]
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,latest_version = 1.3
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,paste.app_factory = nova.api.fancy_api:Wadl.factory
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,which would result in a call to the `Wadl` class as
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import nova.api.fancy_api
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,fancy_api.Wadl(latest_version='1.3')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"You could of course re-implement the `factory` method in subclasses,"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,but using the kwarg passing it shouldn't be necessary.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,""""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return cls(**local_config)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def __call__(self, environ, start_response):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"r""""""Subclasses will probably want to implement __call__ like this:"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,@webob.dec.wsgify(RequestClass=Request)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def __call__(self, req):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Any of the following objects work as responses:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Option 1: simple string
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,res = 'message\n'
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Option 2: a nicely formatted HTTP exception page
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,res = exc.HTTPForbidden(explanation='Nice try')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Option 3: a webob Response object (in case you need to play with
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"# headers, or you want to be treated like an iterable, or ...)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,res = Response()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,res.app_iter = open('somefile')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Option 4: any wsgi app to be run next
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,res = self.application
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"# Option 5: you can get a Response object for a wsgi app, too, to"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# play with headers etc
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,res = req.get_response(self.application)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# You can then just return your response...
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return res
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# ... or set req.response and return None.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,req.response = res
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,See the end of http://pythonpaste.org/webob/modules/dec.html
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,for more info.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,raise NotImplementedError(_('You must implement __call__'))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,class Middleware(Application):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Base WSGI middleware."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,These classes require an application to be
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,initialized that will be called next.  By default the middleware will
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"simply call its wrapped app, or you can override __call__ to customize its"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,behavior.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"Any local configuration (that is, values under the [filter:APPNAME]"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,[filter:analytics]
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,redis_host = 127.0.0.1
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,paste.filter_factory = nova.api.analytics:Analytics.factory
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,which would result in a call to the `Analytics` class as
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,import nova.api.analytics
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"analytics.Analytics(app_from_paste, redis_host='127.0.0.1')"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,def _factory(app):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"return cls(app, **local_config)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return _factory
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def __init__(self, application):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,self.application = application
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def process_request(self, req):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Called on each request."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"If this returns None, the next application down the stack will be"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,executed. If it returns a response then that response will be returned
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,and execution will stop here.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return None
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def process_response(self, response):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Do whatever you'd like to the response."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return response
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,response = self.process_request(req)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if response:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,response = req.get_response(self.application)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return self.process_response(response)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,class Debug(Middleware):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Helper class for debugging a WSGI application."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,Can be inserted into any WSGI application chain to get information
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,about the request and response.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,print(('*' * 40) + ' REQUEST ENVIRON')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"for key, value in req.environ.items():"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"print(key, '=', value)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,print()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,resp = req.get_response(self.application)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,print(('*' * 40) + ' RESPONSE HEADERS')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"for (key, value) in resp.headers.items():"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,resp.app_iter = self.print_generator(resp.app_iter)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return resp
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,@staticmethod
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,def print_generator(app_iter):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Iterator that prints the contents of a wrapper string."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,print(('*' * 40) + ' BODY')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,for part in app_iter:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,sys.stdout.write(six.text_type(part))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,sys.stdout.flush()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,yield part
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,class Router(object):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""WSGI middleware that maps incoming requests to WSGI apps."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def __init__(self, mapper):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Create a router for the given routes.Mapper."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"Each route in `mapper` must specify a 'controller', which is a"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,WSGI app to call.  You'll probably want to specify an 'action' as
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,well and have your controller be an object that can route
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,the request to the action-specific method.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,Examples:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,mapper = routes.Mapper()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,sc = ServerController()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Explicit mapping of one route to a controller+action
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"mapper.connect(None, '/svrlist', controller=sc, action='list')"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Actions are all implicitly defined
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"mapper.resource('server', 'servers', controller=sc)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# Pointing to an arbitrary WSGI app.  You can specify the
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# {path_info:.*} parameter so the target app can be handed just that
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,# section of the URL.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"mapper.connect(None, '/v1.0/{path_info:.*}', controller=BlogApp())"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,self.map = mapper
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"self._router = routes.middleware.RoutesMiddleware(self._dispatch,"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,self.map)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Route the incoming request to a controller based on self.map."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"If no match, return a 404."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return self._router
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,def _dispatch(req):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Dispatch the request to the appropriate controller."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,Called by self._router after matching the incoming request to a route
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,and putting the information into req.environ.  Either returns 404
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,or the routed WSGI app's response.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,match = req.environ['wsgiorg.routing_args'][1]
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if not match:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return webob.exc.HTTPNotFound()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,app = match['controller']
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,return app
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,class Loader(object):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Used to load WSGI applications from paste configurations."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def __init__(self, config_path=None):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Initialize the loader, and attempt to find the config."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,:param config_path: Full or relative path to the paste config.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,:returns: None
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,self.config_path = None
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,config_path = config_path or CONF.wsgi.api_paste_config
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if not os.path.isabs(config_path):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,self.config_path = CONF.find_file(config_path)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,elif os.path.exists(config_path):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,self.config_path = config_path
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,if not self.config_path:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,raise exception.ConfigNotFound(path=config_path)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"def load_app(self, name):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"""""""Return the paste URLMap wrapped WSGI application."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,:param name: Name of the application to load.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,:returns: Paste URLMap object wrapping the requested application.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,:raises: `nova.exception.PasteAppNotFound`
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,try:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"LOG.debug(""Loading app %(name)s from %(path)s"","
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"{'name': name, 'path': self.config_path})"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"return deploy.loadapp(""config:%s"" % self.config_path, name=name)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,except LookupError:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"LOG.exception(_LE(""Couldn't lookup app: %s""), name)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,added,0,"raise exception.PasteAppNotFound(name=name, path=self.config_path)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,from nova import utils
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,from nova import wsgi
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if response.headers.get('Content-Length'):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"# NOTE(andreykurilin): we need to encode 'Content-Length' header,"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"# since webob.Response auto sets it if ""body"" attr is presented."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# https://github.com/Pylons/webob/blob/1.5.0b0/webob/response.py#L147
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response.headers['Content-Length'] = utils.utf8(
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response.headers['Content-Length'])
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"for hdr, value in self._headers.items():"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response.headers[hdr] = utils.utf8(value)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response.headers['Content-Type'] = utils.utf8(content_type)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response.headers[hdr] = utils.utf8(val)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,utils.utf8(val))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import sys
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,from paste import deploy
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import routes.middleware
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import six
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import webob.dec
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import webob.exc
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,class Request(webob.Request):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def __init__(self, environ, *args, **kwargs):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if CONF.wsgi.secure_proxy_ssl_header:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,scheme = environ.get(CONF.wsgi.secure_proxy_ssl_header)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if scheme:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,environ['wsgi.url_scheme'] = scheme
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"super(Request, self).__init__(environ, *args, **kwargs)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,class Application(object):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Base WSGI application wrapper. Subclasses need to implement __call__."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,@classmethod
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def factory(cls, global_config, **local_config):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Used for paste app factories in paste.deploy config files."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"Any local configuration (that is, values under the [app:APPNAME]"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,section of the paste config) will be passed into the `__init__` method
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,as kwargs.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,A hypothetical configuration would look like:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,[app:wadl]
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,latest_version = 1.3
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,paste.app_factory = nova.api.fancy_api:Wadl.factory
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,which would result in a call to the `Wadl` class as
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import nova.api.fancy_api
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,fancy_api.Wadl(latest_version='1.3')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"You could of course re-implement the `factory` method in subclasses,"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,but using the kwarg passing it shouldn't be necessary.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,""""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return cls(**local_config)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def __call__(self, environ, start_response):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"r""""""Subclasses will probably want to implement __call__ like this:"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,@webob.dec.wsgify(RequestClass=Request)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def __call__(self, req):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Any of the following objects work as responses:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Option 1: simple string
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,res = 'message\n'
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Option 2: a nicely formatted HTTP exception page
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,res = exc.HTTPForbidden(explanation='Nice try')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Option 3: a webob Response object (in case you need to play with
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"# headers, or you want to be treated like an iterable, or ...)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,res = Response()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,res.app_iter = open('somefile')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Option 4: any wsgi app to be run next
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,res = self.application
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"# Option 5: you can get a Response object for a wsgi app, too, to"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# play with headers etc
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,res = req.get_response(self.application)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# You can then just return your response...
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return res
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# ... or set req.response and return None.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,req.response = res
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,See the end of http://pythonpaste.org/webob/modules/dec.html
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,for more info.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,raise NotImplementedError(_('You must implement __call__'))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,class Middleware(Application):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Base WSGI middleware."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,These classes require an application to be
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,initialized that will be called next.  By default the middleware will
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"simply call its wrapped app, or you can override __call__ to customize its"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,behavior.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"Any local configuration (that is, values under the [filter:APPNAME]"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,[filter:analytics]
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,redis_host = 127.0.0.1
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,paste.filter_factory = nova.api.analytics:Analytics.factory
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,which would result in a call to the `Analytics` class as
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,import nova.api.analytics
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"analytics.Analytics(app_from_paste, redis_host='127.0.0.1')"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,def _factory(app):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"return cls(app, **local_config)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return _factory
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def __init__(self, application):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,self.application = application
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def process_request(self, req):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Called on each request."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"If this returns None, the next application down the stack will be"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,executed. If it returns a response then that response will be returned
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,and execution will stop here.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return None
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def process_response(self, response):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Do whatever you'd like to the response."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return response
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response = self.process_request(req)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if response:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,response = req.get_response(self.application)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return self.process_response(response)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,class Debug(Middleware):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Helper class for debugging a WSGI application."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,Can be inserted into any WSGI application chain to get information
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,about the request and response.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,print(('*' * 40) + ' REQUEST ENVIRON')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"for key, value in req.environ.items():"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"print(key, '=', value)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,print()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,resp = req.get_response(self.application)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,print(('*' * 40) + ' RESPONSE HEADERS')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"for (key, value) in resp.headers.items():"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,resp.app_iter = self.print_generator(resp.app_iter)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return resp
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,@staticmethod
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,def print_generator(app_iter):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Iterator that prints the contents of a wrapper string."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,print(('*' * 40) + ' BODY')
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,for part in app_iter:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,sys.stdout.write(six.text_type(part))
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,sys.stdout.flush()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,yield part
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,class Router(object):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""WSGI middleware that maps incoming requests to WSGI apps."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def __init__(self, mapper):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Create a router for the given routes.Mapper."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"Each route in `mapper` must specify a 'controller', which is a"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,WSGI app to call.  You'll probably want to specify an 'action' as
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,well and have your controller be an object that can route
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,the request to the action-specific method.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,Examples:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,mapper = routes.Mapper()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,sc = ServerController()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Explicit mapping of one route to a controller+action
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"mapper.connect(None, '/svrlist', controller=sc, action='list')"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Actions are all implicitly defined
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"mapper.resource('server', 'servers', controller=sc)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# Pointing to an arbitrary WSGI app.  You can specify the
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# {path_info:.*} parameter so the target app can be handed just that
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,# section of the URL.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"mapper.connect(None, '/v1.0/{path_info:.*}', controller=BlogApp())"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,self.map = mapper
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"self._router = routes.middleware.RoutesMiddleware(self._dispatch,"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,self.map)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Route the incoming request to a controller based on self.map."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"If no match, return a 404."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return self._router
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,def _dispatch(req):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Dispatch the request to the appropriate controller."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,Called by self._router after matching the incoming request to a route
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,and putting the information into req.environ.  Either returns 404
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,or the routed WSGI app's response.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,match = req.environ['wsgiorg.routing_args'][1]
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if not match:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return webob.exc.HTTPNotFound()
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,app = match['controller']
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,return app
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,class Loader(object):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Used to load WSGI applications from paste configurations."""""""
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def __init__(self, config_path=None):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Initialize the loader, and attempt to find the config."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,:param config_path: Full or relative path to the paste config.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,:returns: None
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,self.config_path = None
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,config_path = config_path or CONF.wsgi.api_paste_config
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if not os.path.isabs(config_path):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,self.config_path = CONF.find_file(config_path)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,elif os.path.exists(config_path):
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,self.config_path = config_path
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,if not self.config_path:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,raise exception.ConfigNotFound(path=config_path)
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"def load_app(self, name):"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"""""""Return the paste URLMap wrapped WSGI application."
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,:param name: Name of the application to load.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,:returns: Paste URLMap object wrapping the requested application.
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,:raises: `nova.exception.PasteAppNotFound`
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,try:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"LOG.debug(""Loading app %(name)s from %(path)s"","
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"{'name': name, 'path': self.config_path})"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"return deploy.loadapp(""config:%s"" % self.config_path, name=name)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,except LookupError:
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"LOG.exception(_LE(""Couldn't lookup app: %s""), name)"
ef6f4e4c8ec82e2c9f9988fe2e04591ee01220e6,16a8f4a98973ae5e5541f2b43db4dc36eaed2647,deleted,1,"raise exception.PasteAppNotFound(name=name, path=self.config_path)"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,CONTROLLER_TO_ADAPTER_TYPE = {
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualLsiLogicController"": constants.DEFAULT_ADAPTER_TYPE,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualBusLogicController"": constants.ADAPTER_TYPE_BUSLOGIC,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualIDEController"": constants.ADAPTER_TYPE_IDE,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""VirtualLsiLogicSASController"": constants.ADAPTER_TYPE_LSILOGICSAS,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""ParaVirtualSCSIController"": constants.ADAPTER_TYPE_PARAVIRTUAL"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,}
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_hardware_devices(session, vm_ref):"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,return vim_util.get_array_items(hardware_devices)
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"def get_vmdk_info(session, vm_ref, uuid=None):"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"""""""Returns information for the primary VMDK attached to the given VM."""""""
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,"hardware_devices = get_hardware_devices(session, vm_ref)"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,elif device.__class__.__name__ in CONTROLLER_TO_ADAPTER_TYPE:
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,adapter_type_dict[device.key] = CONTROLLER_TO_ADAPTER_TYPE[
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,device.__class__.__name__]
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def get_vmdk_info(session, vm_ref, uuid=None):"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Returns information for the primary VMDK attached to the given VM."""""""
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"if hardware_devices.__class__.__name__ == ""ArrayOfVirtualDevice"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,hardware_devices = hardware_devices.VirtualDevice
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif device.__class__.__name__ == ""VirtualLsiLogicController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type_dict[device.key] = constants.DEFAULT_ADAPTER_TYPE
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif device.__class__.__name__ == ""VirtualBusLogicController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_BUSLOGIC
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif device.__class__.__name__ == ""VirtualIDEController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_IDE
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif device.__class__.__name__ == ""VirtualLsiLogicSASController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_LSILOGICSAS
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"elif device.__class__.__name__ == ""ParaVirtualSCSIController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_PARAVIRTUAL
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,CONTROLLER_TO_ADAPTER_TYPE = {
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualLsiLogicController"": constants.DEFAULT_ADAPTER_TYPE,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualBusLogicController"": constants.ADAPTER_TYPE_BUSLOGIC,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualIDEController"": constants.ADAPTER_TYPE_IDE,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""VirtualLsiLogicSASController"": constants.ADAPTER_TYPE_LSILOGICSAS,"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""ParaVirtualSCSIController"": constants.ADAPTER_TYPE_PARAVIRTUAL"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,}
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_hardware_devices(session, vm_ref):"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return vim_util.get_array_items(hardware_devices)
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def get_vmdk_info(session, vm_ref, uuid=None):"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Returns information for the primary VMDK attached to the given VM."""""""
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"hardware_devices = get_hardware_devices(session, vm_ref)"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,elif device.__class__.__name__ in CONTROLLER_TO_ADAPTER_TYPE:
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,adapter_type_dict[device.key] = CONTROLLER_TO_ADAPTER_TYPE[
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,device.__class__.__name__]
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def get_vmdk_info(session, vm_ref, uuid=None):"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Returns information for the primary VMDK attached to the given VM."""""""
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if hardware_devices.__class__.__name__ == ""ArrayOfVirtualDevice"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,hardware_devices = hardware_devices.VirtualDevice
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif device.__class__.__name__ == ""VirtualLsiLogicController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type_dict[device.key] = constants.DEFAULT_ADAPTER_TYPE
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif device.__class__.__name__ == ""VirtualBusLogicController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_BUSLOGIC
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif device.__class__.__name__ == ""VirtualIDEController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_IDE
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif device.__class__.__name__ == ""VirtualLsiLogicSASController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_LSILOGICSAS
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"elif device.__class__.__name__ == ""ParaVirtualSCSIController"":"
ec93474a84aff1c184a58fe436ea4a0842bd9825,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,adapter_type_dict[device.key] = constants.ADAPTER_TYPE_PARAVIRTUAL
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,added,0,"name=BASE_POLICY_NAME,"
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,added,0,"check_str=base.RULE_ADMIN_API,"
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,added,0,"description=""Show console connection information for a given console """
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,added,0,operations=[
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,added,0,"],"
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,added,0,scope_types=['system'])
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,deleted,1,"BASE_POLICY_NAME,"
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,deleted,1,"base.RULE_ADMIN_API,"
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,deleted,1,"""Show console connection information for a given console """
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,deleted,1,[
8e2d0333d925ae905ea6d0afdf7194c8667d6dfa,43657646104e61184bd119bfc2a83a18c851ddd2,deleted,1,])
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,added,0,"name=BASE_POLICY_NAME,"
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,added,0,"check_str=base.RULE_ADMIN_API,"
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,added,0,"description=""""""List and show details of bare metal nodes."
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,added,0,operations=[
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,added,0,"],"
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,added,0,"scope_types=['system']),"
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,deleted,1,"BASE_POLICY_NAME,"
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,deleted,1,"base.RULE_ADMIN_API,"
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,deleted,1,"""""""List and show details of bare metal nodes."
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,deleted,1,[
672aa45dd1229c55d06d862d6b359eb3925308a4,69b0c0d1d499d53c59ee364a78d65d4519ffc38d,deleted,1,"]),"
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"for i, vif_info in enumerate(vif_infos):"
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"extra_specs.vif_limits, i)"
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def _create_vif_spec(client_factory, vif_info, vif_limits=None, offset=0):"
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,net_device.key = -47 - offset
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for vif_info in vif_infos:
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,extra_specs.vif_limits)
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _create_vif_spec(client_factory, vif_info, vif_limits=None):"
a5d153a4c64f6947531823c0df91be5cbc491977,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,net_device.key = -47
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,added,0,def fake_is_vim_object(module):
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,added,0,"test.stub_out('nova.virt.vmwareapi.session.VMwareAPISession.vim',"
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,added,0,test.stub_out('nova.virt.vmwareapi.session.VMwareAPISession.'
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,added,0,"'_is_vim_object',"
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"def fake_is_vim_object(arg, module):"
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"test.stub_out('nova.virt.vmwareapi.driver.VMwareAPISession.vim',"
03fd208c562214476019ff2d7cc38f95c06e1348,e21763b15948603e618d4435335ef3785dc5660a,deleted,1,"test.stub_out('nova.virt.vmwareapi.driver.VMwareAPISession._is_vim_object',"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,from nova.virt.vmwareapi import session
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,added,0,self._session = session.VMwareAPISession(scheme=scheme)
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,from oslo_vmware import api
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,from oslo_vmware import vim
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,self._session = VMwareAPISession(scheme=scheme)
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,class VMwareAPISession(api.VMwareAPISession):
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Sets up a session with the VC/ESX host and handles all"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,the calls made to the host.
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,""""""""
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def __init__(self, host_ip=CONF.vmware.host_ip,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"host_port=CONF.vmware.host_port,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"username=CONF.vmware.host_username,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"password=CONF.vmware.host_password,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"retry_count=CONF.vmware.api_retry_count,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"scheme=""https"","
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cacert=CONF.vmware.ca_file,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"insecure=CONF.vmware.insecure,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pool_size=CONF.vmware.connection_pool_size):
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"super(VMwareAPISession, self).__init__("
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"host=host_ip,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"port=host_port,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"server_username=username,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"server_password=password,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"api_retry_count=retry_count,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"task_poll_interval=CONF.vmware.task_poll_interval,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"scheme=scheme,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"create_session=True,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"cacert=cacert,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"insecure=insecure,"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,pool_size=pool_size)
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _is_vim_object(self, module):"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Check if the module is a VIM Object instance."""""""
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return isinstance(module, vim.Vim)"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _call_method(self, module, method, *args, **kwargs):"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Calls a method within the module specified with"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,args provided.
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,if not self._is_vim_object(module):
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self.invoke_api(module, method, self.vim, *args, **kwargs)"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,else:
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"return self.invoke_api(module, method, *args, **kwargs)"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"def _wait_for_task(self, task_ref):"
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,"""""""Return a Deferred that will give the result of the given task."
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,The task is polled until it completes.
03fd208c562214476019ff2d7cc38f95c06e1348,7a60b5c406336c5f410d1a98868c3f93d888ea0c,deleted,1,return self.wait_for_task(task_ref)
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from nova.virt.vmwareapi import session
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self._session = session.VMwareAPISession(scheme=scheme)
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,from oslo_vmware import api
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,from oslo_vmware import vim
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self._session = VMwareAPISession(scheme=scheme)
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,class VMwareAPISession(api.VMwareAPISession):
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Sets up a session with the VC/ESX host and handles all"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,the calls made to the host.
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,""""""""
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def __init__(self, host_ip=CONF.vmware.host_ip,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_port=CONF.vmware.host_port,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"username=CONF.vmware.host_username,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"password=CONF.vmware.host_password,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"retry_count=CONF.vmware.api_retry_count,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"scheme=""https"","
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cacert=CONF.vmware.ca_file,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"insecure=CONF.vmware.insecure,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,pool_size=CONF.vmware.connection_pool_size):
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"super(VMwareAPISession, self).__init__("
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host=host_ip,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"port=host_port,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"server_username=username,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"server_password=password,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"api_retry_count=retry_count,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"task_poll_interval=CONF.vmware.task_poll_interval,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"scheme=scheme,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"create_session=True,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cacert=cacert,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"insecure=insecure,"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,pool_size=pool_size)
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _is_vim_object(self, module):"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Check if the module is a VIM Object instance."""""""
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return isinstance(module, vim.Vim)"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _call_method(self, module, method, *args, **kwargs):"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Calls a method within the module specified with"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,args provided.
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if not self._is_vim_object(module):
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return self.invoke_api(module, method, self.vim, *args, **kwargs)"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,else:
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return self.invoke_api(module, method, *args, **kwargs)"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _wait_for_task(self, task_ref):"
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Return a Deferred that will give the result of the given task."
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,The task is polled until it completes.
03fd208c562214476019ff2d7cc38f95c06e1348,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return self.wait_for_task(task_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,from oslo_vmware import vim_util
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _create_object(table_obj):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"_db_content.setdefault(table_obj.obj._type, {})"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,update_object(table_obj)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_object(obj_ref):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return _db_content[obj_ref.type][obj_ref.value]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_objects(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return _db_content[obj_type].values()
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_first_object(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get the first object of an object type"""""""
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return next(iter(_db_content[obj_type].values()))
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_first_object_ref(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get the first reference of an object type"""""""
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return get_first_object(obj_type).obj
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def _no_objects_of_type(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return not _db_content.get(obj_type)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def add_object(self, obj):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,self.objects.append(obj)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def get_object_refs(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""""""Get iterator over object References of the type."""""""
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for obj in _db_content[obj_type].values():
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,yield obj.obj
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def update_object(table_obj):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_db_content[table_obj.obj._type][table_obj.obj.value] = table_obj
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,def __repr__(self):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return f'{self._type}:{self.value}'
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"def __eq__(self, other):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return (other is not None and
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vim_util.get_moref_value(other) == self.value and
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vim_util.get_moref_type(other) == self.type)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"# We can't just dump the managed-object, because it may be circular"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"return ""{}:{}({})"".format(self.obj._type, self.obj.value,"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,""", "".join("
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""{}={}"".format(p.name, p.val if p.name == ""name"" else ""<>"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for p in self.propSet))
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_ref = get_first_object_ref(""HostSystem"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_list = DataObject()
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_list.ManagedObjectReference = []
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""vm"", vm_list)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,pool = get_object(r_pool)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""vm"", pool.get(""vm""))"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_sys = get_object(host_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if _no_objects_of_type(""HostNetworkSystem""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if _no_objects_of_type(""HostStorageSystem""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_net_obj = get_first_object(""HostNetworkSystem"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_net_ref = host_net_obj.obj
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"self.set(""configManager.networkSystem"", host_net_ref)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_storage_sys_key = get_first_object_ref('HostStorageSystem')
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if _no_objects_of_type(""Network""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"net_ref = get_first_object_ref(""Network"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_storage_sys = get_object(host_storage_sys_key)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"if _no_objects_of_type(""Folder""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"folder_ref = get_first_object_ref(""Folder"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(host_net_system)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(host_storage_system)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(host_system)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(data_center)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(data_store)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(res_pool)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(folder)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(network)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"for i, host in enumerate(get_object_refs(""HostSystem"")):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,cluster._add_host(host)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if i >= 1:
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,break
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(cluster)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vm_path = ds_obj.DatastorePath(get_first_object(""Datastore""))"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"res_pool_ref = get_first_object_ref(""ResourcePool"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"for value in get_objects(""Datastore""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,ds = value.obj
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(vm)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,res_pool = get_object(res_pool_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(task)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"vms = _db_content.get(""VirtualMachine"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,if not vms:
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,try:
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,return vms[vm_ref.value]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,except KeyError:
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"""there"" % vm_ref.value)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"for vm in get_objects(""VirtualMachine""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_refs.append(vm.obj)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,_create_object(virtual_machine)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"del _db_content[""VirtualMachine""][vm_ref.value]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,vm_mdo = _get_vm_mdo(vm_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo_refs = list(get_object_refs(spec_type))
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,parent_mdo = get_object(obj_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo_list = _db_content[spec_type]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,mdo = mdo_list[mdo_ref.value]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,prop_list = [
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"Prop(prop_name, mdo.get(prop_name))"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,for prop_name in properties
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,"host_mdo = get_first_object(""HostSystem"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,added,0,host_storage_sys = get_first_object('HostStorageSystem')
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,from oslo_serialization import jsonutils
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _create_object(table, table_obj):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_db_content.setdefault(table, {})"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,_db_content[table][table_obj.obj] = table_obj
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _get_object(obj_ref):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return _db_content[obj_ref.type][obj_ref]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _get_objects(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_objs = FakeRetrieveResult()
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for key in _db_content[obj_type]:
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_objs.add_object(_db_content[obj_type][key])
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return lst_objs
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def add_object(self, object):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,self.objects.append(object)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,def _get_object_refs(obj_type):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""""""Get object References of the type."""""""
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_objs = []
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,lst_objs.append(key)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"def _update_object(table, table_obj):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,return jsonutils.dumps({elem.name: elem.val
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for elem in self.propSet})
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_ref = (_db_content[""HostSystem""]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"[list(_db_content[""HostSystem""].keys())[0]].obj)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_sys = _get_object(host_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if _db_content.get(""HostNetworkSystem"", None) is None:"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,if not _get_object_refs('HostStorageSystem'):
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_net_key = list(_db_content[""HostNetworkSystem""].keys())[0]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_net_sys = _db_content[""HostNetworkSystem""][host_net_key].obj"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"self.set(""configManager.networkSystem"", host_net_sys)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_storage_sys_key = _get_object_refs('HostStorageSystem')[0]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if _db_content.get(""Network"", None) is None:"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"net_ref = _db_content[""Network""]["
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"list(_db_content[""Network""].keys())[0]].obj"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_storage_sys = _get_object(host_storage_sys_key)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if _db_content.get(""Folder"", None) is None:"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"folder_ref = _db_content[""Folder""]["
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"list(_db_content[""Folder""].keys())[0]].obj"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object(""HostNetworkSystem"", host_net_system)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object(""HostStorageSystem"", host_storage_system)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('HostSystem', host_system)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('Datacenter', data_center)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('Datastore', data_store)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('ResourcePool', res_pool)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('Folder', folder)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('Network', network)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cluster._add_host(_get_object_refs(""HostSystem"")[0])"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"cluster._add_host(_get_object_refs(""HostSystem"")[1])"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object('ClusterComputeResource', cluster)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_path = ds_obj.DatastorePath(
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,list(_db_content['Datastore'].values())[0])
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,res_pool_ref = list(_db_content['ResourcePool'].keys())[0]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_ref = list(_db_content[""HostSystem""].keys())[0]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"for key, value in _db_content[""Datastore""].items():"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,ds = key
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object(""VirtualMachine"", vm)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,res_pool = _get_object(res_pool_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object(""Task"", task)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if _db_content.get(""VirtualMachine"", None) is None:"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"if vm_ref not in _db_content.get(""VirtualMachine""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""there"" % vm_ref)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"return _db_content.get(""VirtualMachine"")[vm_ref]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"for vm_ref in _db_content.get(""VirtualMachine""):"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm = _get_object(vm_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,vm_refs.append(vm_ref)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_create_object(""VirtualMachine"", virtual_machine)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"del _db_content[""VirtualMachine""][vm_ref]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"raise exception.NotFound(""No Virtual Machine has been """
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"""registered yet"")"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"raise exception.NotFound(""Virtual Machine with ref %s is not """
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"vm_mdo = _db_content.get(""VirtualMachine"").get(vm_ref)"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,mdo_refs = _db_content[spec_type]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,parent_mdo = _db_content[obj_ref.type][obj_ref]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,mdo = _db_content[spec_type][mdo_ref]
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,prop_list = []
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,for prop_name in properties:
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"prop = Prop(prop_name, mdo.get(prop_name))"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,prop_list.append(prop)
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"_host_sk = list(_db_content[""HostSystem""].keys())[0]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,"host_mdo = _db_content[""HostSystem""][_host_sk]"
56055ede03fff633020e0f34fa4da5c8457a89c6,f952992f035ec130b7608e9851ef9c3becc2047a,deleted,1,host_storage_sys = _get_objects('HostStorageSystem').objects[0]
