commit_id,line,line_level_label,count,line_score,row
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// set the env variables, then run scripts as a child process.",1,3,1.0,1
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (er || !st.isDirectory()) {,1,3,1.0,2
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (p === d) {,1,3,1.0,3
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (prefix !== 'npm_package_') return env,1,3,1.0,4
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (i.charAt(0) === '_' && i.indexOf('_' + namePref) !== 0 || i.match(/:_/)) {,1,3,1.0,5
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (value instanceof Stream || Array.isArray(value)) return,1,3,1.0,6
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.warn('lifecycle', 'The node binary used for scripts is', foundExecPath, 'but npm is using', process.execPath, 'itself. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.')",1,3,1.0,7
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!unsafe) {,1,2,0.6666666666666666,8
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} else if (code) {,1,2,0.6666666666666666,9
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (signal) {,1,2,0.6666666666666666,10
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} else if (process.platform === 'win32') {,1,2,0.6666666666666666,11
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (customShell) {,1,2,0.6666666666666666,12
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (log.level !== 'silent') {,1,2,0.6666666666666666,13
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function cb (er) {,1,2,0.6666666666666666,14
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (unsafe) {,1,2,0.6666666666666666,15
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"fs.stat(opts.dir, function (statError, d) {",1,2,0.6666666666666666,16
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (running) {,1,2,0.6666666666666666,17
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (er.code !== 'EPERM') {,1,2,0.6666666666666666,18
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!i.match(/^npm_/)) {,1,2,0.6666666666666666,19
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (statError && statError.code === 'ENOENT' && opts.dir.split(path.sep).slice(-1)[0] === 'node_modules') {,1,2,0.6666666666666666,20
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// check for a hook script, run if present.",1,2,0.6666666666666666,21
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (er) return cb(),1,2,0.6666666666666666,22
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var note = '\n> ' + pkg._id + ' ' + stage + ' ' + wd +,1,2,0.6666666666666666,23
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} else if (!data.hasOwnProperty('_lifecycleEnv')) {,1,2,0.6666666666666666,24
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (i.charAt(0) !== '_') {,1,2,0.6666666666666666,25
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (i === 'readme') {,1,2,0.6666666666666666,26
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (data[i] && typeof data[i] === 'object') {,1,2,0.6666666666666666,27
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (i.indexOf(namePref) === 0) {,1,2,0.6666666666666666,28
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} else if (i.indexOf(verPref) === 0) {,1,2,0.6666666666666666,29
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return env,1,2,0.6666666666666666,30
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (queue.length) {,1,2,0.6666666666666666,31
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!env) {,1,2,0.6666666666666666,32
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// run package lifecycle scripts in the package root, or the nearest parent.",1,2,0.6666666666666666,33
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!opts.unsafePerm) env.TMPDIR = wd,1,2,0.6666666666666666,34
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"return cb(null, d)",1,2,0.6666666666666666,35
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (process.platform === 'win32') {,1,2,0.6666666666666666,36
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (e.match(/^PATH$/i)) {,1,2,0.6666666666666666,37
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return pkg._id + '~' + stage + ':',1,2,0.6666666666666666,38
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (opts.ignoreScripts) {,1,2,0.6666666666666666,39
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (stage === 'prepublish' && opts.ignorePrepublish) {,1,2,0.6666666666666666,40
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!pkg.scripts[stage]) return cb(),1,2,0.6666666666666666,41
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"validWd(wd || path.resolve(opts.dir, pkg.name), function (er, wd) {",1,2,0.6666666666666666,42
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (er) return cb(er),1,2,0.6666666666666666,43
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"if ((wd.indexOf(opts.dir) !== 0 || _incorrectWorkingDirectory(wd, pkg)) &&",1,2,0.6666666666666666,44
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!pkg) return cb(new Error('Invalid package data')),1,2,0.6666666666666666,45
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (shouldPrependCurrentNodeDirToPATH(opts.scriptsPrependNodePath)) {,1,2,0.6666666666666666,46
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (cfgsetting === false) return false,1,2,0.6666666666666666,47
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (packageLifecycle) {,1,2,0.6666666666666666,48
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (foundExecPath) {,1,2,0.6666666666666666,49
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (isDifferentNodeInPath && !shouldPrependCurrentNodeDirToPATH.hasWarned) {,1,2,0.6666666666666666,50
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (cfgsetting === true) return true,1,2,0.6666666666666666,51
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (cfgsetting === 'warn-only') {,1,2,0.6666666666666666,52
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} else if (opts.failOk) {,1,2,0.6666666666666666,53
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (opts.force) {,1,2,0.6666666666666666,54
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (er) {,1,2,0.6666666666666666,55
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var p = path.dirname(d),1,2,0.6666666666666666,56
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function procInterupt () {,1,1,0.3333333333333333,57
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var er = new Error('Exit status ' + code),1,1,0.3333333333333333,58
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function procKill () {,1,1,0.3333333333333333,59
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return cb(er),1,1,0.3333333333333333,60
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"proc.on('exit', function () {",1,1,0.3333333333333333,61
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.stage = stage,1,1,0.3333333333333333,62
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.message = pkg._id + ' ' + stage + ': `' + cmd + '`\n' +,1,1,0.3333333333333333,63
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.info('lifecycle', logid(pkg, stage), 'Failed to exec ' + stage + ' script')",1,1,0.3333333333333333,64
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"uidNumber(user, group, function (er, uid, gid) {",1,1,0.3333333333333333,65
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"proc.on('close', function (code, signal) {",1,1,0.3333333333333333,66
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,sh = process.env.comspec || 'cmd',1,1,0.3333333333333333,67
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var conf = {,1,1,0.3333333333333333,68
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function runCmd_ (cmd, pkg, env, wd, opts, stage, unsafe, uid, gid, cb_) {",1,1,0.3333333333333333,69
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,unsafe = true,1,1,0.3333333333333333,70
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var group = unsafe ? null : opts.group,1,1,0.3333333333333333,71
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"fs.stat(hook, function (er) {",1,1,0.3333333333333333,72
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var user = unsafe ? null : opts.user,1,1,0.3333333333333333,73
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function runHookLifecycle (pkg, env, wd, opts, cb) {",1,1,0.3333333333333333,74
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,Object.keys(opts.config).forEach(function (i) {,1,1,0.3333333333333333,75
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function makeEnv (data, opts, prefix, env) {",1,1,0.3333333333333333,76
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env,1,1,0.3333333333333333,77
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return,1,1,0.3333333333333333,78
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,for (var i in conf) {,1,1,0.3333333333333333,79
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,";[pkgConfig, pkgVerConfig].forEach(function (conf) {",1,1,0.3333333333333333,80
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,else if (typeof value !== 'string') value = JSON.stringify(value),1,1,0.3333333333333333,81
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,else if (typeof value === 'number') value = '' + value,1,1,0.3333333333333333,82
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!value) value = '',1,1,0.3333333333333333,83
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (i.match(/umask/)) value = umask.toString(value),1,1,0.3333333333333333,84
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"{ name: d.name, version: d.version, path: d.path },",1,1,0.3333333333333333,85
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,prefix = prefix || 'npm_package_',1,1,0.3333333333333333,86
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var d = data[i],1,1,0.3333333333333333,87
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} catch (ex) {,1,1,0.3333333333333333,88
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,for (i in data) {,1,1,0.3333333333333333,89
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,{,1,1,0.3333333333333333,90
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (opts.production) env.NODE_ENV = 'production',1,1,0.3333333333333333,91
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,for (var i in process.env) {,1,1,0.3333333333333333,92
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env = {},1,1,0.3333333333333333,93
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var unsafe = opts.unsafePerm,1,1,0.3333333333333333,94
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function procError (er) {,1,1,0.3333333333333333,95
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function runCmd (note, cmd, pkg, env, stage, wd, opts, cb) {",1,1,0.3333333333333333,96
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// prefer current node interpreter in child scripts,1,1,0.3333333333333333,97
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var p = wd.split(/[\\\/]node_modules[\\\/]/),1,1,0.3333333333333333,98
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function lifecycle_ (pkg, stage, wd, opts, env, cb) {",1,1,0.3333333333333333,99
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return wd.lastIndexOf(pkg.name) !== wd.length - pkg.name.length,1,1,0.3333333333333333,100
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function _incorrectWorkingDirectory (wd, pkg) {",1,1,0.3333333333333333,101
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// even if it's never used, sh freaks out.",1,1,0.3333333333333333,102
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env.npm_node_execpath = env.NODE = env.NODE || process.execPath,1,1,0.3333333333333333,103
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"var env = makeEnv(pkg, opts)",1,1,0.3333333333333333,104
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return cb(),1,1,0.3333333333333333,105
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"'%s %s (wd=%s)', pkg._id, pkg.scripts[stage], wd",1,1,0.3333333333333333,106
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.warn('lifecycle', logid(pkg, stage), 'cannot run in wd',",1,1,0.3333333333333333,107
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,!opts.unsafePerm && pkg.scripts[stage]) {,1,1,0.3333333333333333,108
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (!pkg.scripts) pkg.scripts = {},1,1,0.3333333333333333,109
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,while (pkg && pkg._data) pkg = pkg._data,1,1,0.3333333333333333,110
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function lifecycle (pkg, stage, wd, opts, cb) {",1,1,0.3333333333333333,111
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"return lifecycle(pkg, stage, wd, opts, cb)",1,1,0.3333333333333333,112
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function logid (pkg, stage) {",1,1,0.3333333333333333,113
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,Object.keys(process.env).forEach(function (e) {,1,1,0.3333333333333333,114
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,p.forEach(function (pp) {,1,1,0.3333333333333333,115
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env.npm_lifecycle_event = stage,1,1,0.3333333333333333,116
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,if (env[PATH]) pathArr.push(env[PATH]),1,1,0.3333333333333333,117
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return false,1,1,0.3333333333333333,118
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var stage = env.npm_lifecycle_event,1,1,0.3333333333333333,119
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} else {,1,1,0.3333333333333333,120
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function runPackageLifecycle (pkg, env, wd, opts, cb) {",1,1,0.3333333333333333,121
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"return validWd(p, cb)",1,1,0.3333333333333333,122
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return cb(new Error('Could not find suitable wd')),1,1,0.3333333333333333,123
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"fs.stat(d, function (er, st) {",1,1,0.3333333333333333,124
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"function validWd (d, cb) {",1,1,0.3333333333333333,125
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,return isDifferentNodeInPath,1,1,0.3333333333333333,126
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function dequeue () {,1,1,0.3333333333333333,127
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.warn('lifecycle', 'npm is using', process.execPath, 'but there is no node binary in the current PATH. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.')",1,1,0.3333333333333333,128
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,} catch (e) {,1,1,0.3333333333333333,129
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,try {,1,1,0.3333333333333333,130
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function shouldPrependCurrentNodeDirToPATH (cfgsetting) {,1,1,0.3333333333333333,131
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er = null,1,1,0.3333333333333333,132
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,function done (er) {,1,1,0.3333333333333333,133
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.silly('lifecycle', logid(pkg, stage), 'no script for ' + stage + ', continuing')",1,1,0.3333333333333333,134
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.removeListener('SIGTERM', procKill)",1,0,0.0,135
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.once('SIGINT', procInterupt)",1,0,0.0,136
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.message,1,0,0.0,137
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.code = 'ELIFECYCLE',1,0,0.0,138
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.warn('', 'Local package.json exists, but node_modules missing, did you mean to install?')",1,0,0.0,139
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.pkgid = pkg._id,1,0,0.0,140
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.script = cmd,1,0,0.0,141
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.pkgname = pkg.name,1,0,0.0,142
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,proc.kill(),1,0,0.0,143
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.removeListener('SIGTERM', procInterupt)",1,0,0.0,144
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.removeListener('SIGINT', procKill)",1,0,0.0,145
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,'\n> ' + cmd,1,0,0.0,146
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,proc.kill('SIGINT'),1,0,0.0,147
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,process.exit(),1,0,0.0,148
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.once('SIGINT', procKill)",1,0,0.0,149
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"var hook = path.join(opts.dir, '.hooks', stage)",1,0,0.0,150
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.once('SIGTERM', procKill)",1,0,0.0,151
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var cmd = hook,1,0,0.0,152
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"stdio: [ 0, 1, 2 ]",1,0,0.0,153
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,procError(er),1,0,0.0,154
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,er.errno = code,1,0,0.0,155
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"env: env,",1,0,0.0,156
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env[i] = process.env[i],1,0,0.0,157
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,conf.uid = uid ^ 0,1,0,0.0,158
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,conf.gid = gid ^ 0,1,0,0.0,159
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var sh = 'sh',1,0,0.0,160
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var shFlag = '-c',1,0,0.0,161
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var customShell = opts.scriptShell,1,0,0.0,162
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,sh = customShell,1,0,0.0,163
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,shFlag = '/d /s /c',1,0,0.0,164
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,conf.windowsVerbatimArguments = true,1,0,0.0,165
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.verbose('lifecycle', logid(pkg, stage), 'PATH:', env[PATH])",1,0,0.0,166
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.verbose('lifecycle', logid(pkg, stage), 'CWD:', wd)",1,0,0.0,167
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.silly('lifecycle', logid(pkg, stage), 'Args:', [shFlag, cmd])",1,0,0.0,168
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"var proc = spawn(sh, [shFlag, cmd], conf)",1,0,0.0,169
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"proc.on('error', procError)",1,0,0.0,170
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.silly('lifecycle', logid(pkg, stage), 'Returned: code:', code, ' signal:', signal)",1,0,0.0,171
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"process.kill(process.pid, signal)",1,0,0.0,172
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"runCmd(note, hook, pkg, env, stage, wd, opts, cb)",1,0,0.0,173
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,prefix = 'npm_config_',1,0,0.0,174
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// express and others respect the NODE_ENV value.,1,0,0.0,175
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var k,1,0,0.0,176
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// in some rare cases (e.g. working with nerf darts), there are segmented",1,0,0.0,177
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// ""private"" (underscore-prefixed) config names -- don't export",1,0,0.0,178
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var value = opts.config[i],1,0,0.0,179
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,value = value.indexOf('\n') !== -1,1,0,0.0,180
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,? JSON.stringify(value),1,0,0.0,181
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,: value,1,0,0.0,182
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"i = i.replace(/^_+/, '')",1,0,0.0,183
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"k = i.substr(namePref.length).replace(/[^a-zA-Z0-9_]/g, '_')",1,0,0.0,184
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var namePref = data.name + ':',1,0,0.0,185
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,pkgConfig[k] = value,1,0,0.0,186
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"k = i.substr(verPref.length).replace(/[^a-zA-Z0-9_]/g, '_')",1,0,0.0,187
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,pkgVerConfig[k] = value,1,0,0.0,188
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env[envKey] = value,1,0,0.0,189
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,prefix = 'npm_package_config_',1,0,0.0,190
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var envKey = (prefix + i),1,0,0.0,191
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,process.nextTick(dequeue),1,0,0.0,192
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var verPref = data.name + '@' + data.version + ':',1,0,0.0,193
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var pkgVerConfig = {},1,0,0.0,194
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"Object.defineProperty(data, '_lifecycleEnv',",1,0,0.0,195
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// usually these are package objects.,1,0,0.0,196
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"value: env,",1,0,0.0,197
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,enumerable: false,1,0,0.0,198
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"var envKey = (prefix + i).replace(/[^a-zA-Z0-9_]/g, '_')",1,0,0.0,199
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,continue,1,0,0.0,200
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// quick and dirty detection for cyclical structures,1,0,0.0,201
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,JSON.stringify(data[i]),1,0,0.0,202
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"makeEnv(data[i], opts, envKey + '_', env)",1,0,0.0,203
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// just get the path and basic details.,1,0,0.0,204
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var pkgConfig = {},1,0,0.0,205
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,makeEnv(,1,0,0.0,206
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"opts,",1,0,0.0,207
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"envKey + '_',",1,0,0.0,208
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env[envKey] = String(data[i]),1,0,0.0,209
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env[envKey] = env[envKey].indexOf('\n') !== -1,1,0,0.0,210
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,? JSON.stringify(env[envKey]),1,0,0.0,211
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,: env[envKey],1,0,0.0,212
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"cwd: wd,",1,0,0.0,213
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var uidNumber = require('uid-number'),1,0,0.0,214
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,log.resume(),1,0,0.0,215
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"cb_.apply(null, arguments)",1,0,0.0,216
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.info('lifecycle', logid(pkg, stage), pkg._id)",1,0,0.0,217
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.info('lifecycle', logid(pkg, stage), 'ignored because ignore-scripts is set to true', pkg._id)",1,0,0.0,218
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,pkg.scripts = {},1,0,0.0,219
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.info('lifecycle', logid(pkg, stage), 'ignored because ignore-prepublish is set to true', pkg._id)",1,0,0.0,220
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,delete pkg.scripts.prepublish,1,0,0.0,221
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,),1,0,0.0,222
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env.npm_execpath = require.main.filename,1,0,0.0,223
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env.INIT_CWD = process.cwd(),1,0,0.0,224
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// 'nobody' typically doesn't have permission to write to /tmp,1,0,0.0,225
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"lifecycle_(pkg, stage, wd, opts, env, cb)",1,0,0.0,226
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var pathArr = [],1,0,0.0,227
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var acc = path.resolve(p.shift()),1,0,0.0,228
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"pathArr.unshift(path.join(acc, 'node_modules', '.bin'))",1,0,0.0,229
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"acc = path.join(acc, 'node_modules', pp)",1,0,0.0,230
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// we also unshift the bundled node-gyp-bin folder so that,1,0,0.0,231
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// the bundled one will be used for installing things.,1,0,0.0,232
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"pathArr.unshift(path.join(__dirname, '..', '..', 'bin', 'node-gyp-bin'))",1,0,0.0,233
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,}),1,0,0.0,234
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,},1,0,0.0,235
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,PATH = e,1,0,0.0,236
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var spawn = require('./spawn'),1,0,0.0,237
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,const log = require('npmlog'),0,0,0.0,238
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log: log,",0,0,0.0,239
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,const lifecycle = require('npm-lifecycle'),0,0,0.0,240
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"lifecycle(pkg, stage, wd, opts).then(cb, cb)",0,0,0.0,241
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,exports.makeEnv = makeEnv,1,0,0.0,242
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,exports._incorrectWorkingDirectory = _incorrectWorkingDirectory,1,0,0.0,243
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var log = require('npmlog'),1,0,0.0,244
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var path = require('path'),1,0,0.0,245
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,PATH = 'Path',1,0,0.0,246
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var fs = require('graceful-fs'),1,0,0.0,247
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var chain = require('slide').chain,1,0,0.0,248
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var Stream = require('stream').Stream,1,0,0.0,249
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var PATH = 'PATH',1,0,0.0,250
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var umask = require('umask'),1,0,0.0,251
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var which = require('which'),1,0,0.0,252
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"// windows calls it's path 'Path' usually, but this is not guaranteed.",1,0,0.0,253
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,pathArr.push(path.dirname(process.execPath)),1,0,0.0,254
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env[PATH] = pathArr.join(process.platform === 'win32' ? ';' : ':'),1,0,0.0,255
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var packageLifecycle = pkg.scripts && pkg.scripts.hasOwnProperty(stage),1,0,0.0,256
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"queue.push([note, cmd, pkg, env, stage, wd, cb])",1,0,0.0,257
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,'\n> ' + cmd + '\n',1,0,0.0,258
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"runCmd(note, cmd, pkg, env, stage, wd, opts, cb)",1,0,0.0,259
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var running = false,1,0,0.0,260
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var queue = [],1,0,0.0,261
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,running = false,1,0,0.0,262
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var r = queue.shift(),1,0,0.0,263
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"runCmd.apply(null, r)",1,0,0.0,264
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,running = true,1,0,0.0,265
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,shouldPrependCurrentNodeDirToPATH.hasWarned = true,1,0,0.0,266
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,log.pause(),1,0,0.0,267
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,log.clearProgress(),1,0,0.0,268
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,console.log(note),1,0,0.0,269
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,log.showProgress(),1,0,0.0,270
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.verbose('lifecycle', logid(pkg, stage), 'unsafe-perm in lifecycle', unsafe)",1,0,0.0,271
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"runCmd_(cmd, pkg, env, wd, opts, stage, unsafe, 0, 0, cb)",1,0,0.0,272
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"runCmd_(cmd, pkg, env, wd, opts, stage, unsafe, uid, gid, cb)",1,0,0.0,273
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var cmd = env.npm_lifecycle_script,1,0,0.0,274
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,isDifferentNodeInPath = true,1,0,0.0,275
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// define this here so it's available to all scripts.,1,0,0.0,276
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"[runHookLifecycle, pkg, env, wd, opts]",1,0,0.0,277
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env.npm_lifecycle_script = pkg.scripts[stage],1,0,0.0,278
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.info('lifecycle', logid(pkg, stage), 'forced, continuing', er)",1,0,0.0,279
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"log.warn('lifecycle', logid(pkg, stage), 'continuing anyway', er.message)",1,0,0.0,280
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,cb(er),1,0,0.0,281
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,chain(,1,0,0.0,282
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,[,1,0,0.0,283
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"packageLifecycle && [runPackageLifecycle, pkg, env, wd, opts],",1,0,0.0,284
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"],",1,0,0.0,285
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,fs.realpathSync(foundExecPath).toUpperCase(),1,0,0.0,286
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,done,1,0,0.0,287
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var isDifferentNodeInPath,1,0,0.0,288
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var isWindows = process.platform === 'win32',1,0,0.0,289
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,var foundExecPath,1,0,0.0,290
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,"foundExecPath = which.sync(path.basename(process.execPath), {pathExt: isWindows ? ';' : ':'})",1,0,0.0,291
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,// Apply `fs.realpath()` here to avoid false positives when `node` is a symlinked executable.,1,0,0.0,292
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,isDifferentNodeInPath = fs.realpathSync(process.execPath).toUpperCase() !==,1,0,0.0,293
56a6dd3ad00e6efcc1b1dfb6b84eb21eca82352d,env[envKey] = conf[i],1,0,0.0,294
