commit_id,line,line_level_label,count,line_score,row
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Updating replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",0,14,1.0,1
678a8f06bef5b026f044eba73983363a64763e25,"LOG.warn(""Creation disabled so not creating a replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",0,14,1.0,2
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Updating replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",1,14,1.0,3
678a8f06bef5b026f044eba73983363a64763e25,"onApplyError(""Failed to update replicationController from "" + sourceName + "". "" + e + "". "" + replicationController, e);",1,14,1.0,4
678a8f06bef5b026f044eba73983363a64763e25,"LOG.warn(""Creation disabled so not creating a replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",1,14,1.0,5
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Updating replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",0,14,1.0,6
678a8f06bef5b026f044eba73983363a64763e25,"onApplyError(""Failed to update replicationController from "" + sourceName + "". "" + e + "". "" + replicationController, e);",0,14,1.0,7
678a8f06bef5b026f044eba73983363a64763e25,"LOG.warn(""Creation disabled so not creating a replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",0,14,1.0,8
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Updating replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",1,14,1.0,9
678a8f06bef5b026f044eba73983363a64763e25,"onApplyError(""Failed to update replicationController from "" + sourceName + "". "" + e + "". "" + replicationController, e);",1,14,1.0,10
678a8f06bef5b026f044eba73983363a64763e25,"LOG.warn(""Creation disabled so not creating a replicationController from "" + sourceName + "" namespace "" + namespace + "" name "" + getName(replicationController));",1,14,1.0,11
678a8f06bef5b026f044eba73983363a64763e25,"onApplyError(""Failed to update replicationController from "" + sourceName + "". "" + e + "". "" + replicationController, e);",0,14,1.0,12
678a8f06bef5b026f044eba73983363a64763e25,"onApplyError(""Failed to create config from "" + sourceName + "". "" + e, e);",1,10,0.7142857142857142,13
678a8f06bef5b026f044eba73983363a64763e25,"getLog().info(""Using kubernetes at: "" + api.getAddress() + "" in namespace "" + api.getNamespace());",1,9,0.6428571428571428,14
678a8f06bef5b026f044eba73983363a64763e25,"getLog().info(""Using kubernetes at: "" + kubernetes.getAddress() + "" in namespace "" + kubernetes.getNamespace());",0,9,0.6428571428571428,15
678a8f06bef5b026f044eba73983363a64763e25,"LOG.warn(""Unknown JSON type "" + kindNode + "". JSON: "" + tree);",1,7,0.5,16
678a8f06bef5b026f044eba73983363a64763e25,"onApplyError(""Failed to process "" + json + "". "" + e, e);",1,7,0.5,17
678a8f06bef5b026f044eba73983363a64763e25,"log.debug(""Service "" + id + "" has ports: "" + ports);",0,6,0.42857142857142855,18
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""rollingUpgradePreserveScale "" + rollingUpgradePreserveScale + "" new replicas is "" + newSpec.getReplicas());",0,6,0.42857142857142855,19
678a8f06bef5b026f044eba73983363a64763e25,"json = e.getMessage() + "". object: "" + route;",0,5,0.3571428571428571,20
678a8f06bef5b026f044eba73983363a64763e25,"json = e.getMessage() + "". object: "" + route;",0,5,0.3571428571428571,21
678a8f06bef5b026f044eba73983363a64763e25,"json = e.getMessage() + "". object: "" + route;",1,5,0.3571428571428571,22
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Rolling upgrade of the RC "" + namespace + ""/"" + id);",0,5,0.3571428571428571,23
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Rolling upgrade of the RC "" + namespace + ""/"" + id);",0,5,0.3571428571428571,24
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Rolling upgrade of the RC "" + namespace + ""/"" + id);",1,5,0.3571428571428571,25
678a8f06bef5b026f044eba73983363a64763e25,"@Parameter(property = ""fabric8.apply.failOnError"", defaultValue = ""true"")",1,3,0.21428571428571427,26
678a8f06bef5b026f044eba73983363a64763e25,"@Parameter(property = ""fabric8.apply.domain"", defaultValue = ""${env.KUBERNETES_DOMAIN}"")",1,3,0.21428571428571427,27
678a8f06bef5b026f044eba73983363a64763e25,"LOG.warn(""No JSON kind for: "" + tree);",1,3,0.21428571428571427,28
678a8f06bef5b026f044eba73983363a64763e25,"@Parameter(property = ""fabric8.apply.createRoutes"", defaultValue = ""true"")",0,3,0.21428571428571427,29
678a8f06bef5b026f044eba73983363a64763e25,"@Parameter(property = ""fabric8.apply.domain"", defaultValue = ""${env.KUBERNETES_DOMAIN}"")",0,3,0.21428571428571427,30
678a8f06bef5b026f044eba73983363a64763e25,* By default lets ignore the kubernetes services and any service which does not expose ports 80 and 443,0,2,0.14285714285714285,31
678a8f06bef5b026f044eba73983363a64763e25,} catch (Exception e) {,0,2,0.14285714285714285,32
678a8f06bef5b026f044eba73983363a64763e25,private KubernetesClient kubernetes = new KubernetesClient();,1,2,0.14285714285714285,33
678a8f06bef5b026f044eba73983363a64763e25,Controller controller = new Controller(this.kubernetes);,1,2,0.14285714285714285,34
678a8f06bef5b026f044eba73983363a64763e25,"getLog().warn(""No fabric8.apply.routeDomain property or $KUBERNETES_DOMAIN environment variable so cannot create any OpenShift Routes"");",1,2,0.14285714285714285,35
678a8f06bef5b026f044eba73983363a64763e25,"getLog().warn(""Could not load routes; we maybe are not connected to an OpenShift environment? "" + e, e);",1,2,0.14285714285714285,36
678a8f06bef5b026f044eba73983363a64763e25,"routeSpec.setHost(host + ""."" + Strings.stripPrefix(routeDomain, "".""));",1,2,0.14285714285714285,37
678a8f06bef5b026f044eba73983363a64763e25,} catch (JsonProcessingException e) {,1,2,0.14285714285714285,38
678a8f06bef5b026f044eba73983363a64763e25,"getLog().debug(""Created route: "" + json);",1,2,0.14285714285714285,39
678a8f06bef5b026f044eba73983363a64763e25,} else {,0,2,0.14285714285714285,40
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting ReplicationController: "" + id);",0,2,0.14285714285714285,41
678a8f06bef5b026f044eba73983363a64763e25,Object answer = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).replace(replicationController);,0,2,0.14285714285714285,42
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting ReplicationController: "" + id);",1,2,0.14285714285714285,43
678a8f06bef5b026f044eba73983363a64763e25,} else {,1,2,0.14285714285714285,44
678a8f06bef5b026f044eba73983363a64763e25,Object answer = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).replace(replicationController);,1,2,0.14285714285714285,45
678a8f06bef5b026f044eba73983363a64763e25,} catch (Exception e) {,1,2,0.14285714285714285,46
678a8f06bef5b026f044eba73983363a64763e25,} else {,0,2,0.14285714285714285,47
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting ReplicationController: "" + id);",0,2,0.14285714285714285,48
678a8f06bef5b026f044eba73983363a64763e25,Object answer = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).replace(replicationController);,0,2,0.14285714285714285,49
678a8f06bef5b026f044eba73983363a64763e25,} catch (Exception e) {,0,2,0.14285714285714285,50
678a8f06bef5b026f044eba73983363a64763e25,} else {,1,2,0.14285714285714285,51
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting ReplicationController: "" + id);",1,2,0.14285714285714285,52
678a8f06bef5b026f044eba73983363a64763e25,Object answer = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).replace(replicationController);,1,2,0.14285714285714285,53
678a8f06bef5b026f044eba73983363a64763e25,} catch (Exception e) {,1,2,0.14285714285714285,54
678a8f06bef5b026f044eba73983363a64763e25,"@Parameter(property = ""fabric8.apply.recreate"")",1,2,0.14285714285714285,55
678a8f06bef5b026f044eba73983363a64763e25,} else if (isRecreateMode()) {,0,2,0.14285714285714285,56
678a8f06bef5b026f044eba73983363a64763e25,"log.debug(""Created route: "" + json);",0,2,0.14285714285714285,57
678a8f06bef5b026f044eba73983363a64763e25,} else if (dto instanceof KubernetesList) {,0,2,0.14285714285714285,58
678a8f06bef5b026f044eba73983363a64763e25,} catch (JsonProcessingException e) {,0,2,0.14285714285714285,59
678a8f06bef5b026f044eba73983363a64763e25,KubernetesClient kubernetes = getKubernetes();,0,2,0.14285714285714285,60
678a8f06bef5b026f044eba73983363a64763e25,Controller controller = new Controller(this.kubernetes);,0,2,0.14285714285714285,61
678a8f06bef5b026f044eba73983363a64763e25,"getLog().warn(""No fabric8.apply.routeDomain property or $KUBERNETES_DOMAIN environment variable so cannot create any OpenShift Routes"");",0,2,0.14285714285714285,62
678a8f06bef5b026f044eba73983363a64763e25,String namespace = kubernetes.getNamespace();,0,2,0.14285714285714285,63
678a8f06bef5b026f044eba73983363a64763e25,} catch (Exception e) {,0,2,0.14285714285714285,64
678a8f06bef5b026f044eba73983363a64763e25,Service service = (Service) object;,0,2,0.14285714285714285,65
678a8f06bef5b026f044eba73983363a64763e25,"route.setHost(host + ""."" + Strings.stripPrefix(routeDomain, "".""));",0,2,0.14285714285714285,66
678a8f06bef5b026f044eba73983363a64763e25,} catch (JsonProcessingException e) {,0,2,0.14285714285714285,67
678a8f06bef5b026f044eba73983363a64763e25,"getLog().debug(""Created route: "" + json);",0,2,0.14285714285714285,68
678a8f06bef5b026f044eba73983363a64763e25,Controller controller = new Controller(kubernetes);,1,2,0.14285714285714285,69
678a8f06bef5b026f044eba73983363a64763e25,"getLog().warn(""Could not load routes; we maybe are not connected to an OpenShift environment? "" + e, e);",0,2,0.14285714285714285,70
678a8f06bef5b026f044eba73983363a64763e25,} else if (dto instanceof JsonNode) {,1,2,0.14285714285714285,71
678a8f06bef5b026f044eba73983363a64763e25,Controller controller = createController();,0,2,0.14285714285714285,72
678a8f06bef5b026f044eba73983363a64763e25,"public static Route createRouteForService(String routeDomainPostfix, String namespace, Service service, Log log) {",0,2,0.14285714285714285,73
678a8f06bef5b026f044eba73983363a64763e25,"} else if (Objects.equal(""Template"", kind)) {",1,2,0.14285714285714285,74
678a8f06bef5b026f044eba73983363a64763e25,"routeSpec.setHost(host + ""."" + Strings.stripPrefix(routeDomainPostfix, "".""));",0,2,0.14285714285714285,75
678a8f06bef5b026f044eba73983363a64763e25,"log.warn(""Could not load routes; we maybe are not connected to an OpenShift environment? "" + e, e);",0,2,0.14285714285714285,76
678a8f06bef5b026f044eba73983363a64763e25,"log.warn(""No fabric8.apply.routeDomain property or $KUBERNETES_DOMAIN environment variable so cannot create any OpenShift Routes"");",0,2,0.14285714285714285,77
678a8f06bef5b026f044eba73983363a64763e25,Log log = getLog();,0,2,0.14285714285714285,78
678a8f06bef5b026f044eba73983363a64763e25,} catch (Exception e) {,1,2,0.14285714285714285,79
678a8f06bef5b026f044eba73983363a64763e25,} catch (IOException e) {,1,2,0.14285714285714285,80
678a8f06bef5b026f044eba73983363a64763e25,} else {,1,2,0.14285714285714285,81
678a8f06bef5b026f044eba73983363a64763e25,},0,1,0.07142857142857142,82
678a8f06bef5b026f044eba73983363a64763e25,if (isRecreateMode()) {,0,1,0.07142857142857142,83
678a8f06bef5b026f044eba73983363a64763e25,try {,0,1,0.07142857142857142,84
678a8f06bef5b026f044eba73983363a64763e25,"if (UserConfigurationCompare.configEqual(replicationController, old)) {",0,1,0.07142857142857142,85
678a8f06bef5b026f044eba73983363a64763e25,if (deletePodsOnReplicationControllerUpdate) {,0,1,0.07142857142857142,86
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting any pods for the replication controller to ensure they use the new configuration"");",0,1,0.07142857142857142,87
678a8f06bef5b026f044eba73983363a64763e25,this.rollingUpgrade = rollingUpgrade;,0,1,0.07142857142857142,88
678a8f06bef5b026f044eba73983363a64763e25,if (!isAllowCreate()) {,0,1,0.07142857142857142,89
678a8f06bef5b026f044eba73983363a64763e25,public boolean isRollingUpgrade() {,0,1,0.07142857142857142,90
678a8f06bef5b026f044eba73983363a64763e25,public void setRollingUpgrade(boolean rollingUpgrade) {,0,1,0.07142857142857142,91
678a8f06bef5b026f044eba73983363a64763e25,ReplicationController old = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).get();,1,1,0.07142857142857142,92
678a8f06bef5b026f044eba73983363a64763e25,if (isRunning(old)) {,1,1,0.07142857142857142,93
678a8f06bef5b026f044eba73983363a64763e25,ReplicationController old = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).get();,0,1,0.07142857142857142,94
678a8f06bef5b026f044eba73983363a64763e25,"if (UserConfigurationCompare.configEqual(replicationController, old)) {",1,1,0.07142857142857142,95
678a8f06bef5b026f044eba73983363a64763e25,if (isRunning(old)) {,0,1,0.07142857142857142,96
678a8f06bef5b026f044eba73983363a64763e25,"KubernetesHelper.setName(route, namespace, id + ""-route"");",1,1,0.07142857142857142,97
678a8f06bef5b026f044eba73983363a64763e25,if (rollingUpgrade) {,0,1,0.07142857142857142,98
678a8f06bef5b026f044eba73983363a64763e25,kubernetes.setNamespace(namespace);,1,1,0.07142857142857142,99
678a8f06bef5b026f044eba73983363a64763e25,if (Strings.isNotBlank(namespace)) {,1,1,0.07142857142857142,100
678a8f06bef5b026f044eba73983363a64763e25,public KubernetesClient getKubernetes() {,1,1,0.07142857142857142,101
678a8f06bef5b026f044eba73983363a64763e25,},1,1,0.07142857142857142,102
678a8f06bef5b026f044eba73983363a64763e25,json = KubernetesHelper.toJson(route);,1,1,0.07142857142857142,103
678a8f06bef5b026f044eba73983363a64763e25,try {,1,1,0.07142857142857142,104
678a8f06bef5b026f044eba73983363a64763e25,String json = null;,1,1,0.07142857142857142,105
678a8f06bef5b026f044eba73983363a64763e25,"String host = Strings.stripSuffix(Strings.stripSuffix(id, ""-service""), ""."");",1,1,0.07142857142857142,106
678a8f06bef5b026f044eba73983363a64763e25,ObjectReference objectRef = new ObjectReference();,1,1,0.07142857142857142,107
678a8f06bef5b026f044eba73983363a64763e25,try {,1,1,0.07142857142857142,108
678a8f06bef5b026f044eba73983363a64763e25,Route route = new Route();,1,1,0.07142857142857142,109
678a8f06bef5b026f044eba73983363a64763e25,if (Strings.isNotBlank(id)) {,1,1,0.07142857142857142,110
678a8f06bef5b026f044eba73983363a64763e25,String id = KubernetesHelper.getName(service);,1,1,0.07142857142857142,111
678a8f06bef5b026f044eba73983363a64763e25,if (Strings.isNullOrBlank(routeDomain)) {,1,1,0.07142857142857142,112
678a8f06bef5b026f044eba73983363a64763e25,if (isRecreateMode()) {,1,1,0.07142857142857142,113
678a8f06bef5b026f044eba73983363a64763e25,if (rollingUpgradePreserveScale && newSpec != null && oldSpec != null) {,0,1,0.07142857142857142,114
678a8f06bef5b026f044eba73983363a64763e25,if (deletePodsOnReplicationControllerUpdate) {,1,1,0.07142857142857142,115
678a8f06bef5b026f044eba73983363a64763e25,if (!isAllowCreate()) {,0,1,0.07142857142857142,116
678a8f06bef5b026f044eba73983363a64763e25,* Should we fail the build if an apply fails?,1,1,0.07142857142857142,117
678a8f06bef5b026f044eba73983363a64763e25,if (!isAllowCreate()) {,1,1,0.07142857142857142,118
678a8f06bef5b026f044eba73983363a64763e25,},1,1,0.07142857142857142,119
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting any pods for the replication controller to ensure they use the new configuration"");",1,1,0.07142857142857142,120
678a8f06bef5b026f044eba73983363a64763e25,if (deletePodsOnReplicationControllerUpdate) {,1,1,0.07142857142857142,121
678a8f06bef5b026f044eba73983363a64763e25,try {,1,1,0.07142857142857142,122
678a8f06bef5b026f044eba73983363a64763e25,if (isRecreateMode()) {,1,1,0.07142857142857142,123
678a8f06bef5b026f044eba73983363a64763e25,"if (UserConfigurationCompare.configEqual(replicationController, old)) {",1,1,0.07142857142857142,124
678a8f06bef5b026f044eba73983363a64763e25,if (isRunning(old)) {,1,1,0.07142857142857142,125
678a8f06bef5b026f044eba73983363a64763e25,ReplicationController old = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).get();,1,1,0.07142857142857142,126
678a8f06bef5b026f044eba73983363a64763e25,if (rollingUpgrade) {,1,1,0.07142857142857142,127
678a8f06bef5b026f044eba73983363a64763e25,this.rollingUpgradePreserveScale = rollingUpgradePreserveScale;,0,1,0.07142857142857142,128
678a8f06bef5b026f044eba73983363a64763e25,public void setRollingUpgradePreserveScale(boolean rollingUpgradePreserveScale) {,0,1,0.07142857142857142,129
678a8f06bef5b026f044eba73983363a64763e25,public boolean isRollingUpgradePreserveScale() {,0,1,0.07142857142857142,130
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting any pods for the replication controller to ensure they use the new configuration"");",0,1,0.07142857142857142,131
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Deleting any pods for the replication controller to ensure they use the new configuration"");",1,1,0.07142857142857142,132
678a8f06bef5b026f044eba73983363a64763e25,if (deletePodsOnReplicationControllerUpdate) {,0,1,0.07142857142857142,133
678a8f06bef5b026f044eba73983363a64763e25,try {,0,1,0.07142857142857142,134
678a8f06bef5b026f044eba73983363a64763e25,},0,1,0.07142857142857142,135
678a8f06bef5b026f044eba73983363a64763e25,if (replicas != null) {,0,1,0.07142857142857142,136
678a8f06bef5b026f044eba73983363a64763e25,Integer replicas = oldSpec.getReplicas();,0,1,0.07142857142857142,137
678a8f06bef5b026f044eba73983363a64763e25,if (rollingUpgrade) {,0,1,0.07142857142857142,138
678a8f06bef5b026f044eba73983363a64763e25,ReplicationControllerSpec oldSpec = old.getSpec();,0,1,0.07142857142857142,139
678a8f06bef5b026f044eba73983363a64763e25,ReplicationControllerSpec newSpec = replicationController.getSpec();,0,1,0.07142857142857142,140
678a8f06bef5b026f044eba73983363a64763e25,"if (UserConfigurationCompare.configEqual(replicationController, old)) {",0,1,0.07142857142857142,141
678a8f06bef5b026f044eba73983363a64763e25,if (isRunning(old)) {,0,1,0.07142857142857142,142
678a8f06bef5b026f044eba73983363a64763e25,ReplicationController old = kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).get();,0,1,0.07142857142857142,143
678a8f06bef5b026f044eba73983363a64763e25,private boolean rollingUpgradePreserveScale = true;,0,1,0.07142857142857142,144
678a8f06bef5b026f044eba73983363a64763e25,if (!isAllowCreate()) {,1,1,0.07142857142857142,145
678a8f06bef5b026f044eba73983363a64763e25,},1,1,0.07142857142857142,146
678a8f06bef5b026f044eba73983363a64763e25,* The domain added to the service ID when creating OpenShift routes,1,1,0.07142857142857142,147
678a8f06bef5b026f044eba73983363a64763e25,RouteSpec routeSpec = new RouteSpec();,1,1,0.07142857142857142,148
678a8f06bef5b026f044eba73983363a64763e25,if (!ports.contains(80) && !ports.contains(443)) {,0,1,0.07142857142857142,149
678a8f06bef5b026f044eba73983363a64763e25,"public void applyList(KubernetesList list, String sourceName) throws Exception {",0,1,0.07142857142857142,150
678a8f06bef5b026f044eba73983363a64763e25,Route route = new Route();,0,1,0.07142857142857142,151
678a8f06bef5b026f044eba73983363a64763e25,"KubernetesHelper.setName(route, namespace, id + ""-route"");",0,1,0.07142857142857142,152
678a8f06bef5b026f044eba73983363a64763e25,"String host = Strings.stripSuffix(Strings.stripSuffix(id, ""-service""), ""."");",0,1,0.07142857142857142,153
678a8f06bef5b026f044eba73983363a64763e25,String json = null;,0,1,0.07142857142857142,154
678a8f06bef5b026f044eba73983363a64763e25,json = KubernetesHelper.toJson(route);,0,1,0.07142857142857142,155
678a8f06bef5b026f044eba73983363a64763e25,KubernetesClient api = getKubernetes();,1,1,0.07142857142857142,156
678a8f06bef5b026f044eba73983363a64763e25,List<Object> entities = list.getItems();,0,1,0.07142857142857142,157
678a8f06bef5b026f044eba73983363a64763e25,"if (Objects.equal(""Config"", kind) || Objects.equal(""List"", kind)) {",1,1,0.07142857142857142,158
678a8f06bef5b026f044eba73983363a64763e25,if (entities != null) {,0,1,0.07142857142857142,159
678a8f06bef5b026f044eba73983363a64763e25,for (Object entity : entities) {,0,1,0.07142857142857142,160
678a8f06bef5b026f044eba73983363a64763e25,},0,1,0.07142857142857142,161
678a8f06bef5b026f044eba73983363a64763e25,JsonNode tree = (JsonNode) dto;,1,1,0.07142857142857142,162
678a8f06bef5b026f044eba73983363a64763e25,"JsonNode kindNode = tree.get(""kind"");",1,1,0.07142857142857142,163
678a8f06bef5b026f044eba73983363a64763e25,if (kindNode != null) {,1,1,0.07142857142857142,164
678a8f06bef5b026f044eba73983363a64763e25,if (Strings.isNotBlank(id)) {,0,1,0.07142857142857142,165
678a8f06bef5b026f044eba73983363a64763e25,String id = KubernetesHelper.getId(service);,0,1,0.07142857142857142,166
678a8f06bef5b026f044eba73983363a64763e25,if (object instanceof Service) {,0,1,0.07142857142857142,167
678a8f06bef5b026f044eba73983363a64763e25,for (Object object : list) {,0,1,0.07142857142857142,168
678a8f06bef5b026f044eba73983363a64763e25,List<Route> routes = new ArrayList<>();,0,1,0.07142857142857142,169
678a8f06bef5b026f044eba73983363a64763e25,List<Route> items = routes.getItems();,0,1,0.07142857142857142,170
678a8f06bef5b026f044eba73983363a64763e25,if (routes != null) {,0,1,0.07142857142857142,171
678a8f06bef5b026f044eba73983363a64763e25,try {,0,1,0.07142857142857142,172
678a8f06bef5b026f044eba73983363a64763e25,if (Strings.isNullOrBlank(routeDomain)) {,0,1,0.07142857142857142,173
678a8f06bef5b026f044eba73983363a64763e25,"protected void createRoutes(KubernetesClient kubernetes, List<Object> list) {",0,1,0.07142857142857142,174
678a8f06bef5b026f044eba73983363a64763e25,},0,1,0.07142857142857142,175
678a8f06bef5b026f044eba73983363a64763e25,dto = list;,0,1,0.07142857142857142,176
678a8f06bef5b026f044eba73983363a64763e25,if (createRoutes) {,0,1,0.07142857142857142,177
678a8f06bef5b026f044eba73983363a64763e25,List<Object> list = KubernetesHelper.toItemList(dto);,0,1,0.07142857142857142,178
678a8f06bef5b026f044eba73983363a64763e25,* The domain added to the service ID when creating OpenShift routes,0,1,0.07142857142857142,179
678a8f06bef5b026f044eba73983363a64763e25,* Should we create routes for any services which don't already have them.,0,1,0.07142857142857142,180
678a8f06bef5b026f044eba73983363a64763e25,Set<Integer> ports = KubernetesHelper.getPorts(service);,0,1,0.07142857142857142,181
678a8f06bef5b026f044eba73983363a64763e25,String kind = kindNode.asText();,1,1,0.07142857142857142,182
678a8f06bef5b026f044eba73983363a64763e25,RouteList routes = kubernetes.getRoutes(namespace);,0,1,0.07142857142857142,183
678a8f06bef5b026f044eba73983363a64763e25,"Template template = createObjectMapper().treeToValue(tree, Template.class);",1,1,0.07142857142857142,184
678a8f06bef5b026f044eba73983363a64763e25,String id = KubernetesHelper.getName(service);,0,1,0.07142857142857142,185
678a8f06bef5b026f044eba73983363a64763e25,"if (""kubernetes"".equals(id) || ""kubernetes-ro"".equals(id)) {",0,1,0.07142857142857142,186
678a8f06bef5b026f044eba73983363a64763e25,},1,1,0.07142857142857142,187
678a8f06bef5b026f044eba73983363a64763e25,"protected static boolean shouldCreateRouteForService(Log log, Service service, String id) {",0,1,0.07142857142857142,188
678a8f06bef5b026f044eba73983363a64763e25,* @returns true if we should create an OpenShift Route for this service.,0,1,0.07142857142857142,189
678a8f06bef5b026f044eba73983363a64763e25,* Should we try to create a route for the given service?,0,1,0.07142857142857142,190
678a8f06bef5b026f044eba73983363a64763e25,},0,1,0.07142857142857142,191
678a8f06bef5b026f044eba73983363a64763e25,try {,0,1,0.07142857142857142,192
678a8f06bef5b026f044eba73983363a64763e25,String json = null;,0,1,0.07142857142857142,193
678a8f06bef5b026f044eba73983363a64763e25,"String host = Strings.stripSuffix(Strings.stripSuffix(id, ""-service""), ""."");",0,1,0.07142857142857142,194
678a8f06bef5b026f044eba73983363a64763e25,ObjectReference objectRef = new ObjectReference();,0,1,0.07142857142857142,195
678a8f06bef5b026f044eba73983363a64763e25,RouteSpec routeSpec = new RouteSpec();,0,1,0.07142857142857142,196
678a8f06bef5b026f044eba73983363a64763e25,"KubernetesHelper.setName(route, namespace, id + ""-route"");",0,1,0.07142857142857142,197
678a8f06bef5b026f044eba73983363a64763e25,route = new Route();,0,1,0.07142857142857142,198
678a8f06bef5b026f044eba73983363a64763e25,"if (Strings.isNotBlank(id) && shouldCreateRouteForService(log, service, id)) {",0,1,0.07142857142857142,199
678a8f06bef5b026f044eba73983363a64763e25,json = KubernetesHelper.toJson(route);,0,1,0.07142857142857142,200
678a8f06bef5b026f044eba73983363a64763e25,Route route = null;,0,1,0.07142857142857142,201
678a8f06bef5b026f044eba73983363a64763e25,Object dto = null;,1,1,0.07142857142857142,202
678a8f06bef5b026f044eba73983363a64763e25,"JsonNode items = entity.get(""items"");",1,1,0.07142857142857142,203
678a8f06bef5b026f044eba73983363a64763e25,"public void applyList(JsonNode entity, String sourceName) throws Exception {",1,1,0.07142857142857142,204
678a8f06bef5b026f044eba73983363a64763e25,if (route != null) {,0,1,0.07142857142857142,205
678a8f06bef5b026f044eba73983363a64763e25,if (items != null) {,1,1,0.07142857142857142,206
678a8f06bef5b026f044eba73983363a64763e25,for (JsonNode item : items) {,1,1,0.07142857142857142,207
678a8f06bef5b026f044eba73983363a64763e25,String json = item.toString();,1,1,0.07142857142857142,208
678a8f06bef5b026f044eba73983363a64763e25,// TODO the apply method should deal with the item direct?,1,1,0.07142857142857142,209
678a8f06bef5b026f044eba73983363a64763e25,try {,1,1,0.07142857142857142,210
678a8f06bef5b026f044eba73983363a64763e25,dto = loadJson(json);,1,1,0.07142857142857142,211
678a8f06bef5b026f044eba73983363a64763e25,if (dto != null) {,1,1,0.07142857142857142,212
678a8f06bef5b026f044eba73983363a64763e25,String routeDomainPostfix = this.routeDomain;,0,1,0.07142857142857142,213
678a8f06bef5b026f044eba73983363a64763e25,if (Strings.isNullOrBlank(routeDomainPostfix)) {,0,1,0.07142857142857142,214
678a8f06bef5b026f044eba73983363a64763e25,"Route route = createRouteForService(routeDomainPostfix, namespace, service, log);",0,1,0.07142857142857142,215
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).delete();,1,0,0.0,216
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""ReplicationController hasn't changed so not doing anything"");",0,0,0.0,217
678a8f06bef5b026f044eba73983363a64763e25,"doCreateReplicationController(replicationController, namespace, sourceName);",1,0,0.0,218
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""ReplicationController hasn't changed so not doing anything"");",1,0,0.0,219
678a8f06bef5b026f044eba73983363a64763e25,return rollingUpgrade;,0,0,0.0,220
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Warning not deleted any pods so they could well be running with the old configuration!"");",0,0,0.0,221
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.pods().inNamespace(namespace).withLabels(replicationController.getSpec().getSelector()).delete();,0,0,0.0,222
678a8f06bef5b026f044eba73983363a64763e25,"logGeneratedEntity(""Updated replicationController: "", namespace, replicationController, answer);",0,0,0.0,223
678a8f06bef5b026f044eba73983363a64763e25,"doCreateReplicationController(replicationController, namespace, sourceName);",0,0,0.0,224
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).delete();,0,0,0.0,225
678a8f06bef5b026f044eba73983363a64763e25,objectRef.setNamespace(namespace);,1,0,0.0,226
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).rolling().replace(replicationController);,0,0,0.0,227
678a8f06bef5b026f044eba73983363a64763e25,private boolean rollingUpgrade;,0,0,0.0,228
678a8f06bef5b026f044eba73983363a64763e25,return kubernetes;,1,0,0.0,229
678a8f06bef5b026f044eba73983363a64763e25,route.setSpec(routeSpec);,1,0,0.0,230
678a8f06bef5b026f044eba73983363a64763e25,routeSpec.setTo(objectRef);,1,0,0.0,231
678a8f06bef5b026f044eba73983363a64763e25,objectRef.setName(id);,1,0,0.0,232
678a8f06bef5b026f044eba73983363a64763e25,controller.setThrowExceptionOnError(failOnError);,1,0,0.0,233
678a8f06bef5b026f044eba73983363a64763e25,controller.setRecreateMode(recreate);,1,0,0.0,234
678a8f06bef5b026f044eba73983363a64763e25,private String routeDomain;,1,0,0.0,235
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.pods().inNamespace(namespace).withLabels(replicationController.getSpec().getSelector()).delete();,1,0,0.0,236
678a8f06bef5b026f044eba73983363a64763e25,private boolean failOnError;,1,0,0.0,237
678a8f06bef5b026f044eba73983363a64763e25,"logGeneratedEntity(""Updated replicationController: "", namespace, replicationController, answer);",1,0,0.0,238
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.PersistentVolumeClaimList;,1,0,0.0,239
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Warning not deleted any pods so they could well be running with the old configuration!"");",1,0,0.0,240
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.DoneablePersistentVolumeClaim;,1,0,0.0,241
678a8f06bef5b026f044eba73983363a64763e25,*/,1,0,0.0,242
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.pods().inNamespace(namespace).withLabels(replicationController.getSpec().getSelector()).delete();,1,0,0.0,243
678a8f06bef5b026f044eba73983363a64763e25,"logGeneratedEntity(""Updated replicationController: "", namespace, replicationController, answer);",1,0,0.0,244
678a8f06bef5b026f044eba73983363a64763e25,"doCreateReplicationController(replicationController, namespace, sourceName);",1,0,0.0,245
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).delete();,1,0,0.0,246
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""ReplicationController hasn't changed so not doing anything"");",1,0,0.0,247
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).rolling().replace(replicationController);,1,0,0.0,248
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.SecurityContextConstraints;,1,0,0.0,249
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.KubernetesResourceList;,1,0,0.0,250
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.Doneable;,1,0,0.0,251
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""ReplicationController hasn't changed so not doing anything"");",0,0,0.0,252
678a8f06bef5b026f044eba73983363a64763e25,return rollingUpgradePreserveScale;,0,0,0.0,253
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Warning not deleted any pods so they could well be running with the old configuration!"");",0,0,0.0,254
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.pods().inNamespace(namespace).withLabels(newSpec.getSelector()).delete();,0,0,0.0,255
678a8f06bef5b026f044eba73983363a64763e25,"logGeneratedEntity(""Updated replicationController: "", namespace, replicationController, answer);",0,0,0.0,256
678a8f06bef5b026f044eba73983363a64763e25,"doCreateReplicationController(replicationController, namespace, sourceName);",0,0,0.0,257
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).delete();,0,0,0.0,258
678a8f06bef5b026f044eba73983363a64763e25,kubernetesClient.replicationControllers().inNamespace(namespace).withName(id).rolling().replace(replicationController);,0,0,0.0,259
678a8f06bef5b026f044eba73983363a64763e25,newSpec.setReplicas(replicas);,0,0,0.0,260
678a8f06bef5b026f044eba73983363a64763e25,// lets preserve the number of replicas currently running in the environment we are about to upgrade,0,0,0.0,261
678a8f06bef5b026f044eba73983363a64763e25,private boolean recreate;,1,0,0.0,262
678a8f06bef5b026f044eba73983363a64763e25,routes.add(route);,0,0,0.0,263
678a8f06bef5b026f044eba73983363a64763e25,* Should we update resources by deleting them first and then creating them again?,1,0,0.0,264
678a8f06bef5b026f044eba73983363a64763e25,"createRoutes(kubernetes, list);",0,0,0.0,265
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.utils.Objects;,1,0,0.0,266
678a8f06bef5b026f044eba73983363a64763e25,import com.fasterxml.jackson.databind.JsonNode;,1,0,0.0,267
678a8f06bef5b026f044eba73983363a64763e25,"applyEntity(entity, sourceName);",0,0,0.0,268
678a8f06bef5b026f044eba73983363a64763e25,"applyList((KubernetesList) dto, sourceName);",0,0,0.0,269
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.KubernetesList;,0,0,0.0,270
678a8f06bef5b026f044eba73983363a64763e25,list.addAll(routes);,0,0,0.0,271
678a8f06bef5b026f044eba73983363a64763e25,route.setServiceName(id);,0,0,0.0,272
678a8f06bef5b026f044eba73983363a64763e25,// lets get the routes first to see if we should bother,0,0,0.0,273
678a8f06bef5b026f044eba73983363a64763e25,return;,0,0,0.0,274
678a8f06bef5b026f044eba73983363a64763e25,private String routeDomain;,0,0,0.0,275
678a8f06bef5b026f044eba73983363a64763e25,import static io.fabric8.kubernetes.api.KubernetesFactory.createObjectMapper;,1,0,0.0,276
678a8f06bef5b026f044eba73983363a64763e25,private boolean createRoutes;,0,0,0.0,277
678a8f06bef5b026f044eba73983363a64763e25,*/,0,0,0.0,278
678a8f06bef5b026f044eba73983363a64763e25,/**,0,0,0.0,279
678a8f06bef5b026f044eba73983363a64763e25,import java.util.List;,0,0,0.0,280
678a8f06bef5b026f044eba73983363a64763e25,import java.util.ArrayList;,0,0,0.0,281
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.openshift.api.model.RouteList;,0,0,0.0,282
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.openshift.api.model.Route;,0,0,0.0,283
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.kubernetes.api.model.Service;,0,0,0.0,284
678a8f06bef5b026f044eba73983363a64763e25,import com.fasterxml.jackson.core.JsonProcessingException;,0,0,0.0,285
678a8f06bef5b026f044eba73983363a64763e25,import java.io.IOException;,1,0,0.0,286
678a8f06bef5b026f044eba73983363a64763e25,"applyList(tree, sourceName);",1,0,0.0,287
678a8f06bef5b026f044eba73983363a64763e25,/**,1,0,0.0,288
678a8f06bef5b026f044eba73983363a64763e25,objectRef.setNamespace(namespace);,0,0,0.0,289
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.openshift.api.model.template.Template;,1,0,0.0,290
678a8f06bef5b026f044eba73983363a64763e25,return true;,0,0,0.0,291
678a8f06bef5b026f044eba73983363a64763e25,return false;,0,0,0.0,292
678a8f06bef5b026f044eba73983363a64763e25,*/,0,0,0.0,293
678a8f06bef5b026f044eba73983363a64763e25,*,0,0,0.0,294
678a8f06bef5b026f044eba73983363a64763e25,/**,0,0,0.0,295
678a8f06bef5b026f044eba73983363a64763e25,return route;,0,0,0.0,296
678a8f06bef5b026f044eba73983363a64763e25,route.setSpec(routeSpec);,0,0,0.0,297
678a8f06bef5b026f044eba73983363a64763e25,routeSpec.setTo(objectRef);,0,0,0.0,298
678a8f06bef5b026f044eba73983363a64763e25,objectRef.setName(id);,0,0,0.0,299
678a8f06bef5b026f044eba73983363a64763e25,"applyTemplate(template, sourceName);",1,0,0.0,300
678a8f06bef5b026f044eba73983363a64763e25,import java.util.Set;,0,0,0.0,301
678a8f06bef5b026f044eba73983363a64763e25,import org.apache.maven.plugin.logging.Log;,0,0,0.0,302
678a8f06bef5b026f044eba73983363a64763e25,import io.fabric8.openshift.api.model.template.Template;,0,0,0.0,303
678a8f06bef5b026f044eba73983363a64763e25,*/,1,0,0.0,304
678a8f06bef5b026f044eba73983363a64763e25,kubernetes.createConfig(entity);,1,0,0.0,305
678a8f06bef5b026f044eba73983363a64763e25,/*,1,0,0.0,306
678a8f06bef5b026f044eba73983363a64763e25,"apply(dto, sourceName);",1,0,0.0,307
678a8f06bef5b026f044eba73983363a64763e25,"LOG.debug(""Got item: {}"", json);",1,0,0.0,308
678a8f06bef5b026f044eba73983363a64763e25,// lets parse into a new object,1,0,0.0,309
678a8f06bef5b026f044eba73983363a64763e25,"LOG.info(""Warning not deleted any pods so they could well be running with the old configuration!"");",1,0,0.0,310
