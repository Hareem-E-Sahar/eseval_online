commit_id,line,line_level_label,count,line_score,row
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"//against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the ""legacy"" mode.",0,4,1.0,1
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"//against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the ""legacy"" mode.",1,4,1.0,2
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"//is unarchived, is the defaultReference, and is the selected filter category. We",1,3,0.75,3
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"//is unarchived, is the defaultReference, and is the selected filter category. We",1,3,0.75,4
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// We need to get the total number of records available because the entityList returned may not be the full set.,0,3,0.75,5
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"// If we have filter values, create the appropriate restrictions.",0,2,0.5,6
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than "" + queryLimit + "" products found to belong to the selected default categories(%s). This is a "" +",1,2,0.5,7
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than "" + queryLimit + "" products found to belong to the selected default categories(%s). This is a "" +",0,2,0.5,8
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than ""+queryLimit+"" products found to belong to the selected default categories(%s). This is a "" +",1,2,0.5,9
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"FilterAndSortCriteria filter = cto.get(""id"");",1,2,0.5,10
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than ""+queryLimit+"" products found to belong to the selected default categories(%s). This is a "" +",1,2,0.5,11
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than "" + queryLimit + "" products found to belong to the selected default categories(%s). This is a "" +",0,2,0.5,12
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// filter mapping to the cto.,0,2,0.5,13
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than "" + queryLimit + "" products found to belong to the selected default categories(%s). This is a "" +",0,2,0.5,14
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"FilterAndSortCriteria filter = cto.get(""id"");",0,2,0.5,15
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than 800 products found to belong to the selected default categories(%s). This is a "" +",0,2,0.5,16
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""more than 800 products found to belong to the selected default categories(%s). This is a "" +",0,2,0.5,17
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"// If we have any filtered products, clear out the associated filter and sort criteria values and add a new",0,2,0.5,18
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath, List directValues) {",0,1,0.25,19
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath,",1,1,0.25,20
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder,",1,1,0.25,21
d84cd698e4cffef5d0dddfd2148c3d009178e78e,boolean legacy = parentCategoryLegacyModeService.isLegacyMode();,1,1,0.25,22
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Make sure we have the actual product id.,0,1,0.25,23
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Field field = helper.getFieldManager().getField(SkuImpl.class, skuField);",0,1,0.25,24
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",0,1,0.25,25
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Apply the restrictions if any.,0,1,0.25,26
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Path skuFieldPath = root.get(skuField);,0,1,0.25,27
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",0,1,0.25,28
d84cd698e4cffef5d0dddfd2148c3d009178e78e,for (FilterAndSortCriteria filter : cto.getCriteriaMap().values()) {,1,1,0.25,29
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder,",1,1,0.25,30
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path explicitPath, List directValues) {",0,1,0.25,31
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",1,1,0.25,32
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path explicitPath, List directValues) {",1,1,0.25,33
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path explicitPath, List directValues) {",0,1,0.25,34
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder,",0,1,0.25,35
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath,",0,1,0.25,36
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",1,1,0.25,37
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path explicitPath, List directValues) {",1,1,0.25,38
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"// Check if we are only sorting/filtering on Sku related fields. If so, return the filtered product list.",0,1,0.25,39
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath,",1,1,0.25,40
d84cd698e4cffef5d0dddfd2148c3d009178e78e,FilterAndSortCriteria fasc = cto.getCriteriaMap().get(filterProperty);,0,1,0.25,41
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",0,1,0.25,42
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Setup the Sku query.,0,1,0.25,43
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",0,1,0.25,44
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Create a Dynamic Result Set from the entity list created above.,0,1,0.25,45
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path xRefCategoriesCategoryId = root.get(""allParentCategoryXrefs"").get(""category"").get(""id"");",0,1,0.25,46
d84cd698e4cffef5d0dddfd2148c3d009178e78e,FilterMapping filterMapping = new FilterMapping(),0,1,0.25,47
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",0,1,0.25,48
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path explicitPath, List directValues) {",0,1,0.25,49
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"LOG.warn(String.format(""Skipping default category filtering for product fetch query since there are "" +",0,1,0.25,50
d84cd698e4cffef5d0dddfd2148c3d009178e78e,FilterMapping filterMapping = new FilterMapping(),1,1,0.25,51
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",1,1,0.25,52
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//We want to limit the product we find to those who have a CategoryProductXref that,1,1,0.25,53
d84cd698e4cffef5d0dddfd2148c3d009178e78e,FilterMapping filterMapping = new FilterMapping(),0,1,0.25,54
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath, List directValues) {",1,1,0.25,55
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Path explicitPath, List directValues) {",0,1,0.25,56
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//We want to limit the product we find to those who have a CategoryProductXref that,1,1,0.25,57
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Convert the result list into a list of entities,0,1,0.25,58
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"// If a list of products was returned, use them instead of proceeding through the pipeline.",0,1,0.25,59
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"LOG.warn(String.format(""Skipping default category filtering for product fetch query since there are "" +",0,1,0.25,60
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath,",0,1,0.25,61
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder,",0,1,0.25,62
d84cd698e4cffef5d0dddfd2148c3d009178e78e,for (FilterAndSortCriteria filter : cto.getCriteriaMap().values()) {,0,1,0.25,63
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String fullPropertyName, Path explicitPath, List directValues) {",1,1,0.25,64
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,",1,1,0.25,65
d84cd698e4cffef5d0dddfd2148c3d009178e78e,FilterMapping filterMapping = new FilterMapping(),1,1,0.25,66
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (eagerFetchAssociations) {,1,0,0.0,67
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List directValues) {,1,0,0.0,68
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String ceilingEntity,",1,0,0.0,69
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"FieldPathBuilder fieldPathBuilder, From root,",1,0,0.0,70
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,1,0,0.0,71
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultSku"", JoinType.LEFT);",1,0,0.0,72
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,1,0,0.0,73
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withRestriction(new Restriction(),1,0,0.0,74
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(new EmptyFilterValues()),1,0,0.0,75
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getNonCountAdditionalFilterMappings().add(new FilterMapping(),1,0,0.0,76
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Long originalId = sandBoxHelper.getOriginalId(input);,0,0,0.0,77
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return new DynamicResultSet(null, new Entity[0],0);",1,0,0.0,78
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (!legacy) {,1,0,0.0,79
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getCriteriaMap().get(filterProperty).setFilterValues(Collections.<String>emptyList());,0,0,0.0,80
d84cd698e4cffef5d0dddfd2148c3d009178e78e,for (String filterProperty : filteredProperties) {,0,0,0.0,81
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"private void clearFilteredProperties(CriteriaTransferObject cto, Set<String> filteredProperties) {",0,0,0.0,82
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return productIds;,0,0,0.0,83
d84cd698e4cffef5d0dddfd2148c3d009178e78e,});,0,0,0.0,84
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return ((Product)input).getId().toString();,0,0,0.0,85
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return originalId.toString();,0,0,0.0,86
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (originalId != null) {,0,0,0.0,87
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return null;,1,0,0.0,88
d84cd698e4cffef5d0dddfd2148c3d009178e78e,public String transform(Object input) {,0,0,0.0,89
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultCategory"", JoinType.LEFT);",1,0,0.0,90
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (!hasExplicitSort) {,1,0,0.0,91
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},1,0,0.0,92
d84cd698e4cffef5d0dddfd2148c3d009178e78e,extensionManager.getProxy().initiateFetchState();,1,0,0.0,93
d84cd698e4cffef5d0dddfd2148c3d009178e78e,private List<String> buildProductIdList(List<Product> filterValues) {,0,0,0.0,94
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"@Resource(name = ""blSandBoxHelper"")",0,0,0.0,95
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.Map;,0,0,0.0,96
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.List;,0,0,0.0,97
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.ArrayList;,0,0,0.0,98
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.lang.reflect.Field;,0,0,0.0,99
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else {,1,0,0.0,100
d84cd698e4cffef5d0dddfd2148c3d009178e78e,extensionManager.getProxy().endFetchState();,1,0,0.0,101
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} finally {,1,0,0.0,102
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);",1,0,0.0,103
d84cd698e4cffef5d0dddfd2148c3d009178e78e,try {,1,0,0.0,104
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}),1,0,0.0,105
d84cd698e4cffef5d0dddfd2148c3d009178e78e,filter.setSortAscending(true);,1,0,0.0,106
d84cd698e4cffef5d0dddfd2148c3d009178e78e,filter.setNullsLast(false);,1,0,0.0,107
d84cd698e4cffef5d0dddfd2148c3d009178e78e,break;,1,0,0.0,108
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (hasExplicitSort) {,1,0,0.0,109
d84cd698e4cffef5d0dddfd2148c3d009178e78e,hasExplicitSort = filter.getSortDirection() != null;,1,0,0.0,110
d84cd698e4cffef5d0dddfd2148c3d009178e78e,boolean hasExplicitSort = false;,1,0,0.0,111
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//Add special handling for product list grid fetches,1,0,0.0,112
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"(!cto.getCriteriaMap().containsKey(""id"") || CollectionUtils.isEmpty(cto.getCriteriaMap().get(""id"").getFilterValues()))) {",1,0,0.0,113
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (ArrayUtils.isEmpty(persistencePackage.getSectionCrumbs()) &&,1,0,0.0,114
d84cd698e4cffef5d0dddfd2148c3d009178e78e,));,1,0,0.0,115
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"List<String> productIds = BLCCollectionUtils.collectList(filterValues, new TypedTransformer<String>() {",0,0,0.0,116
d84cd698e4cffef5d0dddfd2148c3d009178e78e,isSkuOnly = Boolean.FALSE;,0,0,0.0,117
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,0,0,0.0,118
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Boolean isSkuOnly = Boolean.TRUE;,0,0,0.0,119
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"private Map<String, Predicate> buildSkuRestrictions(CriteriaTransferObject cto, RecordHelper helper, CriteriaBuilder builder, CriteriaQuery<Product> criteria, Root<SkuImpl> root) {",0,0,0.0,120
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return isSkuOnly && (skuFilters > 0);,0,0,0.0,121
d84cd698e4cffef5d0dddfd2148c3d009178e78e,skuFilters++;,0,0,0.0,122
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else if (filterProperty.startsWith(DEFAULT_SKU)){,0,0,0.0,123
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return new DynamicResultSet(null, new Entity[0], 0);",0,0,0.0,124
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"&& !filterProperty.equals(""isLookup"")) {",0,0,0.0,125
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"&& !filterProperty.equals(""id"")",0,0,0.0,126
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (!filterProperty.startsWith(DEFAULT_SKU),0,0,0.0,127
d84cd698e4cffef5d0dddfd2148c3d009178e78e,for (String filterProperty : cto.getCriteriaMap().keySet()) {,0,0,0.0,128
d84cd698e4cffef5d0dddfd2148c3d009178e78e,int skuFilters = 0;,0,0,0.0,129
d84cd698e4cffef5d0dddfd2148c3d009178e78e,private Boolean isSkuOnlyFilter(CriteriaTransferObject cto) {,0,0,0.0,130
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity,",0,0,0.0,131
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"addSkuFilterMapping(cto, filteredProducts);",0,0,0.0,132
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"clearFilteredProperties(cto, restrictions.keySet());",0,0,0.0,133
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (filteredProducts.size() != 0) {,0,0,0.0,134
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return filteredProducts;,0,0,0.0,135
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (isSkuOnlyFilter(cto)) {,0,0,0.0,136
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Product> filteredProducts = query.getResultList();,0,0,0.0,137
d84cd698e4cffef5d0dddfd2148c3d009178e78e,TypedQuery<Product> query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);,0,0,0.0,138
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, Predicate> restrictions = buildSkuRestrictions(cto, helper, builder, criteria, root);",0,0,0.0,139
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Build our list of Sku related restrictions.,0,0,0.0,140
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"criteria.select(root.get(""defaultProduct"").as(Product.class));",0,0,0.0,141
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, Predicate> restrictions = new HashMap<>();",0,0,0.0,142
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (filterProperty.startsWith(DEFAULT_SKU)) {,0,0,0.0,143
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String skuField = filterProperty.replace(DEFAULT_SKU + ""."","""");",0,0,0.0,144
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (fasc.getFilterValues().size() > 0) {,0,0,0.0,145
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(productIds),0,0,0.0,146
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""id""))",0,0,0.0,147
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getAdditionalFilterMappings().add(new FilterMapping(),0,0,0.0,148
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<String> productIds = buildProductIdList(filterValues);,0,0,0.0,149
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"private void addSkuFilterMapping(CriteriaTransferObject cto, List<Product> filterValues) {",0,0,0.0,150
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return restrictions;,0,0,0.0,151
d84cd698e4cffef5d0dddfd2148c3d009178e78e,criteria.where(restrictions.values().toArray(new Predicate[restrictions.size()]));,0,0,0.0,152
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (restrictions.size() > 0) {,0,0,0.0,153
d84cd698e4cffef5d0dddfd2148c3d009178e78e,criteria.orderBy(builder.desc(skuFieldPath));,0,0,0.0,154
d84cd698e4cffef5d0dddfd2148c3d009178e78e,criteria.orderBy(builder.asc(skuFieldPath));,0,0,0.0,155
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (fasc.getSortAscending()) {,0,0,0.0,156
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (fasc.getSortDirection() != null) {,0,0,0.0,157
d84cd698e4cffef5d0dddfd2148c3d009178e78e,// Add sorting if applicable.,0,0,0.0,158
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.put(filterProperty, builder.between(skuFieldPath.as(BigDecimal.class), firstValue, secondValue));",0,0,0.0,159
d84cd698e4cffef5d0dddfd2148c3d009178e78e,BigDecimal secondValue = new BigDecimal(fasc.getFilterValues().get(1));,0,0,0.0,160
d84cd698e4cffef5d0dddfd2148c3d009178e78e,BigDecimal firstValue = new BigDecimal(fasc.getFilterValues().get(0));,0,0,0.0,161
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.put(filterProperty, builder.equal(skuFieldPath.as(String.class), fasc.getFilterValues().get(0)));",0,0,0.0,162
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (fasc.getFilterValues().size() == 1) {,0,0,0.0,163
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else if (field.getType().isAssignableFrom(BigDecimal.class)) {,0,0,0.0,164
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.put(filterProperty, builder.like(skuFieldPath.as(String.class), ""%"" + fasc.getFilterValues().get(0) + ""%""));",0,0,0.0,165
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (field.getType().isAssignableFrom(String.class)) {,0,0,0.0,166
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (productIds.size() == 0) {,0,0,0.0,167
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,1,0,0.0,168
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""id""))",0,0,0.0,169
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, FieldMetadata> adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);",0,0,0.0,170
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity, String fullPropertyName,",1,0,0.0,171
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,1,0,0.0,172
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,1,0,0.0,173
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.util.ModulePresentUtil;,1,0,0.0,174
d84cd698e4cffef5d0dddfd2148c3d009178e78e,catalogService.removeProduct(adminInstance);,0,0,0.0,175
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {",0,0,0.0,176
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return adminInstance;,0,0,0.0,177
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(type), primaryKey);",0,0,0.0,178
d84cd698e4cffef5d0dddfd2148c3d009178e78e,String type = entity.getType()[0];,0,0,0.0,179
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Object primaryKey = helper.getPrimaryKey(entity, adminProperties);",0,0,0.0,180
d84cd698e4cffef5d0dddfd2148c3d009178e78e,PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();,0,0,0.0,181
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},1,0,0.0,182
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Entity entity) throws ClassNotFoundException {,0,0,0.0,183
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper,",0,0,0.0,184
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"removeProduct(persistencePackage, adminInstance, helper);",0,0,0.0,185
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entity);",0,0,0.0,186
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"(!cto.getCriteriaMap().containsKey(""id"") || CollectionUtils.isEmpty(cto.getCriteriaMap().get(""id"").getFilterValues()))) {",0,0,0.0,187
d84cd698e4cffef5d0dddfd2148c3d009178e78e,));,0,0,0.0,188
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}),0,0,0.0,189
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return null;,0,0,0.0,190
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultCategory"", JoinType.LEFT);",0,0,0.0,191
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultSku"", JoinType.LEFT);",0,0,0.0,192
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,1,0,0.0,193
d84cd698e4cffef5d0dddfd2148c3d009178e78e,),1,0,0.0,194
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String ceilingEntity,",0,0,0.0,195
d84cd698e4cffef5d0dddfd2148c3d009178e78e,PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();,1,0,0.0,196
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"extensionManager.getProxy().manageRemove(persistencePackage, adminInstance);",1,0,0.0,197
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (extensionManager != null) {,1,0,0.0,198
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"protected void enterpriseRemove(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {",1,0,0.0,199
d84cd698e4cffef5d0dddfd2148c3d009178e78e,catalogService.removeProduct(adminInstance);,1,0,0.0,200
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else {,1,0,0.0,201
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"enterpriseRemove(persistencePackage, adminInstance, helper);",1,0,0.0,202
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if(ModulePresentUtil.isPresent(ModulePresentUtil.BroadleafModuleEnum.ENTERPRISE)) {,1,0,0.0,203
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);",1,0,0.0,204
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Object primaryKey = helper.getPrimaryKey(entity, adminProperties);",1,0,0.0,205
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, FieldMetadata> adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);",1,0,0.0,206
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"(!cto.getCriteriaMap().containsKey(""id"") || CollectionUtils.isEmpty(cto.getCriteriaMap().get(""id"").getFilterValues()))) {",1,0,0.0,207
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""filter query limitation."", joined));",1,0,0.0,208
d84cd698e4cffef5d0dddfd2148c3d009178e78e,));,1,0,0.0,209
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}),1,0,0.0,210
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return null;,1,0,0.0,211
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultCategory"", JoinType.LEFT);",1,0,0.0,212
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultSku"", JoinType.LEFT);",1,0,0.0,213
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List directValues) {,1,0,0.0,214
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String ceilingEntity,",1,0,0.0,215
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"FieldPathBuilder fieldPathBuilder, From root,",1,0,0.0,216
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withRestriction(new Restriction(),1,0,0.0,217
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(new EmptyFilterValues()),1,0,0.0,218
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List directValues) {,0,0,0.0,219
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"FieldPathBuilder fieldPathBuilder, From root,",0,0,0.0,220
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(productIds),0,0,0.0,221
d84cd698e4cffef5d0dddfd2148c3d009178e78e,*,0,0,0.0,222
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"@Resource(name=""blSandBoxHelper"")",1,0,0.0,223
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.Map;,1,0,0.0,224
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.List;,1,0,0.0,225
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.ArrayList;,1,0,0.0,226
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.lang.reflect.Field;,1,0,0.0,227
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.server.service.ValidationException;,1,0,0.0,228
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.dto.Property;,1,0,0.0,229
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.core.catalog.dao.ProductDao;,1,0,0.0,230
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"((BasicFieldMetadata) adminProperties.get(""defaultSku.retailPrice"")).setRequiredOverride(true);",0,0,0.0,231
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"((BasicFieldMetadata) adminProperties.get(""defaultSku.retailPrice"")).setRequiredOverride(false);",0,0,0.0,232
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, FieldMetadata> adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);",0,0,0.0,233
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return new DynamicResultSet(null, new Entity[0],0);",1,0,0.0,234
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);",0,0,0.0,235
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Entity entity = persistencePackage.getEntity();,0,0,0.0,236
d84cd698e4cffef5d0dddfd2148c3d009178e78e,);,0,0,0.0,237
d84cd698e4cffef5d0dddfd2148c3d009178e78e,),0,0,0.0,238
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},0,0,0.0,239
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,0,0,0.0,240
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity, String fullPropertyName,",0,0,0.0,241
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,0,0,0.0,242
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,0,0,0.0,243
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withRestriction(new Restriction(),0,0,0.0,244
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if(productIds.size() == 0){,1,0,0.0,245
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""id""))",1,0,0.0,246
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withRestriction(new Restriction(),0,0,0.0,247
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"((BasicFieldMetadata)adminProperties.get(""defaultSku.retailPrice"")).setRequiredOverride(false);",1,0,0.0,248
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(new EmptyFilterValues()),0,0,0.0,249
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""filter query limitation."", joined));",0,0,0.0,250
d84cd698e4cffef5d0dddfd2148c3d009178e78e,),0,0,0.0,251
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},0,0,0.0,252
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,0,0,0.0,253
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity, String fullPropertyName,",0,0,0.0,254
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,0,0,0.0,255
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,0,0,0.0,256
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.persistence.Status;,0,0,0.0,257
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"((BasicFieldMetadata)adminProperties.get(""defaultSku.retailPrice"")).setRequiredOverride(true);",1,0,0.0,258
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, FieldMetadata> adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);",1,0,0.0,259
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(productIds),1,0,0.0,260
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"removeBundleFieldRestrictions((ProductBundle)adminInstance, adminProperties, entity);",1,0,0.0,261
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Entity entity  = persistencePackage.getEntity();,1,0,0.0,262
d84cd698e4cffef5d0dddfd2148c3d009178e78e,);,1,0,0.0,263
d84cd698e4cffef5d0dddfd2148c3d009178e78e,),1,0,0.0,264
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},1,0,0.0,265
d84cd698e4cffef5d0dddfd2148c3d009178e78e,CriteriaQuery<Product> criteria = builder.createQuery(Product.class);,0,0,0.0,266
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity, String fullPropertyName,",1,0,0.0,267
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,1,0,0.0,268
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,1,0,0.0,269
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withRestriction(new Restriction(),1,0,0.0,270
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Root<SkuImpl> root = criteria.from(SkuImpl.class);,0,0,0.0,271
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (ArrayUtils.isEmpty(persistencePackage.getSectionCrumbs()) &&,0,0,0.0,272
d84cd698e4cffef5d0dddfd2148c3d009178e78e,CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();,0,0,0.0,273
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}));,1,0,0.0,274
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.sandbox.SandBoxHelper;,0,0,0.0,275
d84cd698e4cffef5d0dddfd2148c3d009178e78e,productIds.toArray(new Long[productIds.size()])));,1,0,0.0,276
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return explicitPath.in(sandBoxHelper.mergeCloneIds(ProductImpl.class,",1,0,0.0,277
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(filterValues),1,0,0.0,278
d84cd698e4cffef5d0dddfd2148c3d009178e78e,final List<Long> productIds = query.getResultList();,1,0,0.0,279
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,0,0,0.0,280
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(productIds),0,0,0.0,281
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));",0,0,0.0,282
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Long> productIds = query.getResultList();,0,0,0.0,283
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getAdditionalFilterMappings().add(filterMapping);,1,0,0.0,284
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},1,0,0.0,285
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.util.TypedTransformer;,0,0,0.0,286
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(sub);,1,0,0.0,287
d84cd698e4cffef5d0dddfd2148c3d009178e78e,sub.where(subRestrictions.toArray(new Predicate[subRestrictions.size()]));,1,0,0.0,288
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"QueryUtils.notArchived(builder, subRestrictions, subRoot, ""archiveStatus"");",1,0,0.0,289
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//archived?,1,0,0.0,290
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"subRestrictions.add(subRoot.get(""category"").get(""id"").in(directValues));",1,0,0.0,291
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"subRestrictions.add(builder.equal(subRoot.get(""defaultReference""), Boolean.TRUE));",1,0,0.0,292
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Predicate> subRestrictions = new ArrayList<Predicate>();,1,0,0.0,293
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"sub.select(subRoot.get(""id"").as(Long.class));",1,0,0.0,294
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Root<CategoryProductXrefImpl> subRoot = sub.from(CategoryProductXrefImpl.class);,1,0,0.0,295
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Subquery<Long> sub = fieldPathBuilder.getCriteria().subquery(Long.class);,1,0,0.0,296
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.util.BLCCollectionUtils;,0,0,0.0,297
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.hibernate.ejb.QueryHints;,0,0,0.0,298
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,0,0,0.0,299
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Root<CategoryProductXrefImpl> root = criteria.from(CategoryProductXrefImpl.class);,0,0,0.0,300
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (productIds.size() <= 800) {,0,0,0.0,301
d84cd698e4cffef5d0dddfd2148c3d009178e78e,final List<Long> productIds = query.getResultList();,0,0,0.0,302
d84cd698e4cffef5d0dddfd2148c3d009178e78e,TypedQuery<Long> query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);,0,0,0.0,303
d84cd698e4cffef5d0dddfd2148c3d009178e78e,criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));,0,0,0.0,304
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"QueryUtils.notArchived(builder, restrictions, root, ""archiveStatus"");",0,0,0.0,305
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//archived?,0,0,0.0,306
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.add(root.get(""category"").get(""id"").in(transformedValues));",0,0,0.0,307
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.add(builder.equal(root.get(""defaultReference""), Boolean.TRUE));",0,0,0.0,308
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Predicate> restrictions = new ArrayList<Predicate>();,0,0,0.0,309
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"criteria.select(root.get(""product"").get(""id"").as(Long.class));",0,0,0.0,310
d84cd698e4cffef5d0dddfd2148c3d009178e78e,CriteriaQuery<Long> criteria = builder.createQuery(Long.class);,0,0,0.0,311
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.TypedQuery;,0,0,0.0,312
d84cd698e4cffef5d0dddfd2148c3d009178e78e,CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();,0,0,0.0,313
d84cd698e4cffef5d0dddfd2148c3d009178e78e,});,0,0,0.0,314
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},0,0,0.0,315
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return Long.parseLong(((String) input));,0,0,0.0,316
d84cd698e4cffef5d0dddfd2148c3d009178e78e,public Long transform(Object input) {,0,0,0.0,317
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,0,0,0.0,318
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"List<Long> transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer<Long>() {",0,0,0.0,319
d84cd698e4cffef5d0dddfd2148c3d009178e78e,protected SandBoxHelper sandBoxHelper;,0,0,0.0,320
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"@Resource(name=""blSandBoxHelper"")",0,0,0.0,321
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.criteria.CriteriaQuery;,0,0,0.0,322
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//results.,1,0,0.0,323
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//do this in a subquery to avoid an additional join that would cause duplicate query,1,0,0.0,324
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity,",1,0,0.0,325
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.TypedQuery;,0,0,0.0,326
d84cd698e4cffef5d0dddfd2148c3d009178e78e,CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();,0,0,0.0,327
d84cd698e4cffef5d0dddfd2148c3d009178e78e,});,0,0,0.0,328
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},0,0,0.0,329
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return Long.parseLong(((String) input));,0,0,0.0,330
d84cd698e4cffef5d0dddfd2148c3d009178e78e,public Long transform(Object input) {,0,0,0.0,331
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,0,0,0.0,332
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"List<Long> transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer<Long>() {",0,0,0.0,333
d84cd698e4cffef5d0dddfd2148c3d009178e78e,protected SandBoxHelper sandBoxHelper;,0,0,0.0,334
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"@Resource(name=""blSandBoxHelper"")",0,0,0.0,335
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.criteria.CriteriaQuery;,0,0,0.0,336
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.hibernate.ejb.QueryHints;,0,0,0.0,337
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,1,0,0.0,338
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.util.TypedTransformer;,0,0,0.0,339
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.util.BLCCollectionUtils;,0,0,0.0,340
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.sandbox.SandBoxHelper;,0,0,0.0,341
d84cd698e4cffef5d0dddfd2148c3d009178e78e,);,1,0,0.0,342
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}),1,0,0.0,343
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.as(Long.class).in(directValues);,1,0,0.0,344
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""allParentCategoryXrefs.category.id""))",1,0,0.0,345
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;,1,0,0.0,346
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}));,0,0,0.0,347
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return xRefCategoriesCategoryId.as(Long.class).in(directValues);,0,0,0.0,348
d84cd698e4cffef5d0dddfd2148c3d009178e78e,CriteriaQuery<Long> criteria = builder.createQuery(Long.class);,0,0,0.0,349
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Root<CategoryProductXrefImpl> root = criteria.from(CategoryProductXrefImpl.class);,0,0,0.0,350
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"criteria.select(root.get(""product"").get(""id"").as(Long.class));",0,0,0.0,351
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Predicate> restrictions = new ArrayList<Predicate>();,0,0,0.0,352
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,1,0,0.0,353
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""allParentCategoryXrefs.id""))",1,0,0.0,354
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""filter query limitation."", joined));",0,0,0.0,355
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String joined = StringUtils.join(transformedValues, ',');",0,0,0.0,356
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else {,0,0,0.0,357
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getAdditionalFilterMappings().add(filterMapping);,0,0,0.0,358
d84cd698e4cffef5d0dddfd2148c3d009178e78e,);,0,0,0.0,359
d84cd698e4cffef5d0dddfd2148c3d009178e78e,),0,0,0.0,360
d84cd698e4cffef5d0dddfd2148c3d009178e78e,productIds.toArray(new Long[productIds.size()])));,0,0,0.0,361
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return explicitPath.in(sandBoxHelper.mergeCloneIds(ProductImpl.class,",0,0,0.0,362
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity, String fullPropertyName,",0,0,0.0,363
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,0,0,0.0,364
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""id""))",0,0,0.0,365
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (productIds.size() <= 800) {,0,0,0.0,366
d84cd698e4cffef5d0dddfd2148c3d009178e78e,final List<Long> productIds = query.getResultList();,0,0,0.0,367
d84cd698e4cffef5d0dddfd2148c3d009178e78e,TypedQuery<Long> query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);,0,0,0.0,368
d84cd698e4cffef5d0dddfd2148c3d009178e78e,criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));,0,0,0.0,369
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"QueryUtils.notArchived(builder, restrictions, root, ""archiveStatus"");",0,0,0.0,370
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//archived?,0,0,0.0,371
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.add(root.get(""category"").get(""id"").in(transformedValues));",0,0,0.0,372
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"restrictions.add(builder.equal(root.get(""defaultReference""), Boolean.TRUE));",0,0,0.0,373
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""id""))",0,0,0.0,374
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity, String fullPropertyName,",0,0,0.0,375
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"private List<Product> buildSkuFilters(CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao, RecordHelper helper) {",0,0,0.0,376
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String ceilingEntity,",0,0,0.0,377
d84cd698e4cffef5d0dddfd2148c3d009178e78e,hasExplicitSort = filter.getSortDirection() != null;,0,0,0.0,378
d84cd698e4cffef5d0dddfd2148c3d009178e78e,boolean hasExplicitSort = false;,0,0,0.0,379
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//Add special handling for product list grid fetches,0,0,0.0,380
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"(!cto.getCriteriaMap().containsKey(""id"") || CollectionUtils.isEmpty(cto.getCriteriaMap().get(""id"").getFilterValues()))) {",0,0,0.0,381
d84cd698e4cffef5d0dddfd2148c3d009178e78e,));,0,0,0.0,382
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}),0,0,0.0,383
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return null;,0,0,0.0,384
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultCategory"", JoinType.LEFT);",0,0,0.0,385
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"root.fetch(""defaultSku"", JoinType.LEFT);",0,0,0.0,386
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List directValues) {,0,0,0.0,387
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"FieldPathBuilder fieldPathBuilder, From root,",0,0,0.0,388
d84cd698e4cffef5d0dddfd2148c3d009178e78e,break;,0,0,0.0,389
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,0,0,0.0,390
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,0,0,0.0,391
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withRestriction(new Restriction(),0,0,0.0,392
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(new EmptyFilterValues()),0,0,0.0,393
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getNonCountAdditionalFilterMappings().add(new FilterMapping(),0,0,0.0,394
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (eagerFetchAssociations) {,0,0,0.0,395
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},0,0,0.0,396
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return new DynamicResultSet(null, new Entity[0], 0);",0,0,0.0,397
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"if (!setupNonLegacyProductCategory(cto, dynamicEntityDao)) {",0,0,0.0,398
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"public static final String DEFAULT_SKU = ""defaultSku"";",0,0,0.0,399
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (hasExplicitSort) {,0,0,0.0,400
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (!hasExplicitSort) {,0,0,0.0,401
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return explicitPath.in(sandBoxHelper.mergeCloneIds(ProductImpl.class,",0,0,0.0,402
d84cd698e4cffef5d0dddfd2148c3d009178e78e,try {,0,0,0.0,403
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return true;,0,0,0.0,404
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return false;,0,0,0.0,405
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (!isDefaultCategoryLegacyMode()) {,0,0,0.0,406
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"private boolean setupNonLegacyProductCategory(CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao) {",0,0,0.0,407
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"@SuppressWarnings(""unchecked"")",0,0,0.0,408
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else {,0,0,0.0,409
d84cd698e4cffef5d0dddfd2148c3d009178e78e,extensionManager.getProxy().endFetchState();,0,0,0.0,410
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} finally {,0,0,0.0,411
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);",0,0,0.0,412
d84cd698e4cffef5d0dddfd2148c3d009178e78e,extensionManager.getProxy().initiateFetchState();,0,0,0.0,413
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return resultSet;,0,0,0.0,414
d84cd698e4cffef5d0dddfd2148c3d009178e78e,filter.setNullsLast(false);,0,0,0.0,415
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"DynamicResultSet resultSet = new DynamicResultSet(entities, totalRecords);",0,0,0.0,416
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings);",0,0,0.0,417
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"List<FilterMapping> filterMappings = helper.getFilterMappings(persistencePerspective, cto, Product.class.getName(), originalProps);",0,0,0.0,418
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, FieldMetadata> originalProps = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);",0,0,0.0,419
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Entity[] entities = helper.getRecords(indexFieldMetadata, filteredProducts);",0,0,0.0,420
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"Map<String, FieldMetadata> indexFieldMetadata = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);",0,0,0.0,421
d84cd698e4cffef5d0dddfd2148c3d009178e78e,PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();,0,0,0.0,422
d84cd698e4cffef5d0dddfd2148c3d009178e78e,if (filteredProducts != null) {,0,0,0.0,423
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"List<Product> filteredProducts = buildSkuFilters(cto, dynamicEntityDao, helper);",0,0,0.0,424
d84cd698e4cffef5d0dddfd2148c3d009178e78e,filter.setSortAscending(true);,0,0,0.0,425
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.criteria.Subquery;,0,0,0.0,426
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.Tuple;,0,0,0.0,427
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.PersistenceContext;,0,0,0.0,428
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//do this in a subquery to avoid an additional join that would cause duplicate query,1,0,0.0,429
d84cd698e4cffef5d0dddfd2148c3d009178e78e,sub.where(subRestrictions.toArray(new Predicate[subRestrictions.size()]));,1,0,0.0,430
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"QueryUtils.notArchived(builder, subRestrictions, subRoot, ""archiveStatus"");",1,0,0.0,431
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//archived?,1,0,0.0,432
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"subRestrictions.add(subRoot.get(""category"").get(""id"").in(directValues));",1,0,0.0,433
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"subRestrictions.add(builder.equal(subRoot.get(""defaultReference""), Boolean.TRUE));",1,0,0.0,434
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Predicate> subRestrictions = new ArrayList<Predicate>();,1,0,0.0,435
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"sub.select(subRoot.get(""id"").as(Long.class));",1,0,0.0,436
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Root<CategoryProductXrefImpl> subRoot = sub.from(CategoryProductXrefImpl.class);,1,0,0.0,437
d84cd698e4cffef5d0dddfd2148c3d009178e78e,Subquery<Long> sub = fieldPathBuilder.getCriteria().subquery(Long.class);,1,0,0.0,438
d84cd698e4cffef5d0dddfd2148c3d009178e78e,//results.,1,0,0.0,439
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"From root, String ceilingEntity,",1,0,0.0,440
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import javax.persistence.EntityManager;,0,0,0.0,441
d84cd698e4cffef5d0dddfd2148c3d009178e78e,@Override,1,0,0.0,442
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withPredicateProvider(new PredicateProvider() {,1,0,0.0,443
d84cd698e4cffef5d0dddfd2148c3d009178e78e,".withFieldPath(new FieldPath().withTargetProperty(""allParentCategoryXrefs.id""))",1,0,0.0,444
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"""filter query limitation."", joined));",0,0,0.0,445
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"String joined = StringUtils.join(transformedValues, ',');",0,0,0.0,446
d84cd698e4cffef5d0dddfd2148c3d009178e78e,} else {,0,0,0.0,447
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getAdditionalFilterMappings().add(filterMapping);,0,0,0.0,448
d84cd698e4cffef5d0dddfd2148c3d009178e78e,);,0,0,0.0,449
d84cd698e4cffef5d0dddfd2148c3d009178e78e,),0,0,0.0,450
d84cd698e4cffef5d0dddfd2148c3d009178e78e,productIds.toArray(new Long[productIds.size()])));,0,0,0.0,451
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(sub);,1,0,0.0,452
d84cd698e4cffef5d0dddfd2148c3d009178e78e,},1,0,0.0,453
d84cd698e4cffef5d0dddfd2148c3d009178e78e,}));,1,0,0.0,454
d84cd698e4cffef5d0dddfd2148c3d009178e78e,cto.getAdditionalFilterMappings().add(filterMapping);,1,0,0.0,455
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.Set;,0,0,0.0,456
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.HashMap;,0,0,0.0,457
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.util.Collections;,0,0,0.0,458
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.math.BigDecimal;,0,0,0.0,459
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import java.io.Serializable;,0,0,0.0,460
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.RestrictionType;,0,0,0.0,461
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.server.domain.PersistencePackageRequest;,0,0,0.0,462
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.dto.SortDirection;,0,0,0.0,463
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.openadmin.dto.ClassMetadata;,0,0,0.0,464
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.core.search.domain.IndexField;,0,0,0.0,465
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.core.catalog.domain.SkuImpl;,0,0,0.0,466
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.sandbox.domain.SandBoxImpl;,0,0,0.0,467
d84cd698e4cffef5d0dddfd2148c3d009178e78e,import org.broadleafcommerce.common.filter.Filter;,0,0,0.0,468
d84cd698e4cffef5d0dddfd2148c3d009178e78e,productIds.toArray(new Long[productIds.size()])));,1,0,0.0,469
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"return explicitPath.in(sandBoxHelper.mergeCloneIds(ProductImpl.class,",1,0,0.0,470
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(filterValues),1,0,0.0,471
d84cd698e4cffef5d0dddfd2148c3d009178e78e,final List<Long> productIds = query.getResultList();,1,0,0.0,472
d84cd698e4cffef5d0dddfd2148c3d009178e78e,return explicitPath.in(directValues);,0,0,0.0,473
d84cd698e4cffef5d0dddfd2148c3d009178e78e,.withDirectFilterValues(productIds),0,0,0.0,474
d84cd698e4cffef5d0dddfd2148c3d009178e78e,"productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));",0,0,0.0,475
d84cd698e4cffef5d0dddfd2148c3d009178e78e,List<Long> productIds = query.getResultList();,0,0,0.0,476
d84cd698e4cffef5d0dddfd2148c3d009178e78e,helper.getCompatibleModule(OperationType.BASIC).remove(persistencePackage);,1,0,0.0,477
