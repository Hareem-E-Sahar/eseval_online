commit_id,line,line_level_label,count,line_score,row
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.agent = sriov_nic_agent.SriovNicSwitchAgent({}, {}, 0, {}, {})",0,5,1.0,1
b2f996346f738e5843a1206d331d866c3d2d22c2,"agent = sriov_nic_agent.SriovNicSwitchAgent({}, {}, 0, {}, {})",0,5,1.0,2
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron.common import config as common_config,1,4,0.8,3
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron_lib.placement import utils as place_utils,0,4,0.8,4
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron.common import utils as n_utils,0,4,0.8,5
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.agent = sriov_nic_agent.SriovNicSwitchAgent({}, {}, 0)",1,4,0.8,6
b2f996346f738e5843a1206d331d866c3d2d22c2,"agent = sriov_nic_agent.SriovNicSwitchAgent({}, {}, 0)",1,4,0.8,7
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron.common import constants as c_const,0,3,0.6000000000000001,8
b2f996346f738e5843a1206d331d866c3d2d22c2,"{}, {}, 0, {}, rp_inventory_values)",0,3,0.6000000000000001,9
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron.common import constants as c_const,0,3,0.6000000000000001,10
b2f996346f738e5843a1206d331d866c3d2d22c2,exists in device mappings,1,3,0.6000000000000001,11
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron.common import utils,1,3,0.6000000000000001,12
b2f996346f738e5843a1206d331d866c3d2d22c2,from neutron.plugins.ml2.drivers.mlnx.agent import config  # noqa,1,3,0.6000000000000001,13
b2f996346f738e5843a1206d331d866c3d2d22c2,from oslo_log import log as logging,1,3,0.6000000000000001,14
b2f996346f738e5843a1206d331d866c3d2d22c2,from oslo_config import cfg,1,3,0.6000000000000001,15
b2f996346f738e5843a1206d331d866c3d2d22c2,"""Device name %(dev_name)s is missing from """,0,2,0.4,16
b2f996346f738e5843a1206d331d866c3d2d22c2,"{}, {}, 0, rp_bandwidth, {})",0,2,0.4,17
b2f996346f738e5843a1206d331d866c3d2d22c2,agent = sriov_nic_agent.SriovNicSwitchAgent(,0,2,0.4,18
b2f996346f738e5843a1206d331d866c3d2d22c2,"raise ValueError(_(""Device name %(dev_name)s is missing from """,1,2,0.4,19
b2f996346f738e5843a1206d331d866c3d2d22c2,agent = mlnx_eswitch_neutron_agent.MlnxEswitchNeutronAgent(,1,2,0.4,20
b2f996346f738e5843a1206d331d866c3d2d22c2,exists in device mappings.,0,2,0.4,21
b2f996346f738e5843a1206d331d866c3d2d22c2,"from neutron.i18n import _LE, _LI",1,2,0.4,22
b2f996346f738e5843a1206d331d866c3d2d22c2,from networking_mlnx.plugins.ml2.drivers.mlnx.agent import (,1,2,0.4,23
b2f996346f738e5843a1206d331d866c3d2d22c2,self.rp_inventory_defaults = place_utils.parse_rp_inventory_defaults(,0,1,0.2,24
b2f996346f738e5843a1206d331d866c3d2d22c2,parser = sriov_nic_agent.SriovNicAgentConfigParser(),0,1,0.2,25
b2f996346f738e5843a1206d331d866c3d2d22c2,def test__validate_rp_in_dev_mappings(self):,0,1,0.2,26
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_inv_defaults = agent.agent_state['configurations'][,0,1,0.2,27
b2f996346f738e5843a1206d331d866c3d2d22c2,'reserved': 0,0,1,0.2,28
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_inventory_values = {,0,1,0.2,29
b2f996346f738e5843a1206d331d866c3d2d22c2,def test_configurations_has_rp_default_inventory(self):,0,1,0.2,30
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_bandwidths = agent.agent_state['configurations'][,0,1,0.2,31
b2f996346f738e5843a1206d331d866c3d2d22c2,"rp_bandwidth = {'ens7': {'egress': 10000, 'ingress': 10000}}",0,1,0.2,32
b2f996346f738e5843a1206d331d866c3d2d22c2,"polling_interval,",0,1,0.2,33
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_inventory_defaults = config_parser.rp_inventory_defaults,0,1,0.2,34
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_bandwidths = config_parser.rp_bandwidths,0,1,0.2,35
b2f996346f738e5843a1206d331d866c3d2d22c2,def test_configurations_has_rp_bandwidth(self):,0,1,0.2,36
b2f996346f738e5843a1206d331d866c3d2d22c2,self.rp_bandwidths = place_utils.parse_rp_bandwidths(,0,1,0.2,37
b2f996346f738e5843a1206d331d866c3d2d22c2,"LOG.info(_LI(""Interface mappings: %s""), interface_mappings)",1,1,0.2,38
b2f996346f738e5843a1206d331d866c3d2d22c2,"polling_interval, rp_bandwidths, rp_inventory_defaults):",0,1,0.2,39
b2f996346f738e5843a1206d331d866c3d2d22c2,import sys,1,1,0.2,40
b2f996346f738e5843a1206d331d866c3d2d22c2,LOG = logging.getLogger(__name__),1,1,0.2,41
b2f996346f738e5843a1206d331d866c3d2d22c2,def main():,1,1,0.2,42
b2f996346f738e5843a1206d331d866c3d2d22c2,except ValueError as e:,1,1,0.2,43
b2f996346f738e5843a1206d331d866c3d2d22c2,interface_mappings = utils.parse_mappings(,1,1,0.2,44
b2f996346f738e5843a1206d331d866c3d2d22c2,interface_mappings),1,1,0.2,45
b2f996346f738e5843a1206d331d866c3d2d22c2,except Exception as e:,1,1,0.2,46
b2f996346f738e5843a1206d331d866c3d2d22c2,"LOG.error(_LE(""Failed on Agent initialisation : %s. """,1,1,0.2,47
b2f996346f738e5843a1206d331d866c3d2d22c2,if __name__ == '__main__':,1,1,0.2,48
b2f996346f738e5843a1206d331d866c3d2d22c2,# you may not use this file except in compliance with the License.,1,1,0.2,49
b2f996346f738e5843a1206d331d866c3d2d22c2,agent.agent_state['configurations']),0,0,0.0,50
b2f996346f738e5843a1206d331d866c3d2d22c2,"'step_size': 1,",0,0,0.0,51
b2f996346f738e5843a1206d331d866c3d2d22c2,"'min_unit': 1,",0,0,0.0,52
b2f996346f738e5843a1206d331d866c3d2d22c2,"'allocation_ratio': 1.0,",0,0,0.0,53
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.assertEqual(rp_bandwidth['ens7'], rp_bandwidths['ens7'])",0,0,0.0,54
b2f996346f738e5843a1206d331d866c3d2d22c2,c_const.RP_BANDWIDTHS],0,0,0.0,55
b2f996346f738e5843a1206d331d866c3d2d22c2,polling_interval):,1,0,0.0,56
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.assertIn(c_const.RP_BANDWIDTHS,",0,0,0.0,57
b2f996346f738e5843a1206d331d866c3d2d22c2,polling_interval),1,0,0.0,58
b2f996346f738e5843a1206d331d866c3d2d22c2,dev_name}),1,0,0.0,59
b2f996346f738e5843a1206d331d866c3d2d22c2,"""physical_device_mappings"") % {'dev_name':",1,0,0.0,60
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.assertIn(c_const.RP_INVENTORY_DEFAULTS,",0,0,0.0,61
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_inventory_defaults),0,0,0.0,62
b2f996346f738e5843a1206d331d866c3d2d22c2,"rp_bandwidths,",0,0,0.0,63
b2f996346f738e5843a1206d331d866c3d2d22c2,},0,0,0.0,64
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.assertEqual(inv_value,",0,0,0.0,65
b2f996346f738e5843a1206d331d866c3d2d22c2,c_const.RP_INVENTORY_DEFAULTS],0,0,0.0,66
b2f996346f738e5843a1206d331d866c3d2d22c2,self.assertListEqual(,0,0,0.0,67
b2f996346f738e5843a1206d331d866c3d2d22c2,"sorted(list(rp_inventory_values)),",0,0,0.0,68
b2f996346f738e5843a1206d331d866c3d2d22c2,sorted(list(rp_inv_defaults.keys()))),0,0,0.0,69
b2f996346f738e5843a1206d331d866c3d2d22c2,"for inv_key, inv_value in rp_inventory_values.items():",0,0,0.0,70
b2f996346f738e5843a1206d331d866c3d2d22c2,rp_inv_defaults[inv_key]),0,0,0.0,71
b2f996346f738e5843a1206d331d866c3d2d22c2,class TestSriovNicAgentConfigParser(base.BaseTestCase):,0,0,0.0,72
b2f996346f738e5843a1206d331d866c3d2d22c2,with mock.patch.object(,0,0,0.0,73
b2f996346f738e5843a1206d331d866c3d2d22c2,"cfg.CONF.SRIOV_NIC, 'physical_device_mappings',",0,0,0.0,74
b2f996346f738e5843a1206d331d866c3d2d22c2,"new=[]), \",0,0,0.0,75
b2f996346f738e5843a1206d331d866c3d2d22c2,mock.patch.object(,0,0,0.0,76
b2f996346f738e5843a1206d331d866c3d2d22c2,"cfg.CONF.SRIOV_NIC, 'resource_provider_bandwidths',",0,0,0.0,77
b2f996346f738e5843a1206d331d866c3d2d22c2,new=['no_such_dev_in_dev_mappings:1:1']):,0,0,0.0,78
b2f996346f738e5843a1206d331d866c3d2d22c2,"""physical_device_mappings"") % {'dev_name': dev_name})",0,0,0.0,79
b2f996346f738e5843a1206d331d866c3d2d22c2,"n_utils.validate_rp_bandwidth(self.rp_bandwidths, dev_net_set)",0,0,0.0,80
b2f996346f738e5843a1206d331d866c3d2d22c2,"# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or",1,0,0.0,81
b2f996346f738e5843a1206d331d866c3d2d22c2,"""Invalid exclude_devices: """,0,0,0.0,82
b2f996346f738e5843a1206d331d866c3d2d22c2,try:,1,0,0.0,83
b2f996346f738e5843a1206d331d866c3d2d22c2,"# Copyright 2013 Mellanox Technologies, Ltd",1,0,0.0,84
b2f996346f738e5843a1206d331d866c3d2d22c2,#,1,0,0.0,85
b2f996346f738e5843a1206d331d866c3d2d22c2,"# Licensed under the Apache License, Version 2.0 (the ""License"");",1,0,0.0,86
b2f996346f738e5843a1206d331d866c3d2d22c2,# You may obtain a copy of the License at,1,0,0.0,87
b2f996346f738e5843a1206d331d866c3d2d22c2,#    http://www.apache.org/licenses/LICENSE-2.0,1,0,0.0,88
b2f996346f738e5843a1206d331d866c3d2d22c2,"# Unless required by applicable law or agreed to in writing, software",1,0,0.0,89
b2f996346f738e5843a1206d331d866c3d2d22c2,"# distributed under the License is distributed on an ""AS IS"" BASIS,",1,0,0.0,90
b2f996346f738e5843a1206d331d866c3d2d22c2,# implied.,1,0,0.0,91
b2f996346f738e5843a1206d331d866c3d2d22c2,# See the License for the specific language governing permissions and,1,0,0.0,92
b2f996346f738e5843a1206d331d866c3d2d22c2,# limitations under the License.,1,0,0.0,93
b2f996346f738e5843a1206d331d866c3d2d22c2,mlnx_eswitch_neutron_agent),1,0,0.0,94
b2f996346f738e5843a1206d331d866c3d2d22c2,common_config.init(sys.argv[1:]),1,0,0.0,95
b2f996346f738e5843a1206d331d866c3d2d22c2,common_config.setup_logging(),1,0,0.0,96
b2f996346f738e5843a1206d331d866c3d2d22c2,cfg.CONF.ESWITCH.physical_interface_mappings),1,0,0.0,97
b2f996346f738e5843a1206d331d866c3d2d22c2,raise ValueError(_(,0,0,0.0,98
b2f996346f738e5843a1206d331d866c3d2d22c2,"LOG.error(_LE(""Parsing physical_interface_mappings failed: %s. """,1,0,0.0,99
b2f996346f738e5843a1206d331d866c3d2d22c2,"""Agent terminated!""), e)",1,0,0.0,100
b2f996346f738e5843a1206d331d866c3d2d22c2,sys.exit(1),1,0,0.0,101
b2f996346f738e5843a1206d331d866c3d2d22c2,# Start everything.,1,0,0.0,102
b2f996346f738e5843a1206d331d866c3d2d22c2,"LOG.info(_LI(""Agent initialised successfully, now running... ""))",1,0,0.0,103
b2f996346f738e5843a1206d331d866c3d2d22c2,agent.run(),1,0,0.0,104
b2f996346f738e5843a1206d331d866c3d2d22c2,sys.exit(0),1,0,0.0,105
b2f996346f738e5843a1206d331d866c3d2d22c2,main(),1,0,0.0,106
b2f996346f738e5843a1206d331d866c3d2d22c2,"c_const.RP_BANDWIDTHS: rp_bandwidths,",0,0,0.0,107
b2f996346f738e5843a1206d331d866c3d2d22c2,"c_const.RP_INVENTORY_DEFAULTS: rp_inventory_defaults,",0,0,0.0,108
b2f996346f738e5843a1206d331d866c3d2d22c2,cfg.CONF.SRIOV_NIC.resource_provider_bandwidths),0,0,0.0,109
b2f996346f738e5843a1206d331d866c3d2d22c2,cfg.CONF.SRIOV_NIC.resource_provider_inventory_defaults),0,0,0.0,110
b2f996346f738e5843a1206d331d866c3d2d22c2,Validate that network_device in resource_provider_bandwidths,0,0,0.0,111
b2f996346f738e5843a1206d331d866c3d2d22c2,"self.assertRaises(ValueError, parser.parse)",0,0,0.0,112
