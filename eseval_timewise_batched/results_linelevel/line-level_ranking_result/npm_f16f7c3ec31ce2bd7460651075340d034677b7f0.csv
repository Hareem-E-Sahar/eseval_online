commit_id,line,line_level_label,count,line_score,row
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function installManyTop_ (what, where, family, ancestors, explicit, parent, cb) {",0,5,1.0,1
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function installMany (what, where, family, ancestors, explicit, parent, cb) {",0,5,1.0,2
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function installManyTop (what, where, family, ancestors, explicit, parent, cb_) {",0,4,0.8,3
f16f7c3ec31ce2bd7460651075340d034677b7f0,"installManyTop_(what, where, family, ancestors, explicit, parent, cb)",0,4,0.8,4
f16f7c3ec31ce2bd7460651075340d034677b7f0,"if (er) return installMany(what, where, family, ancestors, explicit, parent, cb)",0,4,0.8,5
f16f7c3ec31ce2bd7460651075340d034677b7f0,"return installMany(what, where, family, ancestors, explicit, parent, cb)",0,4,0.8,6
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function installManyTop_ (what, where, family, ancestors, explicit, cb) {",1,4,0.8,7
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function installMany (what, where, family, ancestors, explicit, cb) {",1,4,0.8,8
f16f7c3ec31ce2bd7460651075340d034677b7f0,// doing `npm install foo` inside of the foo project.  Print,0,3,0.6000000000000001,9
f16f7c3ec31ce2bd7460651075340d034677b7f0,// each target will be a data object corresponding,1,3,0.6000000000000001,10
f16f7c3ec31ce2bd7460651075340d034677b7f0,// Note: `npm install foo` inside of the `foo` package will abort,0,3,0.6000000000000001,11
f16f7c3ec31ce2bd7460651075340d034677b7f0,// each target will be a data object corresponding,0,3,0.6000000000000001,12
f16f7c3ec31ce2bd7460651075340d034677b7f0,"return installMany(what, where, family, ancestors, explicit, cb)",1,3,0.6000000000000001,13
f16f7c3ec31ce2bd7460651075340d034677b7f0,"if (er) return installMany(what, where, family, ancestors, explicit, cb)",1,3,0.6000000000000001,14
f16f7c3ec31ce2bd7460651075340d034677b7f0,"installManyTop_(what, where, family, ancestors, explicit, cb)",1,3,0.6000000000000001,15
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function installManyTop (what, where, family, ancestors, explicit, cb_) {",1,3,0.6000000000000001,16
f16f7c3ec31ce2bd7460651075340d034677b7f0,"t = d + ""@"" + t",1,2,0.4,17
f16f7c3ec31ce2bd7460651075340d034677b7f0,"installOne(target, where, newContext, cb)",1,2,0.4,18
f16f7c3ec31ce2bd7460651075340d034677b7f0,"asyncMap(targets, function (target, cb) {",1,2,0.4,19
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// to a package, folder, or whatever that is in the cache now.",1,2,0.4,20
f16f7c3ec31ce2bd7460651075340d034677b7f0,"installOne(target, where, newContext, cb)",0,2,0.4,21
f16f7c3ec31ce2bd7460651075340d034677b7f0,"asyncMap(targets, function (target, cb) {",0,2,0.4,22
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// to a package, folder, or whatever that is in the cache now.",0,2,0.4,23
f16f7c3ec31ce2bd7460651075340d034677b7f0,// only take the hit for readInstalled if there are probably bundled,0,2,0.4,24
f16f7c3ec31ce2bd7460651075340d034677b7f0,// is used *twice* here: to skip the first level of repetition.,0,2,0.4,25
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// leave things in an undefined state, but that's what is to be",0,2,0.4,26
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// we need to still fail here, but just skip the first level. Of",0,2,0.4,27
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// if it's identical to its parent, then it's probably someone",0,2,0.4,28
f16f7c3ec31ce2bd7460651075340d034677b7f0,"fn(args, where, family, ancestors, true, cb)",1,2,0.4,29
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function resultList (target, where, parent) {",1,2,0.4,30
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function resultList (target, where, parentId) {",0,2,0.4,31
f16f7c3ec31ce2bd7460651075340d034677b7f0,"target = dep + ""@"" + target",0,2,0.4,32
f16f7c3ec31ce2bd7460651075340d034677b7f0,"}), where, family, ancestors, false, data, cb)",0,2,0.4,33
f16f7c3ec31ce2bd7460651075340d034677b7f0,"fn(args, where, family, ancestors, true, data, cb)",0,2,0.4,34
f16f7c3ec31ce2bd7460651075340d034677b7f0,"cb(er, [resultList(target, where, parent && parent._id)])",0,2,0.4,35
f16f7c3ec31ce2bd7460651075340d034677b7f0,var parent = data,0,2,0.4,36
f16f7c3ec31ce2bd7460651075340d034677b7f0,"d.push(resultList(target, where, parent && parent._id))",0,2,0.4,37
f16f7c3ec31ce2bd7460651075340d034677b7f0,"t = d + ""@"" + t",0,2,0.4,38
f16f7c3ec31ce2bd7460651075340d034677b7f0,"target = dep + ""@"" + target",1,2,0.4,39
f16f7c3ec31ce2bd7460651075340d034677b7f0,"}), where, family, ancestors, false, cb)",1,2,0.4,40
f16f7c3ec31ce2bd7460651075340d034677b7f0,"return log.verbose(""installOne"", ""of"", target.name, ""to"", where, ""already in flight; waiting"")",0,1,0.2,41
f16f7c3ec31ce2bd7460651075340d034677b7f0,// expected when `--force` is used.  That is why getPrototypeOf,0,1,0.2,42
f16f7c3ec31ce2bd7460651075340d034677b7f0,// dependencies to read,0,1,0.2,43
f16f7c3ec31ce2bd7460651075340d034677b7f0,", parent: parent",0,1,0.2,44
f16f7c3ec31ce2bd7460651075340d034677b7f0,"}, cb)",0,1,0.2,45
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.verbose('install', what, 'is installed as', context.family[what])",0,1,0.2,46
f16f7c3ec31ce2bd7460651075340d034677b7f0,"""to"", where,",1,1,0.2,47
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.verbose(""installOne"", ""of"", target.name, ""to"", where, ""not in flight; installing"")",0,1,0.2,48
f16f7c3ec31ce2bd7460651075340d034677b7f0,targets.filter(function (t) { return t }).forEach(function (t) {,1,1,0.2,49
f16f7c3ec31ce2bd7460651075340d034677b7f0,", parent: parent",1,1,0.2,50
f16f7c3ec31ce2bd7460651075340d034677b7f0,"}, cb)",1,1,0.2,51
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// earlier if `--force` is not set.  However, if it IS set, then",0,1,0.2,52
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// course, it'll still fail eventually if it's a true cycle, and",0,1,0.2,53
f16f7c3ec31ce2bd7460651075340d034677b7f0,targets.filter(function (t) { return t }).forEach(function (t) {,0,1,0.2,54
f16f7c3ec31ce2bd7460651075340d034677b7f0,//,0,1,0.2,55
f16f7c3ec31ce2bd7460651075340d034677b7f0,"cb(er, [resultList(target, where, parent)])",1,1,0.2,56
f16f7c3ec31ce2bd7460651075340d034677b7f0,", targetResolver(where, family, ancestors, explicit, d, parent)",0,1,0.2,57
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.warn(""Refusing to install ""+what+"" as a dependency of itself""",0,1,0.2,58
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function targetResolver (where, family, ancestors, explicit, deps, parent) {",0,1,0.2,59
f16f7c3ec31ce2bd7460651075340d034677b7f0,var parent = data._id,1,1,0.2,60
f16f7c3ec31ce2bd7460651075340d034677b7f0,", targetResolver(where, family, ancestors, explicit, d)",1,1,0.2,61
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function targetResolver (where, family, ancestors, explicit, deps) {",1,1,0.2,62
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (er && parent && parent.optionalDependencies &&,0,1,0.2,63
f16f7c3ec31ce2bd7460651075340d034677b7f0,", prettyWhere && parent",1,1,0.2,64
f16f7c3ec31ce2bd7460651075340d034677b7f0,", parent && prettyWhere ]",1,1,0.2,65
f16f7c3ec31ce2bd7460651075340d034677b7f0,"d.push(resultList(target, where, parent))",1,1,0.2,66
f16f7c3ec31ce2bd7460651075340d034677b7f0,"// a warning, and skip it.",0,1,0.2,67
f16f7c3ec31ce2bd7460651075340d034677b7f0,"if (parent && parent.name === what && !npm.config.get(""force"")) {",0,1,0.2,68
f16f7c3ec31ce2bd7460651075340d034677b7f0,", wrap: newWrap }",0,0,0.0,69
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (!context.root) {,1,0,0.0,70
f16f7c3ec31ce2bd7460651075340d034677b7f0,", newAnc = Object.create(context.ancestors)",1,0,0.0,71
f16f7c3ec31ce2bd7460651075340d034677b7f0,var newPrev = Object.create(context.family),1,0,0.0,72
f16f7c3ec31ce2bd7460651075340d034677b7f0,"if (semver.validRange(family[d], true)) {",0,0,0.0,73
f16f7c3ec31ce2bd7460651075340d034677b7f0,else {,0,0,0.0,74
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (!cb_) {,0,0,0.0,75
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (isBundled || currentIsSatisfactory || deps[d.name] === d._resolved) {,0,0,0.0,76
f16f7c3ec31ce2bd7460651075340d034677b7f0,"var currentIsSatisfactory = semver.satisfies(d.version, deps[d.name] || ""*"", true)",0,0,0.0,77
f16f7c3ec31ce2bd7460651075340d034677b7f0,var isBundled = bd && bd.indexOf(d.name) !== -1,0,0,0.0,78
f16f7c3ec31ce2bd7460651075340d034677b7f0,var newWrap = wrapData && wrapData.dependencies,0,0,0.0,79
f16f7c3ec31ce2bd7460651075340d034677b7f0,", explicit: false",0,0,0.0,80
f16f7c3ec31ce2bd7460651075340d034677b7f0,", ancestors: newAnc",0,0,0.0,81
f16f7c3ec31ce2bd7460651075340d034677b7f0,var newContext = { family: newPrev,0,0,0.0,82
f16f7c3ec31ce2bd7460651075340d034677b7f0,: null,0,0,0.0,83
f16f7c3ec31ce2bd7460651075340d034677b7f0,? wrap[target.name].dependencies || {},0,0,0.0,84
f16f7c3ec31ce2bd7460651075340d034677b7f0,targets.forEach(function (t) {,1,0,0.0,85
f16f7c3ec31ce2bd7460651075340d034677b7f0,var wrapData = wrap ? wrap[target.name] : null,0,0,0.0,86
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.info(""installOne"", target._id)",0,0,0.0,87
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.info(""install"", ""%s into %s"", t._id, where)",0,0,0.0,88
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.silly(""install resolved"", targets)",0,0,0.0,89
f16f7c3ec31ce2bd7460651075340d034677b7f0,newPrev[t.name] = t.version,0,0,0.0,90
f16f7c3ec31ce2bd7460651075340d034677b7f0,targets.forEach(function (t) {,0,0,0.0,91
f16f7c3ec31ce2bd7460651075340d034677b7f0,newAnc[data.name] = data.version,1,0,0.0,92
f16f7c3ec31ce2bd7460651075340d034677b7f0,var newWrap = wrapData && wrapData.dependencies,1,0,0.0,93
f16f7c3ec31ce2bd7460651075340d034677b7f0,newPrev[t.name] = t.version,1,0,0.0,94
f16f7c3ec31ce2bd7460651075340d034677b7f0,}),1,0,0.0,95
f16f7c3ec31ce2bd7460651075340d034677b7f0,newPrev[bundle] = bundleData.version,0,0,0.0,96
f16f7c3ec31ce2bd7460651075340d034677b7f0,"""not in flight; installing""",1,0,0.0,97
f16f7c3ec31ce2bd7460651075340d034677b7f0,else log.verbose(,1,0,0.0,98
f16f7c3ec31ce2bd7460651075340d034677b7f0,),1,0,0.0,99
f16f7c3ec31ce2bd7460651075340d034677b7f0,"""already in flight; waiting""",1,0,0.0,100
f16f7c3ec31ce2bd7460651075340d034677b7f0,"""of"", target.name,",1,0,0.0,101
f16f7c3ec31ce2bd7460651075340d034677b7f0,"""installOne"",",1,0,0.0,102
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (!cb_) return log.verbose(,1,0,0.0,103
f16f7c3ec31ce2bd7460651075340d034677b7f0,deps[d.name] === d._resolved) {,1,0,0.0,104
f16f7c3ec31ce2bd7460651075340d034677b7f0,"semver.satisfies(d.version, deps[d.name] || ""*"", true) ||",1,0,0.0,105
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (bd && bd.indexOf(d.name) !== -1 ||,1,0,0.0,106
f16f7c3ec31ce2bd7460651075340d034677b7f0,", wrap: newWrap }",1,0,0.0,107
f16f7c3ec31ce2bd7460651075340d034677b7f0,", explicit: false",1,0,0.0,108
f16f7c3ec31ce2bd7460651075340d034677b7f0,", ancestors: newAnc",1,0,0.0,109
f16f7c3ec31ce2bd7460651075340d034677b7f0,var newContext = { family: newPrev,1,0,0.0,110
f16f7c3ec31ce2bd7460651075340d034677b7f0,: null,1,0,0.0,111
f16f7c3ec31ce2bd7460651075340d034677b7f0,? wrap[target.name].dependencies || {},1,0,0.0,112
f16f7c3ec31ce2bd7460651075340d034677b7f0,var wrapData = wrap ? wrap[target.name] : null,1,0,0.0,113
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.info(""installOne"", target._id)",1,0,0.0,114
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.info(""install"", ""%s into %s"", t._id, where)",1,0,0.0,115
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.silly(""install resolved"", targets)",1,0,0.0,116
f16f7c3ec31ce2bd7460651075340d034677b7f0,}),0,0,0.0,117
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.verbose(what, ""cache add"")",1,0,0.0,118
f16f7c3ec31ce2bd7460651075340d034677b7f0,"'was bundled with', data.name + '@' + data.version",0,0,0.0,119
f16f7c3ec31ce2bd7460651075340d034677b7f0,},1,0,0.0,120
f16f7c3ec31ce2bd7460651075340d034677b7f0,var p = Object.getPrototypeOf(Object.getPrototypeOf(ancestors)),0,0,0.0,121
f16f7c3ec31ce2bd7460651075340d034677b7f0,},0,0,0.0,122
f16f7c3ec31ce2bd7460651075340d034677b7f0,"return cb(null, [])",0,0,0.0,123
f16f7c3ec31ce2bd7460651075340d034677b7f0,",""install"")",0,0,0.0,124
f16f7c3ec31ce2bd7460651075340d034677b7f0,"//log.warn(d, ""write installMany cb"")",1,0,0.0,125
f16f7c3ec31ce2bd7460651075340d034677b7f0,"}), targetFolder, family, ancestors, false, function (er, d) {",1,0,0.0,126
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (er) return cb(er),1,0,0.0,127
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.verbose(what, ""into ""+where)",1,0,0.0,128
f16f7c3ec31ce2bd7460651075340d034677b7f0,"//log.warn(things, ""things"")",1,0,0.0,129
f16f7c3ec31ce2bd7460651075340d034677b7f0,"//log.warn(k, ""k"")",1,0,0.0,130
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (!parsed.protocol) {,1,0,0.0,131
f16f7c3ec31ce2bd7460651075340d034677b7f0,"'installMany', bundle + '@' + bundleData.version,",0,0,0.0,132
f16f7c3ec31ce2bd7460651075340d034677b7f0,"}), targetFolder, family, ancestors, false, target, function (er, d) {",0,0,0.0,133
f16f7c3ec31ce2bd7460651075340d034677b7f0,", parentId && prettyWhere ]",0,0,0.0,134
f16f7c3ec31ce2bd7460651075340d034677b7f0,", prettyWhere && parentId",0,0,0.0,135
f16f7c3ec31ce2bd7460651075340d034677b7f0,"return cb(null, [])",0,0,0.0,136
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.warn(what, ""optional dependency failed, continuing"")",0,0,0.0,137
f16f7c3ec31ce2bd7460651075340d034677b7f0,"parent.optionalDependencies.hasOwnProperty(what.split(""@"").shift())) {",0,0,0.0,138
f16f7c3ec31ce2bd7460651075340d034677b7f0,},0,0,0.0,139
f16f7c3ec31ce2bd7460651075340d034677b7f0,return cb(er),0,0,0.0,140
f16f7c3ec31ce2bd7460651075340d034677b7f0,"log.error(er, ""target resolver error"")",0,0,0.0,141
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (er) {,0,0,0.0,142
f16f7c3ec31ce2bd7460651075340d034677b7f0,var p = Object.getPrototypeOf(ancestors),1,0,0.0,143
f16f7c3ec31ce2bd7460651075340d034677b7f0,var bundled = data.bundleDependencies || data.bundledDependencies || [],0,0,0.0,144
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (bundled.length) {,0,0,0.0,145
f16f7c3ec31ce2bd7460651075340d034677b7f0,"readInstalled(where, { dev: true }, andBuildResolvedTree)",0,0,0.0,146
f16f7c3ec31ce2bd7460651075340d034677b7f0,""", but bundled package wasn't found in unpacked tree""",0,0,0.0,147
f16f7c3ec31ce2bd7460651075340d034677b7f0,log.warn(,0,0,0.0,148
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (!bundleData || !bundleData.version) {,0,0,0.0,149
f16f7c3ec31ce2bd7460651075340d034677b7f0,bundleData = current.devDependencies[bundle],0,0,0.0,150
f16f7c3ec31ce2bd7460651075340d034677b7f0,),0,0,0.0,151
f16f7c3ec31ce2bd7460651075340d034677b7f0,""", but wasn't found in dependencies. Trying devDependencies""",0,0,0.0,152
f16f7c3ec31ce2bd7460651075340d034677b7f0,data.name + '@' + data.version +,0,0,0.0,153
f16f7c3ec31ce2bd7460651075340d034677b7f0,"'installMany', bundle, 'was bundled with',",0,0,0.0,154
f16f7c3ec31ce2bd7460651075340d034677b7f0,log.verbose(,0,0,0.0,155
f16f7c3ec31ce2bd7460651075340d034677b7f0,if ((!bundleData || !bundleData.version) && current.devDependencies) {,0,0,0.0,156
f16f7c3ec31ce2bd7460651075340d034677b7f0,var bundleData = current.dependencies[bundle],0,0,0.0,157
f16f7c3ec31ce2bd7460651075340d034677b7f0,bundled.forEach(function (bundle) {,0,0,0.0,158
f16f7c3ec31ce2bd7460651075340d034677b7f0,newAnc[data.name] = data.version,0,0,0.0,159
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (!context.root) {,0,0,0.0,160
f16f7c3ec31ce2bd7460651075340d034677b7f0,", newAnc = Object.create(context.ancestors)",0,0,0.0,161
f16f7c3ec31ce2bd7460651075340d034677b7f0,var newPrev = Object.create(context.family),0,0,0.0,162
f16f7c3ec31ce2bd7460651075340d034677b7f0,if (er) return cb(er),0,0,0.0,163
f16f7c3ec31ce2bd7460651075340d034677b7f0,"function andBuildResolvedTree (er, current) {",0,0,0.0,164
f16f7c3ec31ce2bd7460651075340d034677b7f0,},0,0,0.0,165
f16f7c3ec31ce2bd7460651075340d034677b7f0,andBuildResolvedTree(),0,0,0.0,166
f16f7c3ec31ce2bd7460651075340d034677b7f0,} else {,0,0,0.0,167
f16f7c3ec31ce2bd7460651075340d034677b7f0,"if (semver.validRange(family[d], true))",1,0,0.0,168
